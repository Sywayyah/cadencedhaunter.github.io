import{$ as ip,$a as bs,$b as kt,A as v,Aa as Oe,Ab as Ei,B as Ye,Ba as Tt,Bb as $e,C as Le,Ca as $a,Cb as xp,D as Ni,Da as ut,Db as kr,E as Ql,Ea as dt,Eb as Ve,F as Kl,Fa as a,Fb as Gn,G as ji,Ga as c,Gb as $i,H as E,Ha as h,Hb as fi,I,Ia as ve,Ib as bp,J as Zl,Ja as Ce,Jb as F,K as ft,Ka as be,Kb as D,L as ws,La as R,Lb as _p,M as Dr,Ma as S,Mb as Mp,N as bt,Na as m,Nb as Gr,O as ti,Oa as ii,Ob as Pp,P as Er,Pa as Ft,Pb as V,Q as Xl,Qa as Or,Qb as Dp,R as Z,Ra as De,Rb as Ep,S as ht,Sa as Ee,Sb as Ip,T as Jl,Ta as Ie,Tb as oo,U as xs,Ua as ne,Ub as Tp,V as ep,Va as d,Vb as _t,W as Ir,Wa as H,Wb as gt,X as Na,Xa as M,Xb as Fp,Y as Fn,Ya as me,Yb as Qe,Z as Tr,Za as dp,Zb as cn,_ as tp,_a as mp,_b as Ot,a as P,aa as np,ab as Re,ac as K,b as N,ba as rp,bb as Ue,bc as Ap,c as _r,ca as op,cb as $t,cc as we,d as jl,da as sp,db as re,dc as Op,e as $l,ea as ap,eb as oe,f as Dt,fa as An,fb as Q,g as Et,ga as jt,gb as fp,h as Li,ha as Fr,hb as _s,i as Mr,ia as On,ib as Ms,j as It,ja as l,jb as Va,k as Vl,ka as y,kb as hp,l as Tn,la as Ar,lb as gp,m as Pr,ma as cp,mb as yp,n as zl,na as je,nb as vp,o as et,oa as Mi,ob as mi,p as Wl,pa as Pi,pb as Cp,q as bi,qa as j,qb as za,r as sn,ra as lp,rb as Sp,s as ql,sa as pp,sb as wp,t as Yl,ta as g,tb as Te,u as O,ua as ja,ub as Ps,v as qe,va as u,vb as Wa,w as _i,wa as $,wb as Di,x,xa as de,xb as kn,y as L,ya as up,yb as At,z as ro,za as an,zb as W}from"./chunk-XQMWGCAB.js";var Hp=null;function Is(){return Hp}function Lp(i){Hp??=i}var Ds=class{};var Vi=new _i("");function Np(i,e){e=encodeURIComponent(e);for(let r of i.split(";")){let t=r.indexOf("="),[n,o]=t==-1?[r,""]:[r.slice(0,t),r.slice(t+1)];if(n.trim()===e)return decodeURIComponent(o)}return null}var qa=/\s+/,kp=[],hi=(()=>{let e=class e{constructor(t,n){this._ngEl=t,this._renderer=n,this.initialClasses=kp,this.stateMap=new Map}set klass(t){this.initialClasses=t!=null?t.trim().split(qa):kp}set ngClass(t){this.rawClass=typeof t=="string"?t.trim().split(qa):t}ngDoCheck(){for(let n of this.initialClasses)this._updateState(n,!0);let t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(let n of t)this._updateState(n,!0);else if(t!=null)for(let n of Object.keys(t))this._updateState(n,!!t[n]);this._applyStateDiff()}_updateState(t,n){let o=this.stateMap.get(t);o!==void 0?(o.enabled!==n&&(o.changed=!0,o.enabled=n),o.touched=!0):this.stateMap.set(t,{enabled:n,changed:!0,touched:!0})}_applyStateDiff(){for(let t of this.stateMap){let n=t[0],o=t[1];o.changed?(this._toggleClass(n,o.enabled),o.changed=!1):o.touched||(o.enabled&&this._toggleClass(n,!1),this.stateMap.delete(n)),o.touched=!1}}_toggleClass(t,n){t=t.trim(),t.length>0&&t.split(qa).forEach(o=>{n?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}};e.\u0275fac=function(n){return new(n||e)(y(ht),y(je))},e.\u0275dir=Le({type:e,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"},standalone:!0});let i=e;return i})(),jp=(()=>{let e=class e{constructor(t){this._viewContainerRef=t,this.ngComponentOutlet=null,this._inputsUsed=new Map}_needToReCreateNgModuleInstance(t){return t.ngComponentOutletNgModule!==void 0||t.ngComponentOutletNgModuleFactory!==void 0}_needToReCreateComponentInstance(t){return t.ngComponentOutlet!==void 0||t.ngComponentOutletContent!==void 0||t.ngComponentOutletInjector!==void 0||this._needToReCreateNgModuleInstance(t)}ngOnChanges(t){if(this._needToReCreateComponentInstance(t)&&(this._viewContainerRef.clear(),this._inputsUsed.clear(),this._componentRef=void 0,this.ngComponentOutlet)){let n=this.ngComponentOutletInjector||this._viewContainerRef.parentInjector;this._needToReCreateNgModuleInstance(t)&&(this._moduleRef?.destroy(),this.ngComponentOutletNgModule?this._moduleRef=pp(this.ngComponentOutletNgModule,Gp(n)):this.ngComponentOutletNgModuleFactory?this._moduleRef=this.ngComponentOutletNgModuleFactory.create(Gp(n)):this._moduleRef=void 0),this._componentRef=this._viewContainerRef.createComponent(this.ngComponentOutlet,{injector:n,ngModuleRef:this._moduleRef,projectableNodes:this.ngComponentOutletContent})}}ngDoCheck(){if(this._componentRef){if(this.ngComponentOutletInputs)for(let t of Object.keys(this.ngComponentOutletInputs))this._inputsUsed.set(t,!0);this._applyInputStateDiff(this._componentRef)}}ngOnDestroy(){this._moduleRef?.destroy()}_applyInputStateDiff(t){for(let[n,o]of this._inputsUsed)o?(t.setInput(n,this.ngComponentOutletInputs[n]),this._inputsUsed.set(n,!1)):(t.setInput(n,void 0),this._inputsUsed.delete(n))}};e.\u0275fac=function(n){return new(n||e)(y(Mi))},e.\u0275dir=Le({type:e,selectors:[["","ngComponentOutlet",""]],inputs:{ngComponentOutlet:"ngComponentOutlet",ngComponentOutletInputs:"ngComponentOutletInputs",ngComponentOutletInjector:"ngComponentOutletInjector",ngComponentOutletContent:"ngComponentOutletContent",ngComponentOutletNgModule:"ngComponentOutletNgModule",ngComponentOutletNgModuleFactory:"ngComponentOutletNgModuleFactory"},standalone:!0,features:[ji]});let i=e;return i})();function Gp(i){return i.get(lp).injector}var Ya=class{constructor(e,r,t,n){this.$implicit=e,this.ngForOf=r,this.index=t,this.count=n}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},q=(()=>{let e=class e{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,n,o){this._viewContainer=t,this._template=n,this._differs=o,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let t=this._ngForOf;if(!this._differ&&t)if(0)try{}catch{}else this._differ=this._differs.find(t).create(this.ngForTrackBy)}if(this._differ){let t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){let n=this._viewContainer;t.forEachOperation((o,s,p)=>{if(o.previousIndex==null)n.createEmbeddedView(this._template,new Ya(o.item,this._ngForOf,-1,-1),p===null?void 0:p);else if(p==null)n.remove(s===null?void 0:s);else if(s!==null){let f=n.get(s);n.move(f,p),Rp(f,o)}});for(let o=0,s=n.length;o<s;o++){let f=n.get(o).context;f.index=o,f.count=s,f.ngForOf=this._ngForOf}t.forEachIdentityChange(o=>{let s=n.get(o.currentIndex);Rp(s,o)})}static ngTemplateContextGuard(t,n){return!0}};e.\u0275fac=function(n){return new(n||e)(y(Mi),y(Ar),y(Cp))},e.\u0275dir=Le({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0});let i=e;return i})();function Rp(i,e){i.context.$implicit=e.item}var se=(()=>{let e=class e{constructor(t,n){this._viewContainer=t,this._context=new Qa,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=n}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){Up("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){Up("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,n){return!0}};e.\u0275fac=function(n){return new(n||e)(y(Mi),y(Ar))},e.\u0275dir=Le({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let i=e;return i})(),Qa=class{constructor(){this.$implicit=null,this.ngIf=null}};function Up(i,e){if(!!!(!e||e.createEmbeddedView))throw new Error(`${i} must be a TemplateRef, but received '${ql(e)}'.`)}var Ka=class{constructor(e,r){this._viewContainerRef=e,this._templateRef=r,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(e){e&&!this._created?this.create():!e&&this._created&&this.destroy()}},gi=(()=>{let e=class e{constructor(){this._defaultViews=[],this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(t){this._ngSwitch=t,this._caseCount===0&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(t){this._defaultViews.push(t)}_matchCase(t){let n=t===this._ngSwitch;return this._lastCasesMatched||=n,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),n}_updateDefaultCases(t){if(this._defaultViews.length>0&&t!==this._defaultUsed){this._defaultUsed=t;for(let n of this._defaultViews)n.enforceState(t)}}};e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=Le({type:e,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0});let i=e;return i})(),ln=(()=>{let e=class e{constructor(t,n,o){this.ngSwitch=o,o._addCase(),this._view=new Ka(t,n)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}};e.\u0275fac=function(n){return new(n||e)(y(Mi),y(Ar),y(gi,9))},e.\u0275dir=Le({type:e,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0});let i=e;return i})();var pn=(()=>{let e=class e{constructor(t,n,o){this._ngEl=t,this._differs=n,this._renderer=o,this._ngStyle=null,this._differ=null}set ngStyle(t){this._ngStyle=t,!this._differ&&t&&(this._differ=this._differs.find(t).create())}ngDoCheck(){if(this._differ){let t=this._differ.diff(this._ngStyle);t&&this._applyChanges(t)}}_setStyle(t,n){let[o,s]=t.split("."),p=o.indexOf("-")===-1?void 0:On.DashCase;n!=null?this._renderer.setStyle(this._ngEl.nativeElement,o,s?`${n}${s}`:n,p):this._renderer.removeStyle(this._ngEl.nativeElement,o,p)}_applyChanges(t){t.forEachRemovedItem(n=>this._setStyle(n.key,null)),t.forEachAddedItem(n=>this._setStyle(n.key,n.currentValue)),t.forEachChangedItem(n=>this._setStyle(n.key,n.currentValue))}};e.\u0275fac=function(n){return new(n||e)(y(ht),y(za),y(je))},e.\u0275dir=Le({type:e,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0});let i=e;return i})(),yt=(()=>{let e=class e{constructor(t){this._viewContainerRef=t,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(t){if(this._shouldRecreateView(t)){let n=this._viewContainerRef;if(this._viewRef&&n.remove(n.indexOf(this._viewRef)),!this.ngTemplateOutlet){this._viewRef=null;return}let o=this._createContextForwardProxy();this._viewRef=n.createEmbeddedView(this.ngTemplateOutlet,o,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(t){return!!t.ngTemplateOutlet||!!t.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(t,n,o)=>this.ngTemplateOutletContext?Reflect.set(this.ngTemplateOutletContext,n,o):!1,get:(t,n,o)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,n,o)}})}};e.\u0275fac=function(n){return new(n||e)(y(Mi))},e.\u0275dir=Le({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[ji]});let i=e;return i})();function jm(i,e){return new bi(2100,!1)}var Za=class{createSubscription(e,r){return Ps(()=>e.subscribe({next:r,error:t=>{throw t}}))}dispose(e){Ps(()=>e.unsubscribe())}},Xa=class{createSubscription(e,r){return e.then(r,t=>{throw t})}dispose(e){}},$m=new Xa,Vm=new Za,yi=(()=>{let e=class e{constructor(t){this._latestValue=null,this.markForCheckOnValueUpdate=!0,this._subscription=null,this._obj=null,this._strategy=null,this._ref=t}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(t){if(!this._obj){if(t)try{this.markForCheckOnValueUpdate=!1,this._subscribe(t)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,n=>this._updateLatestValue(t,n))}_selectStrategy(t){if(hp(t))return $m;if(gp(t))return Vm;throw jm(e,t)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,n){t===this._obj&&(this._latestValue=n,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}};e.\u0275fac=function(n){return new(n||e)(y(mi,16))},e.\u0275pipe=Ni({name:"async",type:e,pure:!1,standalone:!0});let i=e;return i})();function zm(i,e){return{key:i,value:e}}var ni=(()=>{let e=class e{constructor(t){this.differs=t,this.keyValues=[],this.compareFn=Bp}transform(t,n=Bp){if(!t||!(t instanceof Map)&&typeof t!="object")return null;this.differ??=this.differs.find(t).create();let o=this.differ.diff(t),s=n!==this.compareFn;return o&&(this.keyValues=[],o.forEachItem(p=>{this.keyValues.push(zm(p.key,p.currentValue))})),(o||s)&&(this.keyValues.sort(n),this.compareFn=n),this.keyValues}};e.\u0275fac=function(n){return new(n||e)(y(za,16))},e.\u0275pipe=Ni({name:"keyvalue",type:e,pure:!1,standalone:!0});let i=e;return i})();function Bp(i,e){let r=i.key,t=e.key;if(r===t)return 0;if(r===void 0)return 1;if(t===void 0)return-1;if(r===null)return 1;if(t===null)return-1;if(typeof r=="string"&&typeof t=="string")return r<t?-1:1;if(typeof r=="number"&&typeof t=="number")return r-t;if(typeof r=="boolean"&&typeof t=="boolean")return r<t?-1:1;let n=String(r),o=String(t);return n==o?0:n<o?-1:1}var vt=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ye({type:e}),e.\u0275inj=qe({});let i=e;return i})(),$p="browser",Wm="server";function Ja(i){return i===Wm}var Es=class{};var ic=class extends Ds{constructor(){super(...arguments),this.supportsDOMEvents=!0}},nc=class i extends ic{static makeCurrent(){Lp(new i)}onAndCancel(e,r,t){return e.addEventListener(r,t),()=>{e.removeEventListener(r,t)}}dispatchEvent(e,r){e.dispatchEvent(r)}remove(e){e.remove()}createElement(e,r){return r=r||this.getDefaultDocument(),r.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,r){return r==="window"?window:r==="document"?e:r==="body"?e.body:null}getBaseHref(e){let r=Ym();return r==null?null:Qm(r)}resetBaseElement(){so=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Np(document.cookie,e)}},so=null;function Ym(){return so=so||document.querySelector("base"),so?so.getAttribute("href"):null}function Qm(i){return new URL(i,document.baseURI).pathname}var rc=class{addToWindow(e){sn.getAngularTestability=(t,n=!0)=>{let o=e.findTestabilityInTree(t,n);if(o==null)throw new bi(5103,!1);return o},sn.getAllAngularTestabilities=()=>e.getAllTestabilities(),sn.getAllAngularRootElements=()=>e.getAllRootElements();let r=t=>{let n=sn.getAllAngularTestabilities(),o=n.length,s=function(){o--,o==0&&t()};n.forEach(p=>{p.whenStable(s)})};sn.frameworkStabilizers||(sn.frameworkStabilizers=[]),sn.frameworkStabilizers.push(r)}findTestabilityInTree(e,r,t){if(r==null)return null;let n=e.getTestability(r);return n??(t?Is().isShadowRoot(r)?this.findTestabilityInTree(e,r.host,!0):this.findTestabilityInTree(e,r.parentElement,!0):null)}},Km=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac});let i=e;return i})(),oc=new _i(""),qp=(()=>{let e=class e{constructor(t,n){this._zone=n,this._eventNameToPlugin=new Map,t.forEach(o=>{o.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,n,o){return this._findPluginFor(n).addEventListener(t,n,o)}getZone(){return this._zone}_findPluginFor(t){let n=this._eventNameToPlugin.get(t);if(n)return n;if(n=this._plugins.find(s=>s.supports(t)),!n)throw new bi(5101,!1);return this._eventNameToPlugin.set(t,n),n}};e.\u0275fac=function(n){return new(n||e)(x(oc),x(ti))},e.\u0275prov=O({token:e,factory:e.\u0275fac});let i=e;return i})(),Ts=class{constructor(e){this._doc=e}},ec="ng-app-id",Yp=(()=>{let e=class e{constructor(t,n,o,s={}){this.doc=t,this.appId=n,this.nonce=o,this.platformId=s,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Ja(s),this.resetHostNodes()}addStyles(t){for(let n of t)this.changeUsageCount(n,1)===1&&this.onStyleAdded(n)}removeStyles(t){for(let n of t)this.changeUsageCount(n,-1)<=0&&this.onStyleRemoved(n)}ngOnDestroy(){let t=this.styleNodesInDOM;t&&(t.forEach(n=>n.remove()),t.clear());for(let n of this.getAllStyles())this.onStyleRemoved(n);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(let n of this.getAllStyles())this.addStyleToHost(t,n)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(let n of this.hostNodes)this.addStyleToHost(n,t)}onStyleRemoved(t){let n=this.styleRef;n.get(t)?.elements?.forEach(o=>o.remove()),n.delete(t)}collectServerRenderedStyles(){let t=this.doc.head?.querySelectorAll(`style[${ec}="${this.appId}"]`);if(t?.length){let n=new Map;return t.forEach(o=>{o.textContent!=null&&n.set(o.textContent,o)}),n}return null}changeUsageCount(t,n){let o=this.styleRef;if(o.has(t)){let s=o.get(t);return s.usage+=n,s.usage}return o.set(t,{usage:n,elements:[]}),n}getStyleElement(t,n){let o=this.styleNodesInDOM,s=o?.get(n);if(s?.parentNode===t)return o.delete(n),s.removeAttribute(ec),s;{let p=this.doc.createElement("style");return this.nonce&&p.setAttribute("nonce",this.nonce),p.textContent=n,this.platformIsServer&&p.setAttribute(ec,this.appId),t.appendChild(p),p}}addStyleToHost(t,n){let o=this.getStyleElement(t,n),s=this.styleRef,p=s.get(n)?.elements;p?p.push(o):s.set(n,{elements:[o],usage:1})}resetHostNodes(){let t=this.hostNodes;t.clear(),t.add(this.doc.head)}};e.\u0275fac=function(n){return new(n||e)(x(Vi),x(xs),x(Na,8),x(Ir))},e.\u0275prov=O({token:e,factory:e.\u0275fac});let i=e;return i})(),tc={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},ac=/%COMP%/g,Qp="%COMP%",Zm=`_nghost-${Qp}`,Xm=`_ngcontent-${Qp}`,Jm=!0,ef=new _i("",{providedIn:"root",factory:()=>Jm});function tf(i){return Xm.replace(ac,i)}function nf(i){return Zm.replace(ac,i)}function Kp(i,e){return e.map(r=>r.replace(ac,i))}var Vp=(()=>{let e=class e{constructor(t,n,o,s,p,f,C,w=null){this.eventManager=t,this.sharedStylesHost=n,this.appId=o,this.removeStylesOnCompDestroy=s,this.doc=p,this.platformId=f,this.ngZone=C,this.nonce=w,this.rendererByCompId=new Map,this.platformIsServer=Ja(f),this.defaultRenderer=new ao(t,p,C,this.platformIsServer)}createRenderer(t,n){if(!t||!n)return this.defaultRenderer;this.platformIsServer&&n.encapsulation===ro.ShadowDom&&(n=N(P({},n),{encapsulation:ro.Emulated}));let o=this.getOrCreateRenderer(t,n);return o instanceof Fs?o.applyToHost(t):o instanceof co&&o.applyStyles(),o}getOrCreateRenderer(t,n){let o=this.rendererByCompId,s=o.get(n.id);if(!s){let p=this.doc,f=this.ngZone,C=this.eventManager,w=this.sharedStylesHost,T=this.removeStylesOnCompDestroy,U=this.platformIsServer;switch(n.encapsulation){case ro.Emulated:s=new Fs(C,w,n,this.appId,T,p,f,U);break;case ro.ShadowDom:return new sc(C,w,t,n,p,f,this.nonce,U);default:s=new co(C,w,n,T,p,f,U);break}o.set(n.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(n){return new(n||e)(x(qp),x(Yp),x(xs),x(ef),x(Vi),x(Ir),x(ti),x(Na))},e.\u0275prov=O({token:e,factory:e.\u0275fac});let i=e;return i})(),ao=class{constructor(e,r,t,n){this.eventManager=e,this.doc=r,this.ngZone=t,this.platformIsServer=n,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,r){return r?this.doc.createElementNS(tc[r]||r,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,r){(zp(e)?e.content:e).appendChild(r)}insertBefore(e,r,t){e&&(zp(e)?e.content:e).insertBefore(r,t)}removeChild(e,r){r.remove()}selectRootElement(e,r){let t=typeof e=="string"?this.doc.querySelector(e):e;if(!t)throw new bi(-5104,!1);return r||(t.textContent=""),t}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,r,t,n){if(n){r=n+":"+r;let o=tc[n];o?e.setAttributeNS(o,r,t):e.setAttribute(r,t)}else e.setAttribute(r,t)}removeAttribute(e,r,t){if(t){let n=tc[t];n?e.removeAttributeNS(n,r):e.removeAttribute(`${t}:${r}`)}else e.removeAttribute(r)}addClass(e,r){e.classList.add(r)}removeClass(e,r){e.classList.remove(r)}setStyle(e,r,t,n){n&(On.DashCase|On.Important)?e.style.setProperty(r,t,n&On.Important?"important":""):e.style[r]=t}removeStyle(e,r,t){t&On.DashCase?e.style.removeProperty(r):e.style[r]=""}setProperty(e,r,t){e!=null&&(e[r]=t)}setValue(e,r){e.nodeValue=r}listen(e,r,t){if(typeof e=="string"&&(e=Is().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${r}`);return this.eventManager.addEventListener(e,r,this.decoratePreventDefault(t))}decoratePreventDefault(e){return r=>{if(r==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(r)):e(r))===!1&&r.preventDefault()}}};function zp(i){return i.tagName==="TEMPLATE"&&i.content!==void 0}var sc=class extends ao{constructor(e,r,t,n,o,s,p,f){super(e,o,s,f),this.sharedStylesHost=r,this.hostEl=t,this.shadowRoot=t.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let C=Kp(n.id,n.styles);for(let w of C){let T=document.createElement("style");p&&T.setAttribute("nonce",p),T.textContent=w,this.shadowRoot.appendChild(T)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,r){return super.appendChild(this.nodeOrShadowRoot(e),r)}insertBefore(e,r,t){return super.insertBefore(this.nodeOrShadowRoot(e),r,t)}removeChild(e,r){return super.removeChild(null,r)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},co=class extends ao{constructor(e,r,t,n,o,s,p,f){super(e,o,s,p),this.sharedStylesHost=r,this.removeStylesOnCompDestroy=n,this.styles=f?Kp(f,t.styles):t.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Fs=class extends co{constructor(e,r,t,n,o,s,p,f){let C=n+"-"+t.id;super(e,r,t,o,s,p,f,C),this.contentAttr=tf(C),this.hostAttr=nf(C)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,r){let t=super.createElement(e,r);return super.setAttribute(t,this.contentAttr,""),t}},rf=(()=>{let e=class e extends Ts{constructor(t){super(t)}supports(t){return!0}addEventListener(t,n,o){return t.addEventListener(n,o,!1),()=>this.removeEventListener(t,n,o)}removeEventListener(t,n,o){return t.removeEventListener(n,o)}};e.\u0275fac=function(n){return new(n||e)(x(Vi))},e.\u0275prov=O({token:e,factory:e.\u0275fac});let i=e;return i})(),Wp=["alt","control","meta","shift"],of={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},sf={alt:i=>i.altKey,control:i=>i.ctrlKey,meta:i=>i.metaKey,shift:i=>i.shiftKey},af=(()=>{let e=class e extends Ts{constructor(t){super(t)}supports(t){return e.parseEventName(t)!=null}addEventListener(t,n,o){let s=e.parseEventName(n),p=e.eventCallback(s.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Is().onAndCancel(t,s.domEventName,p))}static parseEventName(t){let n=t.toLowerCase().split("."),o=n.shift();if(n.length===0||!(o==="keydown"||o==="keyup"))return null;let s=e._normalizeKey(n.pop()),p="",f=n.indexOf("code");if(f>-1&&(n.splice(f,1),p="code."),Wp.forEach(w=>{let T=n.indexOf(w);T>-1&&(n.splice(T,1),p+=w+".")}),p+=s,n.length!=0||s.length===0)return null;let C={};return C.domEventName=o,C.fullKey=p,C}static matchEventFullKeyCode(t,n){let o=of[t.key]||t.key,s="";return n.indexOf("code.")>-1&&(o=t.code,s="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),Wp.forEach(p=>{if(p!==o){let f=sf[p];f(t)&&(s+=p+".")}}),s+=o,s===n)}static eventCallback(t,n,o){return s=>{e.matchEventFullKeyCode(s,t)&&o.runGuarded(()=>n(s))}}static _normalizeKey(t){return t==="esc"?"escape":t}};e.\u0275fac=function(n){return new(n||e)(x(Vi))},e.\u0275prov=O({token:e,factory:e.\u0275fac});let i=e;return i})();function cf(){nc.makeCurrent()}function lf(){return new Er}function pf(){return Jl(document),document}var uf=[{provide:Ir,useValue:$p},{provide:ep,useValue:cf,multi:!0},{provide:Vi,useFactory:pf,deps:[]}],Zp=yp(Sp,"browser",uf),df=new _i(""),mf=[{provide:_s,useClass:rc,deps:[]},{provide:fp,useClass:Ms,deps:[ti,Va,_s]},{provide:Ms,useClass:Ms,deps:[ti,Va,_s]}],ff=[{provide:Ql,useValue:"root"},{provide:Er,useFactory:lf,deps:[]},{provide:oc,useClass:rf,multi:!0,deps:[Vi,ti,Ir]},{provide:oc,useClass:af,multi:!0,deps:[Vi]},Vp,Yp,qp,{provide:cp,useExisting:Vp},{provide:Es,useClass:Km,deps:[]},[]],Xp=(()=>{let e=class e{constructor(t){}static withServerTransition(t){return{ngModule:e,providers:[{provide:xs,useValue:t.appId}]}}};e.\u0275fac=function(n){return new(n||e)(x(df,12))},e.\u0275mod=Ye({type:e}),e.\u0275inj=qe({providers:[...ff,...mf],imports:[vt,wp]});let i=e;return i})();var cc=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=O({token:e,factory:function(n){let o=null;return n?o=new(n||e):o=x(hf),o},providedIn:"root"});let i=e;return i})(),hf=(()=>{let e=class e extends cc{constructor(t){super(),this._doc=t}sanitize(t,n){if(n==null)return null;switch(t){case An.NONE:return n;case An.HTML:return Tr(n,"HTML")?Fn(n):ap(this._doc,String(n)).toString();case An.STYLE:return Tr(n,"Style")?Fn(n):n;case An.SCRIPT:if(Tr(n,"Script"))return Fn(n);throw new bi(5200,!1);case An.URL:return Tr(n,"URL")?Fn(n):sp(String(n));case An.RESOURCE_URL:if(Tr(n,"ResourceURL"))return Fn(n);throw new bi(5201,!1);default:throw new bi(5202,!1)}}bypassSecurityTrustHtml(t){return tp(t)}bypassSecurityTrustStyle(t){return ip(t)}bypassSecurityTrustScript(t){return np(t)}bypassSecurityTrustUrl(t){return rp(t)}bypassSecurityTrustResourceUrl(t){return op(t)}};e.\u0275fac=function(n){return new(n||e)(x(Vi))},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var mc={};_r(mc,{CombatAttackInteraction:()=>un,FightEnds:()=>vi,FightNextRoundStarts:()=>Vt,GroupAttacked:()=>zi,GroupCounterAttacked:()=>dc,GroupDamagedByGroup:()=>Rn,GroupDies:()=>mn,GroupModifiersChanged:()=>As,GroupSpeedChanged:()=>mo,GroupSpellsChanged:()=>dn,GroupTakesDamage:()=>uc,PlayerCastsInstantSpell:()=>uo,PlayerTargetsSpell:()=>po,RoundGroupSpendsTurn:()=>ho,RoundGroupTurnEnds:()=>Os,RoundPlayerCountinuesAttacking:()=>go,RoundPlayerTurnStarts:()=>Wi,UnitHealed:()=>Un,UnitSummoned:()=>fo});var eu=0;function Be(i=""){let e={__id:eu,__name:i,__type:null},r=function(t={}){return P({__eventType:e},t)};return r.__typeInfo=e,e.__type=r,eu++,r}var z=(()=>{let e=class e{dispatch(t){this.eventStream$.next(t)}constructor(){this.eventStream$=new Dt,Di.logEvents&&this.eventStream$.subscribe(t=>console.log(`[${t.__eventType.__name}]`,t))}onEvent(t){return this.eventStream$.pipe(Tn(n=>n.__eventType.__id===t.__typeInfo.__id))}events(...t){let n=new Map;return t.forEach(o=>n.set(o.eventType.__typeInfo.__id,o.fn)),this.eventStream$.pipe(Tn(o=>{let s=n.get(o.__eventType.__id);return s?(s(o),!0):!1}))}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();function ot({events:i,prefix:e}){return Object.entries(i).forEach(([r,t])=>{let n=t.__typeInfo.__name;t.__typeInfo.__name=`${e}:${r}`+(n?`, ${n}`:"")}),{events:i,getEventByName(r){return i[r]}}}var lo=Symbol("Class members configs"),lc=Symbol("Class type marker");function pc(i,e){let r=Object.getPrototypeOf(i);return r?r[lc]===e?r:pc(r,e):null}function tu(i,e,r,t,n,o){let s=r.value,p=i.constructor,f=pc(p,"store");if(!f)throw new Error(`[Store Feature] ${n} Error. Class ${p.name} must extend StoreClient(). Method ${p.name}.${e}.`);if(typeof s!="function")throw new Error(`[Store Feature] ${n} Error. ${n} in ${p.name}.${e} must be applied to method.`);f[lo].push({type:o,method:s,event:t})}function ee(i){return function(e,r,t){tu(e,r,t,i,`@Notify(${i.name})`,"notify")}}function G(i){return function(e,r,t){tu(e,r,t,i,`@WireEvent(${i.name})`,"wire")}}function ce(){var r;var i,e;return r=class{constructor(){this.events=L(z),this.destroyed$=new Dt,this.plainSubscriptions=new jl,this.untilDestroyed=s=>s.pipe(et(this.destroyed$));let n=this;Object.getPrototypeOf(this).constructor[lo].forEach(s=>{let p=s.event;if(s.type==="wire-prop")return;let f=s.method;switch(s.type){case"wire":this.events.onEvent(p).pipe(this.untilDestroyed).subscribe(w=>{f.apply(this,[w])});break;case"notify":this.events.onEvent(p).pipe(this.untilDestroyed).subscribe(()=>{f.apply(this)});break;case"subscribeEvent":let C=f.apply(n,[this.events.onEvent(p)]);this.plainSubscriptions.add(C);break}})}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete(),this.plainSubscriptions.unsubscribe()}},i=lo,e=lc,r[i]=[],r[e]="store",r}var tt=Be,po=tt(""),uo=tt(),zi=tt(),un=tt(),mo=tt(),dn=tt(),As=tt(),Rn=tt(),uc=tt(),fo=tt(),dc=tt(),mn=tt(),ho=tt(),Os=tt(),Wi=tt(),go=tt(),Vt=tt(),vi=tt("Fight Ends"),Un=tt();var fc={};_r(fc,{AddCombatModifiersToUnit:()=>yo,DefendAction:()=>So,RegisterUnitLoss:()=>Co,RemoveCombatModifiersFromUnit:()=>vo});var ks=Be,yo=ks(),vo=ks(),Co=ks(),So=ks();var gf=ot({prefix:"Battle",events:mc}),yf=ot({prefix:"BattleCommands",events:fc}),K1=P(P({},gf.events),yf.events);var ri=function(i){return i.GroupAttacks="attacks",i.GroupCounterattacks="counterattacks",i.AttackInteractionCompleted="completed",i}(ri||{});var yc={};_r(yc,{BeforeBattleInit:()=>Io,DisplayPopup:()=>Rr,DisplayReward:()=>Ao,FightStarts:()=>zt,GameCreated:()=>xo,GameStarted:()=>wo,NewDayStarted:()=>Fo,NewWeekStarted:()=>Qi,OpenGarrisonPopup:()=>Nn,OpenSplitUnitGroupPopup:()=>Mo,OpenUnitSlotsActionPopup:()=>Po,PlayerEntersTown:()=>bo,PlayerEquipsItem:()=>$n,PlayerLeavesTown:()=>_o,PlayerLevelsUp:()=>Oo,PlayerLosesItem:()=>jn,PlayerOpensActionCards:()=>Do,PlayerOpensHeroInfo:()=>Bn,PlayerReceivesItem:()=>Ci,PlayerStartsFight:()=>Eo,PlayerUnequipsItem:()=>fn,PlayersInitialized:()=>qi,ScheduleAction:()=>Vn,ShowGameOverPopup:()=>To,StructCompleted:()=>Yi,StructFightConfirmed:()=>Ln,StructSelected:()=>Hn,UnitGroupAddedToHero:()=>hc,UnitGroupRemovedFromHero:()=>gc});var _e=Be,wo=_e(),xo=_e(),qi=_e(),bo=_e(),_o=_e(),Bn=_e(),Mo=_e(),Po=_e(),Do=_e(),Hn=_e(),Eo=_e(),Io=_e(),zt=_e(),Yi=_e(),To=_e(),Fo=_e(),Qi=_e(),Ao=_e(),Ln=_e(),Rr=_e(),Nn=_e(),Ci=_e(),jn=_e(),$n=_e(),fn=_e(),Oo=_e(),hc=_e(),gc=_e(),Vn=_e();var Gt=function(i){return i.MainScreen="main-screen",i.NewGame="new-game",i.Structures="structures",i.Battleground="battleground",i.Town="town",i}(Gt||{});var vc={};_r(vc,{ActivateActionCard:()=>Qn,AddActionCardsToPlayer:()=>Ki,CleanUpHandlersOnFightEnd:()=>Gs,DisplayPlayerRewardPopup:()=>Go,GameOpenMainScreen:()=>zn,GameOpenMapStructuresScreen:()=>Ur,InitBuilding:()=>Ho,InitGameObjectApi:()=>Ro,InitItem:()=>Bo,InitSpell:()=>Uo,InitStructure:()=>Lo,MapPanCameraCenterTo:()=>hn,NavigateToView:()=>Ii,OpenMainMenu:()=>qn,OpenNewGameScreen:()=>ko,OpenSettings:()=>Wn,PushEventFeedMessage:()=>Yn,PushPlainEventFeedMessage:()=>Si,RemoveActionPoints:()=>Wt});var it=Be,Gs=it("Clear spells and items registries on fight end"),hn=it("Pan camera on the map"),zn=it("Open Main Screen"),ko=it("Open New Game Screen"),Wn=it("Open Game settings"),qn=it("Open Main menu"),Ii=it("Navigate To View"),Ur=it("Open map structures screen"),Go=it(),Ro=it(),Uo=it(),Bo=it(),Ho=it(),Lo=it(),Yn=it(),Si=it(),Wt=it(),Qn=it(),Ki=it();var vf=ot({events:yc,prefix:"GameEvents"}),Cf=ot({events:vc,prefix:"GameCommands"}),lS=P(P({},vf.events),Cf.events);var Cc={};_r(Cc,{DisplayUnitGroupInfo:()=>gn,PlayerClicksAllyGroup:()=>$o,PlayerClicksEnemyGroup:()=>jo,PlayerHoversGroupCard:()=>Ti,PlayerRightClicksUnitGroup:()=>Vo});var No=Be,jo=No(),$o=No(),Ti=No(),Vo=No(),gn=No();var Ct=function(i){return i[i.EnemyCard=0]="EnemyCard",i[i.AllyCard=1]="AllyCard",i[i.Unhover=2]="Unhover",i}(Ct||{});var Sf=ot({events:Cc,prefix:"UI"}),wS=Sf.events;var Sc={};_r(Sc,{GamePreparationFinished:()=>xf,PrepareGameEvent:()=>wf});var iu=Be,wf=iu("Player started new game, waiting for GamePreparationFinished event to prepare the map."),xf=iu("Map is prepared, player can start the game");var bf=ot({events:Sc,prefix:"Triggers"}),Br=bf.events;var zo=function(i){return i.Normal="normal",i}(zo||{});var A=function(i){return i.Target="target",i.Instant="instant",i.Passive="passive",i.Debuff="debuff",i.Buff="buff",i}(A||{}),_f=[A.Buff,A.Debuff],Mf=[A.Buff,A.Debuff,A.Passive],jS=[A.Instant,A.Passive,A.Target];function Pf(i){return _f.includes(i.baseType.activationType)}var Rs=(()=>{let e=class e extends Ot{constructor(){super(...arguments),this.currentLevel=1}create({spellBaseType:t,initialLevel:n,state:o}){this.baseType=t,this.currentLevel=n,this.name=this.baseType.name,this.state=o,this.sourceInfo={},this.updateCurrentManaCost()}updateCurrentManaCost(){this.currentManaCost=this.baseType.config.spellConfig.getManaCost?.(this)||0}setCooldown(t){this.cooldown=t}clearCooldown(){this.cooldown=void 0}setOwnerObjectId(t){this.sourceInfo.ownerUnitObjectId=t}setSourceGameObjectId(t){this.sourceInfo.gameObjectId=t}levelUp(){this.currentLevel+=1,this.updateCurrentManaCost();let t=this.sourceInfo.ownerUnitObjectId;t&&this.baseType.config.spellConfig.onAcquired?.({spellInstance:this,ownerUnit:this.getApi().gameObjects.getObjectByFullId(t)})}isEffect(){return Pf(this)}isPassive(){return Mf.includes(this.baseType.activationType)}};e.categoryId="spell";let i=e;return i})();var Zi=function(i){return i[i.Icon=0]="Icon",i[i.Html=1]="Html",i[i.Customizable=2]="Customizable",i}(Zi||{}),Xi=function(i){return i[i.VfxElement=0]="VfxElement",i}(Xi||{});var X=(i,e)=>({icon:i,id:e,type:Zi.Icon}),nu=i=>({id:i,type:Zi.Html}),Wo=i=>({id:i,type:Zi.Customizable}),Fe=i=>{let e={config:{layout:"default"},elements:[],elemsKeyframes:{},elemsDefaultStyles:{}};return i.forEach(([r,t,n])=>{e.elements.push(r),e.elemsKeyframes[r.id]=t,e.elemsDefaultStyles[r.id]=n}),e},Rt=()=>[{opacity:"0"},{opacity:"1",offset:.25},{opacity:"1",offset:.35},{offset:.76,opacity:"0"},{opacity:"0"}],st=()=>[{filter:"blur(10px)"},{filter:"blur(0px)",offset:.4},{filter:"blur(0px)",opacity:0}],Kn=()=>[{opacity:"0"},{opacity:"0.2",transform:"translate(-50%, -50%) scale(1.2)",offset:.25},{opacity:"0.3",transform:"translate(-50%, -50%) scale(1.5)",offset:.35},{offset:.76,transform:"translate(-50%, -50%) scale(1.6)",opacity:"0"},{opacity:"0"}];var Ze=(i=0,e=0)=>{let r="translate(-50%, -50%) scale(1)";return[{opacity:0+e,offset:.001+i},{opacity:.3+e,transform:r,offset:.3+i},{opacity:.3+e,transform:r,offset:.5+i},{opacity:.3+e,transform:r},{opacity:0+e,transform:r}]};var yn=(i,e="rgb(244 162 124)")=>Fe([[X(i,"fire-main"),Rt(),{fontSize:"64px",color:e,opacity:"1"}],[X(i,"fire-blur"),st(),{fontSize:"64px",color:e,filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"}],[X(i,"fire-pulse"),Kn(),{fontSize:"64px",color:e,opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"}]]);function Ji(i,e){let r=()=>({transform:"translate(-50%, -50%) scale(3)",fontSize:"64px",color:"rgb(213 197 223)",opacity:"0"});return Fe([[X(i,"bw-1"),Ze(),r()],[X(i,"bw-2"),Ze(.2),r()],[X(i,"bw-3"),Ze(.4),r()],[X(i,"bw-blur"),[{filter:"blur(10px)"},{filter:"blur(10px)",offset:.4,opacity:1},{filter:"blur(0px)",opacity:0,transform:"translate(-50%, -50%) scale(1)"}],{transform:"translate(-50%, -50%) scale(1.5)",fontSize:"64px",color:e,filter:"blur(6px)",opacity:"0",mixBlendMode:"hard-light"}]])}var ru=Fe([[X("focused-lightning","l-main"),[{opacity:"0"},{opacity:"1",offset:.05},{opacity:"1",offset:.15},{opacity:"0",offset:.16},{opacity:"0",offset:.2},{opacity:"1",offset:.23},{opacity:"0"}],{fontSize:"64px",color:"#eaefff",opacity:"1"}],[X("focused-lightning","l-blur"),[{filter:"blur(10px)"},{filter:"blur(10px)",offset:.4},{filter:"blur(0px)",opacity:0,transform:"translate(-50%, -50%) scale(1)"}],{transform:"translate(-50%, -50%) scale(1.5)",fontSize:"64px",color:"#98abff",filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"}]]),Us=yn("fire"),ou=Ji("batwings","rgba(218, 137, 204, 0.78)"),su=Ji("bat-sword","rgba(245, 10, 20, 0.8)"),au=Fe([[X("fire-ring","fr-main"),Rt(),{fontSize:"64px",color:"white",opacity:"1"}],[X("fire-ring","fr-blur"),st(),{fontSize:"64px",color:"violet",filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"}],[X("fire-ring","fr-pulse"),Kn(),{fontSize:"64px",color:"pink",opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"}]]);var wc={textShadow:"0px 0px 5px rgba(0, 0, 0, 1)"},cu=Fe([[Wo("elem"),[],P({fontSize:"24px",position:"relative",top:"17px",left:"10px",color:"white"},wc)]]),lu=Fe([[Wo("elem"),[],P({fontSize:"24px",color:"white"},wc)]]),pu=Fe([[X("burning-book","bm"),[],P({fontSize:"34px",color:"#bfcbff",opacity:.7},wc)],[X("burning-book","bm2"),Ze(0,.2),{fontSize:"34px",color:"#bfcbff",mixBlendMode:"screen"}],[X("burning-book","book-blur"),Kn(),{fontSize:"36px",filter:"blur(6px)",color:"#98abff",mixBlendMode:"screen"}],[X("burning-book","book-blur2"),Kn(),{fontSize:"36px",filter:"blur(6px)",color:"#98abff"}]]);var uu=Fe([[Wo("msg"),[{fontSize:"13px"},{offset:.3,opacity:1,transform:"translate(10px, -50px) scale(1.5)"},{opacity:0,transform:"translate(20px, -100px) scale(0.8)"}],{opacity:.3,fontSize:"15px"}]]),du=Fe([[nu("msg"),[{offset:0,opacity:0,transform:"translate(0, -50px)"},{offset:.2,opacity:1,transform:"translate(0, -10px)"},{offset:.8,opacity:1,transform:"translate(0, -10px)"},{opacity:0,transform:"translate(0, 0px)"}],{fontSize:"15px"}]]);var qo=({icon:i,iconColor:e="white",bgColor:r="transparent"})=>`<i class='ra ra-${i}' style="background: ${r}; color: ${e}"></i>`,Df=({icon:i,iconColor:e,bgColor:r})=>`<i class='ra ra-${i}' style="background: ${r}; color: ${e}"></i>`,Zn=i=>`${Df(i)} <span style="font-weight: 600;">${i.title}</span>`;var xc=i=>`${Math.round(i*100)}`,Bs=i=>`${Math.round(i*100)}%`,mu=(i,e)=>i===e?`${i} `:`${i}-${e} `,fu=i=>i===0?i:i>0?`+${i}`:`-${i}`;var Ut=(i,e,r=!1,t=0,n=!1)=>({parts:[{type:"plainPart",icon:r?"broadhead-arrow":"sword",text:`<span style="${n?"font-weight: 800;":""}">${i}</span>`,color:n?"#ff8100":"red"},...t?[{type:"plainPart",icon:"shield",color:"yellow",text:t}]:[],{type:"plainPart",icon:"skull",text:e,color:"white"}]}),Hs=(i,e)=>({parts:[{type:"plainPart",icon:"double-team",text:i,color:"white"},{type:"plainPart",icon:"health",text:e,color:"#5fc960"}]}),wi=(i,{fontSize:e=15,width:r=100}={})=>`<div style="margin-top: 4px; text-align: center; width: ${r}px; font-size:${e}px; background:rgba(0,0,0,0.6); padding: 2px; border-radius: 5px;">${i}</div>`,gu=(i,e)=>({html:wi(`
      <div style="">${qo({icon:"bat-sword",iconColor:"red"})} ${e}</div>
      <div style="">${qo({icon:"double-team",iconColor:"#91edb8"})}${fu(i)}</div>
    `,{width:50})}),hu=(i,e=i.count)=>`<span style="color: ${i.ownerPlayer.color}; font-weight: 500">${e} ${i.type.name}</span>`,yu=({attacker:i,attacked:e,originalNumber:r,damage:t,unitLoss:n})=>`${hu(i)} retaliated! Dealing ${t} damage to ${hu(e,r)}, ${n} units perish.`;var B=i=>(Ei(i),i),at=({isEnemy:i,unitGroup:e})=>i&&e.fightInfo.isAlive;var vn=({isEnemy:i,unitGroup:e})=>!i,oi={bgClr:At.DefautlDebuffBg,iconClr:At.DefautlDebuffClr},Ls={bgClr:At.DefautlBuffBg,iconClr:At.DefautlBuffClr};var vu=(i,e)=>r=>i+(r-1)*e;var Ew=B({id:"#spell-blindness",name:"Blindness",activationType:A.Instant,icon:{icon:"sunbeams"},getDescription(){return{descriptions:[D("Decreases damage of target enemy group by 15%.")]}},config:{spellConfig:{getManaCost(i){return 0},init:()=>{}}}});var bc=17,_c=B({id:"#spell-enchant-buff",name:"Enchanted",activationType:A.Debuff,icon:P({icon:"fire-ring"},oi),getDescription(){return{descriptions:[D(`Incoming damage from spells is increased by ${bc}%.`)]}},config:{spellConfig:{init:({events:i,actions:e,vfx:r})=>{let t=e.createModifiers({amplifiedTakenMagicDamagePercent:bc/100});i.on({SpellPlacedOnUnitGroup(n){r.createEffectForUnitGroup(n.target,au,{duration:1e3}),e.addModifiersToUnitGroup(n.target,t)}})}}}}),Cu=B({id:"#spell-enchant",name:"Enchant",activationType:A.Target,icon:{icon:"fire-ring"},getDescription(){return{descriptions:[D(`Enchants an enemy to receive increased damage from spells by ${bc}%`)]}},config:{spellConfig:{targetCastConfig:{canActivate:at},getManaCost(i){return{1:2,2:2,3:3,4:3}[i.currentLevel]},init:({events:i,actions:e,ownerPlayer:r})=>{i.on({PlayerTargetsSpell(t){let n=e.createSpellInstance(_c);e.addSpellToUnitGroup(t.target,n,r),e.historyLog("Enemy is enchanted")}})}}}});var Ns="hospital-cross",Mc={fontSize:"64px",color:"rgb(200 244 124)"},Ef=Fe([[X(Ns,"fire-main"),Rt(),N(P({},Mc),{opacity:"1"})],[X(Ns,"fire-blur"),st(),N(P({},Mc),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[X(Ns,"fire-pulse"),Ze(),N(P({},Mc),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),Pc=20,Dc=B({id:"#spell-revitalize",name:"Revitalize",activationType:A.Target,icon:{icon:Ns},getDescription(i){let e=i.ownerUnit,r=e.count,t=e.type.name,n=r*Pc;return{descriptions:[D(`Heals friendly unit group by ${n}. Heal increases by ${Pc} per each Firebird in current group.`)]}},config:{spellConfig:{targetCastConfig:{canActivate:vn},getManaCost(i){return 2},init:({events:i,actions:e,ownerUnit:r,vfx:t})=>{i.on({PlayerTargetsSpell(n){let o=r,s=o.count*Pc,p=n.target,f=p.type.name,C=e.healUnit(p,s);t.createEffectForUnitGroup(p,Ef,{duration:800});let w=C.revivedUnitsCount;e.historyLog(`${o.count} ${o.type.name} heal ${f} by ${s}.`),e.historyLog(`${w} of ${f} are brought back to life.`),t.createFloatingMessageForUnitGroup(n.target,Hs(w,s),{duration:1600})}})}}}});var wu=.25,xu=wu*100,Su=B({id:"#spell-fright-debuff",name:"Fright",activationType:A.Debuff,icon:P({icon:"batwings"},oi),getDescription(){return{descriptions:[D(`This unit group is frightened, dealing ${xu}% less damage to the one who scared it.`)]}},config:{spellConfig:{init({actions:i,events:e,spellInstance:r,vfx:t,ownerHero:n}){e.on({SpellPlacedOnUnitGroup({target:o}){let s=n.modGroup.getModValue("specialtyNecromancy")||0,p=i.createModifiers({__attackConditionalModifiers(f){return!s&&f.attacked===r.state?.frighter?{baseDamagePercentModifier:-wu}:s>=1?f.attacked===r.state?.frighter?{baseDamagePercentModifier:-.25}:f.attacked.modGroup.getModValue("isGhost")?{baseDamagePercentModifier:-.17}:{baseDamagePercentModifier:-.12}:{}}});t.createEffectForUnitGroup(o,ou,{duration:1e3}),i.addModifiersToUnitGroup(o,p)}})}}}}),Ec=B({id:"#spell-fright",name:"Fright",activationType:A.Passive,icon:{icon:"batwings"},getDescription(i){return{descriptions:[D(`Scares enemy group on attack, reducing damage against this group by ${xu}%.  Ability Improves with Necromancy, reducing damage against all your units.`)]}},config:{spellConfig:{init({actions:i,events:e,ownerPlayer:r,ownerUnit:t}){e.on({UnitGroupAttacks({attacked:n,attacker:o}){if(t!==o||n.spells.find(p=>p.baseType===Su))return;let s=i.createSpellInstance(Su,{state:{frighter:o}});i.addSpellToUnitGroup(n,s,r)}})}}}});var ge=function(i){return i.PhysicalAttack="physAttack",i.Physical="physical",i.Magic="magic",i.Fire="fire",i.Cold="cold",i.Poison="poison",i.Lightning="lightning",i.Astral="astral",i}(ge||{});var js="frost-emblem",Ic={fontSize:"64px",color:"#a9bee2"},If=Fe([[X(js,"fire-main"),Rt(),N(P({},Ic),{opacity:"1"})],[X(js,"fire-blur"),st(),N(P({},Ic),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[X(js,"fire-pulse"),Ze(),N(P({},Ic),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),bu=40,$s=4,Vs=3,Tf=B({id:"#spell-frost-arrow-debuff",name:"Freeze",activationType:A.Debuff,icon:N(P({icon:js},oi),{bgClr:"#a9bee2"}),getDescription(i){return{descriptions:[D(`Unit group is slowed down by ${$s}, attack rating reduced by ${Vs}.`)]}},config:{spellConfig:{init:({events:i,actions:e,vfx:r,thisSpell:t})=>{let n=e.createModifiers({unitGroupSpeedBonus:-$s,heroBonusAttack:-Vs});i.on({SpellPlacedOnUnitGroup({target:o}){r.createEffectForUnitGroup(o,If,{duration:800}),e.addModifiersToUnitGroup(o,n),e.historyLog(`${o.type.name} receives ${t.name} debuff, slowed by ${$s} and gains -${Vs} attack rating penalty.`)}})}}}}),_u=B({id:"#spell-frost-arrow",name:"Frost Arrow",activationType:A.Target,icon:{icon:"frozen-arrow"},getDescription(i){return{descriptions:[D(`Deals ${bu} magic damage, slows enemy by ${$s} and reduces attack rating by ${Vs}.`)]}},config:{spellConfig:{targetCastConfig:{canActivate:at},getManaCost(i){return{1:2,2:2,3:3,4:3}[i.currentLevel]},init:({events:i,actions:e,ownerPlayer:r,ownerHero:t,thisSpell:n,vfx:o})=>{i.on({PlayerTargetsSpell:s=>{let p=e.createSpellInstance(Tf);e.addSpellToUnitGroup(s.target,p,r),e.dealDamageTo(s.target,bu,ge.Cold,({finalDamage:f,unitLoss:C})=>{let w=s.target.type.name;e.historyLog(`${t.name} deals ${f} damage to ${w} with ${n.name}, ${C} ${w} perishes`),o.createFloatingMessageForUnitGroup(s.target,Ut(f,C),{duration:1e3})})}})}}}});var Yo="boot-stomp",Tc={fontSize:"64px",color:"rgb(200 244 124)"},Ff=Fe([[X(Yo,"fire-main"),Rt(),N(P({},Tc),{opacity:"1"})],[X(Yo,"fire-blur"),st(),N(P({},Tc),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[X(Yo,"fire-pulse"),Ze(),N(P({},Tc),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),Fc=5,Af=B({id:"#spell-haste-buff",name:"Haste",activationType:A.Buff,icon:P({icon:Yo},Ls),getDescription(){return{descriptions:[D(`Unit group is speeded up by ${Fc}.`)]}},config:{spellConfig:{init:({events:i,actions:e,vfx:r})=>{let t=e.createModifiers({unitGroupSpeedBonus:Fc});i.on({SpellPlacedOnUnitGroup(n){r.createEffectForUnitGroup(n.target,Ff,{duration:800}),e.addModifiersToUnitGroup(n.target,t)}})}}}}),Mu=B({id:"#spell-haste",name:"Haste",activationType:A.Target,icon:{icon:Yo},getDescription(){return{descriptions:[D(`Target unit group is speeding up by ${Fc}.`),D("When upgraded, increases the speed bonus and starts to grant a chance to gain additional turn to units.")]}},config:{spellConfig:{targetCastConfig:{canActivate:vn},getManaCost(i){return{1:2,2:2,3:3,4:3}[i.currentLevel]},init:({events:i,actions:e,ownerPlayer:r})=>{i.on({PlayerTargetsSpell(t){let n=e.createSpellInstance(Af);e.addSpellToUnitGroup(t.target,n,r)}})}}}});var zs="hospital-cross",Ac={fontSize:"64px",color:"rgb(200 244 124)"},Of=Fe([[X(zs,"fire-main"),Rt(),N(P({},Ac),{opacity:"1"})],[X(zs,"fire-blur"),st(),N(P({},Ac),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[X(zs,"fire-pulse"),Ze(),N(P({},Ac),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),mx=B({id:"#spell-heal",name:"Heal",activationType:A.Target,icon:{icon:zs},getDescription(i){return{descriptions:[]}},config:{spellConfig:{targetCastConfig:{canActivate:vn},getManaCost(i){return{1:2,2:2,3:3,4:3}[i.currentLevel]},init:({events:i,actions:e,ownerPlayer:r,ownerUnit:t,vfx:n})=>{i.on({PlayerTargetsSpell(o){let p=o.target.count,f=o.target;e.healUnit(f,64),n.createEffectForUnitGroup(f,Of,{duration:800});let C=o.target.count,w=f.type.name,T=C-p;e.historyLog(`${r.hero.name} heals ${w} by 64.`),e.historyLog(`${T} of ${w} are brought back to life.`),n.createFloatingMessageForUnitGroup(o.target,Hs(T,64),{duration:1e3})}})}}}});var Oc=50,Pu="player-despair",kf=B({id:"#spell-kneeling-light-debuff",name:"Slowed",activationType:A.Debuff,icon:P({icon:Pu},oi),getDescription(i){return{descriptions:[D(`Unit group is slowed down by ${Oc}%.`)]}},config:{spellConfig:{init:({events:i,actions:e,vfx:r})=>{i.on({SpellPlacedOnUnitGroup(t){let n=t.target.type.baseStats.speed,o=e.createModifiers({unitGroupSpeedBonus:-(n*(Oc/100))});r.createEffectForUnitGroup(t.target,Ji("player-despair","rgb(227, 240, 113)"),{duration:1e3}),e.addModifiersToUnitGroup(t.target,o)}})}}}}),Du=B({id:"#spell-kneeling-light",name:"Kneeling Light",icon:{icon:Pu},getDescription(i){return{descriptions:[D(`Makes light so heavy for the enemy target that it loses ${Oc}% of the speed.`)]}},activationType:A.Target,config:{spellConfig:{targetCastConfig:{canActivate:at},getManaCost(i){return{1:2,2:2,3:3,4:3}[i.currentLevel]},init:({events:i,actions:e,ownerPlayer:r})=>{i.on({PlayerTargetsSpell(t){let n=e.createSpellInstance(kf);e.addSpellToUnitGroup(t.target,n,r)}})}}}});var Eu=20,Iu=50,Tu=30,Ws=B({id:"#spell-meteor",name:"Meteor",activationType:A.Instant,icon:{icon:"burning-meteor"},getDescription({spellInstance:i}){let e=Tu*i.currentLevel;return{descriptions:[D(`Can be casted only once per battle.<br/><hr/>Meteor deals ${Eu+e}-${Iu+e} fire damage to random enemy group, next 2 unit groups after current group in fight queue (enemies or allies) will be stunned and will lose their turns. If stunned enemy's creature is tier 4 or higher, instead of stun, it will take 65% of ability's damage.`)]}},config:{spellConfig:{getManaCost:i=>({1:5,2:5,3:6,4:6})[i.currentLevel],init({events:i,actions:e,thisSpell:r,ownerHero:t,vfx:n,spellInstance:o}){i.on({PlayerCastsInstantSpell(s){let p=e.getRandomEnemyPlayerGroup(),f=Tu*o.currentLevel;o.setCooldown(1/0),n.createEffectForUnitGroup(p,yn("burning-meteor"),{duration:1e3});let C=V.randIntInRange(Eu+f,Iu+f);e.dealDamageTo(p,C,ge.Fire,({unitLoss:U,initialUnitCount:pe,finalDamage:ie})=>{e.historyLog(`${t.name} deals ${ie} damage to ${pe} ${p.type.name} with ${r.name}, ${U} units perish`),n.createFloatingMessageForUnitGroup(p,Ut(ie,U),{duration:1e3})});let w=e.getUnitsFromFightQueue(),T=V.selectItems(w,2,1);console.log(w,T),T.forEach(U=>{U.type.level<4?(e.removeTurnsFromUnitGroup(U),n.createDroppingMessageForUnitGroup(U.id,{html:wi("Stunned!")}),e.historyLog(`${U.count} ${U.type.name} stunned by the Meteor.`)):e.isEnemyUnitGroup(U)&&e.dealDamageTo(U,C*.65,ge.Fire,({unitLoss:pe,initialUnitCount:ie,finalDamage:Ge})=>{e.historyLog(`${t.name} deals ${Ge} damage to ${ie} ${U.type.name} with ${r.name}, ${pe} units perish`),n.createFloatingMessageForUnitGroup(p,Ut(Ge,pe),{duration:1e3})})})}})}}}});var Rc=5,Au=34,Ou=46,ku=`${Au}-${Ou}`,Gf=2,kc="bomb-explosion",Gc={fontSize:"64px",color:"rgb(172 202 120)"},Fu=Fe([[X(kc,"fire-main"),[{opacity:"0",transform:"translate(-50%, -50%) scale(0.8)"},{opacity:"1",offset:.25,transform:"translate(-50%, -50%)  scale(1.2)"},{opacity:"1",offset:.35,transform:"translate(-50%, -50%)  scale(1.6)"},{offset:.76,opacity:"0",transform:"translate(-50%, -50%)  scale(1.9)"},{opacity:"0",transform:"translate(-50%, -50%)  scale(2.1)"}],N(P({},Gc),{opacity:"1"})],[X(kc,"fire-blur"),st(),N(P({},Gc),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[X(kc,"fire-pulse"),Ze(),N(P({},Gc),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),Rf=B({id:"#spell-poison-cloud-debuff",name:"Poisoned",activationType:A.Debuff,icon:P({icon:"poison-cloud"},oi),getDescription(i){return{descriptions:[D(`Takes ${ku} damage at the beginning of round, attack rating is lowered by ${Rc}. Rounds left: ${i.spellInstance.state?.debuffRoundsLeft}.`)]}},config:{spellConfig:{init({events:i,actions:e,thisSpell:r,spellInstance:t,vfx:n}){i.on({SpellPlacedOnUnitGroup({target:o}){let s={debuffRoundsLeft:Gf};t.state=s;let p=e.createModifiers({heroBonusAttack:-Rc});n.createEffectForUnitGroup(o,Fu),e.addModifiersToUnitGroup(o,p),e.historyLog(`${o.type.name} gets negative effect "${r.name}"`),i.on({NewRoundBegins(f){e.dealDamageTo(o,V.randIntInRange(Au,Ou),ge.Poison,C=>{e.historyLog(`Poison deals ${C.finalDamage} damage to ${o.type.name}, ${C.unitLoss} units perish`),n.createEffectForUnitGroup(o,Fu),n.createFloatingMessageForUnitGroup(o,Ut(C.finalDamage,C.unitLoss),{duration:1e3})}),s.debuffRoundsLeft--,s.debuffRoundsLeft||(e.removeSpellFromUnitGroup(o,t),e.removeModifiresFromUnitGroup(o,p))}})}})}}}}),Gu=B({id:"#spell-poison-cloud",name:"Poison Cloud",activationType:A.Target,icon:{icon:"poison-cloud"},getDescription(i){return{descriptions:[D(`Poisons target, lowering attack rating by ${Rc} and dealing ${ku} damage at the beginning of each round. Lasts 2 rounds.`)]}},config:{spellConfig:{targetCastConfig:{canActivate:at},getManaCost(i){return{1:2,2:3,3:4,4:5}[i.currentLevel]},init({events:i,actions:e,ownerPlayer:r,ownerHero:t,thisSpell:n}){i.on({PlayerTargetsSpell(o){e.historyLog(`${t.name} casts "${n.name}" against ${o.target.type.name}`);let s=e.createSpellInstance(Rf);e.addSpellToUnitGroup(o.target,s,r)}})}}}});var Bu=65,Hu=25,Ru=vu(Bu,Hu),Xn=3,Uu=[{targets:1,damage:[.3]},{targets:1,damage:[.6]},{targets:2,damage:[.65,.25]}],qs=B({id:"#spell-rain-of-fire",name:"Rain of Fire",activationType:A.Target,icon:{icon:"fire"},getDescription({ownerHero:i,spellInstance:e}){let r=i.specialtiesModGroup.getModValue("specialtyFireMastery")||0,t=[D(`Deals ${Bu} +${Hu} damage per level (${Ru(e.currentLevel)}) to the target.`),D("<br>Improves with Fire Mastery: gains additional targets.")];if(r){let n=Uu[r-1];t.push(D(`<hr/>Fire Mastery ${r}:<br>Additional targets: ${n.targets}<br>Damage: ${n.damage.map(Bs).join(", ")}`))}return{descriptions:t}},config:{spellConfig:{targetCastConfig:{canActivate:at},init:({events:i,actions:e,thisSpell:r,ownerHero:t,vfx:n,spellInstance:o})=>{i.on({PlayerTargetsSpell(s){let p=Ru(o.currentLevel);function f(w,T,U){e.dealDamageTo(w,T,ge.Fire,pe=>{e.historyLog(`${t.name} deals ${pe.finalDamage} damage to ${pe.initialUnitCount} ${w.type.name} with ${r.name}, ${pe.unitLoss} units perish.`),setTimeout(()=>{n.createEffectForUnitGroup(w,Us,{duration:850}),n.createFloatingMessageForUnitGroup(w,Ut(pe.finalDamage,pe.unitLoss),{duration:1200})},U*250)})}f(s.target,p,0);let C=t.specialtiesModGroup.getModValue("specialtyFireMastery")||0;if(C){let w=Uu[C-1],T=e.getAliveUnitGroupsOfPlayer(s.target.ownerPlayer);V.removeItem(T,s.target),T.length&&V.getRandomItems(T,w.targets).forEach((pe,ie)=>{f(pe,p*w.damage[ie],ie+1)})}}})},getManaCost:i=>({1:Xn,2:Xn,3:Xn+1,4:Xn+1,5:Xn+2,6:Xn+2,7:Xn+2})[i.currentLevel]}}});var Lu=2,Nu=.17,ju=B({id:"#spell-wind-bless-buff",name:"Wind Bless",icon:{icon:"feather-wing",bgClr:At.DefautlBuffBg,iconClr:At.DefautlBuffClr},activationType:A.Buff,getDescription(){return _p(`Attack of ranged units increased by ${Lu} and Block-Piercing by ${Bs(Nu)}.`)},config:{spellConfig:{init:({events:i,actions:e,spellInstance:r})=>{i.on({SpellPlacedOnUnitGroup(t){let n=e.createModifiers({heroBonusAttack:Lu,blockPiercingPercent:Nu});r.state={roundsLeft:1,target:t.target,mods:n},e.addModifiersToUnitGroup(t.target,n)},NewRoundBegins(t){let n=r.state;--n.roundsLeft||(e.removeSpellFromUnitGroup(n.target,r),e.removeModifiresFromUnitGroup(n.target,n.mods))}})}}}});var $u=20,Vu=30,zu=2,Uf=yn("dragon-breath"),Wu=B({id:"#spell-fire-breath",name:"Fire Breath",activationType:A.Passive,icon:{icon:"dragon-breath"},getDescription({ownerUnit:i}){return{descriptions:[D(`${i?.type.name} covers ground with fire breath at the beginning of each round, dealing ${$u}-${Vu} fire damage to ${zu} random enemy groups.`)]}},config:{spellConfig:{init({actions:i,vfx:e,ownerPlayer:r,ownerUnit:t,events:n,thisSpell:o}){n.on({NewRoundBegins(){let s=i.getAliveUnitGroupsOfPlayer(i.getEnemyOfPlayer(r)),p=V.getRandomItems(s,zu);i.historyLog(`${t?.type.name} casts ${o.name}.`),p.forEach(f=>{let C=V.randIntInRange($u,Vu);e.createEffectForUnitGroup(f,Uf,{duration:1300}),i.dealDamageTo(f,C,ge.Fire,w=>{i.historyLog(`${t?.type.name} deals ${w.finalDamage} damage to ${w.initialUnitCount} ${f.type.name} with ${o.name}, ${w.unitLoss} units perish`),e.createFloatingMessageForUnitGroup(f,Ut(w.finalDamage,w.unitLoss),{duration:1800})})})}})}}}});var Jn=(i,e)=>i!==e?` (${e}% against ranged units)`:"",er=i=>{let{icon:e,name:r,blockConfig:t,description:n}=i;return B({id:i.id,name:r,activationType:A.Passive,icon:{icon:e},getDescription({ownerUnit:o,spellInstance:s}){let p=s.currentLevel-1,f=t.minDamage[p],C=t.maxDamage[p],w=xc(t.chance[p]),T=xc(t.chanceAgainstRange[p]);return{descriptions:[D(n({meleeChance:w,rangedChance:T,blockValue:mu(f,C)}))]}},config:{spellConfig:{onAcquired({ownerUnit:o,spellInstance:s}){console.log("Aquired",s),s.state?.damageBlockMod&&o.removeSpellMods(s.state.damageBlockMod),s.state={damageBlockMod:{__attackConditionalModifiers({attacker:p}){let f=s.currentLevel-1,C=t.minDamage[f],w=t.maxDamage[f];return p?.modGroup.getModValue("isRanged")?{damageBlockMin:C,damageBlockMax:w,chanceToBlock:t.chanceAgainstRange[f]}:{damageBlockMin:C,damageBlockMax:w,chanceToBlock:t.chance[f]}}}},o.addSpellMods(s.state.damageBlockMod)},init(){}}}})};var qu=er({id:"#spell-knight-block",name:"Damage Block",icon:"heavy-shield",blockConfig:{minDamage:[14,22,34,45,120],maxDamage:[20,28,42,58,160],chance:[.6,.65,.7,.77,.68],chanceAgainstRange:[.6,.65,.72,.8,.7]},description:({blockValue:i,meleeChance:e,rangedChance:r})=>`Knights can block ${i} damage with ${e}% chance${Jn(e,r)}.`}),Yu=er({id:"#spell-tower-shields-block",name:"Tower Shields",icon:"heavy-shield",blockConfig:{minDamage:[14,22,34,45,120],maxDamage:[20,28,42,58,160],chance:[.6,.65,.7,.77,.68],chanceAgainstRange:[.6,.65,.72,.8,.7]},description:({blockValue:i,meleeChance:e,rangedChance:r})=>`Tower shields can block ${i} damage with ${e}% chance${Jn(e,r)}.`});var Pb=B({id:"#spell-protection-aura",name:"Protected",activationType:A.Buff,icon:{icon:"spear-head"},getDescription:()=>({descriptions:["Unit is being protected"]}),config:{spellConfig:{onAcquired({ownerUnit:i,spellInstance:e}){},init({}){}}}}),Qu=B({id:"#spell-protection",name:"Protection",icon:{icon:"spear-head"},activationType:A.Passive,getDescription:()=>({descriptions:["An aura that affects allies in range of 1 and gives damage block plus bonus armor."]}),config:{flags:{isAura:!0},spellConfig:{onAcquired({spellInstance:i,ownerUnit:e}){},init({ownerUnit:i,events:e,actions:r}){e.on({AuraCheck({target:t}){}})}}}});var Mt=([[i,e],r,t,n,o,s])=>({damageInfo:{minDamage:i,maxDamage:e},attackRating:r,defence:t,health:n,speed:o,mana:s||0});function qt(i){return $e(i)}var Uc={createRandomArmy(i){let e=V.randIntInRange(i.minUnitGroups,i.maxUnitGroups),r=[],t=[...i.units],n=t.reduce((o,s)=>{let[p,f,C,w=1/0]=s;return o.set(s,{unitType:p,min:f,max:C,maxGroupsOfThisType:w,createdTimes:0}),o},new Map);console.log("options ->>",i),console.log("Units Map ->>",n);for(let o=0;o<e;o++){let s=V.randItem(t),p=n.get(s),f=p.unitType,w={count:V.randIntInRange(p.min,p.max),unitType:f};r.push(w),p.createdTimes++,p.createdTimes>=p.maxGroupsOfThisType&&(console.log("this unit was generated max times"),n.delete(s),V.removeItem(t,s))}return console.log("generated groups",r),r}},He=i=>()=>({descriptions:i});var Ku={experience:0,gold:0};Ve.defineUnitType({id:"#unit-h00",name:"Pikemen",level:1,mainPortraitUrl:W.Pikemen,baseRequirements:{gold:55},getDescription:He([F("Tier 1 Castle unit. Can be upgraded into Halberdier."),F("<br>While possessing good average stats, Pikemen also strikes back at any attacker."),F("<br>Receives bonuses from Combat Tactics speciality.")]),defaultSpells:[Qu],defaultModifiers:{counterattacks:!0,retaliationDamagePercent:.7},baseStats:{damageInfo:{minDamage:2,maxDamage:3},attackRating:2,defence:2,health:8,speed:13},upgradeDetails:{target:"#unit-h01",upgradeCost:{gold:15}},neutralReward:Ku});Ve.defineUnitType({id:"#unit-h01",mainPortraitUrl:W.Pikemen,name:"Halberdier",level:1,baseStats:Mt([[3,3],2,3,8,14]),getDescription:He([F("Tier 1 Castle unit. Upgraded version of Pikemen."),F("<br>More durable and strong version of Pikemen, also retains ability to counterattack any attacker."),F("<br>Receives bonuses from Combat Tactics speciality.")]),defaultModifiers:{counterattacks:!0,retaliationDamagePercent:.85,__auraModifiers({remoteness:i,target:e,thisUnit:r}){if(i===1){let t=r.count*.8;return{chanceToBlock:1,damageBlockMin:t,damageBlockMax:t}}return null}},baseRequirements:{gold:70,redCrystals:0},upgraded:!0,neutralReward:Ku});Ve.defineUnitType({id:"#unit-h10",mainPortraitUrl:W.Archer,name:"Archers",level:2,getDescription:He([F("Tier 2 Castle ranged unit. Can be upgraded into Crossbowmen."),F("<br>Archers are one of the fastest units, allowing hero to have an early turn against most early foes. Attacks twice per turn."),F("<br>In return to their advantages, they are also costly and relatively fragile."),F("<br>Receives bonuses from Archery specialty, granting bonus Attack Rating and Block-piercing.")]),baseStats:{damageInfo:{minDamage:3,maxDamage:4},attackRating:1,defence:2,health:9,speed:21},upgradeDetails:{target:"#unit-h11",upgradeCost:{gold:25}},getUnitTypeSpecialtyModifiers(i){return i.specialtyArchery===1?{heroBonusAttack:1,blockPiercingPercent:.15}:i.specialtyArchery>=2?{heroBonusAttack:2,blockPiercingPercent:.25}:{}},defaultModifiers:{isRanged:!0},minQuantityPerStack:12,defaultTurnsPerRound:2,baseRequirements:{gold:95},neutralReward:{experience:3,gold:5}});Ve.defineUnitType({id:"#unit-h11",mainPortraitUrl:W.Archer,name:"Crossbowmen",level:2,getDescription:He([F("Tier 2 Castle ranged unit. Upgraded version of Archers."),F("<br>Crossbowmen are one of the fastest units, allowing hero to have an early turn against most early foes. Attacks twice per turn."),F("<br>Crossbowmen have higher base stats and less fragile than Archers, but also have 35% block-piercing attack."),F("<br>Receives bonuses from Archery specialty, granting bonus Attack Rating and Block-piercing.")]),baseStats:{damageInfo:{minDamage:3,maxDamage:4},attackRating:4,defence:3,health:14,speed:21},defaultTurnsPerRound:2,getUnitTypeSpecialtyModifiers(i){return i.specialtyArchery===1?{heroBonusAttack:1,blockPiercingPercent:.2}:i.specialtyArchery>=2?{heroBonusAttack:2,blockPiercingPercent:.3}:{}},defaultModifiers:{isRanged:!0,blockPiercingPercent:.35},upgraded:!0,baseRequirements:{gold:120},neutralReward:{experience:4.5,gold:7}});Ve.defineUnitType({id:"#unit-h20",mainPortraitUrl:W.UnitMelee,name:"Knights",level:3,getDescription:He([F("Tier 3 Castle unit."),F("<br>Knights are possessing high armor and attack. "),F("<br>Chance-based ability to block damage along with +12% to Fire, Cold and Lightning resistances makes them durable fighters.")]),baseStats:Mt([[6,9],6,5,17,11]),baseRequirements:{gold:120},defaultSpells:[qu],defaultModifiers:{resistFire:12,resistCold:12,resistLightning:12},neutralReward:{experience:10,gold:7}});Ve.defineUnitType({id:"#unit-h30",name:"Cavalry",mainPortraitUrl:W.UnitMelee,getDescription:He([F("Tier 4 Castle cavalry unit, can be upgraded into Heavy Cavalry."),F("<br>Cavalry is armored unit type that also deals heavy damage with 55% block-piercing attack.")]),level:4,baseStats:{damageInfo:{minDamage:14,maxDamage:19},attackRating:9,defence:10,health:33,speed:16},defaultModifiers:{blockPiercingPercent:.55,isCavalry:!0},baseRequirements:{gold:225,wood:1},neutralReward:{experience:20,gold:25},upgradeDetails:{target:"#unit-h31",upgradeCost:{gold:85}}});Ve.defineUnitType({id:"#unit-h31",name:"Heavy Cavalry",mainPortraitUrl:W.UnitMelee,getDescription:He([F("Tier 4 Castle cavalry unit, upgraded version of Cavalry."),F("<br>Cavalry is armored unit type that also deals heavy damage with 55% block-piercing attack.")]),level:4,baseStats:{damageInfo:{minDamage:14,maxDamage:19},attackRating:9,defence:10,health:33,speed:16},defaultModifiers:{blockPiercingPercent:.55,isCavalry:!0},baseRequirements:{gold:310,wood:1},neutralReward:{experience:25,gold:35},upgraded:!0});Ve.defineUnitType({id:"#unit-h40",name:"Mystic Birds",mainPortraitUrl:W.FireBird,level:5,getDescription:He([F("Tier 5 Castle magical creatures of fire. Can be upgraded to Firebirds."),F("<br>Majestic and powerful creatures of fire that can heal and resurrect allied units. Resistant against fire (10%)."),F("<br>Has base manapool of 5."),F("<br>Deal 20% more damage against magical creatures.")]),baseStats:Mt([[18,26],8,10,46,16,5]),defaultSpells:[Dc],defaultModifiers:{resistFire:10,isMagical:!0,__attackConditionalModifiers({attacked:i}){return i.modGroup.getModValue("isMagical")?{baseDamagePercentModifier:.2}:{}}},baseRequirements:{gold:350,wood:1},upgradeDetails:{target:"#unit-h41",upgradeCost:{gold:125}},neutralReward:{experience:40,gold:60}});Ve.defineUnitType({id:"#unit-h41",name:"Firebirds",mainPortraitUrl:W.FireBird,level:5,getDescription:He([F("Tier 5 Castle magical creatures of fire, an upgraded version of Mystic Birds."),F("<br>Majestic and powerful of fire that can heal and resurrect allied units, has better stats than Mystical Birds and +17% fire resistance."),F("<br>Has base manapool of 8."),F("<br>Deal 30% more damage against magical creatures.")]),baseStats:Mt([[23,29],12,14,57,17,8]),defaultModifiers:{resistFire:17,isMagical:!0,__attackConditionalModifiers({attacked:i}){return i.modGroup.getModValue("isMagical")?{baseDamagePercentModifier:.3}:{}}},defaultSpells:[Dc],baseRequirements:{gold:475,wood:1},neutralReward:{experience:45,gold:60}});var Bc=ot({prefix:"Spells",events:{PlayerTargetsSpell:Be(),SpellPlacedOnUnitGroup:Be(),NewRoundBegins:Be(),PlayerCastsInstantSpell:Be(),UnitGroupAttacks:Be(""),AuraCheck:Be()}}),Cn=Bc.events;var Zu=B({id:"#spell-unit-poison-arrows-debuff",name:"Poisoned",icon:{icon:"chemical-arrow",bgClr:"green"},activationType:A.Passive,getDescription:({ownerUnit:i})=>({descriptions:[D("This group is poisoned, receiving poison damage.")]}),config:{spellConfig:{init({events:i,actions:e,vfx:r,spellInstance:t}){i.on({SpellPlacedOnUnitGroup({target:n}){r.createDroppingMessageForUnitGroup(n.id,{html:wi("Poisoned!")}),e.dealDamageTo(n,t.state?.poisonDamage||0,ge.Poison)}})}}}}),Hc=B({id:"#spell-unit-poison-arrows",name:"Poison Arrows",icon:{icon:"chemical-arrow"},activationType:A.Passive,getDescription:({ownerUnit:i})=>({descriptions:[D(`Poisons enemy on attack, dealing ${i.count*2} poison damage (2 damage per unit).`)]}),config:{spellConfig:{init({events:i,actions:e,vfx:r,ownerUnit:t,ownerPlayer:n}){i.on({UnitGroupAttacks({attacker:o,attacked:s}){if(o!==t)return;let p=e.createSpellInstance(Zu);p.state={poisonDamage:o.count*2},!s.spells.some(f=>f.baseType===Zu)&&e.addSpellToUnitGroup(s,p,n)}})}}}});var Ys={experience:0,gold:0};kt.defineUnitType({id:"#unit-f00",mainPortraitUrl:W.UnitMelee,name:"Raiders",level:1,baseStats:{damageInfo:{minDamage:1,maxDamage:2},attackRating:1,speed:16,defence:2,health:9},getDescription:He([F("Tier 1 Fort unit. Can be upgraded into Clan."),F("<br>The main attacking mass of the Fort, the goblins with long sharp spears. They are cheap and fragile, but swift, allowing to get an earlier turn and can be dangerous due to the chance of dealing critical damage.")]),defaultModifiers:{counterattacks:!0,criticalDamageChance:.35,criticalDamageMul:1},baseRequirements:{gold:35,redCrystals:0},upgradeDetails:{target:"#unit-f01",upgradeCost:{gold:20}},neutralReward:Ys});kt.defineUnitType({id:"#unit-f01",mainPortraitUrl:W.UnitMelee,name:"Clan",level:1,baseStats:{damageInfo:{minDamage:2,maxDamage:2},attackRating:3,speed:17,defence:3,health:9},getDescription:He([F("Tier 1 Fort unit, upgraded version of Raiders."),F("<br>The main attacking mass of the Fort, the goblins with long sharp spears. They are cheap and fragile, but swift, allowing to get an earlier turn and can be dangerous due to the chance of dealing critical damage.")]),defaultModifiers:{counterattacks:!0,criticalDamageChance:.35,criticalDamageMul:1},baseRequirements:{gold:55,redCrystals:0},upgraded:!0,neutralReward:Ys});kt.defineUnitType({id:"#unit-f10",mainPortraitUrl:W.UnitRanged,name:"Goblin Archers",level:2,baseStats:{damageInfo:{minDamage:1,maxDamage:1},attackRating:1,speed:14,defence:3,health:14},getDescription:He([F("Tier 2 ranged unit of the Fort. Can be upgraded into Goblin Shooters."),F("<br>Basic archers that deal very low damage due to poor technologies, but mitigate that weakness by adding poison to their arrows. Attacks twice per turn.")]),defaultTurnsPerRound:2,defaultModifiers:{isRanged:!0},defaultSpells:[Hc],baseRequirements:{gold:60,redCrystals:0},upgradeDetails:{target:"#unit-f11",upgradeCost:{gold:20}},neutralReward:Ys});kt.defineUnitType({id:"#unit-f11",mainPortraitUrl:W.UnitRanged,name:"Goblin Shooters",level:2,baseStats:{damageInfo:{minDamage:1,maxDamage:1},attackRating:1,speed:14,defence:4,health:18},getDescription:He([F("Tier 2 ranged unit of the Fort. Upgraded version of Goblin Archers."),F("<br>Basic archers that deal very low damage due to poor technologies, but mitigate that weakness by adding poison to their arrows."),F("<br>As an improved version of Goblin Archers they are equipped with primitive but fast-reloading crossbows, allowing them to attack 3 times per round.")]),defaultModifiers:{isRanged:!0},defaultTurnsPerRound:3,defaultSpells:[Hc],baseRequirements:{gold:60,redCrystals:0},upgraded:!0,neutralReward:Ys});var Yt=kr.createFaction({id:"#faction-constellation",title:"Constellation",icon:"arrow-cluster"});var Xu=B({id:"#spell-dream-aura",name:"Dream Aura",icon:{icon:"overmind"},getDescription(){return{descriptions:["Damage dealt to nearby allies becomes part of Star Dragon's dream. Increases All Resist (+17%) and Defence(6) for closest allies."]}},activationType:A.Passive,config:{spellConfig:{init(){}}}});var Bf=B({id:"#spell-essence-leak-debuff",activationType:A.Debuff,icon:{icon:"implosion"},getDescription:()=>({descriptions:[D("Attacker will heal himself.")]}),name:"Life loss",config:{spellConfig:{getManaCost:()=>0,init(){},targetCastConfig:{}}}}),Ju=B({id:"#spell-essence-leak",name:"Essence Leak",icon:{icon:"implosion"},activationType:A.Target,getDescription:()=>({descriptions:[D("Places a curse on enemy. Any time target is attacked, the attacker will be healed by 1 point per each Sprite in the current group")]}),config:{spellConfig:{getManaCost:()=>2,init({events:i,actions:e,ownerUnit:r,vfx:t}){i.on({PlayerTargetsSpell({target:n}){let o=e.createSpellInstance(Bf,{initialLevel:1});n.addSpell(o),t.createEffectForUnitGroup(n,Ji("implosion","rgb(223 165 255)"),{duration:1e3})}})},targetCastConfig:{canActivate:at}}}});Yt.defineUnitType({id:"#unit-c00",name:"Sprite",level:1,mainPortraitUrl:W.UnitMelee,baseRequirements:{gold:75},getDescription:()=>({descriptions:[D("Tier 1 units of the Constellation."),D("<br>One of the strongest tier 1 unit types due to high-value abilities. Sprites can curse specific enemy to heal allied attackers.")]}),defaultSpells:[Ju],baseStats:{damageInfo:{minDamage:2,maxDamage:3},speed:8,defence:4,health:14,attackRating:4},neutralReward:{experience:12,gold:8}});Yt.defineUnitType({id:"#unit-c10",name:"Fencer",level:2,mainPortraitUrl:W.UnitMelee,baseRequirements:{gold:75},baseStats:{damageInfo:{minDamage:2,maxDamage:4},speed:7,defence:2,health:13,attackRating:5},neutralReward:{experience:12,gold:8}});Yt.defineUnitType({id:"#unit-c20",name:"Saggitar",level:3,mainPortraitUrl:W.UnitRanged,baseRequirements:{gold:95},defaultModifiers:{isRanged:!0},baseStats:{damageInfo:{minDamage:6,maxDamage:8},speed:17,defence:4,health:17,attackRating:5},neutralReward:{experience:18,gold:14}});Yt.defineUnitType({id:"#unit-c30",name:"Chariot",level:4,mainPortraitUrl:W.UnitMelee,baseRequirements:{gold:185},baseStats:{damageInfo:{minDamage:15,maxDamage:24},speed:24,defence:8,health:35,attackRating:9},neutralReward:{experience:18,gold:14}});Yt.defineUnitType({id:"#unit-c60",name:"Star Dragon",level:7,mainPortraitUrl:W.UnitMelee,baseRequirements:{gold:1e3,gems:1,redCrystals:1},upgradeDetails:{target:"#unit-c61",upgradeCost:{gold:500,gems:1}},baseStats:{damageInfo:{minDamage:40,maxDamage:60},speed:20,defence:18,health:175,attackRating:16},neutralReward:{experience:180,gold:150}});Yt.defineUnitType({id:"#unit-c61",name:"Night Wyvern",level:7,mainPortraitUrl:W.UnitMelee,baseRequirements:{gold:1500,gems:2,redCrystals:1},baseStats:{damageInfo:{minDamage:47,maxDamage:64},speed:22,defence:21,health:245,attackRating:17},defaultModifiers:{counterattacks:!0,retaliationDamagePercent:.5},defaultSpells:[Xu],neutralReward:{experience:180,gold:150},upgraded:!0});var ze=kr.createFaction({id:"#faction-neutrals",title:"Neutrals",icon:"monster-skull"});ze.defineUnitType({id:"#unit-neut-gnoll-0",mainPortraitUrl:W.UnitMelee,name:"Gnolls",level:1,baseStats:Mt([[3,4],1,1,10,12]),getDescription:He([F("Gnolls are tier 1 forest dwellers with average stats."),F("Mostly known for being bandits, they possess a fire resistant fur, giving them +10% to Fire Resist.")]),defaultModifiers:{resistFire:10,isForest:!0},baseRequirements:{gold:100},neutralReward:{experience:3.3,gold:3.2}});ze.defineUnitType({id:"#unit-neut-poison-ivy-0",mainPortraitUrl:W.UnitMelee,name:"Poison Ivy",level:2,baseStats:Mt([[3,4],1,1,10,10]),getDescription:He([F("Tier 2 forest dweller."),F("A mutated plant, a sturdy enemy with venomous attack, but vulnerable to any magic damage.")]),defaultModifiers:{resistAll:-20,isForest:!0},baseRequirements:{gold:10},neutralReward:{experience:4.5,gold:3.2}});ze.defineUnitType({id:"#unit-neut-thief-0",mainPortraitUrl:W.UnitMelee,name:"Thieves",level:2,getDescription:He([F("Tier 2 forest dweller."),F("<br>Thieves are very dangerous despite being fragile. Their high speed allows them to have their turn earlier, and ability to attack twice, along with high damage, can result in heavy losses.")]),baseStats:Mt([[6,7],2,1,9,16]),defaultTurnsPerRound:2,defaultModifiers:{isForest:!0},baseRequirements:{},neutralReward:{experience:4.55,gold:4.7}});ze.defineUnitType({id:"#unit-neut-forest-troll-0",mainPortraitUrl:W.UnitMelee,name:"Forest Trolls",level:3,getDescription:He([F("Tier 3 forest dweller."),F("<br>Durable and strong, groups of Forest Trolls can absorb big damage, but their slowness usually makes them use their move last.")]),baseStats:Mt([[5,7],3,4,17,10]),defaultModifiers:{isForest:!0},baseRequirements:{},neutralReward:{experience:6,gold:6}});ze.defineUnitType({id:"#unit-neut-fire-spirit-0",name:"Fire Spirits",mainPortraitUrl:W.UnitMelee,baseRequirements:{},level:3,baseStats:Mt([[9,13],3,3,17,18,1]),defaultModifiers:{resistFire:20,resistCold:15,isMagical:!0},getDescription:He([F("Tier 3 Neutral magical creature of fire."),F("<br>Tenacious and strong. Have increased resists against Fire (+20%) and Ice (+15%)."),F("<br>Has base manapool of 1.")]),neutralReward:{experience:20,gold:20},defaultSpells:[]});var ed=er({id:"#spell-skeleton-block",name:"Damage Block",icon:"heavy-shield",blockConfig:{minDamage:[8,24,45,86,120],maxDamage:[16,36,55,96,160],chance:[.2,.3,.35,.4,.45],chanceAgainstRange:[.55,.65,.7,.75,.8]},description:({blockValue:i,meleeChance:e,rangedChance:r})=>`Skeletons can block ${i} damage with ${e}% chance${Jn(e,r)}.`});ze.defineUnitType({id:"#unit-neut-ghost-0",mainPortraitUrl:W.UnitMelee,name:"Ghosts",level:1,baseRequirements:{gold:30},getDescription(i){return{descriptions:[F("Undead unit."),F("<br>Possesses no outstanding qualities outside of low price and passive ability Fright. Gains improvements from Necromancy."),F("<br>Can be upgraded into Wraiths, faster unit with better stats, inheriting Fright ability.")]}},getUnitTypeSpecialtyModifiers:i=>i.specialtyNecromancy>1?{unitGroupSpeedBonus:4,heroBonusDefence:1}:null,baseStats:Mt([[2,3],1,2,6,8]),defaultSpells:[Ec],neutralReward:{experience:2.3,gold:3},upgradeDetails:{target:"#unit-neut-ghost-1",upgradeCost:{gold:25}},defaultModifiers:{isGhost:!0}});ze.defineUnitType({id:"#unit-neut-ghost-1",mainPortraitUrl:W.UnitMelee,name:"Wraiths",level:1,baseRequirements:{gold:55},baseStats:Mt([[3,3],2,4,12,12]),getDescription(i){return{descriptions:[F("Undead unit. Upgraded and faster version of Ghosts."),F("<br>While having increased stats, inherits passive ability Fright."),F("<br>Gains improvements from Necromancy.")]}},getUnitTypeSpecialtyModifiers:i=>i.specialtyNecromancy===1?{unitGroupSpeedBonus:4,heroBonusDefence:2}:i.specialtyNecromancy>=2?{unitGroupSpeedBonus:4,heroBonusDefence:2,resistCold:10,resistFire:10}:null,defaultSpells:[Ec],defaultModifiers:{isGhost:!0},neutralReward:{experience:2.3,gold:2.4},upgraded:!0});ze.defineUnitType({id:"#unit-neut-skeleton-0",name:"Skeletons",mainPortraitUrl:W.UnitMelee,level:1,getDescription(){return{descriptions:[F("Undead unit."),F("Usually found in big numbers, Skeletons also have ability to block damage with some chance.")]}},baseStats:{damageInfo:{minDamage:1,maxDamage:2},attackRating:1,defence:2,health:9,speed:11},defaultSpells:[ed],baseRequirements:{gold:55},neutralReward:{experience:3,gold:2}});ze.defineUnitType({id:"#unit-neut-lich-0",name:"Liches",mainPortraitUrl:W.UnitMelee,level:4,getDescription(){return{descriptions:[F("Tier 4 Undead unit. Can be upgraded into Master Liches."),F("<br>Powerful undead creatures, standing in the head of undead armies. Masterful wielders of long swords, they also possess 25% lifesteal and cannot be slowed down.")]}},baseStats:{damageInfo:{minDamage:13,maxDamage:17},attackRating:6,defence:5,health:32,speed:14},defaultModifiers:{lifesteal:25,isGhost:!0,cannotBeSlowed:!0},baseRequirements:{gold:400},neutralReward:{experience:30,gold:2},upgradeDetails:{target:"#unit-neut-lich-1",upgradeCost:{gold:100}}});var B_=ze.defineUnitType({id:"#unit-neut-lich-1",name:"Master Liches",mainPortraitUrl:W.UnitMelee,level:4,getDescription(){return{descriptions:[F("Tier 4 Undead unit, an upgraded version of Liches."),F("<br>Powerful undead creatures, standing in the head of undead armies. Masterful wielders of long swords, they possess improved 45% lifesteal and cannot be slowed down.")]}},baseStats:{damageInfo:{minDamage:14,maxDamage:19},attackRating:7,defence:7,health:35,speed:15},defaultModifiers:{lifesteal:45,isGhost:!0,cannotBeSlowed:!0},baseRequirements:{gold:400},neutralReward:{experience:40,gold:2}});ze.defineUnitType({id:"#unit-neut-imperial-guard",name:"Imperial Guard",level:3,neutralReward:{experience:10,gold:0},baseStats:{attackRating:3,defence:3,damageInfo:{maxDamage:3,minDamage:3},health:14,speed:12},defaultModifiers:{retaliationDamagePercent:.5,counterattacks:!0},defaultSpells:[Yu],getDescription:()=>({descriptions:[D("Imperial Guards, a part of the imperial army, well trained with combat tactics. They can block damage and retaliate.")]}),baseRequirements:{}});var td=er({id:"#spell-devastator-block",name:"Scale Armor",icon:"dragon-wing",blockConfig:{minDamage:[16],maxDamage:[24],chance:[.35],chanceAgainstRange:[.65]},description:({blockValue:i,meleeChance:e,rangedChance:r})=>`Sturdy scales of Devastator give a ${e}% chance to block ${i} damage${Jn(e,r)}.`});ze.defineUnitType({id:"#unit-neut-boss-devastator",name:"Devastator",mainPortraitUrl:W.UnitMelee,level:8,getDescription:He([F("An evil dragon of fire."),F("<br>Dangerous boss unit with large health pool. Resistant to magic, has +50% to Fire Resist and +20% to All Other Resists, also posseses Fire Breath ability that damages random enemies with fire."),F("<br>His scales allow him to block some damage. Cannot be slowed.")]),baseStats:{damageInfo:{minDamage:32,maxDamage:47},attackRating:9,defence:9,health:820,speed:14},defaultSpells:[Wu,td],defaultModifiers:{isBoss:!0,resistAll:20,resistFire:30,cannotBeSlowed:!0},baseRequirements:{},neutralReward:{experience:120,gold:340},upgraded:!1});ze.defineUnitType({id:"#unit-neut-ranger-0",name:"Rangers",level:2,baseStats:{attackRating:4,damageInfo:{maxDamage:8,minDamage:6},defence:4,health:14,speed:16},defaultModifiers:{__attackConditionalModifiers({attacked:i}){return i.modGroup.getModValue("isForest")?{baseDamagePercentModifier:.75}:{}}},defaultSpells:[],getDescription(i){return{descriptions:[D("Tier 2 Neutral unit."),D("Efficient against forest dwellers, dealing 75% more damage to them.")]}},neutralReward:{experience:1,gold:1},baseRequirements:{gold:100}});var id=18,nd=we({id:"#item-blacklich-swords",name:"Black Lich Sword",icon:"bat-sword",slot:K.Weapon,stats:{heroBonusAttack:3,specialtyNecromancy:1,__unitConditionalMods(i){return i.type.level<=4&&!i.modGroup.getModValue("isRanged")?{lifesteal:id}:null}},cost:{gold:1e3,gems:1},description({thisItemBase:i}){return{descriptions:[Qe(i),D(`Grants ${id}% Lifesteal to non-ranged units up to level 4.`)]}}});var wM=we({id:"#item-doomstring",name:"Doomstring",slot:K.Weapon,icon:"crossbow",stats:{heroBonusAttack:8,specialtyOffence:3,specialtyArchery:2,specialtyFireMastery:1},cost:{gold:5e3,redCrystals:2,gems:1},description:({thisItemBase:i})=>({descriptions:[Qe(i),D("An ancient ballista made in infernal abyss."),D("Grants ability: Doom. Doomed target looses 50% of armor and receives 50% increased physical damage.")]})});var rd=we({id:"#item-eclipse-wand",name:"Eclipse Wand",slot:K.Weapon,stats:{specialtyMagic:1,specialtyMagicRecovery:1,heroMaxMana:5},icon:"crystal-wand",cost:{gold:550},sellingCost:{gold:300},description({thisItemBase:i}){return{descriptions:[Qe(i),D("At the beginning of the battle, applies level 1 Enchant to all enemy groups.")]}},config:{init:({actions:i,events:e,ownerPlayer:r})=>{e.on({NewRoundBegins(t){if(t.round===0){let n=i.getEnemyOfPlayer(r);i.getUnitGroupsOfPlayer(n).forEach(s=>{let p=i.createSpellInstance(_c,{initialLevel:1});i.addSpellToUnitGroup(s,p,r)})}}})}}});var Lc=ot({prefix:"Items",events:{NewRoundBegins:Be("")}}),Nc=Lc.events;var Qs=class Qs{constructor(){this.inventoryItemsMap=new Map,this.equipedItemsSet=new Set}static getSlotTypes(){return this.slotTypes}static getExtendedSlotTypes(){return[...this.extendedSlotsMap.values()]}static getSlotExtendedInfo(e){return this.extendedSlotsMap.get(e)}static filterItemsForSlot(e,r){return r.filter(t=>t.baseType.slotType===e)}equipItem(e){let r=e.baseType.slotType,t=this.inventoryItemsMap.get(r);this.inventoryItemsMap.set(r,e),t&&this.equipedItemsSet.delete(t),this.equipedItemsSet.add(e)}unequipItem(e){this.inventoryItemsMap.delete(this.getItemSlotType(e)),this.equipedItemsSet.delete(e)}unequipSlot(e){let r=this.inventoryItemsMap.get(e);r&&(this.inventoryItemsMap.delete(e),this.equipedItemsSet.delete(r))}getItemInSlot(e){return this.inventoryItemsMap.get(e)||null}isSlotEquipped(e){return this.inventoryItemsMap.has(e)}isItemEquipped(e){return this.equipedItemsSet.has(e)}getEquippedItems(){return[...this.equipedItemsSet]}getItemSlotType(e){return e.baseType.slotType}};Qs.slotTypes=[K.Headgear,K.Amulet,K.Weapon,K.Armor,K.Shield,K.Boots],Qs.extendedSlotsMap=new Map([[K.Headgear,{slotType:K.Headgear,name:"Headgear",icon:"knight-helmet"}],[K.Amulet,{slotType:K.Amulet,name:"Amulet",icon:"gem-pendant"}],[K.Weapon,{slotType:K.Weapon,name:"Weapon",icon:"sword"}],[K.Armor,{slotType:K.Armor,name:"Armor",icon:"vest"}],[K.Shield,{slotType:K.Shield,name:"Shield",icon:"shield"}],[K.Boots,{slotType:K.Boots,name:"Boots",icon:"boot-stomp"}]]);var Qt=Qs;var od=we({id:"#item-ice-bow",name:"Ice Bow",slot:K.Weapon,icon:"frozen-arrow",stats:{heroBonusAttack:1,specialtyArchery:1},cost:{gold:500},sellingCost:{gold:400},description({thisItemBase:i}){return{descriptions:[Qe(i),D("Bow which radiates cold, grants level 1 Frost Arrow")]}},spells:[{level:1,spell:_u}]});var Ks=we({id:"#item-irton-plate",name:"Irton Plate",slot:K.Armor,icon:"vest",cost:{gold:300},sellingCost:{gold:175},stats:{heroBonusDefence:3}});var sd=50,qM=we({id:"#item-lifeform",name:"Lifeform",slot:K.Armor,icon:"vest",stats:{heroBonusDefence:7,resistFire:25,resistPoison:20,resistLightning:15,resistCold:15},description({thisItemBase:i}){return{descriptions:[Qe(i),D(`An incredible artifact that shimmers with bright colors and emits life aura. Heals all units by ${sd} in the beginning of each round.`)]}},config:{init({events:i,actions:e,ownerPlayer:r}){i.on({NewRoundBegins:()=>{e.getUnitGroupsOfPlayer(r).forEach(n=>{e.healUnit(n,sd)})}})}}});var ad=we({id:"#item-meteor-sword",name:"Meteor Swords",slot:K.Weapon,icon:"dervish-swords",stats:{heroBonusAttack:2,specialtyFireMastery:1},cost:{gold:1100},sellingCost:{gold:450},spells:[{spell:Ws,level:1}],description({thisItemBase:i}){return{descriptions:[Qe(i),D("Two large black swords with an astronomical map depicted in gold on the blade. Grants Level 1 Meteor ability.")]}}});var Hr=we({id:"#item-wind-crest",name:"Wind Crest",slot:K.Headgear,stats:{heroBonusDefence:1},icon:"feather-wing",cost:{gold:500},sellingCost:{gold:250},description({thisItem:i,thisItemBase:e}){return{descriptions:[Qe(e),D("At the beginning of the fight, grants Wind Blessing (level 1) effect to your ranged units for 1 round.")]}},config:{init:({actions:i,events:e,ownerPlayer:r})=>{e.on({NewRoundBegins(t){t.round===0&&i.getUnitGroupsOfPlayer(r).filter(n=>n.type.defaultModifiers?.isRanged).forEach(n=>{let o=i.createSpellInstance(ju);i.addSpellToUnitGroup(n,o,r)})}})}}});var cd=we({id:"#item-wishmaster",name:"Wishmaster",slot:K.Headgear,stats:{heroBonusAttack:5,heroBonusDefence:4,resistAll:13},icon:"feather-wing",description({thisItem:i,thisItemBase:e}){return{descriptions:[Qe(e),D("An artefact of incredible strength.")]}}});var ld=50,dP=we({id:"#item-rising-sun",name:"Rising Sun",icon:"gem-pendant",slot:K.Amulet,stats:{heroBonusDefence:2},description({thisItemBase:i}){return{descriptions:[Qe(i),D(`Each round heals your units by ${ld}`)]}},config:{init({events:i,actions:e,ownerPlayer:r}){i.on({NewRoundBegins:()=>{e.getUnitGroupsOfPlayer(r).forEach(n=>{e.healUnit(n,ld)})}})}}});var gP=we({id:"#item-iron-pike",name:"Iron Pike",icon:"spear-head",slot:K.Weapon,cost:{gold:420},sellingCost:{gold:250},stats:{specialtyCombatTactics:1,heroBonusAttack:1}});var pd=B({id:"#spell-charged-strike",name:"Charged Strike",activationType:A.Target,icon:{icon:"lightning"},getDescription:()=>({descriptions:[D("Makes current unit group attack enemy with additional lightning damage."),D("If current unit group is cavalry type, damage is doubled, as well as critical damage is added"),D("Consumes Turn.")]}),config:{spellConfig:{init({actions:i,events:e,vfx:r}){e.on({PlayerTargetsSpell({target:t}){let n=i.getCurrentUnitGroup(),o=n.modGroup.getModValue("isCavalry"),s=i.createModifiers({criticalDamageMul:o?.2:.35,criticalDamageChance:1});i.addModifiersToUnitGroup(n,s),i.dealDamageTo(t,40,ge.Lightning),r.createEffectForUnitGroup(t,ru),i.unitGroupAttack(n,t),i.removeModifiresFromUnitGroup(n,s)}})},getManaCost(){return 2}}}});var DP=we({id:"#item-storm-pike",name:"Storm Pike",icon:"spear-head",slot:K.Weapon,cost:{gold:750},abilityDescription:"Grants ability Charged Strike that supplements unit attacks with lightning damage with additional effectiveness for any cavalry.",sellingCost:{gold:340},stats:{heroBonusAttack:3},spells:[{level:1,spell:pd}]});var AP=we({id:"#item-battlemage-sword",name:"Sword of the Battle Mage",slot:K.Weapon,icon:"sword",stats:{heroBonusAttack:3,heroMaxMana:8,specialtyMagicRecovery:2,specialtyFireMastery:1,specialtyColdMastery:1,specialtyLightningMastery:1},cost:{gold:1e3,redCrystals:1},sellingCost:{gold:600},description({thisItem:i,thisItemBase:e}){return{descriptions:[Qe(e)]}}});var RP=we({id:"#item-kite-shield",name:"Kite Shield",icon:"shield",slot:K.Shield,cost:{gold:450},sellingCost:{gold:400},stats:{__attackConditionalModifiers(){return{damageBlockMax:14,damageBlockMin:10,chanceToBlock:1}},heroBonusDefence:1},abilityDescription:"100% chance to block 10-14 damage"});var rD=Ve.createHero({id:"#hero-helvetica",name:"Helvetica",generalDescription:F("Helvetica is the mage who supports her own army with offensive fire spells as well as increasing their speed."),image:W.HeroHelvetica,abilities:[qs,Mu],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-h00",20,32,1],["#unit-h10",12,18,1],["#unit-h20",6,11,1]]}],items:[Hr],resources:{gems:0,gold:750,redCrystals:0,wood:4},stats:{mana:12,baseAttack:1,baseDefence:0},defaultModifiers:{}});var jc=2,ud=jc+3,Zs=we({id:"#item-light-boots",name:"Light Boots",icon:"boot-stomp",slot:K.Boots,cost:{gold:425},sellingCost:{gold:200},stats:{heroBonusDefence:1,__unitConditionalMods(i){return i.type.level===1?i.type.upgraded?{unitGroupSpeedBonus:ud}:{unitGroupSpeedBonus:jc}:null}},abilityDescription:`Increases speed of tier 1 units by ${jc} (${ud} if unit is upgraded).`});var Qo="fire-shield",$c={fontSize:"64px",color:"#ffbc6c"},Hf=Fe([[X(Qo,"fire-main"),Rt(),N(P({},$c),{opacity:"1"})],[X(Qo,"fire-blur"),st(),N(P({},$c),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[X(Qo,"fire-pulse"),Ze(),N(P({},$c),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]);var Lf=B({id:"#spell-fire-shield-buff",name:"Fire Shield",activationType:A.Buff,icon:P({icon:Qo},Ls),getDescription(){return{descriptions:[D("Unit is protected by Fire Shield, blocking 14-18 damage with 100% and receiving 15% Fire Resist.")]}},config:{spellConfig:{init:({events:i,actions:e,vfx:r})=>{let t=e.createModifiers({__attackConditionalModifiers(){return{chanceToBlock:1,damageBlockMax:18,damageBlockMin:14,resistFire:15}}});i.on({SpellPlacedOnUnitGroup(n){r.createEffectForUnitGroup(n.target,Hf,{duration:800}),e.addModifiersToUnitGroup(n.target,t)}})}}}}),dd=B({id:"#spell-fire-shield",name:"Fire Shield",activationType:A.Target,icon:{icon:Qo},getDescription(){return{descriptions:[D("Protects allied unit with a fire shield that blocks damage.")]}},config:{spellConfig:{targetCastConfig:{canActivate:vn},getManaCost(i){return{1:2,2:2,3:3,4:3}[i.currentLevel]},init:({events:i,actions:e,ownerPlayer:r,ownerUnit:t})=>{i.on({PlayerTargetsSpell(n){let o=e.createSpellInstance(Lf);e.addSpellToUnitGroup(n.target,o,r)}})}}}});var md=3,fd=2,hd=B({id:"#spell-summon-fire-spirits",name:"Fire Spirits",activationType:A.Instant,icon:{icon:"aura"},getDescription({spellInstance:i}){return{descriptions:[D("Can be casted only once per battle <hr/>"),D(`Summon ${md+fd*i.currentLevel} Fire Spirits that fight on your side.`),D("<hr/>Spirits have active ability Fire Shield and disappear when the fight is over.")]}},config:{spellConfig:{getManaCost(i){return 2+i.currentLevel},init({actions:i,spellInstance:e,ownerPlayer:r,events:t,vfx:n}){t.on({PlayerCastsInstantSpell(){let o=i.summonUnitsForPlayer(r,"#unit-neut-fire-spirit-0",md+fd*e.currentLevel);e.setCooldown(1/0);let s=i.createSpellInstance(dd,{initialLevel:1});i.addSpellToUnitGroup(o,s,r),n.createEffectForUnitGroup(o,Us,{duration:1e3});let p=i.getAliveUnitGroupsOfPlayer(i.getEnemyOfPlayer(r))}})}}}});var Fi={gems:0,gold:1250,redCrystals:0,wood:2},gd={gems:0,gold:0,redCrystals:0,wood:0},yd=i=>{let{id:e,abilities:r,army:t,items:n,name:o,resources:s,stats:p,generalDescription:f,image:C}=i,w={id:e,name:o,generalDescription:f,initialState:{abilities:r,army:t,items:n,resources:s,stats:p},image:C??W.HeroMage};return Ei(w),w};var vd=12,AD=Ve.createHero({id:"#hero-taltir",name:"Taltir",generalDescription:F(`Taltir specializes at utilizing Fire Spells, summoning Fire Spirits and devastating Meteors. Knowledge in magic defenses makes him start with +${vd}% to all resists.`),image:W.HeroTaltir,abilities:[hd,Ws],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-h20",6,11,2],["#unit-h30",3,6,2],["#unit-h00",25,30,1]]}],items:[Ks,Zs],resources:Fi,stats:{mana:14,baseAttack:2,baseDefence:2},defaultModifiers:{resistAll:vd}});var Cd=.14,Sd=bp(Cd),Wc=5,wd=2,Vc="cracked-shield",zc={fontSize:"64px",color:"rgb(220 145 129)"},Nf=Fe([[X(Vc,"fire-main"),[{opacity:"0",transform:"translate(-50%, -50%) scale(0.8)"},{opacity:"1",offset:.25,transform:"translate(-50%, -50%)  scale(1.2)"},{opacity:"1",offset:.35,transform:"translate(-50%, -50%)  scale(1.6)"},{offset:.76,opacity:"0",transform:"translate(-50%, -50%)  scale(1.9)"},{opacity:"0",transform:"translate(-50%, -50%)  scale(2.1)"}],N(P({},zc),{opacity:"1"})],[X(Vc,"fire-blur"),st(),N(P({},zc),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[X(Vc,"fire-pulse"),Ze(),N(P({},zc),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),jf=B({id:"#spell-corrosive-fog-debuff",name:"Corrosion",activationType:A.Debuff,icon:P({icon:"cracked-shield"},oi),getDescription(i){return{descriptions:[D(`Defence is lowered by ${Wc}, damage by ${Sd}. Rounds left: ${i.spellInstance.state?.debuffRoundsLeft}.`)]}},config:{spellConfig:{init({events:i,actions:e,thisSpell:r,spellInstance:t,vfx:n}){i.on({SpellPlacedOnUnitGroup({target:o}){let s={debuffRoundsLeft:wd};t.state=s;let p=e.createModifiers({baseDamagePercentModifier:-Cd,heroBonusDefence:-Wc});n.createEffectForUnitGroup(o,Nf),e.addModifiersToUnitGroup(o,p),e.historyLog(`${o.type.name} gets negative effect "${r.name}"`),i.on({NewRoundBegins(f){s.debuffRoundsLeft--,s.debuffRoundsLeft||(e.removeSpellFromUnitGroup(o,t),e.removeModifiresFromUnitGroup(o,p))}})}})}}}}),xd={id:"#spell-corrosive-fog",name:"Corrosive Fog",activationType:A.Target,icon:{icon:"cracked-shield"},getDescription(i){return{descriptions:[D(`Surrounds an enemy with corrosive fog, reducing defence by ${Wc} and outgoing damage by ${Sd}. Lasts ${wd} rounds.`)]}},config:{spellConfig:{targetCastConfig:{canActivate:at},getManaCost(i){return{1:2,2:2,3:3,4:4}[i.currentLevel]},init({events:i,actions:e,ownerPlayer:r,ownerHero:t,thisSpell:n}){i.on({PlayerTargetsSpell(o){e.historyLog(`${t.name} casts "${n.name}" against ${o.target.type.name}`);let s=e.createSpellInstance(jf);e.addSpellToUnitGroup(o.target,s,r)}})}}}};var WD=Ve.createHero({id:"#hero-veasin",name:"Veasin",generalDescription:F("Veasin makes use of her poison abilities, weakening enemies and dealing damage over time."),image:W.HeroMage,abilities:[Gu,xd],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-h01",10,18,2],["#unit-h20",6,11,1],["#unit-h30",3,5,1]]}],items:[Hr],resources:{gold:1100,wood:2,gems:0,redCrystals:0},stats:{mana:14,baseAttack:4,baseDefence:2}});var $f=B({id:"#spell-onslaught-buff",name:"Onslaught",icon:{icon:"spear-head",bgClr:"orange",iconClr:"#f10c0c"},activationType:A.Buff,getDescription:()=>({descriptions:[D("This group of Raiders has increased stats and 40% lifesteal.")]}),config:{spellConfig:{getManaCost:()=>3,init({events:i,actions:e,vfx:r}){let t=e.createModifiers({lifesteal:40,heroBonusAttack:3,heroBonusDefence:2});i.on({SpellPlacedOnUnitGroup({target:n}){e.addModifiersToUnitGroup(n,t)}})}}}}),bd=B({id:"#spell-onslaught",name:"Onslaught",icon:{icon:"spear-head"},activationType:A.Target,getDescription:()=>({descriptions:[D("Can only be casted on Raiders. Increases their stats and grants lifesteal.")]}),config:{spellConfig:{getManaCost:()=>1,init({events:i,actions:e,vfx:r,ownerPlayer:t}){i.on({PlayerTargetsSpell({target:n}){r.createEffectForUnitGroup(n,Ji("spear-head","orange"));let o=e.createSpellInstance($f,{initialLevel:1});e.addSpellToUnitGroup(n,o,t)}})},targetCastConfig:{canActivate:({isEnemy:i,unitGroup:e})=>!i&&e.type.name==="Raiders"}}}});var n2=kt.createHero({id:"#hero-toothpick",name:"Toothpick",generalDescription:F("Toothpick is a famous captain of Raiders, their effectiveness excels under his command."),image:W.HeroKnight,abilities:[bd],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-f00",16,18,1],["#unit-f10",10,10,1]]}],items:[],resources:Fi,stats:{mana:10,baseAttack:2,baseDefence:2},defaultModifiers:{}});var _d=B({id:"#spell-life-transfer",name:"Life Transfer",icon:{icon:"health-decrease"},activationType:A.Instant,getDescription:()=>({descriptions:[D("Reallocates health from enemies, dealing 20 damage to all enemies and equally distributing the dealt damage as healing among your army.")]}),config:{spellConfig:{getManaCost:()=>3,init({events:i,actions:e,vfx:r,ownerPlayer:t}){i.on({PlayerCastsInstantSpell(){let n=e.getEnemyOfPlayer(t),o=e.getAliveUnitGroupsOfPlayer(n),s=o.length;o.forEach(w=>{e.dealDamageTo(w,20,ge.Magic)});let p=s*20,f=e.getUnitGroupsOfPlayer(t),C=Math.round(p/f.length);f.forEach(w=>e.healUnit(w,C))}})}}}});var Md=B({id:"#spell-obelisk",name:"Life Obelisk",icon:{icon:"arena"},activationType:A.Target,getDescription:()=>({descriptions:[D("Stuns selected target and summons an Obelisk with 100 health. Obelisk possesses aura that increases the armor by 4."),D("Obelisk cannot attack, but can be attacked and destroyed."),D("Some of Blight's abilities interact with obelisk."),D("Cannot be casted while there is another obelisk.")]}),config:{spellConfig:{getManaCost:()=>3,init({events:i,actions:e,vfx:r}){i.on({PlayerTargetsSpell({target:t}){r.createDroppingMessageForUnitGroup(t.id,{html:wi("Stunned!")}),e.removeTurnsFromUnitGroup(t,2)}})},targetCastConfig:{canActivate:at}}}});var C2=kt.createHero({id:"#hero-blight",name:"Blight",generalDescription:F("A rotting ent called Blight. His army is weakened by -10% All Resist and -5 Defence, but compensating it with abilities and providing many ways to heal."),image:W.HeroKnight,abilities:[Md,_d],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-f00",13,16,2],["#unit-f10",10,14,1]]}],items:[],resources:Fi,stats:{mana:16,baseAttack:2,baseDefence:0},defaultModifiers:{heroBonusDefence:-5,resistAll:-10}});var Pd=B({id:"#spell-firestorm",name:"Firestorm",icon:{icon:"flaming-claw"},activationType:A.Target,getDescription:()=>({descriptions:[D("Deals 100 damage to the target as fire damage while converting 30% of it to pure damage. Your current unit is going to suffer 25% of that damage as fire damage.")]}),config:{spellConfig:{getManaCost:()=>3,init({events:i,actions:e,vfx:r}){i.on({PlayerTargetsSpell({target:t}){e.dealDamageTo(t,70,ge.Fire),e.dealDamageTo(t,30,ge.Magic),e.dealDamageTo(e.getCurrentUnitGroup(),100*.25,ge.Fire)}})},targetCastConfig:{canActivate:at}}}});var T2=kt.createHero({id:"#hero-firebrand",name:"Firebrand",generalDescription:F("A half-troll who harnessed the chaotic nature of fire magic, which ends up unfortunately both for his enemies and allies. All Fort units will start with -15% Fire Resist."),image:W.HeroKnight,abilities:[Pd],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-f00",16,18,1],["#unit-f10",10,10,1]]}],items:[],resources:Fi,stats:{mana:10,baseAttack:2,baseDefence:2},defaultModifiers:{__unitConditionalMods(i){return i.type.faction===kt?{resistFire:-15}:null}}});var Dd=4,Ed=B({id:"#spell-summon-sagittar",name:"Summon Sagittar",activationType:A.Instant,icon:{icon:"arrow-cluster"},getDescription(i){return{descriptions:[D(`Summons ${Dd} Sagittars that fight on your side.`)]}},config:{spellConfig:{getManaCost(){return 2},init({actions:i,ownerHero:e,ownerPlayer:r,events:t,vfx:n,thisSpell:o}){t.on({PlayerCastsInstantSpell(){let s=i.summonUnitsForPlayer(r,"#unit-c00",Dd);n.createEffectForUnitGroup(s,yn("arrow-cluster","rgb(190, 190, 231)"),{duration:1e3})}})}}}});Yt.createHero({id:"#hero-blackbird",name:"Blackbird",image:W.HeroBlackbird,abilities:[qs,Ed,Du],army:[{maxUnitGroups:3,minUnitGroups:3,units:[["#unit-c00",6,11,2],["#unit-c10",3,5,1]]},{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-c00",12,18,1],["#unit-c10",7,12,1]]},{maxUnitGroups:3,minUnitGroups:3,units:[["#unit-c00",6,10,1],["#unit-c10",4,6,2]]}],generalDescription:F("Blackbird is a hero who specializes at Astral and Fire magic, as well as Summoning."),items:[cd],stats:{baseAttack:2,baseDefence:4,mana:15},resources:{gems:1,gold:1e3,redCrystals:1,wood:1}});var nt=function(i){return i[i.Event=0]="Event",i[i.LocationAction=1]="LocationAction",i[i.PlayerAction=2]="PlayerAction",i}(nt||{});var Id=i=>`<i class="ra ra-${i}"></i>`,Td=i=>i+Id("feather-wing"),Ko=i=>i+Id("crystal-ball");function St(i){return Ei(i),i}var Xs=St({id:"#acard-setup-camp",title:"Set up Camp",icon:"campfire",type:nt.PlayerAction,bgColor:"gray",iconColor:"#ffae66",description:"You set up camp, skipping this day.",config:{onUsedInstantly({events:i,actions:e}){i.dispatch(Wt({points:e.getActionPointsLeft()}))}}}),Zo=St({id:"#acard-skip-the-day",title:"Skip the day",icon:"moon-sun",type:nt.PlayerAction,bgColor:"#283761",iconColor:"rgb(255 198 90)",borderColor:"rgb(255 198 90)",description:"You will immediately skip this day and receive 200 gold for each remaining action point left.",config:{onUsedInstantly({events:i,players:e,actions:r}){let t=e.getCurrentPlayer(),n=r.getActionPointsLeft(),o=n*200;i.dispatch(Wt({points:n})),e.giveResourcesToPlayer(t,{gold:o}),i.dispatch(Yn({message:[{type:fi.FreeHtml,htmlContent:`${Zn(Zo)}:<hr/>+${o} Gold`}]}))}}}),Sn=St({id:"#acard-meditate",title:"Meditate",icon:"barrier",bgColor:"rgb(39 57 89)",iconColor:"#d9f2fd",type:nt.PlayerAction,description:`You restore ${Ko(3)} mana (+${Ko(2)} per point of Restoration specialty), consumes ${Td(2)} action points. Action restored every week.`,actionPoints:2,config:{onUsedInstantly({events:i,players:e}){let r=e.getCurrentPlayer(),o=3+(r.hero.specialtiesModGroup.getModValue("specialtyMagicRecovery")||0)*2;e.addManaToPlayer(r,o),i.dispatch(Yn({message:[{type:fi.FreeHtml,htmlContent:`${Zn(Sn)}: Restored ${Ko(o)} Mana.`}]}))}}}),Vf=St({id:"#acard-restore-mana",title:"Restore Mana",icon:"barrier",bgColor:"rgb(39 57 89)",iconColor:"#d9f2fd",type:nt.PlayerAction,description:"You restore 3 points of mana (+2 per point of Restoration specialty), consumes 1 action point.",actionPoints:1,config:{onUsedInstantly({events:i,players:e}){let r=e.getCurrentPlayer(),o=3+(r.hero.specialtiesModGroup.getModValue("specialtyMagicRecovery")||0)*2;e.addManaToPlayer(r,o),i.dispatch(Yn({message:[{type:fi.FreeHtml,htmlContent:`${Zn(Vf)}: Restored ${Ko(o)} Mana.`}]}))}}}),rE=St({id:"#acard-recruit",title:"Recruit",icon:"knight-helmet",bgColor:"rgb(39 57 89)",iconColor:"#d9f2fd",type:nt.PlayerAction,description:"Gives you additional units below tier 3, consumes 2 action points."}),Fd=St({id:"#acard-rangers-horn",title:"Ranger's Horn",description:"8 Rangers will join your army for 3 days. Rangers are effective against forest dwellers.",bgColor:"#3c843c",icon:"hood",type:nt.PlayerAction,config:{onUsedInstantly({actions:i,players:e,events:r}){let t="#unit-neut-ranger-0",n=e.getCurrentPlayer(),o=8;e.addUnitGroupToPlayer(n,t,o),r.dispatch(Si({message:`${o} Rangers joined your army.`})),i.scheduleAction(()=>{e.removeUnitTypeFromPlayer(n,t,o),r.dispatch(Si({message:"Summoned Rangers have left your army."}))},2)}}});var rt=function(i){return i[i.Hiring=0]="Hiring",i[i.Garrison=1]="Garrison",i[i.ItemsSelling=2]="ItemsSelling",i}(rt||{}),Ad=(()=>{let e=class e extends Ot{constructor(){super(...arguments),this.currentLevel=0,this.built=!1}create(t){this.base=t.base,this.currentBuilding=t.base.levels[0].building}};e.categoryId="building";let i=e;return i})();function he(i){return Ei(i),i}function Xo(i,e,r,t=!1){return{type:rt.Hiring,hiring:{unitTypeId:i,growth:e,refillDaysInterval:7},unitGrowthGroup:r,growth:e,growthIntervalDays:7,upgrade:t}}function wn(i,e,r,t=!1){return{type:rt.Hiring,hiring:{unitTypeId:i,growth:e,refillDaysInterval:7},unitGrowthGroup:r,growth:e,growthIntervalDays:7,upgrade:t}}var zf=he({id:"#build-castle-town-center",name:"Town Center",description:"Earns 500 gold each day.",config:{init({players:i,localEvents:e}){e.on({NewDayBegins(){i.giveResourcesToPlayer(i.getCurrentPlayer(),{gold:500})}})}}}),Wf=he({id:"#build-castle-market",name:"Market"}),qf=he({id:"#build-castle-high-tower",name:"High Tower",description:"Gives 1 Meditation action card instantly and at the beginning of each week.",config:{init({localEvents:i,players:e,globalEvents:r}){r.dispatch(Ki({actionCardStacks:[{card:Sn,count:1}],player:e.getCurrentPlayer()})),i.on({NewWeekStarts(){r.dispatch(Ki({actionCardStacks:[{card:Sn,count:1}],player:e.getCurrentPlayer()}))}})}}}),Yf=he({id:"#build-castle-tavern",activity:{type:rt.Garrison},name:"Tavern",description:"Allows to hire more units, including neutral ones, from your garrison",config:{init({globalEvents:i,players:e,localEvents:r}){i.dispatch(Ki({actionCardStacks:[{card:Fd,count:1}],player:e.getCurrentPlayer()})),r.on({Built(){e.getCurrentPlayer().garrisons.set("castle-tavern",{groups:[{cost:{gold:200},count:8,type:$e("#unit-neut-ranger-0")}],name:"Castle Tavern"})},NewWeekStarts(){e.getCurrentPlayer().garrisons.set("castle-tavern",{groups:[{cost:{gold:200},count:8,type:$e("#unit-neut-ranger-0")}],name:"Castle Tavern"})}})}}}),Qf=he({id:"#build-castle-taining-camp-1",name:"Training Camp",description:"Allows to train Pikemans that can be upgraded.",activity:wn("#unit-h00",18,"pikeman")}),Kf=he({id:"#build-castle-taining-camp-2",name:"Upg. Training Camp",description:"Allows to hire and upgrade Halberdiers",activity:wn("#unit-h00",18,"pikeman",!0)}),Zf=he({id:"#build-castle-archers-1",name:"Archers Outpost",description:"Allows to train Archers",activity:wn("#unit-h10",12,"archers")}),Xf=he({id:"#build-castle-archers-2",name:"Upg. Archers Outpost",description:"Allows to train Archers and Crossbowmen",activity:wn("#unit-h10",12,"archers",!0)}),Jf=he({id:"#build-castle-knights-1",name:"Halls of Knights",description:"Allows to train Knights",activity:wn("#unit-h20",4,"knights")}),eh=he({id:"#build-castle-cavalry-1",name:"Cavalry Stalls",description:"Allows to train Cavalry",activity:wn("#unit-h30",2,"cavalry")}),th=he({id:"#build-castle-magic-tower-1",name:"Magic Tower",description:"Allows to train Mystical Birds",activity:wn("#unit-h40",2,"firebirds")}),ih=he({id:"#build-castle-magic-tower-2",name:"Upg. Magic Tower",description:"Allows to train Mystical Birds and Firebirds",activity:wn("#unit-h40",2,"firebirds",!0)}),nh=he({id:"#build-castle-items-market",name:"Item market",activity:{type:rt.ItemsSelling},description:"Sells items",config:{init({localEvents:i,thisBuilding:e}){i.on({Built(){e.addCustomData({items:["#item-iron-pike","#item-irton-plate","#item-kite-shield","#item-storm-pike","#item-battlemage-sword"],selling:!0})}})}}}),rh=he({id:"#build-castle-halls-of-fate",name:"Halls of Fate"}),oh=he({id:"#build-castle-garrison",name:"Garrison",description:"Allows to hire groups of units temporarily for reduced cost.",activity:{type:rt.Garrison},config:{init({localEvents:i,players:e}){i.on({Built(){e.getCurrentPlayer().garrisons.set("castle-garrison",{groups:[{cost:{gold:200},type:$e("#unit-h00"),count:16},{cost:{gold:340},type:$e("#unit-h20"),count:6}],name:"Castle Garrison"})},NewWeekStarts(){e.getCurrentPlayer().garrisons.set("castle-garrison",{groups:[{cost:{gold:200},type:$e("#unit-h00"),count:16},{cost:{gold:340},type:$e("#unit-h20"),count:6}],name:"Castle Garrison"})}})}}}),sh={id:"#town-castle",name:"Castle",availableBuildings:{"town-center":{baseName:"Town Center",description:"Grants you daily income",levels:[{building:zf,cost:{gold:1e3}}],icon:"capitol",tier:1},"items-market":{baseName:"Items Market",description:"Sells items",icon:"key-basic",levels:[{building:nh,cost:{gold:500}}],tier:1},market:{baseName:"Market",description:"Allows to trade resources",levels:[{building:Wf,cost:{gold:1500,wood:2}}],icon:"gavel",tier:2},"magic-school":{baseName:"Magic School",description:"Allows you to learn spells for your hero",levels:[{building:qf,cost:{gold:1e3,gems:2}}],icon:"burning-book",tier:2},tavern:{baseName:"Tavern",description:"Allows to hire neutral units",levels:[{building:Yf,cost:{gold:850,wood:1}}],icon:"hood",tier:2},garrison:{baseName:"Garrison",description:"Allows to hire units temorary",icon:"guarded-tower",tier:1,levels:[{building:oh,cost:{wood:2,gold:500}}]},"fate-halls":{baseName:"Halls of Fate",description:"Allows to develop your hero",levels:[{building:rh,cost:{gold:1e3}}],icon:"barrier",tier:3},"training-camp":{baseName:"Training Camp",description:"Trains Pikemans",levels:[{building:Qf,cost:{gold:450}},{building:Kf,cost:{gold:150,wood:2}}],icon:"spear-head",tier:1},"archers-outpost":{baseName:"Archers Outpost",description:"Trains Archers",levels:[{building:Zf,cost:{gold:500,wood:2}},{building:Xf,cost:{gold:400,wood:2}}],icon:"arrow-cluster",tier:1},"halls-of-knights":{baseName:"Halls of Knights",description:"Trains Knights",levels:[{building:Jf,cost:{gold:1e3,wood:5}}],icon:"crossed-swords",tier:2},"cavalry-halls":{baseName:"Cavalry Halls",description:"Trains Cavalry",levels:[{building:eh,cost:{gold:1e3,wood:5}}],icon:"horseshoe",tier:3},"magic-tower":{baseName:"Magic Tower",description:"Trains Firebirds and Mystical Birds",levels:[{building:th,cost:{gold:1500,wood:5}},{building:ih,cost:{gold:600,wood:5}}],icon:"tower",tier:4}}};Ve.setTownBase(sh);var ah=he({id:"#build-fort-town-hall-1",name:"Town Hall",description:"Earns 400 gold each day and gives 1 additional reserve slot.",config:{init({players:i,localEvents:e}){e.on({NewDayBegins(){i.giveResourcesToPlayer(i.getCurrentPlayer(),{gold:400})},Built(){i.getCurrentPlayer().hero.addReserveSlots(1)}})}}}),ch=he({id:"#build-fort-market",name:"Market"}),lh=he({id:"#build-fort-tavern",name:"Tavern"}),ph=he({id:"#build-fort-rocky-caves",name:"Rocky Caves",description:"Allows to hire units temporarily",activity:{type:rt.Garrison},config:{init({localEvents:i,players:e}){i.on({Built(){e.getCurrentPlayer().garrisons.set("rocky-caves",{groups:[{cost:{gold:100},count:8,type:$e("#unit-f00")},{cost:{gold:100},count:8,type:$e("#unit-f00")},{cost:{gold:100},count:8,type:$e("#unit-f00")}],name:"Rocky Caves"})},NewWeekStarts(){e.getCurrentPlayer().garrisons.set("rocky-caves",{groups:[{cost:{gold:100},count:8,type:$e("#unit-f00")},{cost:{gold:100},count:8,type:$e("#unit-f00")},{cost:{gold:100},count:8,type:$e("#unit-f00")}],name:"Rocky Caves"})}})}}}),uh=he({id:"#build-fort-goblin-huts-1",name:"Goblin Huts",description:"Allows to train Raiders that can be upgraded.",activity:Xo("#unit-f00",18,"raiders")}),dh=he({id:"#build-fort-goblin-huts-2",name:"Upg. Goblin Huts",description:"Allows to train Raiders and Clan.",activity:Xo("#unit-f00",18,"raiders",!0)}),mh=he({id:"#build-fort-stockade-1",name:"Stockade",description:"Allows to train Goblin Archers that can be upgraded.",activity:Xo("#unit-f10",18,"goblinArcher")}),fh=he({id:"#build-fort-stockade-2",name:"Upg. Stockade",description:"Allows to train Goblin Archers and Goblin Shooters.",activity:Xo("#unit-f10",18,"goblinArcher",!0)}),hh={id:"#town-fort",name:"Castle",availableBuildings:{"town-hall":{baseName:"Town Hall",description:"Grants you daily income",levels:[{building:ah,cost:{gold:1e3}}],icon:"capitol",tier:1},market:{baseName:"Market",description:"Allows to trade resources",levels:[{building:ch,cost:{gold:1500,wood:2}}],icon:"gavel",tier:1},"rocky-caves":{baseName:"Rocky Caves",description:"Allows to hire units temporarily",icon:"guarded-tower",levels:[{building:ph,cost:{gold:200,wood:2}}],tier:1},tavern:{baseName:"Tavern",description:"Allows to hire neutral units",levels:[{building:lh,cost:{gold:1250,wood:3}}],icon:"hood",tier:2},"goblin-huts":{baseName:"Golbin Huts",description:"Trains Goblin Huts",levels:[{building:uh,cost:{gold:475}},{building:dh,cost:{gold:150,wood:2}}],icon:"spear-head",tier:1},stockade:{baseName:"Stockade",description:"Trains Goblin Archers",levels:[{building:mh,cost:{gold:700}},{building:fh,cost:{gold:150,wood:2}}],icon:"spear-head",tier:1}}};kt.setTownBase(hh);function Od(i,e,r,t=!1){return{type:rt.Hiring,hiring:{unitTypeId:i,growth:e,refillDaysInterval:7},unitGrowthGroup:r,growth:e,growthIntervalDays:7,upgrade:t}}var gh=he({id:"#build-stellar-town-center-1",name:"Town Center"}),yh=he({id:"#build-stellar-market",name:"Market"}),vh=he({id:"#build-stellar-high-tower",name:"High Tower"}),Ch=he({id:"#build-stellar-tavern",name:"Tavern"}),Sh=he({id:"#build-stellar-solar-gate",name:"Solar Gate",description:"Allows to hire units temporarily",activity:{type:rt.Garrison},config:{init({localEvents:i,players:e}){i.on({Built(){e.getCurrentPlayer().garrisons.set("solar-gate",{name:"Solar Gate",groups:[{cost:{gold:130},count:8,type:$e("#unit-c00")},{cost:{gold:130},count:8,type:$e("#unit-c00")},{cost:{gold:180},count:8,type:$e("#unit-c20")}]})}})}}}),wh=he({id:"#build-stellar-spirit-towers",name:"Spirit Towers",description:"Allows to train Sprites.",activity:Od("#unit-c00",10,"sprite")}),xh=he({id:"#build-stellar-moon-arch-1",name:"Moon Arch",activity:Od("#unit-c00",8,"saggitar")}),bh=he({id:"#build-stellar-fate-halls",name:"Halls of Fate"}),_h={id:"#town-constellation",name:"Constellation",availableBuildings:{"town-center":{baseName:"Town Center",description:"Grants you daily income",levels:[{building:gh,cost:{gold:2e3}}],icon:"capitol",tier:1},market:{baseName:"Market",description:"Allows to trade resources",levels:[{building:yh,cost:{gold:1350}}],icon:"gavel",tier:1},"star-gate":{baseName:"Solar Gate",description:"Allows to temporarily summon units for reduced cost",icon:"heavy-fall",tier:1,levels:[{building:Sh,cost:{gold:500,wood:1}}]},"magic-school":{baseName:"Magic School",description:"Allows you to learn spells for your hero",levels:[{building:vh,cost:{gold:1500,gems:1}}],icon:"burning-book",tier:2},tavern:{baseName:"Tavern",description:"Allows to hire neutral units",levels:[{building:Ch,cost:{gold:1250}}],icon:"hood",tier:2},"fate-halls":{baseName:"Halls of Fate",description:"Allows to develop your hero",levels:[{building:bh,cost:{gold:1500}}],icon:"barrier",tier:2},"spirit-towers":{baseName:"Spirit Towers",description:"Trains Sprites",levels:[{building:wh,cost:{gold:450}}],icon:"spear-head",tier:1},"moon-arch":{baseName:"Moon Arch",description:"Trains Sagittars",levels:[{building:xh,cost:{gold:500,wood:1}}],icon:"arrow-cluster",tier:1}}};Yt.setTownBase(_h);var Js=class{constructor(e){this.mapSize=P({},e.mapDimensions),this.structures=e.structures,this.startingLocId=e.startLocId}};var Se=function(i){return i.Neutral="neutral",i.EnemyPlayer="enemy",i}(Se||{}),Pt=function(i){return i[i.Scripted=0]="Scripted",i}(Pt||{}),Ne=function(i){return i.SingleResource="resource",i.Resources="resources",i.Item="item",i.UnitsHire="hire",i.Mines="mines",i.UnitsUpgrade="upgrading",i.Scripted="scripted",i.NoReward="no-reward",i}(Ne||{});function Pe(i){return Ei(i),i}function ea({id:i,name:e,guard:r,unitsForHire:t}){return{id:i,name:e,actionPoints:1,control:Se.Neutral,generateGuard:()=>r,generateReward:()=>({type:Ne.UnitsHire,units:t})}}function en(i,e){return e.map(r=>N(P({},r),{id:`${i}.${r.id}`,pathTo:r.pathTo?r.toOuterBranch?r.pathTo:`${i}.${r.pathTo}`:void 0}))}var tr=(()=>{let e=class e extends Ot{constructor(){super(...arguments),this.name="",this.x=0,this.y=0,this.parentStructs=new Set,this.icon="",this.isInactive=!1,this.isCompleted=!1,this.actionPoints=0}create({iconName:t,x:n,y:o,isRoot:s,generator:p,guardingPlayer:f,pathTo:C,actionPoints:w,structParams:T}){this.x=n,this.y=o,this.icon=t,this.isRoot=s,this.generator=p,this.structParams=T,p&&(this.name=p.description?.({thisStruct:this}).name??p.name),this.actionPoints=w||p?.actionPoints||0,this.guardingPlayer=f,this.pathTo=C}setControls(t){this.controls?this.controls=P(P({},this.controls),t):this.controls=t}getStructParams(){return this.structParams}};e.categoryId="structure";let i=e;return i})();var kd=ea({id:"#struct-archers-outpost",name:"Archers Outpost",guard:{maxUnitGroups:3,minUnitGroups:3,units:[["#unit-h10",8,11,3]]},unitsForHire:[{unitTypeId:"#unit-h10",maxCount:12}]});var ye=function(i){return i.Gold="gold",i.Wood="wood",i.RedCrystals="redCrystals",i.Gems="gems",i}(ye||{});var ta={[ye.Gems]:"Gems",[ye.Gold]:"Gold",[ye.RedCrystals]:"Red Crystals",[ye.Wood]:"Wood"};function ia(i){return Object.entries(i).map(([e,r])=>({resName:ta[e],type:e,count:r}))}function Mh(i){return Object.entries(i).map(([e,r])=>`+${r} ${ta[e]}`)}function na(i){return Mh(i).join(`
`)}var tn=Pe({id:"#struct-bandit-camp",name:"Bandit Camp",actionPoints:1,control:Se.Neutral,generateGuard:()=>({maxUnitGroups:2,minUnitGroups:1,units:[["#unit-neut-thief-0",14,24,1],["#unit-neut-gnoll-0",14,24,3]]}),generateReward:()=>V.randBoolean()?{type:Ne.Resources,resourceGroups:[[{type:ye.Gold,count:450},{type:ye.Gems,count:1}],[{type:ye.Gold,count:800},{type:ye.Wood,count:2}]]}:{type:Ne.Item,itemGroups:[[V.randBoolean()?Hr:Zs],[rd],[ad],[od]]}});var Gd=Pe({id:"#struct-big-camp",name:"Big Camp",actionPoints:1,generateGuard(){return{maxUnitGroups:3,minUnitGroups:3,units:[["#unit-neut-forest-troll-0",23,25,1],["#unit-neut-gnoll-0",28,36,1],["#unit-neut-thief-0",15,18,1]]}},control:Se.Neutral,generateReward:()=>({type:Ne.Scripted,description:`Big camp is defeated! 

 +450 Experience`,onAccept({playersApi:i}){let e=i.getCurrentPlayer();i.addExperienceToPlayer(e,450)}})});var Rd=ea({id:"#struct-cavalry-stalls",name:"Cavalry Stalls",guard:{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-h30",3,3,2]]},unitsForHire:[{unitTypeId:"#unit-h30",maxCount:4}]});var Ud=Pe({id:"#struct-graveyard",name:"Graveyard",actionPoints:1,control:Se.Neutral,generateGuard:()=>({maxUnitGroups:2,minUnitGroups:3,units:[["#unit-neut-ghost-0",14,18,3]]}),generateReward:()=>({type:Ne.UnitsHire,units:[{unitTypeId:"#unit-neut-ghost-0",maxCount:24}]})}),Bd=Pe({id:"#struct-undead-beacon",name:"Beacon of the Undead",control:Se.Neutral,description:()=>({descriptions:["Allows to upgrade your ghost units below level 4."]}),generateReward:()=>({type:Ne.UnitsUpgrade,getUnits:i=>i.getCurrentPlayerUnitGroups().filter(e=>{let r=e.type;return!r.upgraded&&r.level<=4&&r.defaultModifiers?.isGhost})})});var Hd=Pe({id:"#struct-magic-river",control:Se.Neutral,actionPoints:1,name:"Magic River",description:()=>({descriptions:[`Walking near magic river, you feel your magical powers restored.

+4 to mana and +2 to max mana`]}),type:Pt.Scripted,config:{init({localEvents:i,players:e,thisStruct:r}){i.on({StructVisited({visitingPlayer:t}){e.addMaxManaToPlayer(t,2),e.addManaToPlayer(t,4),r.visited=!0}})}}});var Ld=Pe({id:"#struct-mountain-nest",control:Se.Neutral,actionPoints:2,name:"Mountain Nest",description:({thisStruct:i})=>{let e=[D(`Walking through mountains, you find a very bright birdnest... 

1-2 Firebirds join your army.`)];return i.controls?.accept===!1&&e.push(D("You have no free slots.")),{descriptions:e}},type:Pt.Scripted,config:{init({localEvents:i,players:e,thisStruct:r}){i.on({StructVisited({visitingPlayer:t}){e.addUnitGroupToPlayer(t,"#unit-h40",V.randIntInRange(1,2)),r.visited=!0},StructInspected(){r.setControls({accept:e.getCurrentPlayer().hero.hasFreeUnitSlots()})}})}}});var Nd=Pe({id:"#struct-witch-hut",control:Se.Neutral,actionPoints:1,name:"Witch Hut",description:()=>({descriptions:[`Walking trough the woods, you find an abandoned Witch Hut.

Learn "Enchant" level 2`]}),type:Pt.Scripted,config:{init({localEvents:i,players:e,thisStruct:r,spells:t}){i.on({StructVisited({visitingPlayer:n}){let o=t.createSpellInstance(Cu,{initialLevel:2});e.addSpellToPlayerHero(n,o),r.visited=!0}})}}});var jd=Pe({id:"#struct-thief-lair",name:"Thieves' Lair",actionPoints:2,control:Se.Neutral,generateGuard:()=>({maxUnitGroups:3,minUnitGroups:3,units:[["#unit-neut-thief-0",12,14,2],["#unit-neut-gnoll-0",14,24,3]]}),generateReward:()=>({type:Ne.Item,itemGroups:[[Ks],[nd],[Op]]})});var $d=Pe({id:"#struct-rocky-passage",name:"Rocky Passage",actionPoints:2,description:()=>({descriptions:["A rocky passage held by a powerful dragon."]}),disableWeeklyGuardRise:!0,generateGuard(){return{minUnitGroups:1,maxUnitGroups:1,units:[["#unit-neut-boss-devastator",1,1,1]]}},control:Se.Neutral,generateReward:()=>({type:Ne.NoReward})});var Vd=Pe({id:"#struct-dark-arts-school",control:Se.Neutral,actionPoints:2,name:"School of Dark Arts",description:()=>({descriptions:[`You are visiting the school of dark arts.

+1 to Necromancy specialty`]}),type:Pt.Scripted,config:{init({localEvents:i,players:e,thisStruct:r}){i.on({StructVisited({visitingPlayer:t}){t.hero.addStatsMods({specialtyNecromancy:1}),r.visited=!0}})}}});var zd=Pe({id:"#struct-fire-ring",name:"Fire Ring",actionPoints:2,generateGuard(){return{maxUnitGroups:3,minUnitGroups:3,units:[["#unit-neut-fire-spirit-0",7,9,3]]}},control:Se.Neutral,generateReward:()=>({type:Ne.NoReward})}),Wd=Pe({id:"#struct-guard-lock",name:"Fire Ring",actionPoints:2,description:({thisStruct:i})=>{let{name:e}=i.getStructParams();return{name:e,descriptions:[]}},generateGuard({thisStruct:i}){let{guards:e}=i.getStructParams();return e},control:Se.Neutral,generateReward:()=>({type:Ne.NoReward})});var qd=Pe({id:"#struct-mausoleum",name:"Mausoleum",actionPoints:1,control:Se.Neutral,generateGuard:()=>({minUnitGroups:3,maxUnitGroups:3,units:[["#unit-neut-skeleton-0",22,34,2],["#unit-neut-lich-0",3,4,1]]})});var qc=Pe({id:"#struct-daily-res-mine",name:"Mine with Resources",control:Se.Neutral,description:({thisStruct:i})=>({descriptions:[`You found a mine with resources, each day it will bring you:

`+na(i.structParams)]}),type:Pt.Scripted,config:{init({localEvents:i,players:e,thisStruct:r,eventFeed:t}){i.on({StructVisited(){r.visited=!0,e.giveResourcesToPlayer(e.getCurrentPlayer(),r.structParams),i.on({NewDayBegins(){e.giveResourcesToPlayer(e.getCurrentPlayer(),r.structParams)}})}})}}});var ir=Pe({id:"#struct-res-pile",name:"Pile of Resources",control:Se.Neutral,description:({thisStruct:i})=>{let e=i.structParams,r=ia(e);return{name:r.length>1?"Pile of Resources":`Pile of ${r[0].resName}`,descriptions:[`You found a pile of resources 

`+na(e)]}},type:Pt.Scripted,config:{init({localEvents:i,players:e,thisStruct:r}){i.on({StructVisited({visitingPlayer:t}){r.visited=!0,e.giveResourcesToPlayer(t,r.structParams)}})}}});var Yc=(i,e)=>({x:i+1700,y:e+1500}),Yd=en("const-start",[N(P({id:"start"},Yc(0,0)),{icon:"campfire"}),N(P({id:"1",pathTo:"start"},Yc(90,-60)),{icon:"gold-bar",actionPoints:2,struct:ir,structParams:{gold:650}}),N(P({id:"2",pathTo:"start"},Yc(10,-70)),{icon:"sword",struct:tn})]);var Dh=476,xn="start";function Y(i){return i+Dh}var Eh=en("start-bottom-right",[{id:"entry",x:Y(60),y:Y(30),icon:"tombstone",pathTo:xn,toOuterBranch:!0,struct:Ud,tags:[""]},{id:"1",x:Y(120),y:Y(40),icon:"sword",pathTo:"entry",struct:tn},{id:"1-1",x:Y(140),y:Y(-10),icon:"hand-saw",pathTo:"1",actionPoints:1,struct:ir,structParams:{wood:4}},{id:"witch",x:Y(180),y:Y(60),icon:"book",pathTo:"1",struct:Nd},{id:"5",x:Y(120),y:Y(90),icon:"sword",pathTo:"1",struct:tn},{id:"pre-boss",x:Y(40),y:Y(80),icon:"sword",pathTo:"5",struct:tn},{id:"7",x:Y(170),y:Y(141),icon:"horseshoe",pathTo:"5",struct:Rd},{id:"7-1",pathTo:"7",x:Y(165),y:Y(201),icon:"scroll-unfurled",struct:Vd},{id:"7-2",actionPoints:2,x:Y(240),y:Y(148),icon:"hand-saw",pathTo:"7",struct:qc,structParams:{wood:1}},{id:"boss",x:Y(45),y:Y(145),icon:"monster-skull",pathTo:"pre-boss",actionPoints:2,struct:Gd}]),Ih=en("five",[{id:"1",pathTo:xn,toOuterBranch:!0,x:Y(-30),y:Y(70),icon:"gold-bar",actionPoints:1,struct:ir,structParams:{gold:650}}]),Th=en("start-bottom-left",[{id:"entry",x:Y(-70),y:Y(10),icon:"sword",pathTo:xn,toOuterBranch:!0,struct:tn},{id:"1",x:Y(-120),y:Y(-100),icon:"mountains",pathTo:"entry",struct:Ld},{id:"2",x:Y(-130),y:Y(55),icon:"sword",pathTo:"entry",struct:tn},{id:"3",x:Y(-120),y:Y(-10),icon:"campfire",pathTo:"2",struct:jd},{id:"4",actionPoints:4,x:Y(-180),y:Y(-80),icon:"crystals",pathTo:"3",struct:qc,structParams:{redCrystals:1}},{id:"pre-boss",x:Y(-190),y:Y(20),icon:"fire-ring",pathTo:"2",struct:zd,actionPoints:2},{id:"boss",x:Y(-250),y:Y(-50),icon:"monster-skull",pathTo:"pre-boss",struct:$d,actionPoints:2},{id:"post-boss",pathTo:"boss",icon:"capitol",x:Y(-300),y:Y(-80),actionPoints:2,struct:qd},{id:"wagon",x:Y(-190),y:Y(90),icon:"mine-wagon",pathTo:"2",struct:ir,structParams:{gold:450,redCrystals:1,gems:1}}]),Fh=en("start-top-left",[{id:"entry",x:Y(-60),y:Y(-60),icon:"sword",pathTo:xn,toOuterBranch:!0,struct:tn},{id:"river",x:Y(-40),y:Y(-120),icon:"incense",pathTo:"entry",struct:Hd,actionPoints:1},{id:"1",x:Y(50),y:Y(-110),icon:"tower",pathTo:"entry",struct:kd,actionPoints:1},{id:"gems",x:Y(70),y:Y(-170),icon:"emerald",pathTo:"1",struct:ir,structParams:{gems:3}}]),Ah=en("post-boss-1",[{id:"entry",x:194,y:338,actionPoints:1,icon:"sword",pathTo:"start-bottom-left.post-boss",toOuterBranch:!0,struct:Wd,structParams:{name:"Swamp",guards:{units:[["#unit-neut-poison-ivy-0",20,20,3]],maxUnitGroups:3,minUnitGroups:3}}}]),Oh=en("start-top-right",[{id:"beacon",x:Y(35),y:Y(-50),icon:"lighthouse",pathTo:xn,toOuterBranch:!0,struct:Bd}]),Qd=[{id:xn,x:Y(0),y:Y(0),icon:"campfire"},...Ih,...Eh,...Th,...Fh,...Oh,...Yd,...Ah];var nr={registryMap:new Map,register(i,e){this.registryMap.has(i)?this.registryMap.get(i).push(e):this.registryMap.set(i,[e])}};nr.register(Br.PrepareGameEvent,{fn:(i,{events:e})=>{if(i.gameMode!==zo.Normal)return;let r=xn;i.selectedFaction,Yt,console.log("Structures are prepared.");let t=new Js({mapDimensions:{heightInCells:27,widthInCells:34,cellSize:86},structures:Qd,startLocId:r});e.dispatch(Br.GamePreparationFinished({map:t}))}});nr.register(qi,{fn:(i,e)=>{let r=[{card:Xs,count:1/0},{card:Sn,count:1},{card:Zo,count:1}],t=e.players.getCurrentPlayer();e.events.dispatch(Ki({player:t,actionCardStacks:r}))}});nr.register(Qi,{fn:(i,e)=>{e.actions.getMapStructures().filter(t=>!t.visited&&t.guard?.length&&!t.generator?.disableWeeklyGuardRise).forEach(t=>{t.guard?.forEach(n=>n.addUnitsCount(Math.round(n.count*.4)))}),e.events.dispatch(Si({message:"Guards in locations raised by 40%"}))}});nr.register(Oo,{fn:(i,{events:e,players:r})=>{e.dispatch(Go({title:`You reached level ${i.newLevel}`,subTitle:"Choose your reward",rewards:[...i.hero.spells.filter(t=>i.hero.base.initialState.abilities.includes(t.baseType)).map(t=>({display:{icon:t.baseType.icon.icon,title:`Level ${t.currentLevel+1} ${t.name}`},onSumbit:()=>{t&&t.levelUp()}})),{display:{icon:"crystal-ball",title:"+4 to Max/Current Mana"},onSumbit:()=>{let t=r.getCurrentPlayer(),n=4;r.addMaxManaToPlayer(t,n),r.addManaToPlayer(t,n)}}]}))}});var Ai=(()=>{let e=class e{constructor(){this.history=[],this.historyEvent$=new Dt}logHtmlMessage(t){let n={type:Gn.Html,message:t};this.pushMessage(n)}logSimpleMessage(t){let n={type:Gn.SimpleMsg,message:t};this.pushMessage(n)}logRoundInfoMessage(t){let n={type:Gn.RoundInfoMsg,message:t};this.pushMessage(n)}logDealtDamageMessage(t){let n=P({type:Gn.DealtDamageMsg},t);this.pushMessage(n)}pushMessage(t){this.history.push(t),this.historyEvent$.next()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();function ra(i){i.next(),i.complete()}var Kt=function(i){return i.HeroMods="hMods",i.CombatMods="cMods",i.AuraMods="aMods",i.SpecialtyAndConditionalMods="scMods",i.SpellMods="sMods",i}(Kt||{}),oa=(()=>{let e=class e extends Ot{constructor(){super(...arguments),this.modGroup=_t.empty(),this.unitStats$=new Et({groupState:{count:0,isAlive:!0,tailHp:0,position:0,turnsLeft:0,currentMana:0},groupStats:{baseAttack:0,bonusAttack:0,finalAttack:0,baseDefence:0,bonusDefence:0,finalDefence:0,defends:!1,baseSpeed:0,speedBonus:0,finalSpeed:0,fireResist:0,coldResist:0,lightningResist:0,poisonResist:0,totalHealth:0,totalMinDamage:0,totalMaxDamage:0,avgTotalDamage:0,position:0,maxMana:0}}),this.unitState=Pi(this.unitStats$.getValue()),this.destroyed$=new Dt}get count(){return this._count}get tailUnitHp(){return this._tailUnitHp}get ownerHero(){return this._ownerHero}get ownerPlayer(){return this._ownerPlayer}get spells(){return this._spells}create({count:t,unitBase:n,ownerHero:o,isSplitted:s}){(t<=0||!t)&&(console.warn(`Cannot create unit group with ${t} units. Setting count to 1.`,this),t=1),this.type=n,o&&(this.assignOwnerHero(o),this.assignOwnerPlayer(o.ownerPlayer)),this.turnsLeft=n.defaultTurnsPerRound||1,this._tailUnitHp=n.baseStats.health,this.type.defaultModifiers&&this.modGroup.addModsRef(gt.fromMods(this.type.defaultModifiers)),this.fightInfo={initialCount:t,isAlive:!0,spellsOnCooldown:!1},this.setUnitsCount(t),s||this.addMana(this.type.baseStats.mana||0),this.modGroup.attachNamedParentGroup(Kt.CombatMods,_t.empty()),this.modGroup.attachNamedParentGroup(Kt.SpecialtyAndConditionalMods,_t.empty()),this.modGroup.attachNamedParentGroup(Kt.SpellMods,_t.empty()),this._spells=[],this.type.defaultSpells&&this.type.defaultSpells.map(p=>this.getApi().spells.createSpellInstance(p)).forEach(p=>this.addSpell(p)),this.setupStatsUpdating()}getStateSignal(){return this.unitState}setPosition(t){let n=this.getState(),{groupState:o}=n;o.position!==t&&this.pushState(N(P({},n),{groupState:N(P({},o),{position:t})}))}assignOwnerHero(t){this._ownerHero=t,this._ownerPlayer=t.ownerPlayer,this.modGroup.detachNamedParentGroup(Kt.HeroMods),this.modGroup.attachNamedParentGroup(Kt.HeroMods,this._ownerHero.modGroup)}onDestroy(){ra(this.destroyed$),this.spells.forEach(t=>this.getApi().gameObjects.destroyObject(t))}assignOwnerPlayer(t){this._ownerPlayer=t}addUnitsCount(t){this.setUnitsCount(this._count+t)}setUnitsCount(t){this._count=t>=0?t:0,this.recalcHealthBasedStats()}setMana(t){let n=this.getState();this.pushState(N(P({},n),{groupState:N(P({},n.groupState),{currentMana:V.limitedNumber(t,this.getState().groupStats.maxMana||this.type.baseStats.mana||0)})}))}addMana(t){let n=this.getState();this.setMana(n.groupState.currentMana+t)}getMana(){return this.getState().groupState.currentMana}hasEnoughMana(t){return this.getMana()>t}addTailUnitHp(t){this.setTailUnitHp((this._tailUnitHp??0)+t)}setTailUnitHp(t){this._tailUnitHp=t,this.recalcHealthBasedStats()}listenStats(){return this.unitStats$.pipe(et(this.destroyed$))}addSpell(t){this._spells.push(t),t.setOwnerObjectId(this.id),t.baseType.config.spellConfig.onAcquired?.({spellInstance:t,ownerUnit:this}),this.getApi().events.dispatch(dn({unitGroup:this}))}removeSpell(t){V.removeItem(this._spells,t)}removeDefendingMod(){let t=this.modGroup.getNamedGroup(Kt.CombatMods);if(!t)return;let n=t?.getAllRefs().find(o=>o.getModValue("defending"));n&&t?.removeModsRef(n)}getState(){return this.unitStats$.getValue()}attachSpecialtyMods(t){this.getSpecialtyAndConditionalModsGroup().addModsRef(gt.fromMods(t))}clearSpecialtyAndConditionalMods(){this.getSpecialtyAndConditionalModsGroup().clearOwnModRefs()}clearCombatMods(){this.modGroup.getNamedGroup(Kt.CombatMods).clearOwnModRefs()}addCombatMods(t){this.modGroup.getNamedGroup(Kt.CombatMods).addModsRef(gt.fromMods(t))}removeCombatMods(t){this.modGroup.getNamedGroup(Kt.CombatMods).removeRefByModInstance(t)}addSpellMods(t){this.modGroup.getNamedGroup(Kt.SpellMods).addModsRef(gt.fromMods(t))}removeSpellMods(t){this.modGroup.getNamedGroup(Kt.SpellMods).removeRefByModInstance(t)}recalcHealthBasedStats(){let t=this.unitStats$.getValue(),n=this.type.baseStats,o=this._count,s=t.groupStats,p=o*n.damageInfo.minDamage,f=o*n.damageInfo.maxDamage;this.pushState(N(P({},t),{groupState:N(P({},t.groupState),{count:o}),groupStats:N(P({},s),{totalHealth:n.health*(o-1)+(this.tailUnitHp??0),totalMinDamage:p,totalMaxDamage:f,avgTotalDamage:(p+f)/2})}))}getSpecialtyAndConditionalModsGroup(){return this.modGroup.getNamedGroup(Kt.SpecialtyAndConditionalMods)}setupStatsUpdating(){this.modGroup.onValueChanges().pipe(et(this.destroyed$)).subscribe(t=>{let n=this.type.baseStats,o=this.ownerPlayer?.hero.base.initialState.stats,s=n.attackRating,p=(t.heroBonusAttack||0)+(o?.baseAttack||0),f=n.defence,C=(t.heroBonusDefence||0)+(o?.baseDefence||0),w=n.speed,T=t.unitGroupSpeedBonus||0;T<0&&t.cannotBeSlowed&&(T=0),t.fixedSpeed&&(T=0,w=t.fixedSpeed||5);let U=t.resistAll||0,pe=this.unitStats$.getValue(),ie=pe.groupStats,Ge={baseAttack:s,bonusAttack:p,finalAttack:s+p,defends:t.defending,baseDefence:f,bonusDefence:C,finalDefence:f+C,baseSpeed:w,speedBonus:T,finalSpeed:w+T,fireResist:(t.resistFire||0)+U,coldResist:(t.resistCold||0)+U,lightningResist:(t.resistLightning||0)+U,poisonResist:(t.resistPoison||0)+U,totalHealth:ie.totalHealth,totalMinDamage:ie.totalMinDamage,totalMaxDamage:ie.totalMaxDamage,avgTotalDamage:ie.avgTotalDamage,position:ie.position,maxMana:n.mana||0};this.pushState(N(P({},pe),{groupStats:Ge}))})}pushState(t){this.unitStats$.next(t),this.unitState.set(this.unitStats$.getValue())}};e.categoryId="unit-group";let i=e;return i})();var Kc=":";function sa(i,e){return`${i}${Kc}${e}`}function kh(i){return i.split(Kc)}var xe=(()=>{let e=class e{constructor(t){this.events=t,this.internalRegistries=new Map,this.allObjects=new Map,this.objectsCustomData=new Map,window.gameObjects=this}createNewGameObject(t,n,o){let s=t.categoryId,p=this.getOrCreateCategoryRegistry(s),f;if(o){let w=sa(s,o);if(this.allObjects.has(w))throw console.error(`Game object with id '${w}' already exists! New params/old object:`,n,this.allObjects.get(w)),new Error(`Game object with id '${w}' already exists!`);f=w}else f=sa(s,p.latestId++);let C=new t(f);return this.events.dispatch(Ro({gameObject:C})),C.create(n),p.objects.add(C),this.allObjects.set(f,C),Di.logGameObjects&&console.log(C),C}getObjectById(t,n){return this.getObjectByFullId(sa(t.categoryId,n))}getObjectByFullId(t){if(kh(t).length!==2)throw new Error(`Getting object by id '${t}' failed, id doesn't follow format 'CategoryId${Kc}ObjectId'`);let o=this.allObjects.get(t);if(!o)throw new Error(`Failed to get object by '${t}' id: Object doens't exist`);return o}destroyObject(t){let o=Object.getPrototypeOf(t).categoryId;this.internalRegistries.get(o)?.objects.delete(t),t.onDestroy(),this.objectsCustomData.delete(t.id),this.allObjects.delete(t.id)}getObjectId(t,n){let o=n.split(":");return o.length===2&&o[0]===t.categoryId?n:sa(t.categoryId,n)}addCustomData(t,n){let o=typeof t=="object"?t.id:t,s=this.objectsCustomData.get(o);this.objectsCustomData.set(o,P(P({},s),n))}getCustomData(t){let n=this.objectsCustomData.get(typeof t=="string"?t:t.id);return console.log("Getting custom data:",n),n}getOrCreateCategoryRegistry(t){let n=this.internalRegistries.get(t);return n||(this.initializeRegistryForCategory(t),this.internalRegistries.get(t))}initializeRegistryForCategory(t){this.internalRegistries.set(t,{latestId:0,objects:new Set})}};e.\u0275fac=function(n){return new(n||e)(x(z))},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var bn=(()=>{let e=class e{constructor(t){this.gameObjectManager=t}createSpellInstance(t,n={}){let o=n.initialLevel??1,s=t.icon;return s.bgClr||(s.bgClr=At.DefaultItemIconBg),s.iconClr||(s.iconClr=At.DefaultItemIconClr),this.gameObjectManager.createNewGameObject(Rs,{spellBaseType:t,initialLevel:o,state:n.state})}createModifiers(t){return t}canSpellBeCastOnUnit(t,n,o){let p=t.baseType.config.spellConfig.targetCastConfig?.canActivate;return p?p({unitGroup:n,isEnemy:o}):!0}};e.\u0275fac=function(n){return new(n||e)(x(xe))},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var ke=(()=>{let e=class e{constructor(t,n,o){this.spells=t,this.gameObjectsManager=n,this.events=o}createUnitGroup(t,n,o){return this.gameObjectsManager.createNewGameObject(oa,{count:n.count,ownerHero:o,unitBase:qt(t)})}createUnitGroupFromGenModel(t){return Uc.createRandomArmy(t).map(n=>this.createUnitGroup(n.unitType,{count:n.count}))}createUnitGroupFromGenModelForPlayer(t,n){return Uc.createRandomArmy(t).map(o=>this.createUnitGroup(o.unitType,{count:o.count},n))}addModifierToUnitGroup(t,n){this.events.dispatch(yo({mods:n,unit:t}))}removeModifiers(t,n){this.events.dispatch(vo({mods:n,unit:t}))}clearUnitModifiers(t){t.clearCombatMods()}getUnitGroupSpeed(t){return t.getState().groupStats.finalSpeed}healUnit(t,n){let o=t.type.baseStats.health,s=Math.floor(n/o),p=s*o,f=n-p,C=t.fightInfo.initialCount,w=t.count,T=C-w,U=t.tailUnitHp||o,pe=o-U,ie=T*o+pe;if(ie===0||n<=0)return{revivedUnitsCount:0,totalHealedHp:0};if(t.fightInfo.isAlive=!0,n>ie)return t.setTailUnitHp(o),t.setUnitsCount(C),{revivedUnitsCount:T,totalHealedHp:ie};let Ge=s;return f>pe?(Ge+=1,t.setTailUnitHp(U+f-o)):t.tailUnitHp===0&&f===0&&Ge>0?t.setTailUnitHp(o):t.addTailUnitHp(f),t.addUnitsCount(Ge),{revivedUnitsCount:Ge,totalHealedHp:n}}};e.\u0275fac=function(n){return new(n||e)(x(bn),x(xe),x(z))},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var wt=(()=>{let e=class e{constructor(t,n){this.units=t,this.events=n,this.battleEvent$=new Et(void 0),this.heroesUnitGroupsMap=new Map,this.currentGroupTurnsLeft=0,this.round=1,this.playerLosses={},this.playersRivalryMap=new Map,this.currentUnitGroup$=new Et(null)}resetCurrentPlayer(){this.currentPlayer=null}initBattleState(t,n){this.initialUnitGroups=t,this.players=n,this.playersRivalryMap.set(n[0],n[1]),this.playersRivalryMap.set(n[1],n[0]),this.initPlayerLossesMap(),this.initPlayerUnitGroupsMap(t),this.resetFightQueue(),this.updateGroupsTailHpAndCombatInfo(),this.refreshUnitGroups()}initNextTurnByQueue(t=!1){if(t&&this.currentUnitGroup.count&&this.fightQueue.shift(),!this.fightQueue.length){this.getAllUnits().forEach(s=>{s.modGroup.getModValue("defending")&&s.removeDefendingMod()}),this.resetFightQueue(),this.resetGroupsTurnsLeft(),this.round++,this.events.dispatch(Vt({round:this.round}));return}let n=this.fightQueue[0],o=this.currentPlayer;this.currentPlayer=n.ownerPlayer,this.currentUnitGroup=n,this.currentUnitGroup$.next(n),this.currentUnitGroup.modGroup.getModValue("defending")?this.currentGroupTurnsLeft=this.currentUnitGroup.turnsLeft:this.currentGroupTurnsLeft=this.currentUnitGroup.turnsLeft||1,this.currentPlayer!==o?this.events.dispatch(Wi({currentPlayer:this.currentPlayer,previousPlayer:o})):this.events.dispatch(go())}getFightQueue(){return this.fightQueue}handleDefeatedUnitGroup(t){let n=t.ownerPlayer,o=this.heroesUnitGroupsMap.get(n),s=o?.indexOf(t);t.fightInfo.isAlive=!1,this.heroesUnitGroupsMap.set(n,o);let p=this.fightQueue.indexOf(t);p!==-1&&this.fightQueue.splice(p,1)}getEnemyOfPlayer(t){return this.playersRivalryMap.get(t)}processAiPlayer(){setTimeout(()=>{let t=this.getAliveUnitsOfPlayer(this.getEnemyOfPlayer(this.currentPlayer)),n=Math.round(Math.random()*(t.length-1)),o=t[n];this.events.dispatch(zi({attackedGroup:o,attackingGroup:this.currentUnitGroup}))},1e3)}getUnitGroupTotalDamage(t){return t.count*t.type.baseStats.damageInfo.maxDamage}resortFightQueue(t=!1){if(t){this.fightQueue=this.getUnitsSortedBySpeed(this.fightQueue);return}this.fightQueue=[this.fightQueue[0],...this.getUnitsSortedBySpeed(this.fightQueue.slice(1))]}removeUnitsWithoutTurnsFromFightQueue(){this.fightQueue=this.fightQueue.filter(t=>t.turnsLeft)}getAliveUnitsOfPlayer(t){return this.heroesUnitGroupsMap.get(t).filter(n=>n.fightInfo.isAlive)}getDeadUnitsOfPlayer(t){return this.heroesUnitGroupsMap.get(t).filter(n=>!n.fightInfo.isAlive)}getSummonsOfPlayer(t){return this.heroesUnitGroupsMap.get(t).filter(n=>n.modGroup.getModValue("isSummon"))}playerHasAnyAliveUnits(t){return this.getAliveUnitsOfPlayer(t).length!==0}summonUnitForPlayer(t,n,o){let s=this.units.createUnitGroup(n,{count:o},t.hero),p=this.heroesUnitGroupsMap.get(t),f=p.length;return p.push(s),s.setPosition(f),this.units.addModifierToUnitGroup(s,{isSummon:!0}),this.resortFigthQueueWithNewUnits(),s}registerPlayerUnitLoss(t,n){let o=this.playerLosses[t.ownerPlayer.id],s=t.type,p=o.get(s);if(p){let f=p+n;f>0?o.set(s,f):o.delete(s)}else o.set(s,n)}initPlayerLossesMap(){this.players.forEach(t=>{this.playerLosses[t.id]=new Map})}resetGroupsTurnsLeft(){this.fightQueue.forEach(t=>t.turnsLeft=t.type.defaultTurnsPerRound||1)}getUnitsSortedBySpeed(t){return[...t].sort((n,o)=>this.units.getUnitGroupSpeed(o)-this.units.getUnitGroupSpeed(n))}resetFightQueue(){this.fightQueue=this.getUnitsSortedBySpeed([...this.getAliveUnitsOfPlayer(this.players[0]),...this.getAliveUnitsOfPlayer(this.players[1])])}getAllUnits(){return[...this.getAliveUnitsOfPlayer(this.players[0]),...this.getAliveUnitsOfPlayer(this.players[1])]}initPlayerUnitGroupsMap(t){this.heroesUnitGroupsMap.clear(),t.forEach(n=>{let o=n.ownerPlayer,s=this.heroesUnitGroupsMap.get(o);s?s.push(n):this.heroesUnitGroupsMap.set(o,[n])}),this.heroesUnitGroupsMap.forEach(n=>{n.forEach((o,s)=>{o.setPosition(s)})})}updateGroupsTailHpAndCombatInfo(){this.players.forEach(t=>{t.hero.unitGroups.forEach(n=>{n.tailUnitHp||n.setTailUnitHp(n.type.baseStats.health),n.fightInfo.initialCount=n.count})})}refreshUnitGroups(){this.players.forEach(t=>{t.hero.unitGroups.forEach(n=>{n.turnsLeft=n.type.defaultTurnsPerRound||1})})}resortFigthQueueWithNewUnits(){this.fightQueue=[this.fightQueue[0],...this.getUnitsSortedBySpeed(this.getAllAliveUnitsWithTurnsExcept(this.fightQueue[0]))]}getAllAliveUnitsWithTurnsExcept(t){return this.getAllAliveUnitsExcept(this.fightQueue[0]).filter(n=>n.turnsLeft)}getAllAliveUnitsExcept(t){return[...this.heroesUnitGroupsMap.values()].flat().filter(n=>n.fightInfo.isAlive&&n!==t)}};e.\u0275fac=function(n){return new(n||e)(x(ke),x(z))},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Lr=(()=>{let e=class e{constructor(){this.mapping=new Map}register(t,n){this.mapping.set(t,n)}unregister(t){this.mapping.delete(t)}get(t){return this.mapping.get(t)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Xc={[ge.Cold]:"coldResist",[ge.Fire]:"fireResist",[ge.Lightning]:"lightningResist",[ge.Poison]:"poisonResist"},Jc=60;var _n=(()=>{let e=class e{constructor(){this.hintMessage$=new Et(null),this.disableActionHint$=new Et(!1)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var rr=class{constructor(){this.triggerMapsByRefsMap=new Map}registerHandlerByRef(e,r,t){let n=this.triggerMapsByRefsMap.get(e);if(n){let o=n.get(r);o?o.push(t):n.set(r,[t])}else this.triggerMapsByRefsMap.set(e,new Map([[r,[t]]]))}triggerAllHandlersByEvent(e){this.triggerMapsByRefsMap.forEach(r=>{r.forEach((t,n)=>t.forEach(o=>{n===e.__eventType.__type&&o(e)}))})}triggerRefEventHandlers(e,r){let t=this.triggerMapsByRefsMap.get(e);t&&t.forEach((n,o)=>{n.forEach(s=>{o===r.__eventType.__type&&s(r)})})}removeAllHandlersForRef(e){this.triggerMapsByRefsMap.delete(e)}removeAllHandlers(){this.triggerMapsByRefsMap.clear()}};var J=(()=>{let e=class e{constructor(){this.currentGame={day:1,globalDay:1,week:1,actionPoints:4},this.settings={orientation:cn.Vertical,mapDebug:!0},this.mainMenu={},this.mapCamera={cameraInitialized:!1,x:0,y:0},this.eventHandlers={spells:new rr,items:new rr,buildings:new rr,structures:new rr},this.unitsAppliedModifiers=new Map}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var le=(()=>{let e=class e{constructor(){}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-ra-icon"]],inputs:{icon:"icon"},decls:1,vars:2,consts:[[1,"ra"]],template:function(n,o){n&1&&h(0,"i",0),n&2&&an("ra-"+o.icon)}});let i=e;return i})();var Ht=(()=>{let e=class e{constructor(t){this.domSanitizer=t}transform(t){return this.domSanitizer.bypassSecurityTrustHtml(t)}};e.\u0275fac=function(n){return new(n||e)(y(cc,16))},e.\u0275pipe=Ni({name:"safeHtml",type:e,pure:!0});let i=e;return i})();var es=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-action-card"]],inputs:{actionCard:"actionCard"},decls:7,vars:11,consts:[[1,"icon"],[3,"icon"],[1,"content"],[1,"title"],[1,"description",3,"innerHtml"]],template:function(n,o){n&1&&(a(0,"div",0),h(1,"mw-ra-icon",1),c(),a(2,"div",2)(3,"div",3),d(4),c(),h(5,"div",4),re(6,"safeHtml"),c()),n&2&&(l(),$("color",o.actionCard.iconColor)("background",o.actionCard.bgColor)("border-color",o.actionCard.borderColor),u("icon",o.actionCard.icon),l(3),M(" ",o.actionCard.title," "),l(),u("innerHtml",oe(6,9,o.actionCard.description),jt))},dependencies:[le,Ht],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center;cursor:pointer}.icon[_ngcontent-%COMP%]{width:84px;height:84px;position:relative;bottom:-14px;display:flex}.icon[_ngcontent-%COMP%]   mw-ra-icon[_ngcontent-%COMP%]{width:74px;height:74px;display:flex;background-color:gray;font-size:74px;border-radius:50%;border:4px solid rgb(82,82,82);color:#fff;margin:auto}.content[_ngcontent-%COMP%]{border:3px solid gray;border-radius:5px;padding:14px 8px 8px;display:flex;flex-direction:column;align-items:center;color:#fff;width:135px;min-height:74px;text-align:center;background-color:#636363;-webkit-user-select:none;user-select:none}.content[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:20px;margin-bottom:6px;padding-bottom:4px;border-bottom:2px solid #8d8d8d;width:100%}.content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:13px}"]});let i=e;return i})();var la=new _i("Popup Reference");var te=class{constructor(){this.popup=L(la),this.data=this.popup.data}close(){this.popup.close()}};var jr=(()=>{let e=class e{constructor(){this.keyPress$=It(document,"keyup"),this.escape$=this.keyPress$.pipe(Tn(t=>t.key==="Escape"))}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var si=(()=>{let e=class e{constructor(){this.popups=[],L(jr).escape$.subscribe(t=>{if(!this.popups.length)return;let n=this.popups[this.popups.length-1];(n.isCloseable||n.escape)&&this.removePopup(n)})}createPopup(t){this.popups.push(t)}createBasicPopup(t){this.createPopup(t)}removePopup(t){V.removeItem(this.popups,t)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();function Uh(i,e){i&1&&be(0)}function Bh(i,e){i&1&&h(0,"div",2)}var pa=(()=>{let e=class e{constructor(t,n,o){this.popups=t,this.hostElemRef=n,this.renderer=o,this.isInactive=!1}ngOnInit(){this.popupData.class&&this.renderer.addClass(this.hostElemRef.nativeElement,this.popupData.class),this.injector=ws.create({providers:[{provide:la,useValue:{data:this.popupData.data,close:()=>{this.popups.removePopup(this.popupData)}}}]})}preventClick(t){t.stopPropagation()}};e.\u0275fac=function(n){return new(n||e)(y(si),y(ht),y(je))},e.\u0275cmp=v({type:e,selectors:[["mw-popup-wrapper"]],hostBindings:function(n,o){n&1&&S("click",function(p){return o.preventClick(p)})},inputs:{popupData:"popupData",isInactive:"isInactive"},decls:2,vars:3,consts:[[4,"ngComponentOutlet","ngComponentOutletInjector"],["class","inactive-overlay",4,"ngIf"],[1,"inactive-overlay"]],template:function(n,o){n&1&&g(0,Uh,1,0,"ng-container",0)(1,Bh,1,0,"div",1),n&2&&(u("ngComponentOutlet",o.popupData.component)("ngComponentOutletInjector",o.injector),l(),u("ngIf",o.isInactive))},dependencies:[jp,se],styles:[".inactive-overlay[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;left:0;top:0;background-color:#48484846}.small-padding[_nghost-%COMP%]{padding:12px}.transparent[_nghost-%COMP%]{background:transparent;width:100%;pointer-events:none;padding:0}"]});let i=e;return i})();var Oi=(()=>{let e=class e{constructor(){this.mwNoContextMenu=new bt}preventContextMenu(t){return t.stopPropagation(),t.preventDefault(),this.mwNoContextMenu.emit(),!1}};e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=Le({type:e,selectors:[["","mwNoContextMenu",""],["","mwUnitGroupCombatAction",""]],hostBindings:function(n,o){n&1&&S("contextmenu",function(p){return o.preventContextMenu(p)})},outputs:{mwNoContextMenu:"mwNoContextMenu"}});let i=e;return i})();function Lh(i,e){i&1&&h(0,"div",2)}function Nh(i,e){if(i&1&&h(0,"mw-popup-wrapper",5),i&2){let r=e.$implicit,t=e.last;u("ngClass",r.class)("popupData",r)("isInactive",!t)}}function jh(i,e){if(i&1){let r=R();a(0,"div",3),S("click",function(n){E(r);let o=m();return I(o.handleOverlayClick(n))}),g(1,Nh,1,3,"mw-popup-wrapper",4),c()}if(i&2){let r=m();l(),u("ngForOf",r.popupsService.popups)}}var ua=(()=>{let e=class e{constructor(t){this.popupsService=t}handleOverlayClick(t){t.preventDefault();let n=this.popupsService.popups,o=Dp(n);o.isCloseable&&this.popupsService.removePopup(o)}};e.\u0275fac=function(n){return new(n||e)(y(si))},e.\u0275cmp=v({type:e,selectors:[["mw-popup-container"]],decls:2,vars:2,consts:[["class","overlay",4,"ngIf"],["mwNoContextMenu","","class","popups-container",3,"click",4,"ngIf"],[1,"overlay"],["mwNoContextMenu","",1,"popups-container",3,"click"],["class","popup",3,"ngClass","popupData","isInactive",4,"ngFor","ngForOf"],[1,"popup",3,"ngClass","popupData","isInactive"]],template:function(n,o){n&1&&g(0,Lh,1,0,"div",0)(1,jh,2,1,"div",1),n&2&&(u("ngIf",o.popupsService.popups.length),l(),u("ngIf",o.popupsService.popups.length))},dependencies:[hi,q,se,Oi,pa],styles:["@keyframes _ngcontent-%COMP%_overlay-appear{0%{background-color:#0000000d}to{background-color:#000000a7}}.popups-container[_ngcontent-%COMP%]{left:0;z-index:9200;top:0;position:fixed;height:100%;width:100%}.overlay[_ngcontent-%COMP%]{left:0;top:0;z-index:4000;position:fixed;height:100%;width:100%;background-color:#0000;animation:_ngcontent-%COMP%_overlay-appear 1s;animation-fill-mode:forwards}.popup[_ngcontent-%COMP%]{position:absolute;display:block;min-width:400px;left:50%;z-index:9500;top:50%;transform:translate(-50%,-50%);background-color:#fff}.dark[_ngcontent-%COMP%]{background-color:#484852}"]});let i=e;return i})();function Vh(i,e){if(i&1){let r=R();a(0,"div",6)(1,"mw-action-card",7),S("click",function(){let n=E(r).$implicit,o=m();return I(o.handleCardClick(n))}),c(),a(2,"div",8),d(3),re(4,"infNum"),c()()}if(i&2){let r=e.$implicit;l(),u("actionCard",r.card)("mwActionHint","Use "+r.card.title),l(2),M("Left: ",oe(4,3,r.count),"")}}var ts=(()=>{let e=class e extends te{constructor(){super(...arguments),this.state=L(J),this.playersService=L(k),this.events=L(z),this.cards=this.playersService.getCurrentPlayer().actionCards,this.actionPointsLeft=this.state.currentGame.actionPoints}handleCardClick(t){this.events.dispatch(Qn({player:this.playersService.getCurrentPlayer(),cardStack:t})),this.close()}};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=ft(e)))(o||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-action-cards-popup"]],features:[j],decls:11,vars:2,consts:[[1,"header"],[1,"action-points"],[1,"points"],["icon","feather-wing"],[1,"cards"],["class","card-stack",4,"ngFor","ngForOf"],[1,"card-stack"],[3,"click","actionCard","mwActionHint"],[1,"cards-left"]],template:function(n,o){n&1&&(a(0,"div",0),d(1," Available action cards "),a(2,"div",1),d(3," Remaining action points for this day: "),h(4,"br"),a(5,"span",2),h(6,"mw-ra-icon",3),d(7),c()(),h(8,"hr"),c(),a(9,"div",4),g(10,Vh,5,5,"div",5),c()),n&2&&(l(7),M(" ",o.actionPointsLeft," "),l(3),u("ngForOf",o.cards))},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center;background-color:#0000009c;padding:40px 0}.header[_ngcontent-%COMP%]{color:#fff;text-align:center;font-size:24px}.header[_ngcontent-%COMP%]   .action-points[_ngcontent-%COMP%]{font-size:16px;font-weight:100;line-height:32px}.header[_ngcontent-%COMP%]   .action-points[_ngcontent-%COMP%]   .points[_ngcontent-%COMP%]{font-size:32px}.cards[_ngcontent-%COMP%]{display:flex;pointer-events:all;gap:14px;padding-top:15px}.card-stack[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;padding:0 16px 8px;border-radius:6px;background-color:#fff0;transform:translateY(0);transition:.2s}.card-stack[_ngcontent-%COMP%]:hover{background-color:#ffffff31;transform:translateY(-20px)}.cards-left[_ngcontent-%COMP%]{color:#fff;text-align:center;font-size:15px;padding-top:4px}"]});let i=e;return i})();var da=(()=>{let e=class e{constructor(){}registerCursorComponent(t){this.cursorComponent=t}setCustomCursor(t,n,o){this.cursorComponent.showCustomCursor=!0,this.updateCursorComponent(),this.cursorComponent.customCursorRef.clearAnimation(),this.cursorComponent.customCursorRef.playAnimation(t,n,o)}setCustomCursorPos(t,n){this.cursorComponent.customCursorPos.x=t,this.cursorComponent.customCursorPos.y=n,this.updateCursorComponent()}clearCustomCursor(){this.updateCursorComponent(),this.cursorComponent.customCursorRef&&(this.cursorComponent.customCursorRef.clearAnimation(),this.cursorComponent.showCustomCursor=!1)}updateCursorComponent(){this.cursorComponent.cdr.detectChanges()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Wh=["customCursorRef"];function qh(i,e){if(i&1&&h(0,"mw-vfx-element",2,0),i&2){let r=m();$("top",r.customCursorPos.y-5,"px")("left",r.customCursorPos.x-2,"px")}}var is=(()=>{let e=class e{constructor(t,n){this.cursor=t,this.cdr=n,this.showCustomCursor=!1,this.customCursorPos={x:0,y:0},this.cursor.registerCursorComponent(this)}};e.\u0275fac=function(n){return new(n||e)(y(da),y(mi))},e.\u0275cmp=v({type:e,selectors:[["mw-custom-cursor"]],viewQuery:function(n,o){if(n&1&&De(Wh,5),n&2){let s;Ee(s=Ie())&&(o.customCursorRef=s.first)}},decls:1,vars:1,consts:[["customCursorRef",""],["class","custom-cursor",3,"top","left",4,"ngIf"],[1,"custom-cursor"]],template:function(n,o){n&1&&g(0,qh,2,4,"mw-vfx-element",1),n&2&&u("ngIf",o.showCustomCursor)},styles:["[_nghost-%COMP%]{position:fixed;left:0;top:0;width:0;height:0}.custom-cursor[_ngcontent-%COMP%]{pointer-events:none;position:absolute;z-index:100000;font-size:24px;color:#fff;transform:scaleX(-1)}"]});let i=e;return i})();var Qh=i=>({$implicit:i});function Kh(i,e){i&1&&be(0)}function Zh(i,e){if(i&1&&(ve(0),g(1,Kh,1,0,"ng-container",2),Ce()),i&2){let r=e.$implicit;m();let t=ne(2);l(),u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,Qh,r))}}function Xh(i,e){if(i&1&&(h(0,"div",3),re(1,"safeHtml")),i&2){let r=e.$implicit;u("innerHTML",oe(1,1,r.htmlContent),jt)}}var Jh=i=>i.map(e=>typeof e=="string"?{htmlContent:e}:e),Xt=(()=>{let e=class e{constructor(){this.descriptions=Z.required({transform:Jh})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-description"]],inputs:{descriptions:[1,"descriptions"]},decls:3,vars:1,consts:[["freeHtml",""],[4,"ngFor","ngForOf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"innerHTML"]],template:function(n,o){n&1&&g(0,Zh,2,4,"ng-container",1)(1,Xh,2,3,"ng-template",null,0,Q),n&2&&u("ngForOf",o.descriptions())},dependencies:[q,yt,Ht],styles:[`mw-description>.spell-descr{font-size:13px}mw-description .spell-stats{padding:7px 3px 3px;font-size:12px;line-height:18px;color:#434040}mw-description .spell-stats>.stat>.value{font-weight:600}mw-description .item-mods{padding:0 5px 5px}mw-description .item-mods>.item-mod{font-size:12px}
`],encapsulation:2,changeDetection:0});let i=e;return i})();function eg(i,e){if(i&1&&(ve(0,1),h(1,"div",2),re(2,"safeHtml"),Ce()),i&2){let r=e.$implicit;u("ngSwitch",r.type),l(),u("innerHTML",oe(2,2,r.htmlContent),jt)}}var Zd=2e3,il=(()=>{let e=class e{constructor(t,n){this.elementRef=t,this.renderer=n,this.messageExpired=new bt,this.type=fi}ngOnInit(){setTimeout(()=>{this.renderer.addClass(this.elementRef.nativeElement,"visible")},0),setTimeout(()=>{this.renderer.addClass(this.elementRef.nativeElement,"hidden")},(this.message.delay||Zd)-400),setTimeout(()=>{this.messageExpired.emit()},this.message.delay||Zd)}};e.\u0275fac=function(n){return new(n||e)(y(ht),y(je))},e.\u0275cmp=v({type:e,selectors:[["mw-event-feed-message"]],inputs:{message:"message"},outputs:{messageExpired:"messageExpired"},decls:1,vars:1,consts:[[3,"ngSwitch",4,"ngFor","ngForOf"],[3,"ngSwitch"],[3,"innerHTML"]],template:function(n,o){n&1&&g(0,eg,3,4,"ng-container",0),n&2&&u("ngForOf",o.message.message)},dependencies:[q,gi,Ht],styles:["[_nghost-%COMP%]{background:#414141;display:inline-block;color:#fff;font-size:13px;border-radius:4px;display:block;padding:3px 10px 3px 5px;overflow:hidden;height:0;opacity:0;position:relative;translate:50% -20px;transition:.4s;text-align:center}.visible[_nghost-%COMP%]{height:100%;translate:50% 0px;opacity:1}.hidden[_nghost-%COMP%]{height:0;opacity:0}"]});let i=e;return i})();var nn=(()=>{let e=class e{constructor(){this.visibleMessages=[],this.allMessages=[]}pushEventFeedMessage(t){this.allMessages.push(t),this.visibleMessages.push(t)}pushPlainMessage(t){let n={message:[{htmlContent:t,type:fi.FreeHtml}],delay:2600};this.pushEventFeedMessage(n)}pushSystemError(t){let n={message:[{htmlContent:`<div style="background: red; font-size: 15px; font-weight: 500">${t}</div>`,type:fi.FreeHtml}],delay:5e3};this.pushEventFeedMessage(n)}removeMessage(t){V.removeItem(this.visibleMessages,t)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();function tg(i,e){if(i&1){let r=R();a(0,"mw-event-feed-message",1),S("messageExpired",function(){let n=E(r).$implicit,o=m();return I(o.removeMessage(n))}),c()}if(i&2){let r=e.$implicit;u("message",r)}}var ns=(()=>{let e=class e{constructor(t){this.eventFeed=t}removeMessage(t){this.eventFeed.removeMessage(t)}};e.\u0275fac=function(n){return new(n||e)(y(nn))},e.\u0275cmp=v({type:e,selectors:[["mw-event-feed"]],decls:1,vars:1,consts:[[3,"message","messageExpired",4,"ngFor","ngForOf"],[3,"messageExpired","message"]],template:function(n,o){n&1&&g(0,tg,1,1,"mw-event-feed-message",0),n&2&&u("ngForOf",o.eventFeed.visibleMessages)},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;pointer-events:none;-webkit-user-select:none;user-select:none}mw-event-feed-message[_ngcontent-%COMP%]{margin-bottom:3px}"]});let i=e;return i})();var ng=["mw-main-button",""],rg=["*"],ae=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["button","mw-main-button",""]],attrs:ng,ngContentSelectors:rg,decls:1,vars:0,template:function(n,o){n&1&&(ii(),Ft(0))},styles:["[_nghost-%COMP%]{display:block;max-width:100%;padding:10px;background:#6478bb;color:#fff;text-align:center;margin:4px;cursor:pointer;-webkit-user-select:none;user-select:none;border:none;font-family:segoe ui;font-size:15px}[_nghost-%COMP%]:hover{background:#5a6793}[_nghost-%COMP%]:active{background:#4f5a7e}[_nghost-%COMP%]:disabled{background:#939ec4;color:#cfcfcf}"]});let i=e;return i})();var og=[[["","popupHeader",""]],[["","popupContent",""]],"*"],sg=["[popupHeader]","[popupContent]","*"],ue=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-popup-base-content"]],ngContentSelectors:sg,decls:3,vars:0,template:function(n,o){n&1&&(ii(og),Ft(0),Ft(1,1),Ft(2,2,["ngProjectAs","[popupButtons]",5,["","popupButtons",""]]))},styles:[`mw-popup-base-content{display:block;padding:16px}mw-popup-base-content [popupHeader]{text-align:center;margin-bottom:4px}mw-popup-base-content [popupContent]{text-align:center}mw-popup-base-content [popupContent] .sub-info p{margin:0;font-size:12px}mw-popup-base-content [popupButtons]{display:flex;justify-content:center;gap:4px;margin-top:4px}
`],encapsulation:2});let i=e;return i})();var fa=(()=>{let e=class e extends te{constructor(){super()}goToMainScreen(){location.reload()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-game-over-popup"]],features:[j],decls:8,vars:0,consts:[["popupHeader",""],["popupContent",""],["popupButtons",""],["mw-main-button","",2,"margin","auto",3,"click"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2,"Game Over"),c(),a(3,"div",1),d(4,"Go to main menu?"),c(),a(5,"div",2)(6,"button",3),S("click",function(){return o.goToMainScreen()}),d(7,"Accept"),c()()())},dependencies:[ae,ue],styles:["[_nghost-%COMP%]{text-align:center}"]});let i=e;return i})();function ag(i,e){i&1&&be(0)}function cg(i,e){if(i&1&&(a(0,"div",1),g(1,ag,1,0,"ng-container",2),c()),i&2){let r=e.$implicit;up(r.style),$("top",r.offsetTop,"px")("right",r.offsetRight,"px")("left",r.offsetLeft,"px")("bottom",r.offsetBottom,"px"),l(),u("ngTemplateOutlet",r.template)}}var ha=(()=>{let e=class e{constructor(){this.hints=[]}createHint(t,n,o){let s=t.nativeElement,{left:p,top:f,bottom:C}=s.getBoundingClientRect(),w=null,T=f+s.clientHeight/2,U=null,pe="transform: translateY(-50%)",ie=null;switch(o){case"after":w=p+s.clientWidth;break;case"before":U=window.innerWidth-p;break;case"above":T=null,pe="transform: translateX(-50%)",ie=window.innerHeight-C+s.clientHeight,w=p+s.clientWidth/2;break;case"below":T=C,pe="transform: translateX(-50%)",w=p+s.clientWidth/2}let Ge={targetElement:t,template:n,offsetLeft:w,offsetBottom:ie,offsetTop:T,offsetRight:U,style:pe};return this.hints.push(Ge),Ge}removeHint(t){let n=this.hints.indexOf(t);this.hints.splice(n,1)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-hints-container"]],decls:1,vars:1,consts:[["class","hint",3,"top","right","left","bottom","style",4,"ngFor","ngForOf"],[1,"hint"],[4,"ngTemplateOutlet"]],template:function(n,o){n&1&&g(0,cg,2,11,"div",0),n&2&&u("ngForOf",o.hints)},dependencies:[q,yt],styles:[".container[_ngcontent-%COMP%]{width:0}.hint[_ngcontent-%COMP%]{position:absolute;z-index:10000}"]});let i=e;return i})();var $r=(()=>{let e=class e{constructor(){this.activeMenusCount=0,this.activeMenus=new Set,this.clickOutsideMenu$=It(window,"click").pipe(Tn(()=>this.activeMenusCount>0)),this.clickOutsideMenu$.subscribe(t=>{let n=t.target,o=n.closest(".menu-hint"),s=n.closest("mw-menu");!o&&!s&&this.closeAllActiveMenus(),s||this.closeClosableMenus()})}closeAllActiveMenus(){this.activeMenus.forEach(t=>this.containerRef.removeHint(t.currentHintRef)),this.activeMenus.clear()}closeClosableMenus(){this.activeMenus.forEach(t=>{t.closeOnClick&&this.containerRef.removeHint(t.currentHintRef),this.activeMenus.delete(t)})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var pg=["elem"],ug=["generalHint"],dg=["*"];function mg(i,e){i&1&&be(0)}function fg(i,e){if(i&1&&(a(0,"div",3),g(1,mg,1,0,"ng-container",4),c()),i&2){let r=m();$("transition",r.transition,"s"),u("ngClass",r.showHintAnimation?"show-hint":"hide-hint"),l(),u("ngTemplateOutlet",r.hintBody)}}var or=(()=>{let e=class e{constructor(t){this.hintsService=t,this.transition=.15,this.hintPos="after",this.showHintAnimation=!1,this.showTimeoutId=null,this.currentHintRef=null}ngOnDestroy(){this.onMouseLeave()}onMouseEnter(){this.currentHintRef=this.hintsService.containerRef.createHint(this.elem,this.generalHint,this.hintPos),this.showTimeoutId=window.setTimeout(()=>{this.clearShowTimeout(),this.showHintAnimation=!0},0)}onMouseLeave(){this.clearShowTimeout(),this.showHintAnimation=!1;let t=this.currentHintRef;this.currentHintRef=null,window.setTimeout(()=>{this.hintsService.containerRef.removeHint(t)},this.transition*1e3)}clearShowTimeout(){this.showTimeoutId&&window.clearTimeout(this.showTimeoutId),this.showTimeoutId=null}};e.\u0275fac=function(n){return new(n||e)(y($r))},e.\u0275cmp=v({type:e,selectors:[["mw-hover-hint"]],viewQuery:function(n,o){if(n&1&&(De(pg,7),De(ug,7)),n&2){let s;Ee(s=Ie())&&(o.elem=s.first),Ee(s=Ie())&&(o.generalHint=s.first)}},inputs:{hintBody:"hintBody",transition:"transition",hintPos:"hintPos"},ngContentSelectors:dg,decls:5,vars:0,consts:[["elem",""],["generalHint",""],[3,"mouseenter","mouseleave"],[1,"hint",3,"ngClass"],[4,"ngTemplateOutlet"]],template:function(n,o){if(n&1){let s=R();ii(),a(0,"div",2,0),S("mouseenter",function(){return E(s),I(o.onMouseEnter())})("mouseleave",function(){return E(s),I(o.onMouseLeave())}),Ft(2),c(),g(3,fg,2,4,"ng-template",null,1,Q)}},dependencies:[hi,yt],styles:["[_nghost-%COMP%]{position:relative}.hint[_ngcontent-%COMP%]{background:#fff;box-shadow:4px 4px 8px #223c504e;display:inline-block;opacity:0}.show-hint[_ngcontent-%COMP%]{opacity:1}.hide-hint[_ngcontent-%COMP%]{opacity:0}"]});let i=e;return i})();var gg=["*"];function yg(i,e){if(i&1&&h(0,"i",1),i&2){let r=m();an("ra-"+r.icon)}}var sr=(()=>{let e=class e{constructor(){this.disabled=!1}click(){return!this.disabled}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-icon-btn"]],hostVars:2,hostBindings:function(n,o){n&1&&S("click",function(){return o.click()}),n&2&&de("disabled",o.disabled)},inputs:{icon:"icon",disabled:"disabled"},ngContentSelectors:gg,decls:2,vars:1,consts:[["class","ra",3,"class",4,"ngIf"],[1,"ra"]],template:function(n,o){n&1&&(ii(),g(0,yg,1,2,"i",0),Ft(1)),n&2&&u("ngIf",o.icon)},dependencies:[se],styles:["[_nghost-%COMP%]{display:inline-block;font-size:30px;color:#fff;background:#55575a;cursor:pointer;border-radius:5px}.disabled[_nghost-%COMP%]{filter:brightness(.7);pointer-events:none}"]});let i=e;return i})();var ga=(()=>{let e=class e{constructor(){}ngOnInit(){let t=this.item?.baseType||this.itemBase;this.descriptions=t.description({thisItem:this.item,thisItemBase:t}).descriptions}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-item-description"]],inputs:{item:"item",itemBase:"itemBase"},decls:1,vars:1,consts:[[3,"descriptions"]],template:function(n,o){n&1&&h(0,"mw-description",0),n&2&&u("descriptions",o.descriptions)},changeDetection:0});let i=e;return i})();var vg=(i,e)=>({color:i,background:e}),ya=(()=>{let e=class e{constructor(){}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-item-icon-base"]],inputs:{icon:"icon",itemColor:"itemColor",bgColor:"bgColor"},decls:2,vars:5,consts:[[1,"player-item","item-icon",3,"ngStyle"],[3,"icon"]],template:function(n,o){n&1&&(a(0,"div",0),h(1,"mw-ra-icon",1),c()),n&2&&(u("ngStyle",$t(2,vg,o.itemColor,o.bgColor)),l(),u("icon",o.icon))},dependencies:[pn,le],styles:[".player-item[_ngcontent-%COMP%]{width:64px;height:32px;padding:6px 0;box-sizing:border-box;border:1px solid gray;border-radius:6px;margin:1px}.item-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-size:32px;overflow:hidden}"]});let i=e;return i})();var Cg=(i,e)=>({color:i,background:e});function Sg(i,e){if(i&1&&(a(0,"div",3)(1,"div",4)(2,"div",5),h(3,"mw-ra-icon",6),c(),a(4,"div",7),d(5),a(6,"div",8),d(7),c()()(),a(8,"div",9),h(9,"mw-item-description",10),c()()),i&2){let r=m();l(2),u("ngStyle",$t(6,Cg,r._itemBase.icon.iconClr,r._itemBase.icon.bgClr)),l(),u("icon",r._itemBase.icon.icon),l(2),M(" ",r._itemBase.name," "),l(2),H(r._itemBase.slotType),l(2),u("item",r._item)("itemBase",r._itemBase)}}var ki=(()=>{let e=class e{constructor(){this.hintPos="above"}set item(t){this._itemBase=t.baseType,this._item=t}set itemBase(t){this._itemBase=t}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-item-icon"]],inputs:{item:"item",itemBase:"itemBase",hintPos:"hintPos"},decls:4,vars:5,consts:[["hint",""],[3,"hintBody","hintPos"],[3,"icon","itemColor","bgColor"],[2,"max-width","200px"],[2,"display","flex"],[1,"tooltip-icon",3,"ngStyle"],[3,"icon"],[2,"padding","4px 8px 8px","font-size","14px"],[2,"font-size","9px","color","gray"],[2,"padding","0 8px 8px","font-size","13px"],[3,"item","itemBase"]],template:function(n,o){if(n&1&&(a(0,"mw-hover-hint",1),h(1,"mw-item-icon-base",2),g(2,Sg,10,9,"ng-template",null,0,Q),c()),n&2){let s=ne(3);u("hintBody",s)("hintPos",o.hintPos),l(),u("icon",o._itemBase.icon.icon)("itemColor",o._itemBase.icon.iconClr)("bgColor",o._itemBase.icon.bgClr)}},styles:[".tooltip-icon[_ngcontent-%COMP%]{height:32px;width:32px;overflow:hidden;font-size:28px;display:flex;align-items:center;justify-content:center}"]});let i=e;return i})();function _(i,e,r,t){var n=arguments.length,o=n<3?e:t===null?t=Object.getOwnPropertyDescriptor(e,r):t,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,r,t);else for(var p=i.length-1;p>=0;p--)(s=i[p])&&(o=(n<3?s(o):n>3?s(e,r,o):s(e,r))||o);return n>3&&o&&Object.defineProperty(e,r,o),o}function wg(i,e){if(i&1&&(a(0,"div"),h(1,"mw-item-icon",5),c()),i&2){let r=m();l(),u("item",r.equippedItem)("itemBase",r.equippedItem.baseType)("hintPos",r.hintPos)}}function xg(i,e){if(i&1&&h(0,"mw-item-icon-base",6),i&2){let r=m();u("icon",r.slotInfo.icon)}}function bg(i,e){if(i&1){let r=R();a(0,"mw-item-icon",10),S("click",function(){let n=E(r).$implicit,o=m(3);return I(o.equipItem(n))}),c()}if(i&2){let r=e.$implicit;u("item",r)("itemBase",r.baseType)}}function _g(i,e){if(i&1){let r=R();ve(0),a(1,"div",7)(2,"mw-item-icon-base",8),S("click",function(){E(r);let n=m(2);return I(n.unequipSlot())}),c(),g(3,bg,1,2,"mw-item-icon",9),c(),Ce()}if(i&2){let r=m(2);l(3),u("ngForOf",r.availableItemsForSlot)}}function Mg(i,e){if(i&1&&g(0,_g,4,1,"ng-container",4),i&2){let r=m(),t=ne(7);u("ngIf",r.availableItemsForSlot.length)("ngIfElse",t)}}function Pg(i,e){if(i&1&&(a(0,"div",11),d(1),c()),i&2){let r=m();l(),M(' No items For "',r.slotInfo.name,'" slot ')}}var Vr=class Vr extends ce(){constructor(e){super(),this.playersService=e,this.hintPos="after",this.isEquipped=!1,this.equippedItem=null,this.availableItemsForSlot=[],this.hero=this.playersService.getCurrentPlayer().hero}ngOnChanges(e){let r=e.itemSlot;if(r){let t=r.currentValue;this.slotInfo=Qt.getSlotExtendedInfo(t);let n=this.hero.inventory;this.isEquipped=n.isSlotEquipped(t),this.equippedItem=n.getItemInSlot(t),this.availableItemsForSlot=Qt.filterItemsForSlot(t,this.hero.itemsBackpack)}}updateItems(e){e.item.baseType.slotType===this.itemSlot&&(this.availableItemsForSlot=Qt.filterItemsForSlot(this.itemSlot,this.hero.itemsBackpack))}removeItem(e){e.item.baseType.slotType===this.itemSlot&&(this.availableItemsForSlot=Qt.filterItemsForSlot(this.itemSlot,this.hero.itemsBackpack),this.equippedItem=null,this.isEquipped=!1)}updateSlotOnEquip(e){e.item.baseType.slotType===this.itemSlot&&(this.equippedItem=e.item,this.isEquipped=!0)}updateSlotOnUnequip(e){e.item.baseType.slotType===this.itemSlot&&(this.equippedItem=null,this.isEquipped=!1)}equipItem(e){this.equippedItem!==e&&(this.equippedItem&&this.unequipSlot(),this.events.dispatch($n({item:e,player:this.playersService.getCurrentPlayer()})))}unequipSlot(){this.isEquipped&&this.equippedItem&&this.events.dispatch(fn({item:this.equippedItem,player:this.playersService.getCurrentPlayer()}))}};Vr.\u0275fac=function(r){return new(r||Vr)(y(k))},Vr.\u0275cmp=v({type:Vr,selectors:[["mw-item-slot"]],inputs:{itemSlot:"itemSlot",hintPos:"hintPos"},features:[j,ji],decls:8,vars:3,consts:[["isUnequipped",""],["itemsMenuBody",""],["noItemsForSlot",""],["pos","below",3,"menuBody"],[4,"ngIf","ngIfElse"],[1,"hoverable",3,"item","itemBase","hintPos"],["bgColor","white","itemColor","gray",1,"hoverable",3,"icon"],[1,"items-menu"],["bgColor","white","itemColor","gray","icon","cancel",1,"hoverable",3,"click"],["class","hoverable","hintPos","above",3,"item","itemBase","click",4,"ngFor","ngForOf"],["hintPos","above",1,"hoverable",3,"click","item","itemBase"],[1,"no-items"]],template:function(r,t){if(r&1&&(a(0,"mw-menu",3),g(1,wg,2,3,"div",4)(2,xg,1,1,"ng-template",null,0,Q),c(),g(4,Mg,1,2,"ng-template",null,1,Q)(6,Pg,2,1,"ng-template",null,2,Q)),r&2){let n=ne(3),o=ne(5);u("menuBody",o),l(),u("ngIf",t.isEquipped)("ngIfElse",n)}},styles:["mw-item-icon-base[_ngcontent-%COMP%]{cursor:pointer}.items-menu[_ngcontent-%COMP%]{max-width:233px;width:200px;display:flex;flex-wrap:wrap;padding:6px;justify-content:center}.no-items[_ngcontent-%COMP%]{text-align:center;width:150px;font-size:12px;color:gray;padding:10px}.hoverable[_ngcontent-%COMP%]{cursor:pointer}"]});var ai=Vr;_([G(Ci)],ai.prototype,"updateItems",null);_([G(jn)],ai.prototype,"removeItem",null);_([G($n)],ai.prototype,"updateSlotOnEquip",null);_([G(fn)],ai.prototype,"updateSlotOnUnequip",null);function va(i){let e=L(jr).escape$.subscribe(()=>i());L(Dr).onDestroy(()=>e.unsubscribe())}var Ca=(()=>{let e=class e extends te{constructor(){super(),this.events=L(z),this.state=L(J),this.state.mainMenu.isOpen=!0,va(()=>this.close())}ngOnDestroy(){this.state.mainMenu.isOpen=!1}openSettings(){this.events.dispatch(Wn())}quitTheGame(){location.reload()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-main-menu-popup"]],features:[j],decls:9,vars:0,consts:[[2,"text-align","center"],[2,"display","flex","flex-direction","column"],["mw-main-button","",3,"click"]],template:function(n,o){n&1&&(a(0,"div",0),d(1,"Main Menu"),c(),a(2,"div",1)(3,"button",2),S("click",function(){return o.close()}),d(4,"Return to the Game"),c(),a(5,"button",2),S("click",function(){return o.openSettings()}),d(6,"Settings"),c(),a(7,"button",2),S("click",function(){return o.quitTheGame()}),d(8,"Quit"),c()())},dependencies:[ae],styles:["[_nghost-%COMP%]{padding:10px;display:block}button[_ngcontent-%COMP%]{min-width:165px;font-weight:600}"]});let i=e;return i})();var Eg=["elem"],Ig=["generalHint"],Tg=["*"];function Fg(i,e){i&1&&be(0)}function Ag(i,e){if(i&1&&(a(0,"div",3),g(1,Fg,1,0,"ng-container",4),c()),i&2){let r=m();$("transition",r.transition,"s"),u("ngClass",r.showHintAnimation?"show-hint":"hide-hint"),l(),u("ngTemplateOutlet",r.menuBody)}}var rs=(()=>{let e=class e{constructor(t,n){this.host=t,this.hintsService=n,this.transition=.15,this.pos="after",this.closeOnClick=!0,this.disabled=!1,this.showHintAnimation=!1,this.currentHintRef=null}onClick(){this.disabled||(this.hintsService.closeAllActiveMenus(),this.showHintAnimation=!0,this.hintsService.activeMenusCount+=1,this.hintsService.activeMenus.add(this),this.currentHintRef=this.hintsService.containerRef.createHint(this.elem,this.generalHint,this.pos))}clearHint(){this.currentHintRef=null}};e.\u0275fac=function(n){return new(n||e)(y(ht),y($r))},e.\u0275cmp=v({type:e,selectors:[["mw-menu"]],viewQuery:function(n,o){if(n&1&&(De(Eg,7),De(Ig,7)),n&2){let s;Ee(s=Ie())&&(o.elem=s.first),Ee(s=Ie())&&(o.generalHint=s.first)}},inputs:{menuBody:"menuBody",transition:"transition",pos:"pos",closeOnClick:"closeOnClick",disabled:"disabled"},ngContentSelectors:Tg,decls:5,vars:0,consts:[["elem",""],["generalHint",""],[3,"click"],[1,"hint","menu-hint",3,"ngClass"],[4,"ngTemplateOutlet"]],template:function(n,o){if(n&1){let s=R();ii(),a(0,"div",2,0),S("click",function(){return E(s),I(o.onClick())}),Ft(2),c(),g(3,Ag,2,4,"ng-template",null,1,Q)}},dependencies:[hi,yt],styles:["[_nghost-%COMP%]{position:relative}.hint[_ngcontent-%COMP%]{background:#fff;box-shadow:4px 4px 8px #223c504e;display:inline-block;opacity:0}.show-hint[_ngcontent-%COMP%]{opacity:1}.hide-hint[_ngcontent-%COMP%]{opacity:0}"]});let i=e;return i})();function os(i){i||(Kl(os),i=L(Dr));let e=new $l(r=>i.onDestroy(r.next.bind(r)));return r=>r.pipe(et(e))}var sl=i=>({hint:i});function kg(i,e){i&1&&be(0)}function Gg(i,e){if(i&1&&(ve(0),g(1,kg,1,0,"ng-container",7),Ce()),i&2){let r=m().ngIf;m();let t=ne(5);l(),u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,sl,r))}}function Rg(i,e){i&1&&be(0)}function Ug(i,e){if(i&1&&(ve(0),g(1,Rg,1,0,"ng-container",7),Ce()),i&2){let r=m().ngIf;m();let t=ne(7);l(),u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,sl,r))}}function Bg(i,e){i&1&&be(0)}function Hg(i,e){if(i&1&&(ve(0),g(1,Bg,1,0,"ng-container",7),Ce()),i&2){let r=m().ngIf;m();let t=ne(3);l(),u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,sl,r))}}function Lg(i,e){if(i&1&&(a(0,"div",4),ve(1,5),g(2,Gg,2,4,"ng-container",6)(3,Ug,2,4,"ng-container",6)(4,Hg,2,4,"ng-container",6),Ce(),c()),i&2){let r=e.ngIf,t=m();l(),u("ngSwitch",r.type),l(),u("ngSwitchCase",t.hintActionTypes.OnHoverEnemyCard),l(),u("ngSwitchCase",t.hintActionTypes.OnTargetSpell),l(),u("ngSwitchCase",t.hintActionTypes.CustomHtml)}}function Ng(i,e){if(i&1&&(h(0,"div",8),re(1,"safeHtml")),i&2){let r=e.hint;u("innerHTML",oe(1,1,r.html),jt)}}function jg(i,e){if(i&1&&(ve(0),d(1),Ce()),i&2){let r=m().hint;l(),M("-",r.maxDamage,"")}}function $g(i,e){if(i&1&&(ve(0),d(1),Ce()),i&2){let r=m().hint;l(),M("-",r.maxCountLoss,"")}}function Vg(i,e){if(i&1&&(a(0,"span"),d(1,"Attack"),c(),a(2,"span"),d(3),c(),a(4,"span"),d(5," dealing "),c(),a(6,"span"),d(7),g(8,jg,2,1,"ng-container",9),c(),a(9,"span"),d(10," damage, killing "),c(),a(11,"span"),d(12),g(13,$g,2,1,"ng-container",9),c(),a(14,"span"),d(15," units "),c()),i&2){let r=e.hint;l(2),$("color",r.attackedGroup.ownerPlayer.color),l(),M(" ",r.attackedGroup.type.name," "),l(4),M(" ",r.minDamage,""),l(),u("ngIf",!r.noDamageSpread),l(4),M(" ",r.minCountLoss,""),l(),u("ngIf",!r.noLossSpread)}}function zg(i,e){if(i&1&&(a(0,"div")(1,"span"),d(2," Cast "),c(),a(3,"span"),d(4),c(),a(5,"span"),d(6," on "),c(),a(7,"span"),d(8),c()(),a(9,"div"),d(10," Press RMB to cancel "),c()),i&2){let r=e.hint;l(4),M(" ",r.spell.name," "),l(4),M(" ",r.target.type.name," ")}}var Gi=(()=>{let e=class e{constructor(t,n,o){this.players=t,this.events=n,this.actionHintService=o,this.hintActionTypes=$i,this.hint$=new Et(null),Mr([this.actionHintService.disableActionHint$,this.actionHintService.hintMessage$]).pipe(Li(([s,p])=>s?null:p),Wl(s=>this.hint$.next(s)),os()).subscribe()}};e.\u0275fac=function(n){return new(n||e)(y(k),y(z),y(_n))},e.\u0275cmp=v({type:e,selectors:[["mw-action-hint"]],decls:8,vars:3,consts:[["customHtml",""],["simple",""],["onTargetSpell",""],["style","text-align: center;",4,"ngIf"],[2,"text-align","center"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"innerHTML"],[4,"ngIf"]],template:function(n,o){n&1&&(g(0,Lg,5,4,"div",3),re(1,"async"),g(2,Ng,2,3,"ng-template",null,0,Q)(4,Vg,16,7,"ng-template",null,1,Q)(6,zg,11,2,"ng-template",null,2,Q)),n&2&&u("ngIf",oe(1,1,o.hint$))},dependencies:[se,yt,gi,ln,yi,Ht],styles:["[_nghost-%COMP%]{pointer-events:none;width:fit-content;margin:auto}"]});let i=e;return i})();var Mn=function(i){return i.HeroStatMods="hsMods",i.HeroItemMods="hiMods",i.CommonCombatMods="ccMods",i}(Mn||{});function wa(i,e){let r=i.unitGroup;i.unitGroup=e.unitGroup,e.unitGroup=r}function Jd(i){return i.filter(e=>!e.unitGroup).length}var em=(()=>{let e=class e extends Ot{constructor(){super(...arguments),this.experience=0,this.level=1,this.freeSkillpoints=0,this.spells=[],this.modGroup=_t.empty(),this.unitAurasModGroup=_t.empty(),this.specialtiesModGroup=_t.empty(),this.itemsBackpack=[],this.inventory=new Qt,this._unitGroups=[],this.heroStats$=new Et({baseAttack:0,bonusAttack:0,finalAttack:0,baseDefence:0,bonusDefence:0,finalDefence:0,fireResist:0,coldResist:0,lightningResist:0,poisonResist:0,currentMana:0,maxMana:0}),this.signalState=Pi(this.heroStats$.getValue()),this.destroyed$=new Dt,this.mainUnitSlots=[{unitGroup:null},{unitGroup:null},{unitGroup:null},{unitGroup:null}],this.reserveUnitSlots=[{unitGroup:null,isReserve:!0},{unitGroup:null,isReserve:!0}]}get ownerPlayer(){return this._ownerPlayer}get unitGroups(){return this._unitGroups}create({heroBase:t,unitGroups:n,ownerPlayer:o}){this.base=t,this.name=t.name;let s=t.initialState.stats;o&&(this._ownerPlayer=o),this.stats={currentMana:s.mana},n&&this.setUnitGroups(n),t.initialState.defaultModifiers&&this.modGroup.addModsRef(gt.fromMods(t.initialState.defaultModifiers)),this.updateSignalState()}getState(){return this.getStats()}addReserveSlots(t){for(let n=0;n<t;n++)this.reserveUnitSlots.push({unitGroup:null,isReserve:!0})}hasFreeUnitSlots(){return this.hasFreeMainSlots()||this.hasFreeReserveSlots()}hasFreeMainSlots(){return this.getFreeMainSlotsCount()!==0}hasFreeReserveSlots(){return this.getFreeReserveSlotsCount()!==0}getFreeUnitSlotsCount(){return this.getFreeMainSlotsCount()+this.getFreeReserveSlotsCount()}getFreeMainSlotsCount(){return Jd(this.mainUnitSlots)}getFreeReserveSlotsCount(){return Jd(this.reserveUnitSlots)}getMainFilledUnitSlots(){return this.mainUnitSlots.filter(t=>t.unitGroup)}updateUnitGroupPositions(){this.getMainFilledUnitSlots().forEach((t,n)=>{t?.unitGroup?.setPosition(n)})}getAllSlots(){return[...this.mainUnitSlots,...this.reserveUnitSlots]}getAllUnitsFromSlots(){return this.getAllSlots().map(t=>t.unitGroup).filter(Tp)}setUnitGroups(t,n=!0){this._unitGroups=t,this._unitGroups.forEach((o,s)=>{n&&(this.mainUnitSlots[s].unitGroup=o),this.updateUnitGroup(o)}),this.updateUnitGroupPositions()}addUnitGroup(t){let n=this.unitGroups.includes(t);if(this._unitGroups.push(t),this.updateUnitGroup(t),n)return;let o=this.mainUnitSlots.find(p=>!p.unitGroup);if(o){o.unitGroup=t,this.refreshUnitGroupsOrderBySlots();return}let s=this.reserveUnitSlots.find(p=>!p.unitGroup);s&&(s.unitGroup=t),this.refreshUnitGroupsOrderBySlots(),this.getApi().events.dispatch(hc({hero:this,unitGroup:t})),this.updateUnitGroupPositions()}removeUnitGroup(t){V.removeItem(this.unitGroups,t),this.getApi().events.dispatch(gc({hero:this,unitGroup:t})),this.updateUnitGroupPositions()}refreshUnitGroupsOrderBySlots(){this._unitGroups=this.mainUnitSlots.map(t=>t.unitGroup).filter(Boolean)}assignOwnerPlayer(t){this._ownerPlayer=t;let n=this.base,o=n.initialState;this.spells=o.abilities.map(s=>this.getApi().spells.createSpellInstance(s)),this.initParentModGroups(),this.setupStatsUpdating(n),this.updateUnitGroupPositions()}onDestroy(){ra(this.destroyed$)}getStats(){return this.heroStats$.getValue()}getStateSignal(){return this.signalState}listenHeroStats(){return this.heroStats$.pipe(et(this.destroyed$))}addItem(t){this.itemsBackpack.push(t)}removeItem(t){V.removeItem(this.itemsBackpack,t),this.inventory.isItemEquipped(t)&&this.unequipItem(t)}equipItem(t){this.inventory.equipItem(t);let n=this.getItemModsGroup(),o=t.baseType;if(o.staticMods){let s=gt.fromMods(o.staticMods);n?.addModsRef(s)}o.bonusAbilities&&o.bonusAbilities.forEach(s=>{let p=this.getApi().spells.createSpellInstance(s.spell,{initialLevel:s.level});p.setSourceGameObjectId(t.id),this.spells.push(p)})}unequipItem(t){this.inventory.unequipItem(t);let n=this.getItemModsGroup();t.baseType.staticMods&&n&&n.removeRefByModInstance(t.baseType.staticMods),this.spells=this.spells.filter(o=>o.sourceInfo.gameObjectId!==t.id)}addCommonCombatMods(t){this.modGroup.getNamedGroup(Mn.CommonCombatMods)?.addModsRef(t)}clearCommonCombatMods(){this.modGroup.getNamedGroup(Mn.CommonCombatMods)?.clearOwnModRefs()}updateUnitsSpecialtyAndConditionalMods(){this.unitGroups.forEach(t=>this.updateUnitSpecialtyAndConditionalMods(t))}updateUnitSpecialtyAndConditionalMods(t){t.clearSpecialtyAndConditionalMods(),this.modGroup.getAllModValues("__unitConditionalMods").map(p=>p(t)).filter(Boolean).forEach(p=>t.attachSpecialtyMods(p));let o=t.type.getUnitTypeSpecialtyModifiers;if(!o)return;let s=o?.(this.specialtiesModGroup.getMods());s&&t.attachSpecialtyMods(s)}addStatsMods(t){this.modGroup.getNamedGroup(Mn.HeroStatMods)?.addModsRef(gt.fromMods(t))}addMana(t){this.stats.currentMana+=t;let n=this.getStats().maxMana;this.stats.currentMana>n&&(this.stats.currentMana=n);let o=this.heroStats$.getValue();this.heroStats$.next(N(P({},o),{currentMana:this.stats.currentMana})),this.updateSignalState()}updateUnitGroup(t){t.assignOwnerPlayer(this.ownerPlayer),t.assignOwnerHero(this),this.updateUnitSpecialtyAndConditionalMods(t)}getItemModsGroup(){return this.modGroup.getNamedGroup(Mn.HeroItemMods)}initParentModGroups(){this.modGroup.attachNamedParentGroup(Mn.HeroItemMods,_t.empty()),this.modGroup.attachNamedParentGroup(Mn.HeroStatMods,_t.empty()),this.modGroup.attachNamedParentGroup(Mn.CommonCombatMods,_t.empty())}setupStatsUpdating(t){this.modGroup.onValueChanges().pipe(et(this.destroyed$)).subscribe(n=>{this.specialtiesModGroup.clearOwnModRefs(),this.specialtiesModGroup.addModsRef(gt.fromMods(Fp(n))),this.updateUnitsSpecialtyAndConditionalMods();let{baseAttack:o,baseDefence:s,mana:p}=t.initialState.stats,f=n.heroBonusAttack||0,C=n.heroBonusDefence||0,w=n.resistAll||0,T=(n.heroMaxMana||0)+p;this.stats.currentMana>T&&(this.stats.currentMana=T);let U={baseAttack:o,bonusAttack:f,finalAttack:o+f,baseDefence:s,bonusDefence:C,finalDefence:s+C,fireResist:(n.resistFire||0)+w,coldResist:(n.resistCold||0)+w,lightningResist:(n.resistLightning||0)+w,poisonResist:(n.resistPoison||0)+w,currentMana:this.stats.currentMana,maxMana:T};this.heroStats$.next(U),this.updateSignalState()})}updateSignalState(){this.signalState.set(this.heroStats$.getValue())}};e.categoryId="hero";let i=e;return i})();var ar={1:0,2:285,3:400,4:475,5:545,6:600,7:650,8:700};var ss=(()=>{let e=class e{constructor(t){this.players=t,this.currentPlayer=this.players.getCurrentPlayer(),this.xpToNextLevel=ar[this.currentPlayer.hero.level+1]}};e.\u0275fac=function(n){return new(n||e)(y(k))},e.\u0275cmp=v({type:e,selectors:[["mw-experience-bar"]],decls:2,vars:2,consts:[[1,"experience-bar"],[1,"experience-progress"]],template:function(n,o){n&1&&(a(0,"div",0),h(1,"div",1),c()),n&2&&(l(),$("width",o.currentPlayer.hero.experience/o.xpToNextLevel*100,"%"))},styles:["[_nghost-%COMP%]{display:block}.experience-bar[_ngcontent-%COMP%]{background:#80808074}.experience-progress[_ngcontent-%COMP%]{background:#4c1f5e;height:3px}"]});let i=e;return i})();function qg(i,e){if(i&1&&h(0,"mw-item-slot",7),i&2){let r=e.$implicit;u("mwActionHint",r.name)("itemSlot",r.slotType)}}function Yg(i,e){if(i&1){let r=R();a(0,"div",9),S("click",function(){E(r);let n=m().$implicit,o=m();return I(o.displayUnitGroupInfo(n.unitGroup))})("mwNoContextMenu",function(){E(r);let n=m().$implicit,o=m();return I(o.displayUnitGroupInfo(n.unitGroup))}),a(1,"div",10),d(2),c(),a(3,"div"),d(4),c()()}if(i&2){let r=m().$implicit,t=m();$("background",t.player.color),u("mwActionHint","Inspect group of "+r.unitGroup.count+" "+r.unitGroup.type.name),l(2),H(r.unitGroup.type.name),l(2),H(r.unitGroup.count)}}function Qg(i,e){if(i&1&&g(0,Yg,5,5,"div",8),i&2){let r=e.$implicit;Oe(r.unitGroup?0:-1)}}function Kg(i,e){if(i&1){let r=R();a(0,"div",12),S("click",function(){E(r);let n=m().$implicit,o=m();return I(o.displayUnitGroupInfo(n.unitGroup))})("mwNoContextMenu",function(){E(r);let n=m().$implicit,o=m();return I(o.displayUnitGroupInfo(n.unitGroup))}),a(1,"div",10),d(2),c(),a(3,"div"),d(4),c()()}if(i&2){let r=m().$implicit,t=m();$("background",t.player.color),u("mwActionHint","Inspect group of "+r.unitGroup.count+" "+r.unitGroup.type.name),l(2),H(r.unitGroup.type.name),l(2),H(r.unitGroup.count)}}function Zg(i,e){if(i&1&&g(0,Kg,5,5,"div",11),i&2){let r=e.$implicit;Oe(r.unitGroup?0:-1)}}var cr=(()=>{let e=class e{constructor(t,n,o){this.players=t,this.state=n,this.events=o,this.player=this.players.getCurrentPlayer(),this.itemSlots=Qt.getExtendedSlotTypes()}openPlayerInfo(){this.events.dispatch(Bn())}getHeroActionHint(){let t=this.player.hero,n=t.level+1;return`
    <div>${ar[n]-t.experience}xp is required to reach Level ${n}</div>
    <div>(${t.experience}/${ar[n]})</div>
    `}displayUnitGroupInfo(t){this.events.dispatch(gn({unitGroup:t}))}};e.\u0275fac=function(n){return new(n||e)(y(k),y(J),y(z))},e.\u0275cmp=v({type:e,selectors:[["mw-player-info-panel"]],decls:13,vars:6,consts:[["mwActionHint","Inspect Hero",1,"hero-image",2,"cursor","pointer",3,"click","mwNoContextMenu"],[1,"hero-info"],[2,"display","flex","flex-direction","row"],["class","info-small-icons","hintPos","above",3,"mwActionHint","itemSlot",4,"ngFor","ngForOf"],[3,"mwActionHint"],[2,"width","270px"],[1,"groups-container"],["hintPos","above",1,"info-small-icons",3,"mwActionHint","itemSlot"],[1,"player-group-card",3,"background","mwActionHint"],[1,"player-group-card",3,"click","mwNoContextMenu","mwActionHint"],[1,"group-name"],[1,"player-group-card","reserve",3,"background","mwActionHint"],[1,"player-group-card","reserve",3,"click","mwNoContextMenu","mwActionHint"]],template:function(n,o){n&1&&(a(0,"div",0),S("click",function(){return o.openPlayerInfo()})("mwNoContextMenu",function(){return o.openPlayerInfo()}),c(),a(1,"div",1)(2,"div")(3,"div",2),g(4,qg,1,2,"mw-item-slot",3),c()(),a(5,"div",4),d(6),h(7,"mw-experience-bar",5),c(),a(8,"div",6),ut(9,Qg,1,1,null,null,$a),ut(11,Zg,1,1,null,null,$a),c()()),n&2&&($("background-image","url('assets/"+o.player.hero.base.image+"')"),l(4),u("ngForOf",o.itemSlots),l(),u("mwActionHint",o.getHeroActionHint()),l(),me(" ",o.player.hero.name,", Level: ",o.player.hero.level," "),l(3),dt(o.player.hero.mainUnitSlots),l(2),dt(o.player.hero.reserveUnitSlots))},styles:["[_nghost-%COMP%]{display:flex}.groups-container[_ngcontent-%COMP%]{display:flex}.hero-info[_ngcontent-%COMP%]{align-self:end;margin-bottom:6px}.hero-image[_ngcontent-%COMP%]{background-size:cover;width:100px;height:100px;border-radius:50%;border:4px solid gray;margin:8px;align-self:end}.player-group-card[_ngcontent-%COMP%]{height:48px;width:48px;color:#fff;display:flex;flex-direction:column;justify-content:center;text-align:center;border-radius:4px;font-size:11px;margin:3px;cursor:pointer}.player-group-card.reserve[_ngcontent-%COMP%]{height:40px;width:40px;font-size:10px;filter:brightness(.7)}.group-name[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis}.skillpoints[_ngcontent-%COMP%]{border:1px solid gold;padding:3px;font-size:12px;cursor:pointer;margin:3px;max-width:200px}"]});let i=e;return i})();function Xg(i,e){if(i&1){let r=R();a(0,"div",2),S("click",function(){let n=E(r).$implicit,o=m();return I(o.displayUnitGroupInfo(n))})("mwNoContextMenu",function(){let n=E(r).$implicit,o=m();return I(o.displayUnitGroupInfo(n))}),a(1,"div"),d(2),c(),a(3,"div"),d(4),c()()}if(i&2){let r=e.$implicit;$("background",r.ownerPlayer.color),u("mwActionHint","Inspect "+r.count+" "+r.type.name),l(2),H(r.type.name),l(2),H(r.count)}}var as=(()=>{let e=class e{constructor(t){this.events=t}displayUnitGroupInfo(t){this.events.dispatch(gn({unitGroup:t}))}};e.\u0275fac=function(n){return new(n||e)(y(z))},e.\u0275cmp=v({type:e,selectors:[["mw-unit-groups-list"]],inputs:{unitGroups:"unitGroups"},decls:2,vars:1,consts:[[1,"list"],["class","group",3,"mwActionHint","background","click","mwNoContextMenu",4,"ngFor","ngForOf"],[1,"group",3,"click","mwNoContextMenu","mwActionHint"]],template:function(n,o){n&1&&(a(0,"div",0),g(1,Xg,5,5,"div",1),c()),n&2&&(l(),u("ngForOf",o.unitGroups))},styles:[".list[_ngcontent-%COMP%]{display:flex;justify-content:center}.group[_ngcontent-%COMP%]{height:64px;width:64px;font-size:13px;display:flex;justify-content:center;flex-direction:column;align-items:center;text-align:center;color:#fff;margin:3px;border-radius:5px;cursor:pointer}"]});let i=e;return i})();var cs=(()=>{let e=class e{constructor(){this.state=L(J),this.events=L(z),this.players=L(k),this.currentPlayer=this.players.getCurrentPlayer()}goToTown(){this.events.dispatch(bo())}openPlayerInfo(){this.events.dispatch(Bn())}openActionCards(){this.events.dispatch(Do())}openGarrison(){this.events.dispatch(Nn())}setupCampAction(){let t=this.players.getCurrentPlayer();this.events.dispatch(Qn({player:t,cardStack:t.actionCards.find(n=>n.card===Xs)}))}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-player-map-actions-panel"]],decls:13,vars:8,consts:[["icon","castle-emblem",3,"click","mwActionHint"],["mwActionHint","Inspect Hero","icon","aura",3,"click"],[1,"action-points",3,"click","mwActionHint"],[1,"action-info"],["icon","spades-card"],["mwActionHint","Learn new abilities"],["icon","barrier",3,"disabled"],[3,"mwActionHint"],["icon","guarded-tower",3,"click","disabled"],[1,"camp-action",3,"click","mwActionHint"],["icon","campfire"]],template:function(n,o){n&1&&(a(0,"mw-icon-btn",0),S("click",function(){return o.goToTown()}),c(),a(1,"mw-icon-btn",1),S("click",function(){return o.openPlayerInfo()}),c(),a(2,"mw-icon-btn",2),S("click",function(){return o.openActionCards()}),a(3,"div",3),h(4,"mw-ra-icon",4),a(5,"span"),d(6),c()()(),a(7,"div",5),h(8,"mw-icon-btn",6),c(),a(9,"div",7)(10,"mw-icon-btn",8),S("click",function(){return o.openGarrison()}),c()(),a(11,"mw-icon-btn",9),S("click",function(){return o.setupCampAction()}),h(12,"mw-ra-icon",10),c()),n&2&&(Or("mwActionHint","Go to ",o.state.createdGame.faction.title,""),l(2),u("mwActionHint","Action Cards<hr>"+o.state.currentGame.actionPoints+" action points left"),l(4),H(o.currentPlayer.actionCards.length),l(2),u("disabled",!0),l(),u("mwActionHint",o.currentPlayer.garrisons.size!==0?"Garrison":"Garrison <hr> No garrisons to hire"),l(),u("disabled",o.currentPlayer.garrisons.size===0),l(),u("mwActionHint","Set up Camp<hr>Skips current day"))},styles:["mw-icon-btn[_ngcontent-%COMP%]{text-align:center;min-width:70px;max-width:70px;min-height:40px;margin-bottom:4px}mw-icon-btn.action-points[_ngcontent-%COMP%]{font-weight:100;font-size:23px;padding-top:4px;box-sizing:border-box}mw-icon-btn[_ngcontent-%COMP%] > .action-info[_ngcontent-%COMP%]{margin-left:-2px}"]});let i=e;return i})();function t0(i,e){if(i&1){let r=R();a(0,"div",7),S("click",function(){let n=E(r).$implicit,o=m();return I(o.setActiveReward(n))}),h(1,"mw-ra-icon",8),a(2,"div",9),d(3),c()()}if(i&2){let r=e.$implicit,t=m();de("active",r===t.activeReward),l(),u("icon",r.display.icon),l(2),H(r.display.title)}}var xa=(()=>{let e=class e extends te{setActiveReward(t){this.activeReward=t}acceptReward(){this.activeReward.onSumbit(),this.close()}};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=ft(e)))(o||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-reward-popup"]],features:[j],decls:12,vars:4,consts:[["popupHeader",""],["popupContent",""],[1,"sub-info"],[1,"rewards"],["class","reward",3,"active","click",4,"ngFor","ngForOf"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],[1,"reward",3,"click"],[3,"icon"],[1,"reward-title"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2),c(),a(3,"div",1)(4,"div",2)(5,"p"),d(6),c()(),a(7,"div",3),g(8,t0,4,4,"div",4),c()(),a(9,"div",5)(10,"button",6),S("click",function(){return o.acceptReward()}),d(11," Accept "),c()()()),n&2&&(l(2),M(" ",o.data.title," "),l(4),H(o.data.subTitle),l(2),u("ngForOf",o.data.rewards),l(2),u("disabled",!o.activeReward))},dependencies:[q,le,ae,ue],styles:[".title[_ngcontent-%COMP%]{font-size:16px;text-align:center}.sub-title[_ngcontent-%COMP%]{font-size:13px;text-align:center}.rewards[_ngcontent-%COMP%]{display:flex;padding-top:10px;width:100%;justify-content:center}.reward[_ngcontent-%COMP%]{display:flex;width:120px;height:80px;align-items:center;justify-content:center;border:1px solid gray;flex-direction:column;margin:10px;cursor:pointer;-webkit-user-select:none;user-select:none}.reward.active[_ngcontent-%COMP%]{border:1px solid gold}.reward[_ngcontent-%COMP%]   mw-ra-icon[_ngcontent-%COMP%]{font-size:30px}.reward[_ngcontent-%COMP%]   .reward-title[_ngcontent-%COMP%]{font-size:13px;text-align:center}"]});let i=e;return i})();var al=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-round-icon"]],inputs:{icon:"icon"},decls:1,vars:1,consts:[[3,"icon"]],template:function(n,o){n&1&&h(0,"mw-ra-icon",0),n&2&&u("icon",o.icon)},dependencies:[le],styles:["[_nghost-%COMP%]{border:5px solid rgb(105,105,105);border-radius:50%;width:28px;height:28px;background-color:gray;color:#fff;display:flex;font-size:20px;justify-content:center;align-items:center}"]});let i=e;return i})(),ba=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-round-icon-btn"]],inputs:{icon:"icon"},decls:1,vars:1,consts:[[3,"icon"]],template:function(n,o){n&1&&h(0,"mw-round-icon",0),n&2&&u("icon",o.icon)},dependencies:[al],styles:["mw-round-icon[_ngcontent-%COMP%]:hover{filter:brightness(1.1)}mw-round-icon[_ngcontent-%COMP%]:active{filter:brightness(.7)}"]});let i=e;return i})();var cl=(()=>{let e=class e{constructor(t){this.template=t}ngOnInit(){console.log("------->>",this.templateName)}};e.\u0275fac=function(n){return new(n||e)(y(Ar))},e.\u0275dir=Le({type:e,selectors:[["","mwSharedTemplate",""]],inputs:{templateName:[0,"mwSharedTemplate","templateName"]}});let i=e;return i})();function n0(i,e){if(i&1&&h(0,"mw-ra-icon",2),i&2){let r=e.data;u("icon",r.icon)}}function r0(i,e){i&1&&h(0,"mw-vfx-element")}var ls=(()=>{let e=class e{constructor(){}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-shared-templates"]],decls:2,vars:0,consts:[["mwSharedTemplate","icon"],["mwSharedTemplate","animation"],[3,"icon"]],template:function(n,o){n&1&&g(0,n0,1,1,"ng-template",0)(1,r0,1,0,"ng-template",1)}});let i=e;return i})();var lr=(()=>{let e=class e{constructor(){this.spell=Z.required(),this.hero=Z(),this.player=Z.required(),this.ownerUnit=Z(),this.descriptions=Te(()=>this.spell().baseType.getDescription({thisSpell:this.spell().baseType,spellInstance:this.spell(),ownerHero:this.hero(),ownerPlayer:this.player(),ownerUnit:this.ownerUnit()}).descriptions)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-spell-description"]],inputs:{spell:[1,"spell"],hero:[1,"hero"],player:[1,"player"],ownerUnit:[1,"ownerUnit"]},decls:1,vars:1,consts:[[3,"descriptions"]],template:function(n,o){n&1&&h(0,"mw-description",0),n&2&&u("descriptions",o.descriptions())},changeDetection:0});let i=e;return i})();var _a=(()=>{let e=class e extends te{constructor(){super(...arguments),this.players=L(k),this.gameObjects=L(xe),this.toSplit=0}upgadeValue(t){this.toSplit=Number(t.target.value)}split(){if(this.toSplit===0){this.close();return}let t=this.data.unitGroup,n=this.players.getCurrentPlayer().hero,o=this.gameObjects.createNewGameObject(oa,{count:this.toSplit,unitBase:t.type,ownerHero:n,isSplitted:!0});n.addUnitGroup(o),t.addUnitsCount(-this.toSplit),this.close()}closePopup(){this.close()}};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=ft(e)))(o||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-split-units-popup"]],features:[j],decls:15,vars:5,consts:[["popupHeader",""],["popupContent",""],["type","range","min","0",3,"input","max","value"],["popupButtons",""],["mw-main-button","",3,"click"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2," Splitting Group "),c(),a(3,"div",1)(4,"div"),d(5),c(),a(6,"div")(7,"input",2),S("input",function(p){return o.upgadeValue(p)}),c(),a(8,"div"),d(9),c()()(),a(10,"div",3)(11,"button",4),S("click",function(){return o.split()}),d(12," Split "),c(),a(13,"button",4),S("click",function(){return o.closePopup()}),d(14," Close "),c()()()),n&2&&(l(5),me(" ",o.popup.data.unitGroup.type.name," ",o.popup.data.unitGroup.count," "),l(2),u("max",o.popup.data.unitGroup.count-1)("value",o.toSplit),l(2),M(" To split: ",o.toSplit," "))},dependencies:[ae,ue],encapsulation:2});let i=e;return i})();var ps=(()=>{let e=class e extends te{};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=ft(e)))(o||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-unit-group-info-popup"]],features:[j],decls:1,vars:1,consts:[[3,"unitGroup"]],template:function(n,o){n&1&&h(0,"mw-unit-group-info",0),n&2&&u("unitGroup",o.data.unitGroup)},encapsulation:2});let i=e;return i})();function a0(i,e){if(i&1&&h(0,"mw-description",20),i&2){let r=m(2);u("descriptions",r.description.descriptions)}}function c0(i,e){i&1&&d(0," No Description. ")}function l0(i,e){if(i&1&&h(0,"mw-unit-group-spell-icon",24),i&2){let r=e.$implicit,t=m(3);u("hero",t.unitGroup.ownerPlayer.hero)("spell",r)("hintPos","above")("owner",t.unitGroup)}}function p0(i,e){if(i&1&&(a(0,"div",21),h(1,"hr"),a(2,"div",5),d(3," Abilities: "),c(),a(4,"div",22),g(5,l0,1,4,"mw-unit-group-spell-icon",23),c()()),i&2){let r=m(2);l(5),u("ngForOf",r.spells)}}function u0(i,e){if(i&1&&h(0,"mw-unit-group-spell-icon",24),i&2){let r=e.$implicit,t=m(3);u("hero",t.unitGroup.ownerPlayer.hero)("spell",r)("hintPos","above")("owner",t.unitGroup)}}function d0(i,e){if(i&1&&(a(0,"div",21),h(1,"hr"),a(2,"div",5),d(3," Effects: "),c(),a(4,"div",22),g(5,u0,1,4,"mw-unit-group-spell-icon",23),c()()),i&2){let r=m(2);l(5),u("ngForOf",r.effects)}}function m0(i,e){if(i&1&&(ve(0),h(1,"mw-unit-group-portrait",2),a(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),d(6),c(),a(7,"div",7),d(8),c()(),a(9,"div",8)(10,"div",9)(11,"div",10),h(12,"mw-ra-icon",11),d(13),c(),a(14,"div",10),h(15,"mw-ra-icon",12),d(16),c()(),a(17,"div",9)(18,"div",10),h(19,"mw-ra-icon",13),d(20),c()()()(),a(21,"div",14),h(22,"hr"),g(23,a0,1,1,"mw-description",15)(24,c0,1,0,"ng-template",null,0,Q),c()(),a(26,"div",16)(27,"div",5),d(28,"Group Stats"),c(),h(29,"hr"),a(30,"div",8)(31,"div",9)(32,"div",10),h(33,"mw-ra-icon",11),d(34),c(),a(35,"div",10),h(36,"mw-ra-icon",12),d(37),c(),h(38,"hr"),a(39,"div",17)(40,"div",10)(41,"div"),d(42,"Attack:"),c(),a(43,"div"),d(44),h(45,"span",18),c()(),a(46,"div",10)(47,"div"),d(48,"Defence:"),c(),a(49,"div"),d(50),h(51,"span",18),c()(),a(52,"div",10)(53,"div"),d(54,"Speed"),c(),a(55,"div"),d(56),h(57,"span",18),c()()(),g(58,p0,6,1,"div",19)(59,d0,6,1,"div",19),c()()(),Ce()),i&2){let r=e.ngIf,t=ne(25),n=m();l(),u("unitGroup",n.unitGroup)("isHero",n.unitGroup.type.isHero),l(5),me(" ",n.unitGroup.count," ",n.unitGroup.type.name," "),l(2),M(" Tier ",n.unitGroup.type.level," "),l(5),me(" ",n.baseStats.damageInfo.minDamage,"-",n.baseStats.damageInfo.maxDamage," "),l(3),M(" ",n.baseStats.health," "),l(4),M(" Turns per round: ",n.unitGroup.type.defaultTurnsPerRound," "),l(3),u("ngIf",n.description.descriptions.length)("ngIfElse",t),l(11),dp(" ",r.groupStats.totalMinDamage,"-",r.groupStats.totalMaxDamage," (avg. ",r.groupStats.avgTotalDamage,") "),l(3),M(" ",r.groupStats.totalHealth," "),l(7),M(" ",r.groupStats.baseAttack," "),l(),u("mwNumberModifier",r.groupStats.bonusAttack),l(5),M(" ",r.groupStats.baseDefence," "),l(),u("mwNumberModifier",r.groupStats.bonusDefence),l(5),M(" ",r.groupStats.baseSpeed," "),l(),u("mwNumberModifier",r.groupStats.speedBonus),l(),u("ngIf",n.spells.length),l(),u("ngIf",n.effects.length)}}var Ma=(()=>{let e=class e{ngOnChanges(t){this.unitStats$=this.unitGroup.listenStats(),this.baseStats=this.unitGroup.type.baseStats;let n=this.unitGroup.spells;this.effects=n.filter(o=>o.isEffect()),this.spells=n.filter(o=>!o.isEffect()),this.description=this.unitGroup.type.getDescription?.({unit:this.unitGroup,unitBase:this.unitGroup.type})||{descriptions:[]}}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-unit-group-info"]],inputs:{unitGroup:"unitGroup"},features:[ji],decls:2,vars:3,consts:[["noDescription",""],[4,"ngIf"],["size","big",1,"unit-portrait",3,"unitGroup","isHero"],[1,"main-group"],[1,"info-header"],[1,"title"],[1,"group"],[1,"tier"],[1,"stats"],[1,"col"],[1,"stat"],["icon","sword"],["icon","health"],["icon","spinning-sword"],[1,"description"],[3,"descriptions",4,"ngIf","ngIfElse"],[1,"secondary-group"],[1,"hor-stats"],[3,"mwNumberModifier"],["class","abilities",4,"ngIf"],[3,"descriptions"],[1,"abilities"],[1,"abilities-list"],[3,"hero","spell","hintPos","owner",4,"ngFor","ngForOf"],[3,"hero","spell","hintPos","owner"]],template:function(n,o){n&1&&(g(0,m0,60,23,"ng-container",1),re(1,"async")),n&2&&u("ngIf",oe(1,1,o.unitStats$))},styles:["[_nghost-%COMP%]{display:flex;width:570px}.unit-portrait[_ngcontent-%COMP%]{position:absolute;left:-60px;top:-42px}.info-header[_ngcontent-%COMP%]{display:flex;margin-left:64px;flex-direction:column;height:92px}.stats[_ngcontent-%COMP%]{margin-top:12px;font-size:13px;display:flex}.col[_ngcontent-%COMP%]{margin-left:8px}.tier[_ngcontent-%COMP%]{font-size:13px}.description[_ngcontent-%COMP%]{font-size:12px;max-width:360px}.secondary-group[_ngcontent-%COMP%]{width:202px;flex-grow:1;margin-left:8px}.secondary-group[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{text-align:center}.secondary-group[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%]{width:100%}.secondary-group[_ngcontent-%COMP%]   .abilities-list[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4px}.secondary-group[_ngcontent-%COMP%]   .hor-stats[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.secondary-group[_ngcontent-%COMP%]   .hor-stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]{display:flex;flex-direction:column}.secondary-group[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]{display:flex;justify-content:center;text-align:center}.secondary-group[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]{padding-bottom:2px}"]});let i=e;return i})();var us=(()=>{let e=class e{constructor(){this.toRight=!0}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-unit-group-portrait"]],hostVars:6,hostBindings:function(n,o){n&2&&(an(o.size),de("is-hero",o.isHero)("to-right",o.toRight))},inputs:{unitGroup:"unitGroup",isHero:"isHero",toRight:"toRight",size:"size"},decls:2,vars:2,consts:[[1,"portrait",3,"src"],["src","../assets/common/common-unit-frame.png",1,"portrait-frame"]],template:function(n,o){n&1&&h(0,"img",0)(1,"img",1),n&2&&Or("src","../assets/",o.unitGroup.type.mainPortraitUrl,"",Fr)},styles:["[_nghost-%COMP%]{position:relative;-webkit-user-select:none;user-select:none;display:inline-block}[_nghost-%COMP%]:not(.is-hero).to-right{scale:-1 1}.is-hero[_nghost-%COMP%]{scale:-1 1}.is-hero.to-right[_nghost-%COMP%]{scale:1 1}[_nghost-%COMP%] > .portrait-frame[_ngcontent-%COMP%]{height:130px;width:121px}[_nghost-%COMP%] > .portrait[_ngcontent-%COMP%]{position:absolute;z-index:-1;left:30px;width:64px;height:83px;top:20px}.is-hero[_nghost-%COMP%] > .portrait[_ngcontent-%COMP%]{width:72px;height:72px;left:25px}.is-hero.big[_nghost-%COMP%] > .portrait[_ngcontent-%COMP%]{width:91px;height:91px}.big[_nghost-%COMP%] > .portrait-frame[_ngcontent-%COMP%]{height:170px;width:144px}.big[_nghost-%COMP%] > .portrait[_ngcontent-%COMP%]{width:78px;height:102px;top:26px}"],changeDetection:0});let i=e;return i})();var h0=i=>({disabled:i}),im=(i,e)=>({color:i,background:e});function g0(i,e){if(i&1&&(a(0,"div",7),d(1),c()),i&2){let r=m(2);l(),M(" Mana Cost: ",r.spell().currentManaCost," ")}}function y0(i,e){if(i&1&&(a(0,"div",4),h(1,"mw-ra-icon",5),a(2,"div",6)(3,"div"),d(4),c(),a(5,"div",7),d(6),c(),g(7,g0,2,1,"div",8),c()(),a(8,"div",9),h(9,"mw-spell-description",10),c()),i&2){let r=m();l(),u("icon",r.icon().icon)("ngStyle",$t(9,im,r.icon().iconClr,r.icon().bgClr)),l(3),H(r.baseType().name),l(2),M("Level ",r.spell().currentLevel,""),l(),u("ngIf",!r.isPassive()),l(2),u("spell",r.spell())("player",r.owner().ownerPlayer)("ownerUnit",r.owner())("hero",r.hero())}}var zr=(()=>{let e=class e{constructor(){this.owner=Z.required(),this.spell=Z.required(),this.hero=Z(),this.disabled=Z(!1),this.combinedMana=Te(()=>this.owner().getStateSignal()().groupState.currentMana+(this.hero()?.getStateSignal()().currentMana||0)),this.hasEnoughMana=Te(()=>this.isPassive()?!0:this.combinedMana()>=this.spell().currentManaCost),this.onCooldown=Z(),this.hintPos=Z("above"),this.baseType=Te(()=>this.spell().baseType),this.icon=Te(()=>this.spell().baseType.icon),this.isPassive=Te(()=>this.spell().isPassive())}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-unit-group-spell-icon"]],inputs:{owner:[1,"owner"],spell:[1,"spell"],hero:[1,"hero"],disabled:[1,"disabled"],onCooldown:[1,"onCooldown"],hintPos:[1,"hintPos"]},decls:5,vars:10,consts:[["buffHint",""],[3,"hintBody","hintPos"],[3,"ngClass"],[1,"spell-icon",3,"icon","ngStyle"],[2,"display","flex"],[1,"hint-icon",3,"icon","ngStyle"],[2,"padding","4px","font-size","14px"],[2,"font-size","12px"],["style","font-size: 12px;",4,"ngIf"],[2,"padding","4px","font-size","13px","max-width","240px"],[3,"spell","player","ownerUnit","hero"]],template:function(n,o){if(n&1&&(a(0,"mw-hover-hint",1)(1,"div",2),h(2,"mw-ra-icon",3),c()(),g(3,y0,10,12,"ng-template",null,0,Q)),n&2){let s=ne(4);u("hintBody",s)("hintPos",o.hintPos()),l(),u("ngClass",Ue(5,h0,o.onCooldown()||o.disabled()||!o.hasEnoughMana())),l(),u("icon",o.icon().icon)("ngStyle",$t(7,im,o.icon().iconClr,o.icon().bgClr))}},styles:[".spell-icon[_ngcontent-%COMP%]{font-size:26px;margin:3px;display:block;height:30px;width:28px;text-align:center}.hint-icon[_ngcontent-%COMP%]{width:38px;height:38px;font-size:26px;text-align:center;padding-top:5px}.disabled[_ngcontent-%COMP%]{filter:brightness(.5)}"],changeDetection:0});let i=e;return i})();var Pa=(()=>{let e=class e extends te{constructor(){super(...arguments),this.players=L(k),this.gameObjects=L(xe)}swap(){wa(this.data.sourceSlot,this.data.targetSlot),this.data.postAction(),this.close()}merge(){let t=this.players.getCurrentPlayer().hero,n=this.data.targetSlot.unitGroup,o=this.data.sourceSlot.unitGroup,s=Math.max(n.getMana(),o.getMana());n.addUnitsCount(this.data.sourceSlot.unitGroup.count),this.gameObjects.destroyObject(o),this.data.sourceSlot.unitGroup=null,t.removeUnitGroup(o),n.setMana(s),this.data.postAction(),this.close()}};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=ft(e)))(o||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-unit-slots-action-popup"]],features:[j],decls:14,vars:0,consts:[["popupHeader",""],["popupContent",""],["popupButtons",""],["mw-main-button","",3,"click"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0)(2,"div"),d(3," These groups are of the same type "),c()(),a(4,"div",1)(5,"div"),d(6," What do you want to do? "),c()(),a(7,"div",2)(8,"button",3),S("click",function(){return o.merge()}),d(9," Merge "),c(),a(10,"button",3),S("click",function(){return o.swap()}),d(11," Swap "),c(),a(12,"button",3),S("click",function(){return o.popup.close()}),d(13," Cancel "),c()()())},dependencies:[ae,ue],encapsulation:2});let i=e;return i})();function C0(i,e){if(i&1&&(ve(0),h(1,"div",4)(2,"div",5),Ce()),i&2){let r=m();l(),$("width",r.uiBarWidth(),"%")("height",r.barHeight(),"px"),l(),$("background",r.color())("width",r.uiBarWidth(),"%")("height",r.barHeight(),"px")}}function S0(i,e){if(i&1&&(ve(0),h(1,"div",6),Ce()),i&2){let r=m();l(),$("background",r.color())("height",r.barHeight(),"px")}}function w0(i,e){if(i&1&&(ve(0),d(1),Ce()),i&2){let r=m();l(),M("/",r.maxValue(),"")}}var Da=(()=>{let e=class e{constructor(){this.hostElem=Gr(),this.renderer=Pp(),this.maxValue=Z.required(),this.barStyle=Z("normal"),this.showMax=Z(!1),this.currentValue=Z(0),this.color=Z("red"),this.barHeight=Z(3),this.side=Z("left"),this.uiBarWidth=Te(()=>this.currentValue()/this.maxValue()*100),Wa(()=>{this.renderer.setStyle(this.hostElem,"height",`${this.barHeight()}px`)})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-value-bar"]],inputs:{maxValue:[1,"maxValue"],barStyle:[1,"barStyle"],showMax:[1,"showMax"],currentValue:[1,"currentValue"],color:[1,"color"],barHeight:[1,"barHeight"],side:[1,"side"]},decls:6,vars:7,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"values"],[4,"ngIf"],[1,"diff-bar"],[1,"main-bar"],[1,"main-bar",2,"width","100%"]],template:function(n,o){n&1&&(ve(0,0),g(1,C0,3,10,"ng-container",1)(2,S0,2,4,"ng-container",1),Ce(),a(3,"span",2),d(4),g(5,w0,2,1,"ng-container",3),c()),n&2&&(u("ngSwitch",o.barStyle()),l(),u("ngSwitchCase","normal"),l(),u("ngSwitchCase","static"),l(),de("left",o.side()==="left"),l(),M(" ",o.currentValue(),""),l(),u("ngIf",o.showMax))},dependencies:[se,gi,ln],styles:["[_nghost-%COMP%]{position:relative;display:block;background:#373737;width:100%}.diff-bar[_ngcontent-%COMP%]{transition:1.1s;background:#ffffff9d;position:absolute;transition-timing-function:ease-in-out}.main-bar[_ngcontent-%COMP%]{transition:.4s;position:absolute}.values[_ngcontent-%COMP%]{position:absolute;left:50%;transform:translate(-50%,-2px);text-shadow:1px 2px black;font-size:11px;color:#fff}"],changeDetection:0});let i=e;return i})();var b0=["container"],_0=["iconSfx"],M0=["customizableVfx"],P0=["htmlSfx"],D0=i=>({part:i});function E0(i,e){if(i&1&&h(0,"mw-ra-icon",6),i&2){let r=e.icon;u("icon",r)}}function I0(i,e){if(i&1&&(h(0,"div",7),re(1,"safeHtml")),i&2){let r=e.html;u("innerHTML",oe(1,1,r),jt)}}function T0(i,e){i&1&&be(0)}function F0(i,e){if(i&1&&(ve(0),g(1,T0,1,0,"ng-container",12),Ce()),i&2){let r=m().$implicit;m(2);let t=ne(10);l(),u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,D0,r))}}function A0(i,e){if(i&1&&(a(0,"div",10),g(1,F0,2,4,"ng-container",11),c()),i&2){let r=e.$implicit;$("color",r.color),u("ngSwitch",r.type),l(),u("ngSwitchCase","plainPart")}}function O0(i,e){if(i&1&&(a(0,"div",8),g(1,A0,2,4,"div",9),c()),i&2){let r=e.data;l(),u("ngForOf",r.parts)}}function k0(i,e){if(i&1&&(h(0,"mw-ra-icon",6)(1,"span",13),re(2,"safeHtml")),i&2){let r=e.part;u("icon",r.icon),l(),u("innerHTML",oe(2,2,r.text),jt)}}var Pn=(()=>{let e=class e{constructor(t,n){this.renderer=t,this.hostElem=n,this.createdViews={},this.animationEnded=new bt,this.created=new bt}ngOnInit(){this.created.emit(this)}playAnimation(t,n={duration:1e3},o={}){t.config.layout==="default"&&this.renderer.addClass(this.hostElem.nativeElement,"default-layout");let s=[];return t.elements.forEach(p=>{let f=null;switch(p.type){case Zi.Icon:f=this.viewContainerRef.createEmbeddedView(this.iconSfx,{icon:p.icon});break;case Zi.Customizable:f=this.viewContainerRef.createEmbeddedView(this.customizableVfx,{data:o.custom});break;case Zi.Html:f=this.viewContainerRef.createEmbeddedView(this.htmlSfx,{html:o.custom?.html})}this.createdViews[p.id]=f;let C=f.rootNodes[0];Object.entries(t.elemsDefaultStyles[p.id]).forEach(([U,pe])=>{this.renderer.setStyle(C,U,pe)}),n.skipDlClass||this.renderer.addClass(C,"dl-sfx");let w=t.elemsKeyframes[p.id],T=C.animate(w,{duration:n.duration??1e3,fill:n.type??"forwards",iterations:n.iterations??1});s.push(T)}),{elem:this,animationsList:s}}clearAnimation(){this.viewContainerRef.clear()}};e.\u0275fac=function(n){return new(n||e)(y(je),y(ht))},e.\u0275cmp=v({type:e,selectors:[["mw-vfx-element"]],viewQuery:function(n,o){if(n&1&&(De(b0,7,Mi),De(_0,7),De(M0,7),De(P0,7)),n&2){let s;Ee(s=Ie())&&(o.viewContainerRef=s.first),Ee(s=Ie())&&(o.iconSfx=s.first),Ee(s=Ie())&&(o.customizableVfx=s.first),Ee(s=Ie())&&(o.htmlSfx=s.first)}},outputs:{animationEnded:"animationEnded",created:"created"},decls:11,vars:0,consts:[["container",""],["iconSfx",""],["htmlSfx",""],["customizableVfx",""],["plainDamagePart",""],[1,"effect"],[3,"icon"],[2,"text-shadow","1px 1px 2px #202020","color","white",3,"innerHTML"],[2,"text-shadow","1px 1px #4e4e4e","z-index","10000"],[3,"ngSwitch","color",4,"ngFor","ngForOf"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"innerHTML"]],template:function(n,o){n&1&&(a(0,"div",5),be(1,null,0),c(),g(3,E0,1,1,"ng-template",null,1,Q)(5,I0,2,3,"ng-template",null,2,Q)(7,O0,2,1,"ng-template",null,3,Q)(9,k0,3,4,"ng-template",null,4,Q))},dependencies:[q,yt,gi,ln,le,Ht],styles:[".default-layout[_ngcontent-%COMP%] > .effect[_ngcontent-%COMP%]{pointer-events:none}.dl-sfx[_ngcontent-%COMP%]{position:absolute;transform:translate(-50%,-50%)}"]});let i=e;return i})();var ll={darkOverlay:!0,duration:1e3},ci=(()=>{let e=class e{constructor(){this.latestVfxId=0,this.containersSet=new Map}registerLayerComponent(t){this.layerComponent=t}registerVfxContainer(t,n){this.containersSet.set(t,n)}unregisterVfxContainer(t){this.containersSet.delete(t)}getNewId(){return this.latestVfxId++}createXyVfx(t,n,o,s={}){this.layerComponent.createXyVfx(t,n,o,P(P({},ll),s))}createVfxForUnitGroup(t,n,o={}){this.layerComponent.createVfxForUnitGroup(t,n,P(P({},ll),o))}createEffectAnimationForUnitGroup(t,n,o={}){this.layerComponent.createVfxForUnitGroup(t,{type:Xi.VfxElement,animation:n},P(P({},ll),o))}createEffectAnimationForContainer(t,n,o={}){this.containersSet.get(t)?.addAnimation(n)}createFloatingMessageForUnitGroup(t,n,o={}){this.layerComponent.createFloatingMessageForUnitGroup(t,{custom:n},o)}createDroppingMessageForContainer(t,n,o={}){this.containersSet.get(t)?.addAnimation(du,P({skipDlClass:!0},o),{custom:n})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var R0=["effectsContainer"],U0=["vfxElement"];function B0(i,e){i&1&&h(0,"mw-vfx-element")}var ds=(()=>{let e=class e{constructor(t,n,o,s){this.vfxService=t,this.renderer=n,this.unitsCardsMapping=o,this.cdr=s,this.activeEffects=new Map,this.EffectTypes=Xi,this.effectsWithOverlay=0}ngOnInit(){this.vfxService.registerLayerComponent(this)}createXyVfx(t,n,o,s){let p=this.createNewEffect({bottom:0,left:t,right:0,top:n},o);this.instantiateEffect(o,s,p)}createVfxForUnitGroup(t,n,o){let p=this.unitsCardsMapping.get(t).hostElem.nativeElement,{left:f,top:C}=p.getBoundingClientRect(),w=this.createNewEffect({bottom:0,left:f+p.clientWidth/2,right:0,top:C+p.clientHeight/2},n);this.instantiateEffect(n,o,w)}createFloatingMessageForUnitGroup(t,n,o={}){let p=this.unitsCardsMapping.get(t).hostElem.nativeElement,{left:f,top:C}=p.getBoundingClientRect(),w={type:Xi.VfxElement,animation:uu},T=this.createNewEffect({bottom:0,left:f+p.clientWidth/2,right:0,top:C+p.clientHeight/2},w);this.instantiateEffect(w,P({darkOverlay:!1,duration:1e3},o),T,n)}createNewEffect(t,n){return{id:this.vfxService.getNewId(),offset:t,vfx:n}}instantiateEffect(t,n,o,s={}){switch(n.darkOverlay&&this.effectsWithOverlay++,this.activeEffects.set(o.id,o),t.type){case Xi.VfxElement:let p=t,f=this.effectsContainerRef.createComponent(Pn),C=f.instance,w=C.playAnimation(p.animation,{duration:n.duration},s);Mr(w.animationsList.map(T=>It(T,"finish"))).pipe(Pr(1)).subscribe(()=>{this.activeEffects.delete(o.id),n.darkOverlay&&this.effectsWithOverlay--,f.destroy()}),this.updateEffectElementPosition(C.hostElem.nativeElement,o)}}updateEffectElementPosition(t,n){this.renderer.setStyle(t,"position","fixed"),this.renderer.setStyle(t,"left",`${n.offset.left}px`),this.renderer.setStyle(t,"top",`${n.offset.top}px`)}};e.\u0275fac=function(n){return new(n||e)(y(ci),y(je),y(Lr),y(mi))},e.\u0275cmp=v({type:e,selectors:[["mw-vfx-layer"]],viewQuery:function(n,o){if(n&1&&(De(R0,7,Mi),De(U0,7)),n&2){let s;Ee(s=Ie())&&(o.effectsContainerRef=s.first),Ee(s=Ie())&&(o.vfxElementRef=s.first)}},decls:5,vars:2,consts:[["effectsContainer",""],["vfxElement",""],[1,"basic-overlay"]],template:function(n,o){n&1&&(h(0,"div",2),be(1,null,0),g(3,B0,1,0,"ng-template",null,1,Q)),n&2&&de("visible",o.effectsWithOverlay)},styles:["[_nghost-%COMP%]{position:fixed;pointer-events:none;inset:0}.vfx[_ngcontent-%COMP%]{position:fixed;pointer-events:none}.basic-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;opacity:0;background:#0000006b;transition:.3s;pointer-events:none}.basic-overlay.visible[_ngcontent-%COMP%]{opacity:1}"]});let i=e;return i})();var L0=["*"];function N0(i,e){if(i&1){let r=R();a(0,"mw-vfx-element",2),S("created",function(n){let o=E(r).$implicit,s=m();return I(s.playAnimation(n,o))}),c()}}var ms=(()=>{let e=class e{constructor(){this.vfxService=L(ci),this.animations=[]}ngOnInit(){this.vfxService.registerVfxContainer(this.containerId,this)}ngOnDestroy(){this.vfxService.unregisterVfxContainer(this.containerId)}playAnimation(t,n){let o=t.playAnimation(n.anim,n.options,n.data);Mr(o.animationsList.map(s=>It(s,"finish"))).pipe(Pr(1)).subscribe(()=>{V.removeItem(this.animations,n)})}addAnimation(t,n,o){this.animations.push({anim:t,options:n,data:o})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-vfx-container"]],inputs:{containerId:"containerId"},ngContentSelectors:L0,decls:3,vars:1,consts:[[2,"position","absolute","z-index","200","left","50%","top","20%"],[3,"created",4,"ngFor","ngForOf"],[3,"created"]],template:function(n,o){n&1&&(ii(),a(0,"div",0),g(1,N0,1,0,"mw-vfx-element",1),c(),Ft(2)),n&2&&(l(),u("ngForOf",o.animations))},styles:["[_nghost-%COMP%]{display:block;position:relative}"]});let i=e;return i})();var Ea=(()=>{let e=class e{constructor(){this.unitType=Z.required(),this.count=Z.required()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-unit-group-preview"]],inputs:{unitType:[1,"unitType"],count:[1,"count"]},decls:4,vars:4,consts:[[2,"display","flex","flex-direction","column"],[3,"src"]],template:function(n,o){n&1&&(a(0,"div",0),h(1,"img",1),a(2,"div"),d(3),c()()),n&2&&(l(),Or("src","../assets/",o.unitType().mainPortraitUrl,"",Fr),l(2),me(" ",o.unitType().name," (",o.count(),") "))},encapsulation:2,changeDetection:0});let i=e;return i})();var En=(()=>{let e=class e extends ce(){constructor(t,n,o,s,p,f,C,w){super(),this.battleState=t,this.actionHint=n,this.players=o,this.unitState=s,this.units=p,this.history=f,this.state=C,this.vfx=w}onBattleBegins(){this.initPlayersSpells()}dealDamageTo(t,n,o=ge.PhysicalAttack,s,p={}){let f=n,C=0,w=0,T=0,U=!1;switch(o){case ge.PhysicalAttack:if(p.attackerUnit){console.log("attacker?",p.attackerUnit);let Ge={attacked:t,attacker:p.attackerUnit},ei=p.attackerUnit.modGroup,xi=ei.getAllModValues("__attackConditionalModifiers").map(Hi=>Hi(Ge)),Gm=ei.getAllModValues("__unitConditionalMods").map(Hi=>Hi(p.attackerUnit)),Rm=t.modGroup.getAllModValues("__attackConditionalModifiers").map(Hi=>Hi(Ge)),no=_t.withRefs([...xi.map(gt.fromMods),...Gm.filter(Ip).map(gt.fromMods),...ei.getAllRefs()]),Ul=no.getModValue("criticalDamageChance");Ul&&V.chanceRoll(Ul)&&(U=!0,f=f+f*(no.getModValue("criticalDamageMul")||0));let Ha=_t.withRefs(Rm.map(gt.fromMods)),La=Ha.getModValue("chanceToBlock"),Um=Ha.getModValue("damageBlockMin"),Bm=Ha.getModValue("damageBlockMax");if(La){let Hi=V.chanceRoll(La);if(console.log("blocking -> chance to block",La,Hi),Hi){let Nl=V.randIntInRange(Um,Bm),Hm=V.maxPercent(ei.getModValue("blockPiercingPercent")||0);C=Math.round(Nl-Nl*Hm)}}let Bl=no.getModValue("baseDamagePercentModifier")||0,Hl=no.getModValue("lifesteal")||0;console.log(`damage reduced by ${Bl}%`),f=V.nonNegative(Math.round(f+f*Bl)-C);let Ll=no.getModValue("retaliationDamagePercent");p.isCounterattack&&Ll&&(f*=Ll),Hl&&(w=Math.round(f*(Hl/100)),console.log("Lifesteal: ",w))}break;default:if(Xc[o]){let ei=t.modGroup.getModValue("amplifiedTakenMagicDamagePercent")||0;f+=n*ei,f=Math.round(f);let xi=t.getState().groupStats[Xc[o]];xi>Jc&&(xi=Jc),console.log(n,o,"resist:",xi),f=f-f*(xi/100)}}let pe=t.count;if(f=Math.round(f),w&&p.attackerUnit){let Ge=this.units.healUnit(p.attackerUnit,w);T=Ge.revivedUnitsCount,this.events.dispatch(Un({healedUnitsCount:Ge.revivedUnitsCount,target:p.attackerUnit}))}let ie=this.unitState.dealPureDamageToUnitGroup(t,f);return ie.finalUnitLoss&&this.events.dispatch(Co({unit:t,loss:ie.finalUnitLoss})),s&&s({unitLoss:ie.finalUnitLoss,finalDamage:ie.finalDamage,initialUnitCount:pe}),o===ge.PhysicalAttack?N(P({},ie),{blockedDamage:C,stolenLife:w,stolenLifeUnitsRestored:T,isCritical:U}):(ie.isDamageFatal&&(this.battleState.handleDefeatedUnitGroup(t),this.events.dispatch(mn({target:t,targetPlayer:t.ownerPlayer,loss:ie.finalUnitLoss}))),ie.finalUnitLoss&&this.events.dispatch(uc({unitLoss:ie.finalUnitLoss,group:t})),N(P({},ie),{blockedDamage:C,stolenLife:w,stolenLifeUnitsRestored:T,isCritical:U}))}handleAttackInteraction(t){let{attackingGroup:n,attackedGroup:o,action:s}=t,p=s===ri.GroupCounterattacks,f=p?o:n,C=p?n:o;this.triggerEventForAllSpellsHandler(Cn.UnitGroupAttacks({attacked:C,attacker:f}));let w=this.unitState.getDetailedAttackInfo(f,C),T=this.unitState.getFinalDamageInfoFromDamageDetailedInfo(w),U=this.dealDamageTo(C,T.finalDamage,ge.PhysicalAttack,void 0,{attackerUnit:f,isCounterattack:p});if(p&&(this.vfx.createDroppingMessageForContainer(C.id,{html:wi(`
          <div style="font-size: 14px">Retaliated! ${qo({icon:"skull"})} ${U.finalUnitLoss}</div>
        `,{width:130})},{duration:1500}),this.history.logHtmlMessage(yu({attacked:C,attacker:f,damage:U.finalDamage,originalNumber:w.originalAttackersCount,unitLoss:U.finalUnitLoss}))),p?this.events.dispatch(dc({attackingGroup:f,attackedGroup:C,loss:U.finalUnitLoss,damage:U.finalDamage})):(this.battleState.currentGroupTurnsLeft--,f.turnsLeft=this.battleState.currentGroupTurnsLeft,this.events.dispatch(Rn({attackingGroup:f,attackedGroup:C,attackedCount:w.originalAttackedCount,attackersCount:w.originalAttackersCount,loss:U.finalUnitLoss,damage:U.finalDamage,damageBlocked:U.blockedDamage,lifeStolen:U.stolenLife,lifeStolenUnitsRestored:U.stolenLifeUnitsRestored,isCritical:U.isCritical}))),U.isDamageFatal){this.battleState.handleDefeatedUnitGroup(C),this.events.dispatch(mn({target:C,targetPlayer:C.ownerPlayer,loss:U.finalUnitLoss})),t.action=ri.AttackInteractionCompleted,this.events.dispatch(un(t));return}if(!p){w.enemyCanCounterattack?t.action=ri.GroupCounterattacks:t.action=ri.AttackInteractionCompleted,this.events.dispatch(un(t));return}p&&(t.action=ri.AttackInteractionCompleted),this.events.dispatch(un(t))}setDamageHintMessageOnCardHover(t){let n=this.getTargetAttackActionInfo(t.hoveredCard);this.actionHint.hintMessage$.next(n)}getTargetAttackActionInfo(t){let n=this.battleState.currentUnitGroup,o=this.unitState.getDetailedAttackInfo(n,t);return{type:$i.OnHoverEnemyCard,attackedGroup:o.attacked,minDamage:o.multipliedMinDamage,maxDamage:o.multipliedMaxDamage,noDamageSpread:o.multipliedMinDamage===o.multipliedMaxDamage,minCountLoss:o.minUnitCountLoss,maxCountLoss:o.maxUnitCountLoss,noLossSpread:o.minUnitCountLoss===o.maxUnitCountLoss,attackSuperiority:o.attackSuperiority}}forEachUnitGroup(t){this.battleState.heroesUnitGroupsMap.forEach((n,o)=>{n.forEach(s=>{t(s,o)})})}applyDispellToUnitGroup(t){let n=[A.Buff,A.Debuff];t.spells.forEach(o=>{n.includes(o.baseType.activationType)&&this.removeSpellFromUnitGroup(t,o)}),this.units.clearUnitModifiers(t)}triggerEventForAllSpellsHandler(t){this.state.eventHandlers.spells.triggerAllHandlersByEvent(t)}triggerEventForSpellHandler(t,n){this.state.eventHandlers.spells.triggerRefEventHandlers(t,n)}initAllUnitGroupSpells(){this.forEachUnitGroup((t,n)=>{t.spells&&t.spells.forEach(o=>this.initSpell(o,n,t))})}resetAllUnitGroupsCooldowns(){this.forEachUnitGroup(t=>t.fightInfo.spellsOnCooldown=!1)}getRandomEnemyUnitGroup(){let t=this.players.getEnemyPlayer(),n=this.battleState.heroesUnitGroupsMap.get(t);return V.randItem(n.filter(o=>o.fightInfo.isAlive))}addSpellToUnitGroup(t,n,o){t.addSpell(n),this.events.dispatch(dn({unitGroup:t})),this.initSpell(n,o),this.triggerEventForSpellHandler(n,Cn.SpellPlacedOnUnitGroup({target:t}))}removeSpellFromUnitGroup(t,n){t.removeSpell(n),this.state.eventHandlers.spells.removeAllHandlersForRef(n),this.events.dispatch(dn({unitGroup:t}))}initSpell(t,n,o){this.events.dispatch(Uo({spell:t,player:n,ownerUnit:o}))}initPlayersSpells(){[this.players.getCurrentPlayer(),this.players.getEnemyPlayer()].forEach(t=>{t.hero.spells.forEach(n=>{this.initSpell(n,t)})})}};e.\u0275fac=function(n){return new(n||e)(x(wt),x(_n),x(k),x(Ia),x(ke),x(Ai),x(J),x(ci))},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Lt=function(i){return i.Player="Player",i.AI="AI",i}(Lt||{}),Me=function(i){return i.Normal="normal",i.SpellTargeting="spell-targeting",i.WaitsForTurn="waits-for-turn",i}(Me||{}),Wr=(()=>{let e=class e extends Ot{constructor(){super(...arguments),this.garrisons=new Map,this.actionCards=[]}create({color:t,hero:n,resources:o,type:s}){this.color=t,this.resources=o,this.type=s,this.hero=n,this.hero.assignOwnerPlayer(this),this.hero.updateUnitsSpecialtyAndConditionalMods()}addActionCards(t,n){let o=this.actionCards.find(s=>s.card===t);o?o.count+=n:this.actionCards.push({card:t,count:n})}};e.categoryId="player";let i=e;return i})();var V0=B({id:"#spell-null",activationType:A.Instant,name:"",icon:{icon:""},getDescription(i){return{descriptions:[]}},config:{spellConfig:{getManaCost(i){return 0},init:()=>{}}}}),pr=class pr extends ce(){constructor(e,r){super(),this.players=e,this.gameObjectsManager=r,this.NULL_SPELL_INSTANCE=this.gameObjectsManager.createNewGameObject(Rs,{initialLevel:0,spellBaseType:V0,state:{}},"null-spell"),this.currentSpell=this.NULL_SPELL_INSTANCE,this.playerCurrentState=Me.Normal,this.playerStateChanged$=new Et(Me.Normal),this.spellsAreOnCooldown=!1}playersInit(){this.currentPlayer=this.players.getCurrentPlayer()}resetSpellsCooldowns(){this.spellsAreOnCooldown=!1}setSpellsOnCooldown(){this.currentCasterUnit?(this.currentCasterUnit.fightInfo.spellsOnCooldown=!0,this.currentCasterUnit=void 0):this.spellsAreOnCooldown=!0}onSpellClick(e,r){switch(this.currentSpell=e,this.currentCasterUnit=r,e.baseType.activationType){case"instant":this.onCurrentSpellCast(),this.events.dispatch(uo({player:this.currentPlayer,spell:e})),this.setSpellsOnCooldown();break;case"target":this.setPlayerState(Me.SpellTargeting);break;case"passive":break;default:break}}isSpellBeingCasted(){return this.currentSpell!==this.NULL_SPELL_INSTANCE}resetCurrentSpell(){this.currentSpell=this.NULL_SPELL_INSTANCE}cancelCurrentSpell(){this.resetCurrentSpell(),this.setPlayerState(Me.Normal),this.currentCasterUnit=void 0}onCurrentSpellCast(){let e=this.currentSpell.currentManaCost;if(this.currentCasterUnit){let r=this.currentCasterUnit.getMana(),t=V.limitedNumber(e,r),n=e-t;t&&this.currentCasterUnit.addMana(-t),n&&this.currentPlayer.hero.addMana(-n);return}this.currentPlayer.hero.addMana(-e)}setPlayerState(e){this.playerCurrentState=e,this.playerStateChanged$.next(e)}};pr.\u0275fac=function(r){return new(r||pr)(x(k),x(xe))},pr.\u0275prov=O({token:pr,factory:pr.\u0275fac,providedIn:"root"});var We=pr;_([ee(qi)],We.prototype,"playersInit",null);var z0=yd({id:"#hero-non-player-neutral",name:"neutral-hero",generalDescription:F(""),abilities:[],army:[],items:[],resources:gd,stats:{mana:0,baseAttack:0,baseDefence:0}}),qr=(()=>{let e=class e{constructor(t,n){this.gameObjectsManager=t,this.unitGroups=n}addManaToHero(t,n){t.addMana(n)}addSpellToHero(t,n){t.spells.push(n)}createHero(t){return this.gameObjectsManager.createNewGameObject(em,{heroBase:t,unitGroups:t.initialState.army.length?[...this.unitGroups.createUnitGroupFromGenModel(t.initialState.army[0]),...Di.enableHeroUnits?[this.unitGroups.createUnitGroup(`#unit-!hero-${t.id}`,{count:1})]:[]]:[]})}createNeutralHero(){return this.createHero(z0)}};e.\u0275fac=function(n){return new(n||e)(x(xe),x(ke))},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Ri=(()=>{let e=class e{constructor(t,n,o){this.events=t,this.state=n,this.gameObjectsManager=o}createItem(t){let n=t.icon;return n.bgClr||(n.bgClr=At.DefaultItemIconBg),n.iconClr||(n.iconClr=At.DefaultItemIconClr),this.gameObjectsManager.createNewGameObject(Ap,{itemBase:t,state:t.defaultState})}registerItemsEventHandlers(t,n){this.events.dispatch(Bo({item:t,ownerPlayer:n}))}triggerEventForAllItemsHandlers(t){this.state.eventHandlers.items.triggerAllHandlersByEvent(t)}triggerEventForItemHandlers(t,n){this.state.eventHandlers.items.triggerRefEventHandlers(t,n)}};e.\u0275fac=function(n){return new(n||e)(x(z),x(J),x(xe))},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Ui=function(i){return i.Main="main",i.Neutral="neutral",i}(Ui||{});var k=(()=>{let e=class e extends ce(){get playersMap(){return this.state.gameState.playersMap}constructor(t,n,o,s){super(),this.heroesService=t,this.unitGroups=n,this.state=o,this.gameObjectsManager=s,this.currentPlayerId=this.gameObjectsManager.getObjectId(Wr,Ui.Main)}createPlayer(t,n){return this.gameObjectsManager.createNewGameObject(Wr,n,t)}getCurrentPlayer(){return this.playersMap.get(this.currentPlayerId)}addResourceToPlayer(t,n,o){t.resources[n]+=o}addResourcesToPlayer(t,n){Object.entries(n).forEach(([o,s])=>t.resources[o]+=s)}removeResourcesFromPlayer(t,n){Object.entries(n).forEach(([o,s])=>t.resources[o]-=s)}playerHasResources(t,n){let o=t.resources;return Object.entries(n).every(([s,p])=>o[s]>=p)}getMissingResources(t,n){let o=t.resources;return Object.entries(n).reduce((s,[p,f])=>{let C=o[p]-f;return C<0&&(s[p]=Math.abs(C)),s},{})}getCurrentPlayerId(){return this.currentPlayerId}isEnemyUnitGroup(t){return this.getUnitGroupsOfPlayer(this.getEnemyPlayer().id).includes(t)}getPlayerUnitsCountOfType(t,n){return t.hero.unitGroups.reduce((o,s)=>o+(s.type.id===n?s.count:0),0)}addExperienceToPlayer(t,n){let s=this.getPlayerById(t).hero;s.experience+=n;let p=ar[s.level+1];p<=s.experience&&(s.level++,s.freeSkillpoints++,s.experience=s.experience-p,this.events.dispatch(Oo({newLevel:s.level,hero:s})))}getPlayerById(t){return this.playersMap.get(this.gameObjectsManager.getObjectId(Wr,t))}getNeutralPlayer(){return this.playersMap.get(this.gameObjectsManager.getObjectId(Wr,Ui.Neutral))}getEnemyPlayer(){return this.getNeutralPlayer()}getUnitGroupsOfPlayer(t){return this.playersMap.get(this.gameObjectsManager.getObjectId(Wr,t)).hero.unitGroups}addUnitGroupToTypeStack(t,n){let o=t.hero.unitGroups.find(s=>s.type===n.type);o?o.addUnitsCount(n.count):t.hero.addUnitGroup(n)}removeNUnitsFromGroup(t,n,o){if(n.addUnitsCount(-o),n.count<=0){t.hero.removeUnitGroup(n),this.gameObjectsManager.destroyObject(n);let s=n.ownerHero.getAllSlots().find(p=>p.unitGroup===n);s&&(s.unitGroup=null)}}removeUnitTypeCountFromPlayer(t,n,o){let s=t.hero.getAllUnitsFromSlots().filter(T=>T.type.id===n),p=s.reduce((T,U)=>U.count+T,0),f=p<o?p:o,C=f,w=0;for(;C>0;){let T=s[w++],U=T.count,pe=C>U?U:C;this.removeNUnitsFromGroup(t,T,pe),C-=pe}return f}addManaToPlayer(t,n){t.hero.addMana(n)}addItemToPlayer(t,n){this.events.dispatch(Ci({player:t,item:n}))}removeItemFromPlayer(t,n){this.events.dispatch(fn({player:t,item:n}))}createPlayerWithHero(t,n,o){return{color:t,hero:this.heroesService.createHero(n),resources:n.initialState.resources,type:o}}};e.\u0275fac=function(n){return new(n||e)(x(qr),x(ke),x(J),x(xe))},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var rm=(()=>{let e=class e{constructor(t){this.playersService=t}getPlayerInfo(){return this.playersService.getEnemyPlayer()}getUnitGroups(){return this.playersService.getUnitGroupsOfPlayer(Ui.Neutral)}};e.\u0275fac=function(n){return new(n||e)(x(k))},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var om=(()=>{let e=class e{constructor(t){this.playersService=t}getPlayerInfo(){return this.playersService.getCurrentPlayer()}getUnitGroups(){return this.playersService.getUnitGroupsOfPlayer(Ui.Main)}};e.\u0275fac=function(n){return new(n||e)(x(k))},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var li=(()=>{let e=class e{constructor(t,n,o,s){this.playersService=t,this.unitGroups=n,this.gameObjectsManager=o,this.events=s,this.initialStructs=[],this.availableStructuresMap={}}initStructures(t){this.neutralPlayer=this.playersService.getNeutralPlayer(),this.initialStructs=t.map.structures,this.startingLocationId=t.map.startingLocId,this.playerCurrentLocId=this.gameObjectsManager.getObjectId(tr,this.startingLocationId),this.viewStructures=this.createViewStructures(this.initialStructs),this.updateParentLinks(),this.updateAvailableStructures()}updateParentLinks(){this.viewStructures.forEach(t=>{this.viewStructures.filter(o=>t.pathTo===o.id).forEach(o=>t.parentStructs.add(o.id))})}updateAvailableStructures(){Object.keys(this.availableStructuresMap).forEach(t=>{this.viewStructures.filter(o=>[...o.parentStructs].find(s=>this.gameObjectsManager.getObjectByFullId(this.gameObjectsManager.getObjectId(tr,s))?.visited)&&o.parentStructs.has(t)).forEach(o=>this.availableStructuresMap[o.id]=!0)})}createViewStructures(t){let n=t.map(o=>this.gameObjectsManager.createNewGameObject(tr,{iconName:o.icon,x:o.x,y:o.y,generator:o.struct,guardingPlayer:void 0,isRoot:o.id===this.startingLocationId,pathTo:o.pathTo?this.gameObjectsManager.getObjectId(tr,o.pathTo):void 0,actionPoints:o.actionPoints,structParams:o.structParams},o.id));return n.map(o=>{this.events.dispatch(Lo({structure:o}));let s=o.pathTo;if(o.isRoot&&(o.isRoot=!0,o.visited=!0,this.availableStructuresMap[o.id]=!0),s){let p=n.find(xi=>xi.id===o.pathTo);o.pathTo=s;let{x:f,y:C}=o,w=Math.min(f,p.x),T=Math.min(C,p.y),U=Math.max(f,p.x),ie=Math.max(C,p.y)-T,Ge=U-w;o.svg={x:w,y:T,height:ie,width:Ge,ox:p.x>f?Ge:0,oy:p.y>C?ie:0,tx:f<p.x?0:Ge,ty:C<p.y?0:ie};let ei=o.generator;ei?.generateGuard&&(o.guard=this.unitGroups.createUnitGroupFromGenModel(ei.generateGuard({thisStruct:o})),o.guard.forEach(xi=>xi.assignOwnerPlayer(this.playersService.getNeutralPlayer())),o.guardingPlayer=this.playersService.getNeutralPlayer()),ei?.generateReward&&(o.reward=ei.generateReward())}return o})}};e.\u0275fac=function(n){return new(n||e)(x(k),x(ke),x(xe),x(z))},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Ia=(()=>{let e=class e{constructor(t){this.units=t}getTailUnitHealth(t){let{tailUnitHp:n}=t;return n===0?0:n===void 0?t.type.baseStats.health:n}getUnitGroupTotalHp(t){return(t.count-1)*t.type.baseStats.health+this.getTailUnitHealth(t)}getUnitGroupDamage(t,n=0){let s=t.type.baseStats.damageInfo,p=t.count,f=s.minDamage*t.count,C=s.maxDamage*t.count,w=n*(n>=0?.05:.035),T=f+f*w,U=C+C*w;return{attacker:t,attackingUnitsCount:p,minDamage:f,maxDamage:C,attackSuperiority:n,damageMultiplier:w,multipliedMinDamage:Math.round(T),multipliedMaxDamage:Math.round(U)}}getDetailedAttackInfo(t,n){let s=n.type.baseStats,p=t.getState(),f=n.getState(),C=p.groupStats.finalAttack,w=f.groupStats.finalDefence,T=C-w,U=this.getUnitGroupDamage(t,T),pe=this.calcUnitCountLoss(U.multipliedMinDamage,s.health,n.count),ie=this.calcUnitCountLoss(U.multipliedMaxDamage,s.health,n.count),Ge=this.canGroupCounterattack(n);return N(P({},U),{attacked:n,originalAttackedCount:n.count,originalAttackersCount:t.count,enemyCanCounterattack:Ge,minUnitCountLoss:pe,maxUnitCountLoss:ie})}getFinalDamageInfoFromDamageDetailedInfo(t){let n=V.randIntInRange(t.multipliedMinDamage,t.multipliedMaxDamage);return this.getFinalDamageInfo(t.attacked,n)}getFinalDamageInfo(t,n){let o=t,s=o.type.baseStats,p=t.count,f=this.getUnitGroupTotalHp(o),C=f-n,w=n>=f,T=C%s.health,U=w?0:T===0?s.health:T,pe=Math.ceil(C/s.health),ie=p-pe;return{finalDamage:n,finalUnitLoss:ie>t.count?t.count:ie,finalTotalUnitLoss:ie,tailHpLeft:U,isDamageFatal:n>=f}}dealPureDamageToUnitGroup(t,n){let o=this.getFinalDamageInfo(t,n);return t.addUnitsCount(-o.finalTotalUnitLoss),t.setTailUnitHp(o.tailHpLeft),o}calcUnitCountLoss(t,n,o){let s=Math.floor(t/n);return s>o?o:s}canGroupCounterattack(t){return!!t.type.defaultModifiers?.counterattacks}isUnitGroupRanged(t){return!!t.type.defaultModifiers?.isRanged}rollDamage(t){return V.randIntInRange(t.multipliedMinDamage,t.multipliedMaxDamage)}};e.\u0275fac=function(n){return new(n||e)(x(ke))},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var pi=(()=>{let e=class e{constructor(t,n,o,s,p,f,C,w){this.playersService=t,this.heroes=n,this.unitGroups=o,this.players=s,this.spells=p,this.events=f,this.state=C,this.structures=w}getPlayerApi(){return{removeUnitTypeFromPlayer:(t,n,o)=>this.players.removeUnitTypeCountFromPlayer(t,n,o),playerHasResources:(t,n)=>this.players.playerHasResources(t,n),removeResourcesFromPlayer:(t,n)=>this.players.removeResourcesFromPlayer(t,n),addExperienceToPlayer:(t,n)=>{this.players.addExperienceToPlayer(t.id,n)},addUnitGroupToPlayer:(t,n,o)=>{let s=this.unitGroups.createUnitGroup(n,{count:o},t.hero);this.players.addUnitGroupToTypeStack(t,s)},addManaToPlayer:(t,n)=>{this.heroes.addManaToHero(t.hero,n)},addMaxManaToPlayer:(t,n)=>{t.hero.addStatsMods({heroMaxMana:n})},giveResourceToPlayer:(t,n,o)=>this.playersService.addResourceToPlayer(t,n,o),addSpellToPlayerHero:(t,n)=>{this.heroes.addSpellToHero(t.hero,n)},getCurrentPlayer:()=>this.playersService.getCurrentPlayer(),getCurrentPlayerUnitGroups:()=>this.playersService.getUnitGroupsOfPlayer(this.playersService.getCurrentPlayer().id),giveResourcesToPlayer:(t,n)=>this.playersService.addResourcesToPlayer(t,n)}}getSpellsApi(){return{createSpellInstance:(t,n)=>this.spells.createSpellInstance(t,n)}}getGameApi(){return{events:{dispatch:t=>{this.events.dispatch(t)}},players:this.getPlayerApi(),actions:{getMapStructures:()=>this.structures.viewStructures,getActionPointsLeft:()=>this.state.currentGame.actionPoints,scheduleAction:(t,n)=>{this.events.dispatch(Vn({action:t,dayOffset:n}))}}}}getGlobalEventsApi(){return{dispatch:t=>this.events.dispatch(t)}}};e.\u0275fac=function(n){return new(n||e)(x(k),x(qr),x(ke),x(k),x(bn),x(z),x(J),x(li))},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var sm=(()=>{let e=class e extends ce(){constructor(t){super(),this.apiProvider=t,this.initTriggersFromTriggersRegistry()}initTriggersFromTriggersRegistry(){nr.registryMap.forEach((t,n)=>{t.forEach(o=>{this.events.onEvent(n).subscribe(s=>{o.fn(s,this.apiProvider.getGameApi())})})})}};e.\u0275fac=function(n){return new(n||e)(x(pi))},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var dr=class dr extends ce(){constructor(e){super(),this.battleLog=e}clearLogOnFightStart(){this.battleLog.history=[]}logGroupDamagedByGroup({attackingGroup:e,attackedGroup:r,damage:t,loss:n,attackedCount:o,attackersCount:s,damageBlocked:p,lifeStolen:f,lifeStolenUnitsRestored:C,isCritical:w}){this.battleLog.logDealtDamageMessage({attacked:r.type,attackedPlayer:r.ownerPlayer,attackersNumber:s,attackedNumber:o,attacker:e.type,attackingPlayer:e.ownerPlayer,damage:t,damageBlocked:p,losses:n,stolenLife:f,stolenLifeUnitsRestored:C,isCritical:w})}logPlayerStartsTurn(e){this.battleLog.logRoundInfoMessage(`Player ${e.currentPlayer.type} starts his turn`)}logFightEnds(e){this.battleLog.logRoundInfoMessage(e.win?"Win!":"Defeat")}logNextRoundStarts(e){this.battleLog.logRoundInfoMessage(`Round ${e.round} starts`)}};dr.\u0275fac=function(r){return new(r||dr)(x(Ai))},dr.\u0275prov=O({token:dr,factory:dr.\u0275fac});var rn=dr;_([ee(zt)],rn.prototype,"clearLogOnFightStart",null);_([G(Rn)],rn.prototype,"logGroupDamagedByGroup",null);_([G(Wi)],rn.prototype,"logPlayerStartsTurn",null);_([G(vi)],rn.prototype,"logFightEnds",null);_([G(Vt)],rn.prototype,"logNextRoundStarts",null);var mr=class mr extends ce(){constructor(e,r,t,n,o,s,p,f){super(),this.battleState=e,this.curPlayerState=r,this.strucuresService=t,this.playersService=n,this.vfx=o,this.state=s,this.historyLog=p,this.gameObjectsManager=f}beforeBattleInit(){this.applyStaticModsFromEquippedItems()}prepareFightState(){this.battleState.resetCurrentPlayer(),this.battleState.initNextTurnByQueue()}defendAction(){let e=this.battleState.currentUnitGroup;e.addCombatMods({fixedSpeed:5,heroBonusDefence:5,defending:!0}),this.battleState.resortFightQueue(!0),this.vfx.createDroppingMessageForContainer(e.id,{html:wi("Defending!",{width:80})},{duration:1e3}),this.historyLog.logSimpleMessage(`${e.count} ${e.type.name} choose to defend. Their speed is fixed to 5, and armor is increased by 5.`),this.battleState.initNextTurnByQueue()}recalcTurnQueue(){this.battleState.initNextTurnByQueue()}updatePlayerState({currentPlayer:e}){e.type===Lt.AI?(this.curPlayerState.setPlayerState(Me.WaitsForTurn),this.battleState.processAiPlayer()):this.curPlayerState.setPlayerState(Me.Normal)}updateQueueOnGroupTurnEnd(){this.battleState.initNextTurnByQueue(!0)}registerHealedUnits(e){e.healedUnitsCount&&this.battleState.registerPlayerUnitLoss(e.target,-e.healedUnitsCount)}registerUnitLossOnAnyOtherDamageSources({loss:e,unit:r}){this.battleState.registerPlayerUnitLoss(r,e)}checkIfFightEndedOnUnitGroupDeath(){let e=this.strucuresService.currentStruct,r=this.playersService.getCurrentPlayer(),t=this.battleState.getAliveUnitsOfPlayer(r);if(!t.length){this.playersService.getCurrentPlayer().hero.setUnitGroups(t),this.events.dispatch(vi({struct:e,win:!1}));return}let n=this.battleState.getEnemyOfPlayer(r);if(!this.battleState.getAliveUnitsOfPlayer(n).length){let s=this.battleState.getDeadUnitsOfPlayer(r),p=this.battleState.getSummonsOfPlayer(r),f=this.battleState.getDeadUnitsOfPlayer(n);[...s,...f,...p].forEach(T=>{this.gameObjectsManager.destroyObject(T)});let C=t.filter(T=>!T.modGroup.getModValue("isSummon")),w=this.playersService.getCurrentPlayer().hero;w.spells.forEach(T=>T.clearCooldown()),w.unitGroups.filter(T=>!T.fightInfo.isAlive).forEach(T=>{let U=w.getAllSlots().find(pe=>pe.unitGroup===T);U&&(U.unitGroup=null)}),w.setUnitGroups(C,!1),e.isInactive=!0,this.events.dispatch(vi({struct:e,win:!0}));return}}processAiPlayer(){this.battleState.currentPlayer.type===Lt.AI&&this.enemyHasAnyLivingUnits()&&this.battleState.processAiPlayer()}checkControlWhenGroupRunsOutOfTurns({groupHasMoreTurns:e,groupPlayer:r,groupStillAlive:t}){r.type===Lt.AI&&e&&t&&this.enemyHasAnyLivingUnits()&&this.battleState.processAiPlayer(),(!e||!t)&&this.events.dispatch(Os({playerEndsTurn:r}))}updateFightQueryDueToSpeedChange(){this.battleState.resortFightQueue()}cleanUpHandlersOnFightEnd(){this.cleanupStaticModsFromEquippedItems(),this.events.dispatch(Gs())}cleanUpHandlers(){this.state.eventHandlers.spells.removeAllHandlers()}enemyHasAnyLivingUnits(){return this.battleState.playerHasAnyAliveUnits(this.battleState.getEnemyOfPlayer(this.battleState.currentPlayer))}applyStaticModsFromEquippedItems(){this.playersService.getCurrentPlayer().hero.inventory.getEquippedItems().forEach(e=>{console.log(e);let r=e.baseType.staticEnemyMods;r&&this.playersService.getEnemyPlayer().hero.addCommonCombatMods(gt.fromMods(r))})}cleanupStaticModsFromEquippedItems(){this.playersService.getCurrentPlayer().hero.clearCommonCombatMods(),this.playersService.getEnemyPlayer().hero.clearCommonCombatMods()}};mr.\u0275fac=function(r){return new(r||mr)(x(wt),x(We),x(li),x(k),x(ci),x(J),x(Ai),x(xe))},mr.\u0275prov=O({token:mr,factory:mr.\u0275fac});var lt=mr;_([ee(Io)],lt.prototype,"beforeBattleInit",null);_([ee(zt)],lt.prototype,"prepareFightState",null);_([ee(So)],lt.prototype,"defendAction",null);_([ee(Vt)],lt.prototype,"recalcTurnQueue",null);_([G(Wi)],lt.prototype,"updatePlayerState",null);_([ee(Os)],lt.prototype,"updateQueueOnGroupTurnEnd",null);_([G(Un)],lt.prototype,"registerHealedUnits",null);_([G(Co)],lt.prototype,"registerUnitLossOnAnyOtherDamageSources",null);_([ee(mn)],lt.prototype,"checkIfFightEndedOnUnitGroupDeath",null);_([ee(go)],lt.prototype,"processAiPlayer",null);_([G(ho)],lt.prototype,"checkControlWhenGroupRunsOutOfTurns",null);_([ee(mo)],lt.prototype,"updateFightQueryDueToSpeedChange",null);_([ee(vi)],lt.prototype,"cleanUpHandlersOnFightEnd",null);_([ee(Gs)],lt.prototype,"cleanUpHandlers",null);var fr=class fr extends ce(){constructor(e){super(),this.combatInteractor=e}dispellAllUnitsOnStructCompleted(){this.combatInteractor.forEachUnitGroup(e=>this.combatInteractor.applyDispellToUnitGroup(e))}prepareSpellsOnFightStart(){this.combatInteractor.initAllUnitGroupSpells(),this.combatInteractor.resetAllUnitGroupsCooldowns()}startCombatInteraction(e){this.events.dispatch(un({action:ri.GroupAttacks,attackedGroup:e.attackedGroup,attackingGroup:e.attackingGroup}))}processCombatInteraction(e){switch(e.action){case ri.GroupAttacks:this.combatInteractor.handleAttackInteraction(e);break;case ri.GroupCounterattacks:this.combatInteractor.handleAttackInteraction(e);break;case ri.AttackInteractionCompleted:let r=e.attackingGroup;this.events.dispatch(ho({group:r,groupPlayer:r.ownerPlayer,groupStillAlive:!!r.count,groupHasMoreTurns:!!r.turnsLeft}))}}resetCooldownsAndEmitNewRoundEventToSpells(e){this.combatInteractor.triggerEventForAllSpellsHandler(Cn.NewRoundBegins({round:e.round})),this.combatInteractor.resetAllUnitGroupsCooldowns()}dispelUnitOnDeath(e){this.combatInteractor.applyDispellToUnitGroup(e.target)}addCombatModsToUnit({mods:e,unit:r}){r.addCombatMods(e)}removeCombatModsToUnit({mods:e,unit:r}){r.removeCombatMods(e)}};fr.\u0275fac=function(r){return new(r||fr)(x(En))},fr.\u0275prov=O({token:fr,factory:fr.\u0275fac});var ui=fr;_([ee(Yi)],ui.prototype,"dispellAllUnitsOnStructCompleted",null);_([ee(zt)],ui.prototype,"prepareSpellsOnFightStart",null);_([G(zi)],ui.prototype,"startCombatInteraction",null);_([G(un)],ui.prototype,"processCombatInteraction",null);_([G(Vt)],ui.prototype,"resetCooldownsAndEmitNewRoundEventToSpells",null);_([G(mn)],ui.prototype,"dispelUnitOnDeath",null);_([G(yo)],ui.prototype,"addCombatModsToUnit",null);_([G(vo)],ui.prototype,"removeCombatModsToUnit",null);var Fa=Be,dl=ot({prefix:"Structure",events:{NewDayBegins:Fa(),NewWeekBegins:Fa(),StructVisited:Fa(),StructInspected:Fa()}}),Qr=dl.events;var am=(()=>{let e=class e extends Ot{create({townBase:t}){this.base=t,this.initTownBuildings(),this.initUnitGrowthAndAvailability(),this.getApi().events.on(Qi).subscribe(n=>{this.updateAvailableUnitsByWeeklyGrowth(),this.getApi().eventFeed.pushPlainMessage(`The army of ${this.base.name} has grown`)})}updateAvailableUnitsByWeeklyGrowth(){this.getHiringBuildings().forEach(t=>{let n=t.currentBuilding.activity;this.unitsAvailableMap[n.unitGrowthGroup]+=n.growth})}initTownBuildings(){this.buildings=Object.keys(this.base.availableBuildings).reduce((t,n)=>N(P({},t),{[n]:this.getApi().gameObjects.createNewGameObject(Ad,{base:this.base.availableBuildings[n]})}),{})}initUnitGrowthAndAvailability(){let t=this.getHiringBuildings();this.growthMap=t.reduce((n,o)=>{let s=o.currentBuilding.activity,p=s.unitGrowthGroup;return n[p]=s.growth,n},{}),this.unitsAvailableMap=t.reduce((n,o)=>{let s=o.currentBuilding.activity;return n[s.unitGrowthGroup]=s.growth,n},{})}getHiringBuildings(){return Object.values(this.buildings).filter(t=>t.currentBuilding.activity?.type===rt.Hiring)}};e.categoryId="town";let i=e;return i})();var ml=Be,fl=ot({prefix:"Building",events:{NewDayBegins:ml(),NewWeekStarts:ml(),Built:ml()}}),hs=fl.events;var hr=class hr extends ce(){constructor(e,r,t,n,o,s,p,f){super(),this.battleState=e,this.structuresService=r,this.players=t,this.heroesService=n,this.state=o,this.eventFeedUiService=s,this.gameApiProvider=p,this.eventFeed=f,this.scheduledActions=[]}openMainScreenOnGameStart(){this.events.dispatch(zn())}initializeGameMap(e){this.state.mapsState={currentMap:e.map,maps:[e.map]},this.structuresService.initStructures(e)}initPlayersOnGameStart(){let e=this.players.createPlayer(Ui.Main,this.players.createPlayerWithHero(this.state.createdGame.selectedColor,this.state.createdGame.selectedHero,Lt.Player)),r=this.players.createPlayer(Ui.Neutral,{color:kn.GRAY,type:Lt.AI,hero:this.heroesService.createNeutralHero(),resources:P({},Fi)});e.hero.assignOwnerPlayer(e),r.hero.assignOwnerPlayer(r),e.hero.unitGroups.forEach(t=>t.assignOwnerHero(e.hero)),r.hero.unitGroups.forEach(t=>t.assignOwnerHero(r.hero)),this.state.gameState={players:[e,r],currentPlayer:e,playersMap:new Map([[e.id,e],[r.id,r]])},this.events.dispatch(qi({})),this.events.dispatch(Br.PrepareGameEvent({gameMode:zo.Normal,selectedFaction:this.state.createdGame.faction})),this.events.dispatch(Ur())}notifyBuildingsNewDayStarted(){this.state.eventHandlers.buildings.triggerAllHandlersByEvent(hs.NewDayBegins()),this.state.eventHandlers.structures.triggerAllHandlersByEvent(Qr.NewDayBegins());let e=this.state.currentGame.globalDay;this.scheduledActions.filter(t=>t.day===e).forEach(t=>t.action()),this.scheduledActions=this.scheduledActions.filter(t=>t.day!==e)}pushEventFeedMessage(e){this.eventFeedUiService.pushEventFeedMessage(e)}pushPlainEventFeedMessage(e){this.eventFeedUiService.pushEventFeedMessage({message:[{type:fi.FreeHtml,htmlContent:e.message}],delay:e.delay})}addActionCardsToPlayer(e){this.eventFeedUiService.pushPlainMessage(`Received action cards:<hr> ${e.actionCardStacks.map(({card:r,count:t})=>`x${oo(t)} ${Zn(r)}`).join("<br>")}`),e.actionCardStacks.forEach(({card:r,count:t})=>{e.player.addActionCards(r,t)})}activateActionCard({player:e,cardStack:r}){console.log(r);let t=r.card;r.count--,t.actionPoints&&this.events.dispatch(Wt({points:t.actionPoints})),r.count||V.removeItem(e.actionCards,r),this.eventFeed.pushPlainMessage(`${Zn(t)} is used. Left: ${oo(r.count)}`),t.type===nt.PlayerAction&&t.config?.onUsedInstantly?.(this.gameApiProvider.getGameApi())}notifyBuildignsNewWeekStarted(e){this.eventFeedUiService.pushPlainMessage(`Week ${e.week} started`),this.state.eventHandlers.buildings.triggerAllHandlersByEvent(hs.NewWeekStarts()),this.state.eventHandlers.structures.triggerAllHandlersByEvent(Qr.NewWeekBegins())}scheduleAction(e){this.scheduledActions.push({action:e.action,day:this.state.currentGame.globalDay+e.dayOffset})}openMapScreenWhenPlayerLeavesTown(){this.events.dispatch(Ur())}initFight(e){this.state.currentBattleState={currentPlayer:this.state.gameState.currentPlayer,enemyPlayer:e.struct.guardingPlayer}}fightStartInitQueue({players:e,unitGroups:r}){this.events.dispatch(Io()),this.battleState.initBattleState(r,e),this.events.dispatch(zt({}))}onStructSelected(e){this.structuresService.currentStruct=e.struct}};hr.\u0275fac=function(r){return new(r||hr)(x(wt),x(li),x(k),x(qr),x(J),x(nn),x(pi),x(nn))},hr.\u0275prov=O({token:hr,factory:hr.\u0275fac});var pt=hr;_([ee(wo)],pt.prototype,"openMainScreenOnGameStart",null);_([G(Br.GamePreparationFinished)],pt.prototype,"initializeGameMap",null);_([ee(xo)],pt.prototype,"initPlayersOnGameStart",null);_([ee(Fo)],pt.prototype,"notifyBuildingsNewDayStarted",null);_([G(Yn)],pt.prototype,"pushEventFeedMessage",null);_([G(Si)],pt.prototype,"pushPlainEventFeedMessage",null);_([G(Ki)],pt.prototype,"addActionCardsToPlayer",null);_([G(Qn)],pt.prototype,"activateActionCard",null);_([G(Qi)],pt.prototype,"notifyBuildignsNewWeekStarted",null);_([G(Vn)],pt.prototype,"scheduleAction",null);_([ee(_o)],pt.prototype,"openMapScreenWhenPlayerLeavesTown",null);_([G(Ln)],pt.prototype,"initFight",null);_([G(Eo)],pt.prototype,"fightStartInitQueue",null);_([G(Hn)],pt.prototype,"onStructSelected",null);var gr=class gr extends ce(){constructor(e){super(),this.itemsService=e}triggerEventsForItems(e){this.itemsService.triggerEventForAllItemsHandlers(Nc.NewRoundBegins({round:e.round}))}trigger(){this.itemsService.triggerEventForAllItemsHandlers(Nc.NewRoundBegins({round:0}))}};gr.\u0275fac=function(r){return new(r||gr)(x(Ri))},gr.\u0275prov=O({token:gr,factory:gr.\u0275fac});var Kr=gr;_([G(Vt)],Kr.prototype,"triggerEventsForItems",null);_([ee(zt)],Kr.prototype,"trigger",null);var yr=class yr extends ce(){constructor(e,r,t){super(),this.curPlayerState=e,this.itemsService=r,this.state=t}resetCooldowns(){this.curPlayerState.resetSpellsCooldowns()}addItemToPlayer({item:e,player:r}){let t=r.hero;t.addItem(e),t.inventory.isSlotEquipped(e.baseType.slotType)||this.events.dispatch($n({item:e,player:r}))}removeItemFromPlayer({item:e,player:r}){r.hero.removeItem(e)}equipItem({item:e,player:r}){r.hero.equipItem(e),this.itemsService.registerItemsEventHandlers(e,r)}unequipItem({player:e,item:r}){e.hero.unequipItem(r),this.state.eventHandlers.items.removeAllHandlersForRef(r)}};yr.\u0275fac=function(r){return new(r||yr)(x(We),x(Ri),x(J))},yr.\u0275prov=O({token:yr,factory:yr.\u0275fac});var on=yr;_([ee(Vt),ee(zt)],on.prototype,"resetCooldowns",null);_([G(Ci)],on.prototype,"addItemToPlayer",null);_([G(jn)],on.prototype,"removeItemFromPlayer",null);_([G($n)],on.prototype,"equipItem",null);_([G(fn)],on.prototype,"unequipItem",null);var vr=class vr extends ce(){constructor(e,r,t){super(),this.structuresService=e,this.state=r,this.gameObjectsManager=t}removeActionPoints({points:e}){let r=this.state.currentGame;r.actionPoints-=e,r.actionPoints<=0&&(r.day+=1,r.globalDay+=1,r.actionPoints+=4,this.events.dispatch(Fo({day:r.day})),r.day%7===0&&(r.week+=1,r.day=1,this.events.dispatch(Qi({week:r.week}))))}handleCompletedStructure(e){let r=e.struct.id;this.structuresService.availableStructuresMap[r]=!0,this.gameObjectsManager.getObjectByFullId(r).visited=!0,this.structuresService.playerCurrentLocId=r,this.structuresService.updateAvailableStructures(),this.events.dispatch(Wt({points:e.struct.actionPoints}))}panMapCamera(e){this.state.mapCamera.x=e.x,this.state.mapCamera.y=e.y}};vr.\u0275fac=function(r){return new(r||vr)(x(li),x(J),x(xe))},vr.\u0275prov=O({token:vr,factory:vr.\u0275fac});var Cr=vr;_([G(Wt)],Cr.prototype,"removeActionPoints",null);_([G(Yi)],Cr.prototype,"handleCompletedStructure",null);_([G(hn)],Cr.prototype,"panMapCamera",null);var Sr=class Sr extends ce(){constructor(e,r,t,n,o){super(),this.combatInteractor=e,this.actionHint=r,this.curPlayerState=t,this.cardsMapping=n,this.popupService=o}handleEnemyCardClick(e){let r=this.curPlayerState.playerCurrentState;if(r===Me.Normal){this.events.dispatch(zi({attackedGroup:e.attackedGroup,attackingGroup:e.attackingGroup}));return}r===Me.SpellTargeting&&(this.curPlayerState.onCurrentSpellCast(),this.events.dispatch(po({player:e.attackingPlayer,spell:this.curPlayerState.currentSpell,target:e.attackedGroup})),this.curPlayerState.setSpellsOnCooldown())}handleAllyGroupClick(e){if(this.curPlayerState.playerCurrentState===Me.SpellTargeting){this.curPlayerState.onCurrentSpellCast();let r=e.unitGroup;this.events.dispatch(po({player:r.ownerPlayer,spell:this.curPlayerState.currentSpell,target:r})),this.curPlayerState.setSpellsOnCooldown()}}handlePlayerHover(e){switch(e.hoverType){case Ct.EnemyCard:if(this.curPlayerState.playerCurrentState===Me.Normal&&this.combatInteractor.setDamageHintMessageOnCardHover(e),this.curPlayerState.playerCurrentState===Me.SpellTargeting){let r={type:$i.OnTargetSpell,spell:this.curPlayerState.currentSpell,target:e.hoveredCard};this.actionHint.hintMessage$.next(r)}break;case Ct.AllyCard:if(this.curPlayerState.playerCurrentState===Me.SpellTargeting){let r={type:$i.OnTargetSpell,spell:this.curPlayerState.currentSpell,target:e.hoveredCard};this.actionHint.hintMessage$.next(r)}break;case Ct.Unhover:this.actionHint.hintMessage$.next(null)}}handleRightClick(e){this.events.dispatch(gn({unitGroup:e.unitGroup}))}displayUnitGroupInfo(e){Di.logObjectsOnRightClick&&console.log("show info for:",e),this.popupService.createBasicPopup({data:{unitGroup:e.unitGroup},component:ps,isCloseable:!0,class:"small-padding"})}disableActionHintOnEnemyTurn(e){e.currentPlayer!==this.curPlayerState.currentPlayer?this.actionHint.disableActionHint$.next(!0):this.actionHint.disableActionHint$.next(!1)}enableActionHint(){this.actionHint.disableActionHint$.next(!1)}playerTargetsSpell(e){this.combatInteractor.triggerEventForSpellHandler(e.spell,Cn.PlayerTargetsSpell({target:e.target})),this.curPlayerState.setPlayerState(Me.Normal),this.curPlayerState.resetCurrentSpell()}playerUsesInstantSpell(e){this.combatInteractor.triggerEventForSpellHandler(e.spell,Cn.PlayerCastsInstantSpell({player:e.player,spell:e.spell}))}};Sr.\u0275fac=function(r){return new(r||Sr)(x(En),x(_n),x(We),x(Lr),x(si))},Sr.\u0275prov=O({token:Sr,factory:Sr.\u0275fac});var Jt=Sr;_([G(jo)],Jt.prototype,"handleEnemyCardClick",null);_([G($o)],Jt.prototype,"handleAllyGroupClick",null);_([G(Ti)],Jt.prototype,"handlePlayerHover",null);_([G(Vo)],Jt.prototype,"handleRightClick",null);_([G(gn)],Jt.prototype,"displayUnitGroupInfo",null);_([G(Wi)],Jt.prototype,"disableActionHintOnEnemyTurn",null);_([ee(vi)],Jt.prototype,"enableActionHint",null);_([G(po)],Jt.prototype,"playerTargetsSpell",null);_([G(uo)],Jt.prototype,"playerUsesInstantSpell",null);var wr=class wr extends ce(){constructor(e,r,t,n,o,s,p,f,C,w,T,U,pe,ie){super(),this.combatInteractor=e,this.vfxService=r,this.battleState=t,this.spellsService=n,this.units=o,this.battleLog=s,this.players=p,this.itemsService=f,this.apiProvider=C,this.state=w,this.gameObjectsManager=T,this.eventFeed=U,this.structures=pe,this.currentPlayer=ie}initPlayerItems(){let e=this.players.getCurrentPlayer();e.hero.base.initialState.items.forEach(r=>{this.events.dispatch(Ci({player:e,item:this.itemsService.createItem(r)}))})}initSpell({spell:e,player:r,ownerUnit:t}){let n=e.baseType;n.config.flags?.isAura||n.config.spellConfig.init({actions:this.createActionsApiRef(),events:{on:o=>{Object.entries(o).forEach(([s,p])=>{let f=Bc.getEventByName(s);this.state.eventHandlers.spells.registerHandlerByRef(e,f,p)})}},vfx:{createEffectForUnitGroup:(o,s,p)=>{this.vfxService.createVfxForUnitGroup(o,{type:Xi.VfxElement,animation:s},p)},createFloatingMessageForUnitGroup:(o,s,p)=>{this.vfxService.createFloatingMessageForUnitGroup(o,s,p)},createDroppingMessageForUnitGroup:(o,s,p)=>{this.vfxService.createDroppingMessageForContainer(o,s,p)}},thisSpell:e.baseType,ownerPlayer:r,spellInstance:e,ownerHero:r.hero,ownerUnit:t})}initItem({item:e,ownerPlayer:r}){e.baseType.config.init({actions:this.createActionsApiRef(),events:{on:t=>{Object.entries(t).forEach(([n,o])=>{let s=Lc.getEventByName(n);this.state.eventHandlers.items.registerHandlerByRef(e,s,o)})}},ownerHero:r.hero,ownerPlayer:r,thisInstance:e})}initBuilding({building:e,player:r}){this.state.eventHandlers.buildings.removeAllHandlersForRef(e),e.currentBuilding.config?.init({players:this.apiProvider.getPlayerApi(),localEvents:{on:t=>{Object.entries(t).forEach(([n,o])=>{let s=fl.getEventByName(n);this.state.eventHandlers.buildings.registerHandlerByRef(e,s,o)})}},globalEvents:this.apiProvider.getGlobalEventsApi(),thisBuilding:e,gameObjects:this.gameObjectsManager})}initStructureGameObject({structure:e}){e.generator?.config?.init({structures:{updateAvailableLocations:()=>this.structures.updateAvailableStructures(),markLocationVisited:r=>{r.visited=!0,this.structures.updateAvailableStructures()}},players:this.apiProvider.getPlayerApi(),thisStruct:e,localEvents:{on:r=>{Object.entries(r).forEach(([t,n])=>{let o=dl.getEventByName(t);this.state.eventHandlers.structures.registerHandlerByRef(e,o,n)})}},eventFeed:{postEventFeedMessage:r=>this.eventFeed.pushEventFeedMessage(r),pushPlainMessage:r=>this.eventFeed.pushPlainMessage(r)},spells:this.apiProvider.getSpellsApi()})}initializeGameObjectApi(e){let r=e.gameObject;r.api={spells:this.apiProvider.getSpellsApi(),events:{on:t=>this.events.onEvent(t),dispatch:t=>this.events.dispatch(t)},gameObjects:this.gameObjectsManager,eventFeed:{postEventFeedMessage:t=>{this.eventFeed.pushEventFeedMessage(t)},pushPlainMessage:t=>this.eventFeed.pushPlainMessage(t)}}}createActionsApiRef(){return{isEnemyUnitGroup:e=>e.ownerPlayer!==this.currentPlayer.currentPlayer,getUnitsFromFightQueue:()=>this.battleState.getFightQueue(),removeTurnsFromUnitGroup:(e,r=e.turnsLeft)=>{e.turnsLeft-=r,e.turnsLeft<0&&(e.turnsLeft=0),this.battleState.removeUnitsWithoutTurnsFromFightQueue()},unitGroupAttack:(e,r)=>this.events.dispatch(zi({attackingGroup:e,attackedGroup:r})),getCurrentUnitGroup:()=>this.battleState.currentUnitGroup,summonUnitsForPlayer:(e,r,t)=>{let n=this.battleState.summonUnitForPlayer(e,r,t);return this.events.dispatch(fo({unitGroup:n})),n},dealDamageTo:(e,r,t,n)=>{this.combatInteractor.dealDamageTo(e,r,t,n)},createSpellInstance:(e,r)=>this.spellsService.createSpellInstance(e,r),addModifiersToUnitGroup:(e,r)=>{this.units.addModifierToUnitGroup(e,r),r.unitGroupSpeedBonus&&this.events.dispatch(mo({unitGroup:e})),this.events.dispatch(As({unitGroup:e}))},createModifiers:e=>this.spellsService.createModifiers(e),removeModifiresFromUnitGroup:(e,r)=>{this.units.removeModifiers(e,r),this.events.dispatch(As({unitGroup:e}))},addSpellToUnitGroup:(e,r,t)=>{this.combatInteractor.addSpellToUnitGroup(e,r,t)},removeSpellFromUnitGroup:(e,r)=>{this.combatInteractor.removeSpellFromUnitGroup(e,r)},getUnitGroupsOfPlayer:e=>this.battleState.heroesUnitGroupsMap.get(e),getAliveUnitGroupsOfPlayer:e=>this.battleState.getAliveUnitsOfPlayer(e),getRandomEnemyPlayerGroup:()=>this.combatInteractor.getRandomEnemyUnitGroup(),getEnemyOfPlayer:e=>this.battleState.getEnemyOfPlayer(e),historyLog:e=>{this.battleLog.logSimpleMessage(e)},healUnit:(e,r)=>{let t=this.units.healUnit(e,r);return this.events.dispatch(Un({target:e,healedUnitsCount:t.revivedUnitsCount})),t}}}};wr.\u0275fac=function(r){return new(r||wr)(x(En),x(ci),x(wt),x(bn),x(ke),x(Ai),x(k),x(Ri),x(pi),x(J),x(xe),x(nn),x(li),x(We))},wr.\u0275prov=O({token:wr,factory:wr.\u0275fac});var Bi=wr;_([ee(qi)],Bi.prototype,"initPlayerItems",null);_([G(Uo)],Bi.prototype,"initSpell",null);_([G(Bo)],Bi.prototype,"initItem",null);_([G(Ho)],Bi.prototype,"initBuilding",null);_([G(Lo)],Bi.prototype,"initStructureGameObject",null);_([G(Ro)],Bi.prototype,"initializeGameObjectApi",null);var W0=["mapCanvas"],q0=["underlay"],Zr=class Zr extends ce(){constructor(e,r,t){super(),this.state=e,this.ngZone=r,this.renderer=t,this.hostElem=Gr(),this.mapDragEvent=new bt,this.cellSize=0,this.windowWidth=0,this.windowHeight=0,this.windowWidthHalf=0,this.windowHeightHalf=0,this.mapTotalWidth=0,this.mapTotalHeight=0,this.offsetX=0,this.offsetY=0}ngOnInit(){this.canvasElem=this.mapCanvasRef.nativeElement,this.canvasCtx=this.canvasElem.getContext("2d"),this.underlayElem=this.underlayRef.nativeElement,this.currentMap=this.state.mapsState.currentMap,this.renderMapCellsGrid(),this.setupWindowResizingHandling(),this.setupMapDragging(),this.resetCanvasPosition()}onMapClick(e){vp()&&console.log({id:"new-id",x:e.clientX-this.offsetX,y:e.clientY-this.offsetY,icon:"sword"})}panCameraCenterTo(e){console.log("[Map View]: Pan camera center to",e);let r=-(e.x-this.windowWidthHalf),t=-(e.y-this.windowHeightHalf);this.setMapElementsPosition(r,t),this.mapDragEvent.emit({finalPosX:r,finalPosY:t})}setupMapDragging(){this.ngZone.runOutsideAngular(()=>{It(this.hostElem,"mousedown").pipe(zl(e=>{let r=e,t=parseInt(this.canvasElem.style.left),n=parseInt(this.canvasElem.style.top);return It(window,"mousemove").pipe(Li(o=>{let s=o;return{xDragOffset:s.clientX-r.clientX,yDragOffset:s.clientY-r.clientY,mapPosX:t,mapPosY:n}}),et(Vl(It(window,"mouseup"),It(window,"onfocusout")).pipe(Pr(1))))}),this.untilDestroyed).subscribe(e=>{let r=this.windowWidthHalf,t=this.windowHeightHalf,n=e.mapPosX+e.xDragOffset,o=e.mapPosY+e.yDragOffset,s=n,p=o;n>r?s=r:n<-(this.mapTotalWidth-r)&&(s=-(this.mapTotalWidth-r)),o>t?p=t:o<-(this.mapTotalHeight-t)&&(p=-(this.mapTotalHeight-t)),this.state.mapCamera.x=s*-1+r,this.state.mapCamera.y=p*-1+t,this.setMapElementsPosition(s,p),this.mapDragEvent.emit({finalPosX:s,finalPosY:p})})})}setMapElementsPosition(e,r){this.offsetX=e,this.offsetY=r,this.renderer.setStyle(this.canvasElem,"left",`${e}px`),this.renderer.setStyle(this.canvasElem,"top",`${r}px`)}resetCanvasPosition(){this.offsetX=0,this.offsetY=0,this.renderer.setStyle(this.canvasElem,"left","0px"),this.renderer.setStyle(this.canvasElem,"top","0px")}renderMapCellsGrid(){let{heightInCells:e,widthInCells:r,cellSize:t}=this.currentMap.mapSize;this.cellSize=t;let n=r*t,o=e*t;this.mapTotalWidth=n,this.mapTotalHeight=o,this.canvasElem.width=n,this.canvasElem.height=o;let s=this.canvasCtx;for(let p=0;p<=e;p++)s.moveTo(0,p*t),s.lineTo(n,p*t);for(let p=0;p<=r;p++)s.moveTo(p*t,0),s.lineTo(p*t,o);s.setLineDash([5,8]),s.lineWidth=.5,s.strokeStyle="gray",s.stroke()}setupWindowResizingHandling(){this.updateWindowSizeData(),this.updateUnderlaySize(),this.ngZone.runOutsideAngular(()=>{It(window,"resize").pipe(this.untilDestroyed).subscribe(()=>{this.updateWindowSizeData(),this.updateUnderlaySize(),this.panCameraCenterTo(this.state.mapCamera)})})}updateWindowSizeData(){this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.windowWidthHalf=this.windowWidth/2,this.windowHeightHalf=this.windowHeight/2}updateUnderlaySize(){this.renderer.setStyle(this.underlayElem,"width",`${this.windowWidth}px`),this.renderer.setStyle(this.underlayElem,"height",`${this.windowHeight}px`)}};Zr.\u0275fac=function(r){return new(r||Zr)(y(J),y(ti),y(je))},Zr.\u0275cmp=v({type:Zr,selectors:[["mw-map-canvas"]],viewQuery:function(r,t){if(r&1&&(De(W0,7),De(q0,7)),r&2){let n;Ee(n=Ie())&&(t.mapCanvasRef=n.first),Ee(n=Ie())&&(t.underlayRef=n.first)}},outputs:{mapDragEvent:"mapDragEvent"},features:[j],decls:4,vars:0,consts:[["underlay",""],["mapCanvas",""],[1,"underlay"],[3,"click"]],template:function(r,t){if(r&1){let n=R();h(0,"div",2,0),a(2,"canvas",3,1),S("click",function(s){return E(n),I(t.onMapClick(s))}),c()}},styles:[".underlay[_ngcontent-%COMP%]{background-color:#e9e9e9;z-index:-3;position:absolute;-webkit-user-select:none;user-select:none}canvas[_ngcontent-%COMP%]{position:absolute;background:#f5f5f5;z-index:-2;-webkit-user-select:none;user-select:none}"]});var Xr=Zr;_([G(hn)],Xr.prototype,"panCameraCenterTo",null);var xt=(()=>{let e=class e{constructor(t){this.actionHint=t,this.mwActionHint=""}ngOnDestroy(){this.actionHint.hintMessage$.next(null)}showHint(){this.actionHint.hintMessage$.next({type:$i.CustomHtml,html:this.mwActionHint})}hideHint(){this.actionHint.hintMessage$.next(null)}};e.\u0275fac=function(n){return new(n||e)(y(_n))},e.\u0275dir=Le({type:e,selectors:[["","mwActionHint",""]],hostBindings:function(n,o){n&1&&S("mouseenter",function(){return o.showHint()})("mouseleave",function(){return o.hideHint()})},inputs:{mwActionHint:"mwActionHint"}});let i=e;return i})();function Q0(i,e){if(i&1&&(a(0,"div",2),d(1),c()),i&2){let r=m();l(),M(" ",r.struct.actionPoints,`
`)}}var hl=(()=>{let e=class e{constructor(){this.isAvailable=!1,this.isCurrentLoc=!1,this.activeLocColor="",this.structSelected=new bt}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-map-structure"]],inputs:{struct:"struct",isAvailable:"isAvailable",isCurrentLoc:"isCurrentLoc",activeLocColor:"activeLocColor"},outputs:{structSelected:"structSelected"},decls:2,vars:13,consts:[[1,"struct-icon",3,"click","mwActionHint","icon"],["class","loc-action-points",4,"ngIf"],[1,"loc-action-points"]],template:function(n,o){n&1&&(a(0,"mw-ra-icon",0),S("click",function(){return o.structSelected.emit(o.struct)}),c(),g(1,Q0,2,1,"div",1)),n&2&&($("border-color",o.isCurrentLoc?o.activeLocColor:"rgb(90, 90, 90)"),de("available",o.isAvailable&&!o.struct.visited)("completed",o.struct.visited)("disabled",!o.isAvailable)("guards",o.struct.guard&&!o.struct.visited&&o.isAvailable),u("mwActionHint",(o.struct.guard&&o.isAvailable&&!o.struct.visited?"Attack the guard of ":"")+o.struct.name+(o.struct.visited?"<hr/>Visited":o.struct.actionPoints?"<hr/>Cost: "+o.struct.actionPoints+" action points":""))("icon",o.struct.icon),l(),u("ngIf",o.isAvailable&&!o.struct.visited&&o.struct.actionPoints))},dependencies:[se,xt,le],styles:[".struct-icon[_ngcontent-%COMP%]{position:absolute;cursor:pointer;z-index:50;transform:translate(-50%,-50%) scale(1.2);text-align:center;font-size:20px;border:4px solid rgb(90,90,90);background-color:gray;color:#fff;border-radius:50%;width:20px;height:20px;display:block;filter:brightness(1)}.struct-icon[_ngcontent-%COMP%]:hover{filter:brightness(1);transition:.4s;transform:translate(-50%,-50%) scale(1.4)}.available[_ngcontent-%COMP%]{outline:4px solid rgba(151,133,27,.28)}.struct-icon.disabled[_ngcontent-%COMP%]{filter:brightness(.7)}.struct-icon[_ngcontent-%COMP%]:not(.disabled) ~ .path-line[_ngcontent-%COMP%]{opacity:1}.struct-icon[_ngcontent-%COMP%]:hover ~ .path-line[_ngcontent-%COMP%] > .line[_ngcontent-%COMP%]{stroke-width:7;animation:pathanim 2s linear infinite}.structure[_ngcontent-%COMP%]{width:100px;margin:10px;border-radius:6px;background:gray;color:#fff;padding:14px;cursor:pointer}.inactive[_ngcontent-%COMP%]{opacity:.5}.loc-action-points[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;z-index:50;position:relative;background:#4d4d4d;width:14px;height:14px;border-radius:50%;font-size:11px;text-align:center;color:#fff;border:2px solid;top:7px;left:5px}"]});let i=e;return i})();var Z0=["locationsContainer"];function X0(i,e){if(i&1){let r=R();a(0,"mw-map-canvas",6),S("mapDragEvent",function(n){E(r);let o=m();return I(o.updateLocationsPosition(n))}),c()}}function J0(i,e){if(i&1&&(a(0,"div",8)(1,"span",12),d(2),c()()),i&2){let r=m().$implicit;$("left",r.x,"px")("top",r.y,"px"),l(2),M(" ",r.id," ")}}function ey(i,e){if(i&1&&(Zl(),a(0,"svg",13),h(1,"line",14),c()),i&2){let r=m().$implicit;$("left",r.svg.x,"px")("top",r.svg.y,"px"),ja("width",r.svg.width)("height",r.svg.height),l(),ja("x1",r.svg.ox)("y1",r.svg.oy)("x2",r.svg.tx)("y2",r.svg.ty)}}function ty(i,e){if(i&1){let r=R();a(0,"div",7)(1,"div",8)(2,"mw-map-structure",9),S("structSelected",function(n){E(r);let o=m();return I(o.onStructureSelected(n))}),c()(),g(3,J0,3,5,"div",10)(4,ey,2,10,"svg",11),c()}if(i&2){let r=e.$implicit,t=m();l(),$("left",r.x,"px")("top",r.y,"px"),l(),u("struct",r)("isAvailable",t.structsService.availableStructuresMap[r.id])("isCurrentLoc",t.structsService.playerCurrentLocId===r.id)("activeLocColor",t.state.createdGame.selectedColor),l(),u("ngIf",t.isLocIdVisible),l(),u("ngIf",r.svg)}}var gl=(()=>{let e=class e extends ce(){constructor(t,n,o,s,p){super(),this.playersService=t,this.state=n,this.structsService=o,this.renderer=s,this.gameObjectsManager=p,this.isLocIdVisible=Di.showLocationsIds,this.player=this.playersService.getCurrentPlayer(),va(()=>{this.state.mainMenu.isOpen||this.events.dispatch(qn())})}ngAfterViewInit(){if(this.state.mapCamera.cameraInitialized){let{x:o,y:s}=this.state.mapCamera;this.events.dispatch(hn({x:o,y:s}));return}let t=this.state.mapsState.currentMap.startingLocId,n=this.gameObjectsManager.getObjectById(tr,t);n?this.events.dispatch(hn({x:n.x,y:n.y})):console.warn(`[Map View]: Couldn't find location with id ${t} to pan camera center on game start`),this.state.mapCamera.cameraInitialized=!0}updateLocationsPosition(t){let n=this.locationsRef.nativeElement;this.renderer.setStyle(n,"left",`${t.finalPosX}px`),this.renderer.setStyle(n,"top",`${t.finalPosY}px`)}onStructureSelected(t){!this.structsService.availableStructuresMap[t.id]||!t.generator||t.isInactive||(t.guard&&this.playersService.getEnemyPlayer().hero.setUnitGroups(t.guard),this.events.dispatch(Hn({struct:t})))}};e.\u0275fac=function(n){return new(n||e)(y(k),y(J),y(li),y(je),y(xe))},e.\u0275cmp=v({type:e,selectors:[["mw-structures-view"]],viewQuery:function(n,o){if(n&1&&De(Z0,5),n&2){let s;Ee(s=Ie())&&(o.locationsRef=s.first)}},features:[j],decls:7,vars:2,consts:[["locationsContainer",""],[3,"mapDragEvent",4,"ngIf"],[1,"map-view"],["class","struct",4,"ngFor","ngForOf"],[1,"player-info-panel"],[1,"player-actions"],[3,"mapDragEvent"],[1,"struct"],[2,"position","absolute"],[3,"structSelected","struct","isAvailable","isCurrentLoc","activeLocColor"],["style","position: absolute;",3,"left","top",4,"ngIf"],["class","path-line","version","1.1","xmlns","http://www.w3.org/2000/svg",3,"left","top",4,"ngIf"],[1,"loc-name"],["version","1.1","xmlns","http://www.w3.org/2000/svg",1,"path-line"],["stroke-dasharray","10, 13",1,"line"]],template:function(n,o){n&1&&(g(0,X0,1,0,"mw-map-canvas",1),a(1,"div",2,0),g(3,ty,5,10,"div",3),c(),h(4,"mw-player-info-panel",4)(5,"mw-action-hint")(6,"mw-player-map-actions-panel",5)),n&2&&(u("ngIf",o.state.settings.mapDebug),l(3),u("ngForOf",o.structsService.viewStructures))},dependencies:[q,se,Gi,cs,cr,hl,Xr],styles:[".map-view[_ngcontent-%COMP%]{height:0;width:0;position:absolute;left:0;top:0;z-index:-1}@keyframes _ngcontent-%COMP%_pathanim{0%{stroke-dashoffset:0}to{stroke-dashoffset:-23}}.path-line[_ngcontent-%COMP%]{position:absolute;opacity:.4;transition:.4s;overflow:visible;min-width:15px;pointer-events:none}.struct[_ngcontent-%COMP%]:hover   .path-line[_ngcontent-%COMP%]{opacity:.6}.struct[_ngcontent-%COMP%]:hover   .path-line[_ngcontent-%COMP%] > .line[_ngcontent-%COMP%]{stroke-width:7;animation:_ngcontent-%COMP%_pathanim 2s linear infinite}.line[_ngcontent-%COMP%]{stroke:#000;stroke-width:5;stroke-dashoffset:0;opacity:.6}.guards[_ngcontent-%COMP%]{font-size:13px}.player-info-panel[_ngcontent-%COMP%]{position:fixed;left:0;bottom:0}.player-actions[_ngcontent-%COMP%]{position:fixed;left:70px;top:50%;display:flex;flex-direction:column;transform:translateY(-50%)}mw-action-hint[_ngcontent-%COMP%]{position:fixed;top:90%;left:0;right:0;font-size:13px}.loc-name[_ngcontent-%COMP%]{position:relative;left:-50%;background:#525252;text-align:center;color:#fff;display:block;font-size:9px;padding:2px;border-radius:3px;top:12px;z-index:100000}"]});let i=e;return i})();var Jr=(()=>{let e=class e{transform(t){return $e(t)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275pipe=Ni({name:"entity",type:e,pure:!0});let i=e;return i})();function ny(i,e){if(i&1&&(a(0,"div",11)(1,"div"),d(2),c(),a(3,"div"),d(4),c()()),i&2){let r=e.$implicit;l(2),H(r.key),l(2),H(r.value)}}function ry(i,e){if(i&1){let r=R();a(0,"div",7)(1,"div"),d(2),re(3,"entity"),c(),a(4,"div"),d(5),c(),a(6,"input",8),S("input",function(n){let o=E(r).$implicit,s=m();return I(s.updateCountForGroup(o,n))}),c(),a(7,"div"),d(8,"Cost:"),c(),a(9,"div",9),g(10,ny,5,2,"div",10),re(11,"keyvalue"),c()()}if(i&2){let r=e.$implicit;l(2),H(oe(3,6,r.hire.unitTypeId).name),l(3),H(r.count),l(),u("min",0)("max",r.hire.maxCount)("value",0),l(4),u("ngForOf",oe(11,8,r.currentCost))}}function oy(i,e){i&1&&(a(0,"div"),d(1,"You don't have enough free slots in army."),c())}var yl=(()=>{let e=class e extends te{constructor(t,n){super(),this.playersService=t,this.unitGroups=n,this.canConfirm=!0,this.playerHasFreeSlots=!0,this.playerHasFreeSlots=this.playersService.getCurrentPlayer().hero.hasFreeUnitSlots()}ngOnInit(){this.hiredGroups=this.data.struct.reward.units.map(t=>{let n={},o={},s=qt(t.unitTypeId).baseRequirements;return[ye.Gems,ye.Gold,ye.RedCrystals,ye.Wood].forEach(f=>{s[f]&&(n[f]=s[f],o[f]=0)}),{hire:t,count:0,baseCost:n,currentCost:o}})}updateCountForGroup(t,n){t.count=Number(n.target.value),this.canConfirm=!0,Object.entries(t.baseCost).forEach(([o,s])=>{t.currentCost[o]=s*t.count}),this.updateCanConfirm()}confirmHire(){let t=this.playersService.getCurrentPlayer(),n=this.calcTotalCosts();this.playersService.removeResourcesFromPlayer(t,n),this.hiredGroups.forEach(o=>{if(o.count){let s=this.unitGroups.createUnitGroup(o.hire.unitTypeId,{count:o.count},t.hero);this.playersService.addUnitGroupToTypeStack(t,s)}}),this.close()}calcTotalCosts(){return this.hiredGroups.reduce((t,n)=>(Object.entries(n.currentCost).forEach(([o,s])=>{let p=o;t[p]?t[p]+=n.currentCost[p]:t[p]=n.currentCost[p]}),t),{})}updateCanConfirm(){let t=this.calcTotalCosts();this.canConfirm=this.playersService.playerHasResources(this.playersService.getCurrentPlayer(),t)}};e.\u0275fac=function(n){return new(n||e)(y(k),y(ke))},e.\u0275cmp=v({type:e,selectors:[["mw-hiring-reward-popup"]],features:[j],decls:10,vars:3,consts:[[2,"padding","10px"],["popupHeader",""],["popupContent",""],[1,"units"],["class","unit-column",4,"ngFor","ngForOf"],["popupButtons",""],[1,"button",3,"click","disabled"],[1,"unit-column"],["type","range",3,"input","min","max","value"],[1,"cost"],["class","resource",4,"ngFor","ngForOf"],[1,"resource"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content",0)(1,"div",1),d(2," Hire units: "),c(),a(3,"div",2)(4,"div",3),g(5,ry,12,10,"div",4),c(),g(6,oy,2,0,"div"),c(),a(7,"div",5)(8,"button",6),S("click",function(){return o.confirmHire()}),d(9," Confirm "),c()()()),n&2&&(l(5),u("ngForOf",o.hiredGroups),l(),Oe(o.playerHasFreeSlots?-1:6),l(2),u("disabled",!o.canConfirm||!o.playerHasFreeSlots))},dependencies:[q,ue,ni,Jr],styles:[".units[_ngcontent-%COMP%]{display:flex;justify-content:center}.unit-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid gray;padding:10px;margin:6px;width:160px;align-items:center;font-size:13px}.cost[_ngcontent-%COMP%]{display:flex}.resource[_ngcontent-%COMP%]{border:1px solid gray;border-radius:4px;padding:7px}"]});let i=e;return i})();function sy(i,e){if(i&1&&(a(0,"div",9),h(1,"mw-item-icon",10),a(2,"div",11),d(3),c()()),i&2){let r=e.$implicit;l(),u("item",r)("hintPos","above"),l(2),M(" ",r.baseType.name," ")}}function ay(i,e){if(i&1){let r=R();a(0,"div",7),S("click",function(){let n=E(r).$implicit,o=m();return I(o.setSelectedGroup(n))}),g(1,sy,4,3,"div",8),c()}if(i&2){let r=e.$implicit,t=m();de("selected",r===t.selectedGroup),l(),u("ngForOf",r)}}var vl=(()=>{let e=class e extends te{constructor(t,n){super(),this.itemsService=t,this.playersService=n}ngOnInit(){let t=this.data.struct.reward;this.itemGroups=t.itemGroups.map(n=>n.map(o=>this.itemsService.createItem(o)))}setSelectedGroup(t){this.selectedGroup=t}onSubmit(){this.selectedGroup.forEach(t=>{this.playersService.addItemToPlayer(this.playersService.getCurrentPlayer(),t)}),this.close()}};e.\u0275fac=function(n){return new(n||e)(y(Ri),y(k))},e.\u0275cmp=v({type:e,selectors:[["mw-item-reward-popup"]],features:[j],decls:10,vars:2,consts:[["popupHeader",""],[2,"text-align","center","padding-bottom","20px"],["popupContent",""],[1,"reward-container"],["class","items-group",3,"selected","click",4,"ngFor","ngForOf"],["popupButtons","",2,"padding-top","18px"],["mw-main-button","",3,"click","disabled"],[1,"items-group",3,"click"],["style","display: flex; flex-direction: column; align-items: center;",4,"ngFor","ngForOf"],[2,"display","flex","flex-direction","column","align-items","center"],[3,"item","hintPos"],[2,"font-size","11px","text-align","center"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0)(2,"div",1),d(3," Select Item "),c()(),a(4,"div",2)(5,"div",3),g(6,ay,2,3,"div",4),c()(),a(7,"div",5)(8,"button",6),S("click",function(){return o.onSubmit()}),d(9," Submit "),c()()()),n&2&&(l(6),u("ngForOf",o.itemGroups),l(2),u("disabled",!o.selectedGroup))},dependencies:[q,ki,ae,ue],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between}.reward-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.items-group[_ngcontent-%COMP%]{margin:14px;padding:16px;border:1px solid gray;cursor:pointer}.selected[_ngcontent-%COMP%]{border-color:gold}"]});let i=e;return i})();function cy(i,e){if(i&1&&(a(0,"div",8)(1,"span"),d(2),c(),a(3,"span"),d(4),c()()),i&2){let r=e.$implicit;l(2),H(r.type.name),l(2),H(r.count)}}function ly(i,e){if(i&1&&(a(0,"div",8)(1,"span"),d(2),c(),a(3,"span"),d(4),c()()),i&2){let r=e.$implicit;l(2),H(r.type.name),l(2),H(r.count)}}var Cl=(()=>{let e=class e extends te{constructor(t,n){super(),this.players=t,this.events=n,this.totalGoldReward=0,this.totalExperienceReward=0}ngOnInit(){this.data.enemyLosses.forEach(t=>{this.totalExperienceReward+=Math.round(t.count*t.type.neutralReward.experience)})}onContinue(t){if(!t.isWin){this.close(),this.events.dispatch(To());return}this.close(),this.players.addExperienceToPlayer(this.players.getCurrentPlayerId(),this.totalExperienceReward);let o=this.players.getCurrentPlayer().resources;o[ye.Gold]+=this.totalGoldReward,this.events.dispatch(Yi({struct:t.struct}))}};e.\u0275fac=function(n){return new(n||e)(y(k),y(z))},e.\u0275cmp=v({type:e,selectors:[["mw-post-fight-reward-popup"]],features:[j],decls:21,vars:4,consts:[["popupHeader",""],[1,"header"],["popupContent",""],[2,"text-align","center"],[1,"losses-container"],["class","loss-card",4,"ngFor","ngForOf"],["popupButtons",""],["mw-main-button","",2,"margin","auto","display","block",3,"click"],[1,"loss-card"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0)(2,"div",1),d(3),c()(),a(4,"div",2)(5,"div")(6,"div",3),d(7,"Player's Losses"),c(),a(8,"div",4),g(9,cy,5,2,"div",5),c()(),a(10,"div")(11,"div",3),d(12,"Enemy's Losses"),c(),a(13,"div",4),g(14,ly,5,2,"div",5),c()(),a(15,"div")(16,"div"),d(17),c()()(),a(18,"div",6)(19,"button",7),S("click",function(){return o.onContinue(o.data)}),d(20," Continue "),c()()()),n&2&&(l(3),H(o.data.isWin?"Win!":"Defeat"),l(6),u("ngForOf",o.data.playerLosses),l(5),u("ngForOf",o.data.enemyLosses),l(3),M("Experience: +",o.totalExperienceReward,""))},dependencies:[q,ae,ue],styles:[".header[_ngcontent-%COMP%]{text-align:center;padding-bottom:16px}.losses-container[_ngcontent-%COMP%]{display:flex;justify-content:center}.loss-card[_ngcontent-%COMP%]{width:72px;height:72px;background-color:gray;border-radius:6px;color:#fff;margin:4px;text-align:center;padding:12px 0;font-size:13px;box-sizing:border-box;display:flex;flex-direction:column}"]});let i=e;return i})();var py=i=>({thisStruct:i});function uy(i,e){if(i&1&&(a(0,"div",7),h(1,"mw-description",8),c()),i&2){let r,t=m();l(),u("descriptions",t.data.struct.generator==null||(r=t.data.struct.generator.description(Ue(1,py,t.data.struct)))==null?null:r.descriptions)}}var Sl=(()=>{let e=class e extends te{constructor(t){super(),this.events=t,this.struct=this.data.struct,this.totalGoldReward=0,this.totalExpReward=0}ngOnInit(){this.data.struct.guard?.forEach(t=>{this.totalExpReward+=Math.round(t.count*t.type.neutralReward.experience)})}onBattleConfirmed(){this.close(),this.events.dispatch(Ln({struct:this.popup.data.struct}))}};e.\u0275fac=function(n){return new(n||e)(y(z))},e.\u0275cmp=v({type:e,selectors:[["mw-pre-fight-popup"]],features:[j],decls:16,vars:4,consts:[["popupHeader",""],["popupContent",""],["class","description",4,"ngIf"],[3,"unitGroups"],["popupButtons",""],["mw-main-button","",3,"click"],["icon","crossed-swords"],[1,"description"],[3,"descriptions"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2),c(),a(3,"div",1),g(4,uy,2,3,"div",2),a(5,"div"),h(6,"mw-unit-groups-list",3),c(),a(7,"div")(8,"div"),d(9),c()()(),a(10,"div",4)(11,"button",5),S("click",function(){return o.onBattleConfirmed()}),h(12,"mw-ra-icon",6),d(13," Fight "),c(),a(14,"button",5),S("click",function(){return o.close()}),d(15," Cancel "),c()()()),n&2&&(l(2),M(" ",o.data.struct.generator==null?null:o.data.struct.generator.name," "),l(2),u("ngIf",o.data.struct.generator==null?null:o.data.struct.generator.description),l(2),u("unitGroups",o.data.struct.guard),l(3),M("Experience: ",o.totalExpReward,""))},dependencies:[se,Xt,as,le,ae,ue],styles:[".description[_ngcontent-%COMP%]{padding:10px;text-align:center}"]});let i=e;return i})();var dy=i=>({thisStruct:i});function my(i,e){if(i&1&&h(0,"mw-description",3),i&2){let r,t=m();u("descriptions",t.struct.generator==null||(r=t.struct.generator.description(Ue(1,dy,t.struct)))==null?null:r.descriptions)}}var wl=(()=>{let e=class e extends te{constructor(t,n,o,s){super(),this.players=t,this.apiProvider=n,this.state=o,this.events=s,this.struct=this.data.struct,this.state.eventHandlers.structures.triggerRefEventHandlers(this.struct,Qr.StructInspected())}closePopup(){this.close()}accept(){let t=this.players.getCurrentPlayer(),n=this.data.struct;n.generator?.onVisited?.({playersApi:this.apiProvider.getPlayerApi(),spellsApi:this.apiProvider.getSpellsApi(),visitingPlayer:t}),this.state.eventHandlers.structures.triggerRefEventHandlers(this.data.struct,Qr.StructVisited({visitingPlayer:this.players.getCurrentPlayer()}));let o=this.data.struct.actionPoints;o&&this.events.dispatch(Wt({points:o})),n.isInactive=!0,this.closePopup()}};e.\u0275fac=function(n){return new(n||e)(y(k),y(pi),y(J),y(z))},e.\u0275cmp=v({type:e,selectors:[["mw-preview-popup"]],features:[j],decls:11,vars:3,consts:[["popupHeader",""],["popupContent",""],[2,"white-space","pre","padding","16px"],[3,"descriptions"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],["mw-main-button","",3,"click"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2),c(),a(3,"div",1)(4,"div",2),g(5,my,1,3,"mw-description",3),c()(),a(6,"div",4)(7,"button",5),S("click",function(){return o.accept()}),d(8,"Accept"),c(),a(9,"button",6),S("click",function(){return o.closePopup()}),d(10,"Cancel"),c()()()),n&2&&(l(2),M(" ",o.data.struct.name," "),l(3),Oe(o.struct.generator!=null&&o.struct.generator.description?5:-1),l(2),u("disabled",(o.struct.controls==null?null:o.struct.controls.accept)===!1))},dependencies:[Xt,ae,ue],styles:["[_nghost-%COMP%]{text-align:center}"]});let i=e;return i})();function fy(i,e){if(i&1&&(a(0,"div",8)(1,"div"),d(2),c(),a(3,"div"),d(4),c()()),i&2){let r=e.$implicit;l(2),M(" ",r.type," "),l(2),M(" ",r.count," ")}}function hy(i,e){if(i&1){let r=R();a(0,"div",6),S("click",function(){let n=E(r).$implicit,o=m();return I(o.setCurrentReward(o.data,n))}),g(1,fy,5,2,"div",7),c()}if(i&2){let r=e.$implicit,t=m();de("selected",t.data.selectedRewardGroup===r),l(),u("ngForOf",r)}}var xl=(()=>{let e=class e extends te{constructor(t){super(),this.playersService=t}ngOnInit(){this.resourceGroups=this.data.struct.reward.resourceGroups}setCurrentReward(t,n){t.selectedRewardGroup=n}confirmResources(t){this.close(),t.selectedRewardGroup&&t.selectedRewardGroup.forEach(n=>{this.playersService.addResourceToPlayer(this.playersService.getCurrentPlayer(),n.type,n.count)})}};e.\u0275fac=function(n){return new(n||e)(y(k))},e.\u0275cmp=v({type:e,selectors:[["mw-resources-reward-popup"]],features:[j],decls:9,vars:2,consts:[["popupHeader",""],["popupContent",""],[1,"reources-rewards"],["class","resource-column",3,"selected","click",4,"ngFor","ngForOf"],["popupButtons",""],["mw-main-button","",2,"margin","auto","display","block",3,"click","disabled"],[1,"resource-column",3,"click"],["class","resource-card",4,"ngFor","ngForOf"],[1,"resource-card"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2," Select Reward: "),c(),a(3,"div",1)(4,"div",2),g(5,hy,2,3,"div",3),c()(),a(6,"div",4)(7,"button",5),S("click",function(){return o.confirmResources(o.data)}),d(8," Confirm "),c()()()),n&2&&(l(5),u("ngForOf",o.resourceGroups),l(2),u("disabled",!o.data.selectedRewardGroup))},dependencies:[q,ae,ue],styles:[".reources-rewards[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:20px 10px}.resource-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid gray;margin:0 20px;cursor:pointer;width:120px}.resource-column.selected[_ngcontent-%COMP%]{border:1px solid gold;margin:0 20px}.resource-card[_ngcontent-%COMP%]{text-align:center;margin:10px}"]});let i=e;return i})();var bl=(()=>{let e=class e extends te{constructor(t,n,o){super(),this.players=t,this.apiProvider=n,this.events=o}ngOnInit(){let n=this.data.struct.generator?.generateReward?.();n&&(this.reward=n,this.description=n.description)}closePopup(){this.reward.onAccept({playersApi:this.apiProvider.getPlayerApi(),spellsApi:this.apiProvider.getSpellsApi(),visitingPlayer:this.players.getCurrentPlayer()});let t=this.data.struct.actionPoints;t&&this.events.dispatch(Wt({points:t})),this.close()}};e.\u0275fac=function(n){return new(n||e)(y(k),y(pi),y(z))},e.\u0275cmp=v({type:e,selectors:[["mw-scripted-reward-popup"]],features:[j],decls:9,vars:1,consts:[["popupHeader",""],["popupContent",""],[2,"padding","10px 8px"],["popupButtons",""],["mw-main-button","",3,"click"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2," Victory! "),c(),a(3,"div",1)(4,"div",2),d(5),c()(),a(6,"div",3)(7,"button",4),S("click",function(){return o.closePopup()}),d(8,"Continue"),c()()()),n&2&&(l(5),H(o.description))},dependencies:[ae,ue]});let i=e;return i})();var gy=i=>({thisStruct:i});function yy(i,e){if(i&1&&(a(0,"div",8),h(1,"mw-description",9),c()),i&2){let r,t=m();l(),u("descriptions",t.data.struct.generator==null||(r=t.data.struct.generator.description(Ue(1,gy,t.data.struct)))==null?null:r.descriptions)}}function vy(i,e){if(i&1&&(a(0,"div",14)(1,"div"),d(2),c(),a(3,"div"),d(4),c()()),i&2){let r=e.$implicit;l(2),H(r.key),l(2),H(r.value)}}function Cy(i,e){if(i&1){let r=R();a(0,"div",10)(1,"div"),d(2),c(),a(3,"div"),d(4,"to"),c(),a(5,"div"),d(6),re(7,"entity"),c(),a(8,"input",11),S("input",function(n){let o=E(r).$implicit,s=m();return I(s.updateCountForGroup(o,n))}),c(),a(9,"div"),d(10,"Cost:"),c(),a(11,"div",12),g(12,vy,5,2,"div",13),re(13,"keyvalue"),c()()}if(i&2){let r=e.$implicit;l(2),me("",r.originalGroup.count," ",r.originalGroup.type.name,""),l(4),me("",r.count," ",oe(7,8,r.hire.unitTypeId).name,""),l(2),u("min",0)("max",r.hire.maxCount)("value",0),l(4),u("ngForOf",oe(13,10,r.currentCost))}}var _l=(()=>{let e=class e extends te{constructor(t,n,o){super(),this.apiProvider=t,this.playersService=n,this.unitGroups=o,this.canConfirm=!0}ngOnInit(){this.hiredGroups=this.data.struct.reward.getUnits(this.apiProvider.getPlayerApi()).map(t=>{let n={},o={},s=t.type.upgradeDetails?.upgradeCost;return[ye.Gems,ye.Gold,ye.RedCrystals,ye.Wood].forEach(f=>{s[f]&&(n[f]=s[f],o[f]=0)}),{hire:{maxCount:t.count,unitTypeId:t.type.upgradeDetails?.target},count:0,baseCost:n,currentCost:o,originalGroup:t}})}updateCountForGroup(t,n){t.count=Number(n.target.value);let o=this.playersService.getCurrentPlayer().resources;this.canConfirm=!0,Object.entries(t.baseCost).forEach(([s,p])=>{t.currentCost[s]=p*t.count}),this.updateCanConfirm()}cancel(){this.close()}confirmHire(){let t=this.playersService.getCurrentPlayer(),n=t.resources,o=this.calcTotalCosts();Object.entries(o).forEach(([s,p])=>{n[s]-=p}),this.hiredGroups.forEach(s=>{if(s.count){this.playersService.removeNUnitsFromGroup(t,s.originalGroup,s.count);let p=this.unitGroups.createUnitGroup(s.hire.unitTypeId,{count:s.count},t.hero);this.playersService.addUnitGroupToTypeStack(t,p)}}),this.close()}calcTotalCosts(){return this.hiredGroups.reduce((t,n)=>(Object.entries(n.currentCost).forEach(([o,s])=>{let p=o;t[p]?t[p]+=n.currentCost[p]:t[p]=n.currentCost[p]}),t),{})}updateCanConfirm(){let t=this.playersService.getCurrentPlayer().resources,n=this.calcTotalCosts();this.canConfirm=Object.entries(n).every(([o,s])=>t[o]>=s)}};e.\u0275fac=function(n){return new(n||e)(y(pi),y(k),y(ke))},e.\u0275cmp=v({type:e,selectors:[["mw-upgrade-reward-popup"]],features:[j],decls:12,vars:4,consts:[["popupHeader",""],["popupContent",""],["class","description",4,"ngIf"],[1,"units"],["class","unit-column",4,"ngFor","ngForOf"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],["mw-main-button","",3,"click"],[1,"description"],[3,"descriptions"],[1,"unit-column"],["type","range",3,"input","min","max","value"],[1,"cost"],["class","resource",4,"ngFor","ngForOf"],[1,"resource"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2),c(),a(3,"div",1),g(4,yy,2,3,"div",2),a(5,"div",3),g(6,Cy,14,12,"div",4),c()(),a(7,"div",5)(8,"button",6),S("click",function(){return o.confirmHire()}),d(9," Confirm "),c(),a(10,"button",7),S("click",function(){return o.cancel()}),d(11," Cancel "),c()()()),n&2&&(l(2),M(" ",o.data.struct.generator==null?null:o.data.struct.generator.name," "),l(2),u("ngIf",o.data.struct.generator==null?null:o.data.struct.generator.description),l(2),u("ngForOf",o.hiredGroups),l(2),u("disabled",!o.canConfirm))},dependencies:[q,se,Xt,ae,ue,ni,Jr],styles:[".units[_ngcontent-%COMP%]{display:flex;justify-content:center}.description[_ngcontent-%COMP%]{text-align:center;font-size:13px;padding:7px}.unit-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid gray;padding:10px;margin:6px;width:160px;align-items:center;font-size:13px}.cost[_ngcontent-%COMP%]{display:flex}.resource[_ngcontent-%COMP%]{border:1px solid gray;border-radius:4px;padding:7px}"]});let i=e;return i})();var xr=(()=>{let e=class e{constructor(t,n){this.hostElem=t,this.renderer=n,this.hideEmpty=!0,this.renderer.addClass(this.hostElem.nativeElement,"mod-text")}ngOnDestroy(){this.renderer.removeClass(this.hostElem.nativeElement,"mod-text")}ngOnChanges(){let t=this.hostElem.nativeElement;if(this.hideEmpty&&!this.value){t.innerHTML="";return}if(typeof this.value!="number"){t.innerHTML="";return}t.innerHTML=(this.value>0?"+":"")+this.value,this.renderer.setStyle(t,"color",this.value<0?"red":"lime")}};e.\u0275fac=function(n){return new(n||e)(y(ht),y(je))},e.\u0275dir=Le({type:e,selectors:[["","mwNumberModifier",""]],inputs:{value:[0,"mwNumberModifier","value"],hideEmpty:"hideEmpty"},features:[ji]});let i=e;return i})();var pm=(i,e)=>({color:i,background:e});function Sy(i,e){if(i&1&&(a(0,"div",5)(1,"div",6)(2,"div",7),h(3,"mw-ra-icon",3),c(),a(4,"div",8)(5,"div",9),d(6),c(),a(7,"div",10),d(8),c(),a(9,"div",10),d(10),c()()(),a(11,"div",11),h(12,"mw-spell-description",12),c()()),i&2){let r=m();l(2),u("ngStyle",$t(8,pm,r.uiSpellIcon().iconClr,r.uiSpellIcon().bgClr)),l(),u("icon",r.uiSpellIcon().icon),l(3),H(r.spell().name),l(2),M("Level: ",r.spell().currentLevel,""),l(2),M("Mana Cost: ",r.spell().currentManaCost,""),l(2),u("spell",r.spell())("player",r.player())("hero",r.hero())}}var ys=(()=>{let e=class e{constructor(){this.spell=Z.required(),this.player=Z.required(),this.hero=Z.required(),this.onCooldown=Z(!1),this.disabled=Z(!1),this.isActive=Z(!1),this.hintPos=Z("above"),this.clicked=Xl(),this.isCurrentSpell=Te(()=>this.isActive()&&this.spell().baseType.activationType===this.activationTypes.Target),this.uiSpellIcon=Te(()=>this.spell().baseType.icon),this.activationTypes=A}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-spell-button"]],inputs:{spell:[1,"spell"],player:[1,"player"],hero:[1,"hero"],onCooldown:[1,"onCooldown"],disabled:[1,"disabled"],isActive:[1,"isActive"],hintPos:[1,"hintPos"]},outputs:{clicked:"clicked"},decls:6,vars:13,consts:[["hint",""],[3,"hintBody","hintPos"],[1,"ability","spell-icon",3,"click","ngStyle"],[3,"icon"],[1,"ra","light"],[2,"min-width","170px","max-width","200px"],[2,"display","flex"],[1,"tooltip-icon",3,"ngStyle"],[2,"padding","4px"],[2,"font-size","14px"],[2,"font-size","12px"],[2,"font-size","12px","padding","4px"],[3,"spell","player","hero"]],template:function(n,o){if(n&1){let s=R();a(0,"mw-hover-hint",1)(1,"div",2),S("click",function(){return E(s),I(o.clicked.emit(o.spell()))}),h(2,"mw-ra-icon",3)(3,"i",4),c(),g(4,Sy,13,11,"ng-template",null,0,Q),c()}if(n&2){let s=ne(5);u("hintBody",s)("hintPos",o.hintPos()),l(),de("disabled",o.disabled())("current-ability",o.isCurrentSpell()),u("ngStyle",$t(10,pm,o.uiSpellIcon().iconClr,o.uiSpellIcon().bgClr)),l(),u("icon",o.uiSpellIcon().icon),l(),an("ra-"+o.uiSpellIcon().icon)}},styles:["[_nghost-%COMP%]{display:block;max-width:56px}.ability[_ngcontent-%COMP%]{width:48px;height:42px;border:1px solid gray;font-size:13px;display:flex;justify-content:center;align-items:center;border-radius:4px;margin:4px;cursor:pointer}.current-ability[_ngcontent-%COMP%]{border:1px solid gold}.disabled[_ngcontent-%COMP%]{cursor:not-allowed;opacity:.5}.spell-icon[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;font-size:42px;overflow:hidden}.tooltip-icon[_ngcontent-%COMP%]{height:32px;width:32px;overflow:hidden;font-size:28px;display:flex;align-items:center;justify-content:center}.light[_ngcontent-%COMP%]{position:absolute;mix-blend-mode:hard-light;filter:blur(4px);display:none}.ability[_ngcontent-%COMP%]:not(.no-mana):not(.disabled):hover   .light[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]:active   .spell-icon[_ngcontent-%COMP%], .spell-icon.current-ability[_ngcontent-%COMP%]{filter:brightness(.65)}"],changeDetection:0});let i=e;return i})();function xy(i,e){if(i&1&&h(0,"mw-item-slot",19),i&2){let r=e.$implicit;u("itemSlot",r)}}function by(i,e){if(i&1){let r=R();a(0,"div",22),S("mwNoContextMenu",function(){E(r);let n=m().$implicit,o=m(2);return I(o.splitGroup(n))})("click",function(){E(r);let n=m().$implicit,o=m(2);return I(o.clickOnSlot(n))}),a(1,"span"),d(2),c(),a(3,"span"),d(4),c()()}if(i&2){let r=m().$implicit,t=m(2);$("background",r.unitGroup.ownerPlayer.color),de("active",r===t.activeGroupSlot),l(2),H(r.unitGroup.type.name),l(2),H(r.unitGroup.count)}}function _y(i,e){if(i&1){let r=R();a(0,"div",22),S("mwNoContextMenu",function(){E(r);let n=m().$implicit,o=m(2);return I(o.splitGroup(n))})("click",function(){E(r);let n=m().$implicit,o=m(2);return I(o.clickOnSlot(n))}),c()}}function My(i,e){if(i&1&&g(0,by,5,6,"div",20)(1,_y,1,0,"div",21),i&2){let r=e.$implicit;Oe(r.unitGroup?0:1)}}function Py(i,e){if(i&1){let r=R();a(0,"div",25),S("mwNoContextMenu",function(){E(r);let n=m().$implicit,o=m(2);return I(o.splitGroup(n))})("click",function(){E(r);let n=m().$implicit,o=m(2);return I(o.clickOnSlot(n))}),a(1,"span"),d(2),c(),a(3,"span"),d(4),c()()}if(i&2){let r=m().$implicit,t=m(2);$("background",r.unitGroup.ownerPlayer.color),de("active",r===t.activeGroupSlot),l(2),H(r.unitGroup.type.name),l(2),H(r.unitGroup.count)}}function Dy(i,e){if(i&1){let r=R();a(0,"div",25),S("mwNoContextMenu",function(){E(r);let n=m().$implicit,o=m(2);return I(o.splitGroup(n))})("click",function(){E(r);let n=m().$implicit,o=m(2);return I(o.clickOnSlot(n))}),c()}}function Ey(i,e){if(i&1&&g(0,Py,5,6,"div",23)(1,Dy,1,0,"div",24),i&2){let r=e.$implicit;Oe(r.unitGroup?0:1)}}function Iy(i,e){if(i&1&&(a(0,"div")(1,"div"),d(2),c()()),i&2){let r=e.$implicit;l(2),H(r)}}function Ty(i,e){if(i&1&&(ve(0),g(1,Iy,3,1,"div",27),Ce()),i&2){let r=m().ngIf;l(),u("ngForOf",r)}}function Fy(i,e){i&1&&(a(0,"div"),d(1,"No specialties"),c())}function Ay(i,e){if(i&1&&(ve(0),g(1,Ty,2,1,"ng-container",26)(2,Fy,2,0,"ng-template",null,0,Q),Ce()),i&2){let r=e.ngIf,t=ne(3);l(),u("ngIf",r.length)("ngIfElse",t)}}function Oy(i,e){if(i&1&&(a(0,"div",16),h(1,"mw-spell-button",28),a(2,"div",29),d(3),c()()),i&2){let r=e.$implicit,t=m(2);l(),u("spell",r)("player",t.currentPlayer)("hero",t.currentPlayer.hero),l(2),M(" ",r.baseType.name," ")}}function ky(i,e){if(i&1&&(ve(0),a(1,"div",5)(2,"div",6)(3,"div"),d(4," Your items: "),c(),a(5,"div",7),g(6,xy,1,1,"mw-item-slot",8),c()(),a(7,"div",9)(8,"div"),d(9),c(),a(10,"div"),d(11),c(),h(12,"mw-experience-bar",10),a(13,"div",11),ut(14,My,2,1,null,null,Tt),c(),d(16," Reserve: "),a(17,"div",11),ut(18,Ey,2,1,null,null,Tt),c()()(),a(20,"div",12)(21,"div"),d(22,"Resistances:"),c(),a(23,"div"),d(24," Fire: "),h(25,"span",13),c(),a(26,"div"),d(27," Cold: "),h(28,"span",13),c(),a(29,"div"),d(30," Lightning: "),h(31,"span",13),c(),a(32,"div"),d(33," Poison: "),h(34,"span",13),c(),h(35,"hr"),a(36,"div",14),d(37," Specialties: "),g(38,Ay,4,2,"ng-container",2),re(39,"async"),c(),h(40,"hr"),a(41,"div",15),d(42,"Spells:"),c(),a(43,"div",16)(44,"div",17),g(45,Oy,4,4,"div",18),c()()(),Ce()),i&2){let r=e.ngIf,t=m();l(6),u("ngForOf",t.itemSlots),l(3),H(t.hero.base.name),l(2),M("Level ",t.hero.level,""),l(3),dt(t.hero.mainUnitSlots),l(4),dt(t.hero.reserveUnitSlots),l(7),u("mwNumberModifier",r.fireResist)("hideEmpty",!1),l(3),u("mwNumberModifier",r.coldResist)("hideEmpty",!1),l(3),u("mwNumberModifier",r.lightningResist)("hideEmpty",!1),l(3),u("mwNumberModifier",r.poisonResist)("hideEmpty",!1),l(4),u("ngIf",oe(39,13,t.heroSpecialties$)),l(7),u("ngForOf",t.currentPlayer.hero.spells)}}var Ml=(()=>{let e=class e extends te{constructor(t,n,o,s){super(),this.playersService=t,this.state=n,this.curPlayerState=o,this.events=s,this.currentPlayer=this.playersService.getCurrentPlayer(),this.hero=this.currentPlayer.hero,this.heroStats$=this.hero.listenHeroStats(),this.itemSlots=Qt.getSlotTypes(),this.heroSpecialties$=this.hero.specialtiesModGroup.onValueChanges().pipe(Li(p=>Ep(p).filter(([,f])=>f).map(([f,C])=>`${Mp[f]}: ${C}`)))}splitGroup(t){this.activeGroupSlot=void 0,!(!t.unitGroup||t.unitGroup.count===1)&&this.hero.hasFreeUnitSlots()&&this.events.dispatch(Mo({unitGroup:t.unitGroup}))}clickOnSlot(t){if(!this.activeGroupSlot){t.unitGroup&&(this.activeGroupSlot=t);return}if(this.activeGroupSlot){if(this.activeGroupSlot===t){this.activeGroupSlot=void 0;return}if(t.unitGroup){if(t.unitGroup.type===this.activeGroupSlot.unitGroup?.type){this.events.dispatch(Po({sourceSlot:this.activeGroupSlot,targetSlot:t,postAction:()=>{this.activeGroupSlot=void 0,this.hero.refreshUnitGroupsOrderBySlots()}}));return}wa(this.activeGroupSlot,t),this.activeGroupSlot=void 0}else{let n=this.hero.mainUnitSlots.filter(o=>o.unitGroup).length;if(!this.activeGroupSlot.isReserve&&t.isReserve&&n===1){this.activeGroupSlot=void 0;return}t.unitGroup=this.activeGroupSlot.unitGroup,this.activeGroupSlot.unitGroup=null,this.activeGroupSlot=void 0}this.hero.refreshUnitGroupsOrderBySlots()}}};e.\u0275fac=function(n){return new(n||e)(y(k),y(J),y(We),y(z))},e.\u0275cmp=v({type:e,selectors:[["mw-hero-popup"]],features:[j],decls:7,vars:3,consts:[["noSpecialties",""],["popupContent",""],[4,"ngIf"],["popupButtons","",2,"justify-content","end"],["mw-main-button","",3,"click"],[1,"hero-panel"],[1,"items"],[2,"display","flex","flex-direction","column"],[3,"itemSlot",4,"ngFor","ngForOf"],[1,"info"],[2,"width","270px"],[1,"unit-groups-slots"],[1,"stats-panel"],[3,"mwNumberModifier","hideEmpty"],[1,"specialties"],[2,"margin-bottom","5px","text-align","center"],[2,"display","flex","flex-direction","column","align-items","center"],[2,"display","flex","flex-wrap","wrap","justify-content","center","gap","4px"],["style","display: flex; flex-direction: column; align-items: center;",4,"ngFor","ngForOf"],[3,"itemSlot"],[1,"unit-slot",3,"active","background"],[1,"unit-slot"],[1,"unit-slot",3,"mwNoContextMenu","click"],[1,"unit-slot","reserve",3,"active","background"],[1,"unit-slot","reserve"],[1,"unit-slot","reserve",3,"mwNoContextMenu","click"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],[3,"spell","player","hero"],[2,"font-size","10px","text-align","center"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",1),g(2,ky,46,15,"ng-container",2),re(3,"async"),c(),a(4,"div",3)(5,"button",4),S("click",function(){return o.close()}),d(6," Close "),c()()()),n&2&&(l(2),u("ngIf",oe(3,1,o.heroStats$)))},dependencies:[xr,Oi,ai,ae,ue,ss,q,se,ys,yi],styles:[".buttons[_ngcontent-%COMP%]{margin-top:16px;display:flex;justify-content:flex-end}[_nghost-%COMP%]{width:500px}.hero-panel[_ngcontent-%COMP%]{text-align:left;display:flex}.items[_ngcontent-%COMP%]{margin-right:16px;font-size:10px}.info[_ngcontent-%COMP%]{font-size:12px}.unit-groups-slots[_ngcontent-%COMP%]{display:flex;padding-top:6px;gap:4px;text-align:center}.unit-groups-slots[_ngcontent-%COMP%]   .unit-slot[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;flex-direction:column;cursor:pointer;width:52px;height:52px;border:1px solid gray;box-sizing:border-box;border-radius:4px;-webkit-user-select:none;user-select:none}.unit-groups-slots[_ngcontent-%COMP%]   .unit-slot.reserve[_ngcontent-%COMP%]{width:40px;height:40px;font-size:10px;filter:brightness(.8)}.unit-groups-slots[_ngcontent-%COMP%]   .unit-slot.active[_ngcontent-%COMP%]{border-color:gold;border-width:2px}.stats-panel[_ngcontent-%COMP%]{position:absolute;right:-160px;box-sizing:border-box;top:0;background:#fff;font-size:13px;padding:6px 8px;width:150px}"]});let i=e;return i})();var Aa=(()=>{let e=class e{constructor(){this.imgSrc=Z.required(),this.gradientClr=Z.required(),this.bgGradient=Te(()=>`
    linear-gradient(
      90deg,
      ${this.gradientClr()} 0%,
      rgba(33, 33, 33, 0.272233893557423) 5%,
      rgba(255, 255, 255, 0) 50%,
      rgba(32, 32, 32, 0.1966036414565826) 95%,
      ${this.gradientClr()} 100%
    )`)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-gradient-img"]],inputs:{imgSrc:[1,"imgSrc"],gradientClr:[1,"gradientClr"]},decls:2,vars:3,consts:[[3,"src"],[1,"gradient"]],template:function(n,o){n&1&&h(0,"img",0)(1,"div",1),n&2&&(u("src",o.imgSrc(),Fr),l(),$("background",o.bgGradient()))},styles:["[_nghost-%COMP%]{display:block;position:relative}img[_ngcontent-%COMP%]{width:inherit;height:inherit}.gradient[_ngcontent-%COMP%]{width:inherit;height:inherit;position:absolute;inset:0}"]});let i=e;return i})();var um=(()=>{let e=class e{constructor(t){this.events=t}openNewGameScreen(){this.events.dispatch(ko())}openSettings(){this.events.dispatch(Wn())}};e.\u0275fac=function(n){return new(n||e)(y(z))},e.\u0275cmp=v({type:e,selectors:[["mw-main-screen"]],decls:9,vars:0,consts:[[1,"backdrop"],["gradientClr","rgb(12,12,12)","imgSrc","assets/background/serpent.jpg"],[1,"block"],["mw-main-button","",3,"click"]],template:function(n,o){n&1&&(h(0,"div",0)(1,"mw-gradient-img",1),a(2,"div",2),d(3," Mirrorwalk "),a(4,"div")(5,"button",3),S("click",function(){return o.openNewGameScreen()}),d(6,"New Game"),c(),a(7,"button",3),S("click",function(){return o.openSettings()}),d(8,"Settings"),c()()())},dependencies:[Aa,ae],styles:["[_nghost-%COMP%]{display:block;position:relative}.backdrop[_ngcontent-%COMP%]{background:#0b0b0b;width:100vw;height:100vh;position:fixed}mw-gradient-img[_ngcontent-%COMP%]{width:1200px;left:5%}.block[_ngcontent-%COMP%]{position:fixed;right:0;bottom:0;width:250px;height:200px;padding:20px}[mw-main-button][_ngcontent-%COMP%]{width:100%}"]});let i=e;return i})();function Uy(i,e){if(i&1){let r=R();ve(0),a(1,"div")(2,"input",5),S("click",function(){let n=E(r).$implicit,o=m();return I(o.setOrientation(n.value))}),c(),a(3,"label",6),d(4),c()(),Ce()}if(i&2){let r=e.$implicit,t=m();l(2),u("id","orient-"+r.value)("value",r.value)("checked",t.settings.orientation===r.value),l(),u("for","orient-"+r.value),l(),H(r.label)}}var dm=(()=>{let e=class e extends te{constructor(t){super(),this.state=t,this.orientation=cn,this.orientationOptions=[{label:"Vertical",value:cn.Vertical},{label:"Horizontal",value:cn.Horizontal}],this.settings=this.state.settings}setOrientation(t){this.state.settings.orientation=t}loadScript(){import("./chunk-7WEGSRBZ.js").then(t=>{console.log("loaded script successfully!",t)})}loadScriptByPath(){var t=document.createElement("input");t.type="file",t.multiple=!0,t.onchange=n=>{var o=n.target.files[0];console.log(o);var s=new FileReader;s.readAsText(o),s.onload=p=>{var f=p.target.result;console.log(f);var C=document.createElement("script");C.innerHTML=f,C.setAttribute("type","module"),document.head.appendChild(C)}},t.click()}};e.\u0275fac=function(n){return new(n||e)(y(J))},e.\u0275cmp=v({type:e,selectors:[["mw-settings-popup"]],features:[j],decls:12,vars:1,consts:[["popupHeader",""],["popupContent",""],[4,"ngFor","ngForOf"],["mw-main-button","",3,"click"],["popupButtons",""],["type","radio","name","orientation",3,"click","id","value","checked"],[3,"for"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2," Units Orientation "),c(),a(3,"div",1),g(4,Uy,5,5,"ng-container",2),a(5,"button",3),S("click",function(){return o.loadScriptByPath()}),d(6," Load Script By Path "),c(),a(7,"button",3),S("click",function(){return o.loadScript()}),d(8," Load Mod "),c()(),a(9,"div",4)(10,"button",3),S("click",function(){return o.close()}),d(11," Close "),c()()()),n&2&&(l(4),u("ngForOf",o.orientationOptions))},dependencies:[q,ae,ue]});let i=e;return i})();function By(i,e){if(i&1&&(a(0,"span"),d(1," ("),a(2,"span",9),d(3),c(),d(4,") "),c()),i&2){let r=m().$implicit,t=m();l(3),M("-",t.missingCostMap[r.type],"")}}function Hy(i,e){if(i&1&&(a(0,"div"),d(1),g(2,By,5,1,"span",5),c()),i&2){let r=e.$implicit,t=m();l(),me(" ",r.count," ",r.resName," "),l(),u("ngIf",t.missingCostMap[r.type])}}function Ly(i,e){i&1&&(a(0,"div"),d(1," You don't have enough resources. "),c())}var vs=(()=>{let e=class e extends te{constructor(t,n,o){super(),this.players=t,this.events=n,this.state=o;let s=this.data.building;this.buildingLevel=s.base.levels[this.data.targetLevel-1];let p=this.getBuildingCost();this.cost=ia(p),this.missingCostMap=this.players.getMissingResources(this.players.getCurrentPlayer(),p),this.canBuild=this.players.playerHasResources(this.players.getCurrentPlayer(),p)}build(){let t=this.data.building;this.data.targetLevel===1?t.built=!0:(t.currentLevel=this.data.targetLevel-1,t.currentBuilding=t.base.levels[this.data.targetLevel-1].building),this.events.dispatch(Ho({building:t,player:this.players.getCurrentPlayer()})),this.players.removeResourcesFromPlayer(this.players.getCurrentPlayer(),this.getBuildingCost()),this.state.eventHandlers.buildings.triggerRefEventHandlers(this.data.building,hs.Built()),this.close()}getBuildingCost(){return this.buildingLevel.cost}};e.\u0275fac=function(n){return new(n||e)(y(k),y(z),y(J))},e.\u0275cmp=v({type:e,selectors:[["mw-build-popup"]],features:[j],decls:15,vars:7,consts:[["popupHeader",""],[2,"display","block","font-size","40px","margin","8px 0",3,"icon"],["popupContent",""],[2,"padding-bottom","8px"],[4,"ngFor","ngForOf"],[4,"ngIf"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],["mw-main-button","",3,"click"],[2,"color","red"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2),h(3,"mw-ra-icon",1),c(),a(4,"div",2)(5,"div",3),d(6),c(),a(7,"div"),g(8,Hy,3,3,"div",4),c(),g(9,Ly,2,0,"div",5),c(),a(10,"div",6)(11,"button",7),S("click",function(){return o.build()}),d(12,"Build"),c(),a(13,"button",8),S("click",function(){return o.close()}),d(14,"Close"),c()()()),n&2&&(l(2),me(" Build: ",o.data.building.currentBuilding.name,", level ",o.data.targetLevel," "),l(),u("icon",o.data.building.base.icon),l(3),M(" ",o.buildingLevel.building.description," "),l(2),u("ngForOf",o.cost),l(),u("ngIf",!o.canBuild),l(2),u("disabled",!o.canBuild))},dependencies:[q,se,le,ae,ue],styles:["[_nghost-%COMP%]{text-align:center;display:flex;flex-direction:column;font-size:14px;color:wheat}[popupButtons][_ngcontent-%COMP%]{padding-top:8px}"]});let i=e;return i})();function Ny(i,e){if(i&1&&(a(0,"span"),d(1),c()),i&2){let r=e.$implicit;l(),me("",r.key,": ",r.value,"")}}var eo=(()=>{let e=class e{constructor(){this.capitalize=!0}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-resources-cost"]],hostVars:2,hostBindings:function(n,o){n&2&&de("capitalize",o.capitalize)},inputs:{cost:"cost",capitalize:"capitalize"},decls:3,vars:2,template:function(n,o){n&1&&(ut(0,Ny,2,2,"span",null,Tt),re(2,"keyvalue")),n&2&&dt(oe(2,0,o.cost))},dependencies:[ni],styles:[".capitalize[_nghost-%COMP%]{text-transform:capitalize}"]});let i=e;return i})();function jy(i,e){if(i&1){let r=R();a(0,"div",12),S("click",function(){let n=E(r).$implicit,o=m().$implicit,s=m();return I(s.selectItem(n,o.value))}),h(1,"mw-unit-group-preview",13)(2,"hr")(3,"mw-resources-cost",14),c()}if(i&2){let r=e.$implicit,t=m(2);de("selected",t.selectedGroup===r),l(),u("unitType",r.type)("count",r.count),l(2),u("cost",r.cost)}}function $y(i,e){if(i&1&&(a(0,"div",8)(1,"div",9),d(2),c(),a(3,"div",10),ut(4,jy,4,5,"div",11,Tt),c()()),i&2){let r=e.$implicit;l(2),H(r.value.name),l(2),dt(r.value.groups)}}function Vy(i,e){i&1&&(a(0,"span"),d(1,"You don't have enough resources"),c())}var Pl=(()=>{let e=class e extends te{constructor(){super(...arguments),this.players=L(k),this.unitsService=L(ke),this.events=L(z),this.currentPlayer=this.players.getCurrentPlayer(),this.canHire=!0}selectItem(t,n){this.selectedGroup=t,this.selectedGarrison=n,this.canHire=this.players.playerHasResources(this.currentPlayer,t.cost)}hire(){if(!this.selectedGroup||!this.selectedGarrison||!this.canHire)return;let t=this.selectedGroup;V.removeItem(this.selectedGarrison.groups,t),this.players.removeResourcesFromPlayer(this.currentPlayer,t.cost);let n=this.unitsService.createUnitGroup(t.type.id,{count:t.count},this.currentPlayer.hero);this.players.addUnitGroupToTypeStack(this.currentPlayer,n),this.events.dispatch(Si({message:`${t.count} ${t.type.name} joined your army for 3 days.`})),this.events.dispatch(Vn({action:()=>{let o=this.players.removeUnitTypeCountFromPlayer(this.currentPlayer,t.type.id,t.count);o&&this.events.dispatch(Si({message:`${o} ${t.type.name} have left your army.`}))},dayOffset:3})),this.selectedGarrison=void 0,this.selectedGroup=void 0}};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=ft(e)))(o||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-garrison-popup"]],features:[j],decls:18,vars:5,consts:[["popupHeader",""],["popupContent",""],[1,"sub-info"],["class","hiring-section",4,"ngFor","ngForOf"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],["icon","guarded-tower"],["mw-main-button","",3,"click"],[1,"hiring-section"],[1,"header"],[1,"groups"],[1,"group",3,"selected"],[1,"group",3,"click"],[3,"unitType","count"],[3,"cost"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2,"Garrison"),c(),a(3,"div",1)(4,"div",2)(5,"p"),d(6,"Hire units temporarily (3 days) for reduced cost."),c(),a(7,"p"),d(8,"Garrison is reset each week."),c()(),g(9,$y,6,1,"div",3),re(10,"keyvalue"),g(11,Vy,2,0,"span"),c(),a(12,"div",4)(13,"button",5),S("click",function(){return o.hire()}),h(14,"mw-ra-icon",6),d(15," Hire "),c(),a(16,"button",7),S("click",function(){return o.close()}),d(17," Leave "),c()()()),n&2&&(l(9),u("ngForOf",oe(10,3,o.currentPlayer.garrisons)),l(2),Oe(o.canHire?-1:11),l(2),u("disabled",!o.selectedGroup||!o.canHire))},dependencies:[q,eo,Ea,le,ae,ue,ni],styles:[".hiring-section[_ngcontent-%COMP%]{padding-top:8px}.groups[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:8px}.groups[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]{width:70px;font-size:13px;padding:3px 4px;-webkit-user-select:none;user-select:none;border:1px solid black;cursor:pointer}.groups[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]   .group-name[_ngcontent-%COMP%]{padding-bottom:4px}.groups[_ngcontent-%COMP%]   .group.selected[_ngcontent-%COMP%]{border:1px solid gold}[popupButtons][_ngcontent-%COMP%]{padding-top:8px}"]});let i=e;return i})();function zy(i,e){if(i&1){let r=R();a(0,"div",4),S("click",function(){E(r);let n=m();return I(n.setMode("upgrade"))}),d(1),c()}if(i&2){let r=m();de("active",r.currentMode==="upgrade"),l(),M(" Upgrade: ",r.countToUpgrade-r.plannedToUpgrade," ")}}function Wy(i,e){if(i&1&&(a(0,"div",16)(1,"div"),d(2),c(),a(3,"div"),d(4),c()()),i&2){let r=e.$implicit;l(2),H(r.key),l(2),H(r.value)}}function qy(i,e){if(i&1){let r=R();a(0,"div",12)(1,"div"),d(2),c(),a(3,"div"),d(4),c(),a(5,"input",13),S("input",function(n){let o=E(r).$implicit,s=m();return I(s.updateCountForGroup(o,n))}),c(),a(6,"div"),d(7,"Cost:"),c(),a(8,"div",14),g(9,Wy,5,2,"div",15),re(10,"keyvalue"),c()()}if(i&2){let r=e.$implicit;l(2),H(r.hire.unitType.name),l(2),H(r.count),l(),u("min",0)("max",r.hire.maxCount)("value",0),l(4),u("ngForOf",oe(10,6,r.currentCost))}}function Yy(i,e){if(i&1){let r=R();a(0,"button",17),S("click",function(){E(r);let n=m();return I(n.upgradeBuilding())}),d(1," Upgrade Building "),c()}}var Dl=(()=>{let e=class e extends te{constructor(t,n,o,s){super(),this.playersService=t,this.unitsService=n,this.popupService=o,this.gameObjectsManager=s,this.hirableGroups=[],this.canConfirm=!0,this.plannedToHire=0,this.plannedToUpgrade=0,this.currentMode="hire",this.unitType=qt(this.data.hiringActivity.hiring.unitTypeId),this.activity=this.data.hiringActivity,this.currentBuilding=this.data.building.currentBuilding,this.canBeUpgraded=this.data.building.base.levels.length-1>this.data.building.currentLevel}ngOnInit(){console.log(this.data);let t=this.data.building.currentBuilding.activity;this.originalCountToHire=this.data.town.unitsAvailableMap[t.unitGrowthGroup],this.countToHire=this.originalCountToHire,this.activity.upgrade&&(this.countToUpgrade=this.playersService.getPlayerUnitsCountOfType(this.playersService.getCurrentPlayer(),this.activity.hiring.unitTypeId)),this.hirableGroups=this.getGroupsToHire().map(n=>{let o={},s={},p=qt(n.unitTypeId).baseRequirements;return[ye.Gems,ye.Gold,ye.RedCrystals,ye.Wood].forEach(C=>{p[C]&&(o[C]=p[C],s[C]=0)}),{hire:{maxCount:this.data.town.unitsAvailableMap[t.unitGrowthGroup],unitType:qt(n.unitTypeId)},count:0,baseCost:o,currentCost:s}})}setMode(t){if(this.currentMode===t)return;t==="hire"?this.plannedToUpgrade=0:this.plannedToHire=0,this.currentMode=t;let n=this.data.building.currentBuilding.activity;this.hirableGroups=this.getGroupsToHire().map(o=>{let s={},p={},f=qt(this.activity.hiring.unitTypeId),C=this.currentMode==="hire"?qt(o.unitTypeId).baseRequirements:f.upgradeDetails.upgradeCost;return[ye.Gems,ye.Gold,ye.RedCrystals,ye.Wood].forEach(T=>{C[T]&&(s[T]=C[T],p[T]=0)}),{hire:{maxCount:this.currentMode==="hire"?this.data.town.unitsAvailableMap[n.unitGrowthGroup]:this.countToUpgrade,unitType:qt(o.unitTypeId)},count:0,baseCost:s,currentCost:p}})}getGroupsToHire(){let t=this.data.building.currentBuilding.activity,n=qt(t.hiring.unitTypeId);return this.currentMode==="hire"?t.upgrade?[t.hiring,...n.upgradeDetails?.target?[{growth:0,unitTypeId:qt(t.hiring?.unitTypeId).upgradeDetails?.target}]:[]]:[t.hiring]:[...n.upgradeDetails?.target?[{growth:0,unitTypeId:n.upgradeDetails.target}]:[]]}updateCountForGroup(t,n){t.count=Number(n.target.value),this.canConfirm=!0,Object.entries(t.baseCost).forEach(([o,s])=>{t.currentCost[o]=s*t.count}),this.currentMode==="hire"?this.plannedToHire=this.hirableGroups.reduce((o,s)=>o+s.count,0):this.plannedToUpgrade=this.hirableGroups.reduce((o,s)=>o+s.count,0),this.updateCanConfirm()}confirmHire(){let t=this.playersService.getCurrentPlayer(),n=this.calcTotalCosts();this.playersService.removeResourcesFromPlayer(t,n),this.currentMode==="hire"?this.hirableGroups.forEach(o=>{if(o.count){let s=this.unitsService.createUnitGroup(o.hire.unitType.id,{count:o.count},t.hero),p=this.data.building.currentBuilding.activity;this.data.town.unitsAvailableMap[p.unitGrowthGroup]-=o.count,this.playersService.addUnitGroupToTypeStack(t,s)}}):this.hirableGroups.forEach(o=>{if(o.count){this.playersService.removeUnitTypeCountFromPlayer(t,this.activity.hiring.unitTypeId,o.count);let s=this.unitsService.createUnitGroup(o.hire.unitType.id,{count:o.count},t.hero);this.playersService.addUnitGroupToTypeStack(t,s)}}),this.close()}upgradeBuilding(){this.close(),this.popupService.createBasicPopup({component:vs,data:{building:this.data.building,targetLevel:2},class:"dark"})}calcTotalCosts(){return this.hirableGroups.reduce((t,n)=>(Object.entries(n.currentCost).forEach(([o,s])=>{let p=o;t[p]?t[p]+=n.currentCost[p]:t[p]=n.currentCost[p]}),t),{})}updateCanConfirm(){let t=this.calcTotalCosts();this.canConfirm=this.playersService.playerHasResources(this.playersService.getCurrentPlayer(),t)}};e.\u0275fac=function(n){return new(n||e)(y(k),y(ke),y(si),y(xe))},e.\u0275cmp=v({type:e,selectors:[["mw-hiring-popup"]],features:[j],decls:19,vars:9,consts:[["popupHeader",""],["popupContent",""],[1,"sub-info"],[2,"display","flex","justify-content","center"],[1,"type",3,"click"],["class","type",3,"active","click",4,"ngIf"],[1,"hiring-panel"],["class","unit-column",4,"ngFor","ngForOf"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],["mw-main-button","","style","font-size: 12px;",3,"click",4,"ngIf"],["mw-main-button","",3,"click"],[1,"unit-column"],["type","range",3,"input","min","max","value"],[1,"cost"],["class","resource",4,"ngFor","ngForOf"],[1,"resource"],["mw-main-button","",2,"font-size","12px",3,"click"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2),c(),a(3,"div",1)(4,"div",2)(5,"p"),d(6),c()(),a(7,"div",3)(8,"div",4),S("click",function(){return o.setMode("hire")}),d(9),c(),g(10,zy,2,3,"div",5),c(),a(11,"div",6),g(12,qy,11,8,"div",7),c()(),a(13,"div",8)(14,"button",9),S("click",function(){return o.confirmHire()}),d(15," Hire "),c(),g(16,Yy,2,0,"button",10),a(17,"button",11),S("click",function(){return o.close()}),d(18," Close "),c()()()),n&2&&(l(2),M(" ",o.currentBuilding.name," "),l(4),M(" Hire ",o.unitType.name," "),l(2),de("active",o.currentMode==="hire"),l(),M(" Hire: ",o.countToHire-o.plannedToHire," "),l(),u("ngIf",o.activity.upgrade),l(2),u("ngForOf",o.hirableGroups),l(2),u("disabled",!o.canConfirm||o.countToHire-o.plannedToHire<0),l(2),u("ngIf",o.canBeUpgraded))},dependencies:[q,se,ae,ue,ni],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center}.type[_ngcontent-%COMP%]{padding:8px;margin:4px;font-size:12px;border:1px solid black;cursor:pointer}.type.active[_ngcontent-%COMP%]{border:1px solid gold}.hiring-panel[_ngcontent-%COMP%]{display:flex;justify-content:center}.unit-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid gray;padding:10px;margin:6px;width:160px;align-items:center;font-size:13px}.cost[_ngcontent-%COMP%]{display:flex}.resource[_ngcontent-%COMP%]{border:1px solid gray;border-radius:4px;padding:7px}"]});let i=e;return i})();function Qy(i,e){if(i&1){let r=R();a(0,"div",8),S("click",function(){let n=E(r).$implicit,o=m();return I(o.itemToBuy.set(n))}),h(1,"mw-item-icon",9),d(2),h(3,"mw-resources-cost",10),c()}if(i&2){let r=e.$implicit,t=m();de("active",t.itemToBuy()===r),l(),u("itemBase",r),l(),M(" ",r.name," "),l(),u("cost",r.cost)}}function Ky(i,e){if(i&1){let r=R();a(0,"div",8),S("click",function(){let n=E(r).$implicit,o=m(2);return I(o.itemToSell.set(n))}),h(1,"mw-item-icon",9),d(2),h(3,"mw-resources-cost",10),c()}if(i&2){let r=e.$implicit,t=m(2);de("active",t.itemToSell()===r),l(),u("itemBase",r.baseType),l(),M(" ",r.baseType.name," "),l(),u("cost",r.baseType.sellingCost)}}function Zy(i,e){if(i&1&&(a(0,"div"),d(1,"Sell:"),c(),a(2,"div",2),ut(3,Ky,4,5,"div",3,Tt),c()),i&2){let r=m();l(3),dt(r.hero.itemsBackpack)}}function Xy(i,e){if(i&1){let r=R();a(0,"button",4),S("click",function(){E(r);let n=m();return I(n.sellItem())}),d(1," Sell "),c()}if(i&2){let r=m();u("disabled",!r.canSell())}}var El=(()=>{let e=class e extends te{constructor(){super(...arguments),this.players=L(k),this.itemsService=L(Ri),this.events=L(z),this.currentPlayer=this.players.getCurrentPlayer(),this.hero=this.currentPlayer.hero,this.sellingData=this.data.building.getCustomData(),this.items=xp(this.sellingData?.items),this.allowsSelling=this.sellingData?.selling,this.itemToBuy=Pi(null),this.itemToSell=Pi(null),this.canBuy=Te(()=>{let t=this.itemToBuy();return this.itemToSell(),!!t&&this.players.playerHasResources(this.currentPlayer,t.cost)}),this.canSell=Te(()=>!!this.itemToSell())}buyItem(){let t=this.itemToBuy(),n=this.itemsService.createItem(t);this.players.removeResourcesFromPlayer(this.currentPlayer,t.cost||{}),this.events.dispatch(Ci({item:n,player:this.currentPlayer})),V.removeItem(this.items,t),this.itemToBuy.set(null)}sellItem(){let t=this.itemToSell();this.players.addResourcesToPlayer(this.currentPlayer,t.baseType.sellingCost||{}),this.events.dispatch(jn({item:t,player:this.currentPlayer})),this.itemToSell.set(null)}};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=ft(e)))(o||e)}})(),e.\u0275cmp=v({type:e,selectors:[["mw-items-selling-popup"]],features:[j],decls:17,vars:3,consts:[["popupHeader",""],["popupContent",""],[1,"item-list"],[1,"item",3,"active"],["mw-main-button","",3,"click","disabled"],["popupButtons",""],["mw-main-button","",3,"disabled"],["mw-main-button","",3,"click"],[1,"item",3,"click"],[3,"itemBase"],[2,"display","flex","flex-direction","column",3,"cost"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0)(2,"div"),d(3,"Items Market"),c(),a(4,"div"),d(5,"Buy:"),c()(),a(6,"div",1)(7,"div",2),ut(8,Qy,4,5,"div",3,Tt),c(),a(10,"button",4),S("click",function(){return o.buyItem()}),d(11," Buy "),c(),g(12,Zy,5,0),c(),a(13,"div",5),g(14,Xy,2,1,"button",6),a(15,"button",7),S("click",function(){return o.popup.close()}),d(16," Close "),c()()()),n&2&&(l(8),dt(o.items),l(2),u("disabled",!o.canBuy()),l(2),Oe(o.allowsSelling?12:-1),l(2),Oe(o.allowsSelling?14:-1))},dependencies:[eo,ki,ae,ue],styles:[".item-list[_ngcontent-%COMP%]{display:flex;gap:8px;justify-content:center}.item[_ngcontent-%COMP%]{border:1px solid gray;border-radius:4px;padding:4px;font-size:13px;cursor:pointer;max-width:94px;display:flex;flex-direction:column;align-items:center;text-align:center}.item.active[_ngcontent-%COMP%]{border-color:gold}"]});let i=e;return i})();function Oa(i){let e=L(z),r=L(jr).escape$.subscribe(()=>e.dispatch(Ii({view:i})));L(Dr).onDestroy(()=>r.unsubscribe())}function Jy(i,e){if(i&1&&(a(0,"div",13),d(1),c()),i&2){let r=m().$implicit;l(),me(" Level ",r.currentLevel+1,"/",r.base.levels.length," ")}}function ev(i,e){i&1&&(a(0,"div",13),d(1,"Not built"),c())}function tv(i,e){if(i&1){let r=R();a(0,"div",8)(1,"div",9),S("click",function(){let n=E(r).$implicit,o=m(2);return I(o.handleBuildingClicked(n))}),h(2,"mw-ra-icon",10),d(3),g(4,Jy,2,2,"div",11)(5,ev,2,0,"ng-template",null,0,Q),h(7,"hr",12),c()()}if(i&2){let r=e.$implicit,t=ne(6),n=m(2);u("mwActionHint","Inspect "+r.base.baseName),l(),$("background-color",n.builtColor),de("not-built",!r.built),l(),u("icon",r.base.icon),l(),M(" ",r.currentBuilding.name," "),l(),u("ngIf",r.built)("ngIfElse",t)}}function iv(i,e){if(i&1&&(a(0,"div",5)(1,"div"),d(2),c(),a(3,"div",6),g(4,tv,8,9,"div",7),c()()),i&2){let r=e.$implicit;l(2),M("Tier ",r.key,""),l(2),u("ngForOf",r.value)}}var Il=(()=>{let e=class e{constructor(t,n,o){this.state=t,this.events=n,this.popupService=o,this.players=L(k),this.buildingsByTiers={},this.town=this.state.createdGame.town,this.builtColor=this.state.createdGame.selectedColor,Oa(Gt.Structures),this.buildingsByTiers=Object.entries(this.town.base.availableBuildings).reduce((s,[p,f])=>(s[f.tier]?s[f.tier].push(this.town.buildings[p]):s[f.tier]=[this.town.buildings[p]],s),{})}leaveTown(){this.events.dispatch(_o({}))}handleBuildingClicked(t){if(!t.built){this.popupService.createBasicPopup({component:vs,data:{building:t,targetLevel:1},class:"dark"});return}let n=t.currentBuilding.activity;if(n)switch(n.type){case rt.Hiring:let o=n;this.popupService.createBasicPopup({component:Dl,data:{building:t,town:this.town,hiringActivity:o}});break;case rt.ItemsSelling:this.popupService.createBasicPopup({component:El,data:{building:t}});break;case rt.Garrison:this.players.getCurrentPlayer().garrisons&&this.events.dispatch(Nn());break}}};e.\u0275fac=function(n){return new(n||e)(y(J),y(z),y(si))},e.\u0275cmp=v({type:e,selectors:[["mw-town-view"]],decls:6,vars:3,consts:[["notBuilt",""],["mwActionHint","Return to Map","icon","sideswipe",2,"padding","0px 10px","position","fixed","top","50%",3,"click"],[1,"buildings"],["class","building",4,"ngFor","ngForOf"],[2,"position","absolute","bottom","0","left","0"],[1,"building"],[1,"build"],[3,"mwActionHint",4,"ngFor","ngForOf"],[3,"mwActionHint"],[1,"header",3,"click"],[2,"font-size","28px",3,"icon"],["style","font-size: 10px;",4,"ngIf","ngIfElse"],[2,"width","100%","border-top","0"],[2,"font-size","10px"]],template:function(n,o){n&1&&(a(0,"mw-icon-btn",1),S("click",function(){return o.leaveTown()}),c(),h(1,"mw-action-hint"),a(2,"div",2),g(3,iv,5,2,"div",3),re(4,"keyvalue"),c(),h(5,"mw-player-info-panel",4)),n&2&&(l(3),u("ngForOf",oe(4,1,o.buildingsByTiers)))},dependencies:[q,se,xt,Gi,le,sr,cr,ni],styles:[".buildings[_ngcontent-%COMP%]{display:flex;flex-direction:row;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%)}.building[_ngcontent-%COMP%]{display:flex;flex-direction:column;background-color:#41454e;color:#fff;text-align:center;margin:5px;border-radius:8px;font-size:14px}.building[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{padding:10px;cursor:pointer;margin:5px;color:#fff;border-radius:20px;display:flex;flex-direction:column}.building[_ngcontent-%COMP%]   .header.not-built[_ngcontent-%COMP%]{background:#555967!important;color:#aeaeae}.build[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center}mw-action-hint[_ngcontent-%COMP%]{position:fixed;top:90%;left:0;right:0;font-size:13px}"]});let i=e;return i})();var br=class br extends ce(){constructor(e,r,t){super(),this.popupService=e,this.battleState=r,this.playersService=t}displayPopup(e){this.popupService.createPopup(e)}openHeroInfo(){this.popupService.createPopup({component:Ml,data:{},escape:!0})}openSettings(){this.popupService.createBasicPopup({component:dm,data:{},escape:!0})}openMainMenu(){this.popupService.createBasicPopup({component:Ca,data:{}})}openGarrison(){this.popupService.createBasicPopup({component:Pl,data:{}})}showGameOverPopup(){this.popupService.createBasicPopup({component:fa,data:{}})}displayPlayerRewardPopup(e){this.popupService.createBasicPopup({component:xa,data:e})}openUnitGroupSplitPopup(e){this.popupService.createBasicPopup({component:_a,data:e})}openUnitSlotsActionPopup(e){this.popupService.createBasicPopup({component:Pa,data:e})}displayActionCardsPopup(){this.popupService.createBasicPopup({component:ts,data:{},class:"transparent",isCloseable:!0})}playerSelectsStructure(e){if(e.struct.guard?.length){let r={struct:e.struct};this.events.dispatch(Rr({component:Sl,data:r}));return}if(!e.struct.guard?.length){if(e.struct.generator?.onVisited||e.struct.generator?.type===Pt.Scripted){let t={struct:e.struct};this.events.dispatch(Rr({component:wl,data:t}));return}let r={struct:e.struct};this.events.dispatch(Rr({component:_l,data:r}))}}fightEndsPopup(e){let r={isWin:e.win,playerLosses:this.getPlayerLosses(this.playersService.getCurrentPlayerId()),enemyLosses:this.getPlayerLosses(this.playersService.getEnemyPlayer().id),struct:e.struct};this.popupService.createPopup({data:r,component:Cl})}displayRewardPopup(e){let r=e.struct,t={struct:r},n=r.reward;if(n){let o={[Ne.Resources]:xl,[Ne.UnitsHire]:yl,[Ne.Item]:vl,[Ne.Scripted]:bl},s=n.type;if(s in o){let p=o[s];this.popupService.createBasicPopup({data:t,component:p})}}}getPlayerLosses(e){return[...this.battleState.playerLosses[e]].map(t=>({type:t[0],count:t[1]}))}};br.\u0275fac=function(r){return new(r||br)(x(si),x(wt),x(k))},br.\u0275prov=O({token:br,factory:br.\u0275fac});var mt=br;_([G(Rr)],mt.prototype,"displayPopup",null);_([ee(Bn)],mt.prototype,"openHeroInfo",null);_([ee(Wn)],mt.prototype,"openSettings",null);_([ee(qn)],mt.prototype,"openMainMenu",null);_([ee(Nn)],mt.prototype,"openGarrison",null);_([ee(To)],mt.prototype,"showGameOverPopup",null);_([G(Go)],mt.prototype,"displayPlayerRewardPopup",null);_([G(Mo)],mt.prototype,"openUnitGroupSplitPopup",null);_([G(Po)],mt.prototype,"openUnitSlotsActionPopup",null);_([ee(Do)],mt.prototype,"displayActionCardsPopup",null);_([G(Hn)],mt.prototype,"playerSelectsStructure",null);_([G(vi)],mt.prototype,"fightEndsPopup",null);_([G(Ao)],mt.prototype,"displayRewardPopup",null);var fm=St({id:"#acard-loc-attack",title:"Attack",icon:"crossed-swords",type:nt.LocationAction,bgColor:"#f33b4e",description:"Attack the camp."}),hm=St({id:"#acard-init-attack",title:"Initiative Attack",icon:"groundbreaker",type:nt.LocationAction,bgColor:"red",description:"Attack the camp, allowing your hero to cast a spell at the beginning of the fight."}),gm=St({id:"#acard-visit",title:"Visit",icon:"trail",type:nt.LocationAction,bgColor:"#ffa446",description:"Visit the location. Takes 1 action point until location says otherwise."});var ym=St({id:"#acard-thunder",title:"Thunder",icon:"lightning-storm",type:nt.Event,description:"Your hero loses 1 action point."}),vm=St({id:"#acard-rainbow",title:"Rainbow",icon:"sunbeams",type:nt.Event,description:"Your hero gains +1 action point."}),Cm=St({id:"#acard-snowfall",title:"Snowfall",icon:"frost-emblem",type:nt.Event,description:"Your army is slowed down by 25% during the combat."}),Sm=St({id:"#acard-raiders",title:"Raiders",icon:"demolish",type:nt.Event,description:"Raiders are approaching. At the end of the day, you will lose a random building on the map."});var ka=(()=>{let e=class e{constructor(){this.hostElem=Gr(),this.renderer=L(je),this.cursor=L(da),this.ngZone=L(ti),this.isHovered=!1,this.destroyed$=new Dt,this.setNativeCursorVisibility(!1),this.ngZone.runOutsideAngular(()=>{this.unlistenMouseMove=this.renderer.listen(this.hostElem,"mousemove",t=>{this.cursor.setCustomCursorPos(t.clientX,t.clientY)})})}ngOnDestroy(){this.cursor.clearCustomCursor(),this.isHovered=!1,this.destroyed$.next(),this.unlistenMouseMove()}onMouseOver(t){t.stopPropagation(),this.isHovered=!0;let n=this.getCursorToShow();n?(this.cursor.setCustomCursor(n.animation,n.options,n.data),this.setNativeCursorVisibility(!1)):(this.setNativeCursorVisibility(!0),this.cursor.clearCustomCursor())}onMouseOut(t){t.stopPropagation(),this.isHovered=!1,this.cursor.clearCustomCursor()}getCursorToShow(){return this.cursorAnimation}setCursorIcon(t){this.isHovered&&t&&(this.setNativeCursorVisibility(!1),this.cursor.setCustomCursor(t.animation,t.options,t.data)),t||(this.setNativeCursorVisibility(!0),this.cursor.clearCustomCursor())}recalcCursorIcon(){let t=this.getCursorToShow();this.isHovered&&t&&(this.setCursorIcon(t),this.setNativeCursorVisibility(!1)),t||(this.cursor.clearCustomCursor(),this.setNativeCursorVisibility(!0))}setNativeCursorVisibility(t){this.renderer.setStyle(this.hostElem,"cursor",t?"auto":"none")}};e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=Le({type:e,selectors:[["","mwCustomCursor",""]],hostBindings:function(n,o){n&1&&S("mouseenter",function(p){return o.onMouseOver(p)})("mouseleave",function(p){return o.onMouseOut(p)})}});let i=e;return i})();var Cs=new _i("UI element unit group provider"),Ga=(()=>{let e=class e extends ka{constructor(){super(...arguments),this.curPlayerState=L(We),this.spells=L(bn),this.players=L(k),this.unitGroupProvider=L(Cs)}ngOnInit(){this.unitGroup=this.unitGroupProvider.getUnitGroup(),this.curPlayerState.playerStateChanged$.pipe(et(this.destroyed$)).subscribe(()=>{this.recalcCursorIcon()})}getCursorToShow(){let t=this.players.isEnemyUnitGroup(this.unitGroup),n=this.curPlayerState.playerCurrentState;if(this.curPlayerState.playerCurrentState!==Me.SpellTargeting&&!t)return null;if(n===Me.Normal&&(!t||t&&!this.unitGroup.fightInfo.isAlive))return this.createStaticCursor("interdiction");let o=this.spells.canSpellBeCastOnUnit(this.curPlayerState.currentSpell,this.unitGroup,t);if(n===Me.SpellTargeting&&!o)return this.createStaticCursor("interdiction");let s={[Me.Normal]:"sword",[Me.SpellTargeting]:"burning-book",[Me.WaitsForTurn]:"hourglass"};return this.curPlayerState.playerCurrentState===Me.SpellTargeting?{animation:pu,options:{duration:2e3,iterations:1/0}}:this.createStaticCursor(s[this.curPlayerState.playerCurrentState])}createStaticCursor(t){return t==="interdiction"?{animation:lu,data:{custom:{parts:[{color:"white",icon:t,text:"",type:"plainPart"}]}}}:{animation:cu,data:{custom:{parts:[{color:"white",icon:t,text:"",type:"plainPart"}]}}}}};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=ft(e)))(o||e)}})(),e.\u0275dir=Le({type:e,selectors:[["","mwUnitEventsCursor",""]],features:[j]});let i=e;return i})();var Ra=(()=>{let e=class e{constructor(t,n,o,s,p){this.curPlayerState=t,this.players=n,this.mwBattleStateService=o,this.events=s,this.unitGroupProvider=p,this.isEnemyCard=!1}ngOnInit(){this.actionTargetUnitGroup=this.unitGroupProvider.getUnitGroup(),this.isEnemyCard=this.players.isEnemyUnitGroup(this.actionTargetUnitGroup)}onContextMenu(t){return t.stopPropagation(),t.preventDefault(),!1}onMouseDown(t){t.button===2&&(t.preventDefault(),this.curPlayerState.isSpellBeingCasted()?(this.curPlayerState.cancelCurrentSpell(),this.dispatchUnitGroupHovered(this.isEnemyCard?Ct.EnemyCard:Ct.AllyCard)):this.events.dispatch(Vo({unitGroup:this.actionTargetUnitGroup})))}onClick(){if(!this.canActivateCurrentSpell()){this.curPlayerState.cancelCurrentSpell();return}if(this.isEnemyCard){if(!this.actionTargetUnitGroup.fightInfo.isAlive)return;this.events.dispatch(jo({attackedGroup:this.actionTargetUnitGroup,attackingGroup:this.mwBattleStateService.currentUnitGroup,attackingPlayer:this.mwBattleStateService.currentPlayer})),this.dispatchUnitGroupHovered(Ct.EnemyCard)}else this.events.dispatch($o({unitGroup:this.actionTargetUnitGroup})),this.dispatchUnitGroupHovered(Ct.Unhover)}canActivateCurrentSpell(){let n=this.curPlayerState.currentSpell.baseType.config.spellConfig.targetCastConfig?.canActivate;return n?n({unitGroup:this.actionTargetUnitGroup,isEnemy:this.isEnemyCard}):!0}dispatchUnitGroupHovered(t){this.events.dispatch(Ti({hoverType:t,currentCard:this.mwBattleStateService.currentUnitGroup,hoveredCard:this.actionTargetUnitGroup}))}};e.\u0275fac=function(n){return new(n||e)(y(We),y(k),y(wt),y(z),y(Cs))},e.\u0275dir=Le({type:e,selectors:[["","mwUnitGroupCombatAction",""]],hostBindings:function(n,o){n&1&&S("contextmenu",function(p){return o.onContextMenu(p)})("mousedown",function(p){return o.onMouseDown(p)})("click",function(p){return o.onClick(p)})},inputs:{actionTargetUnitGroup:"actionTargetUnitGroup"}});let i=e;return i})();function sv(i,e){i&1&&h(0,"mw-ra-icon",21)}function av(i,e){i&1&&h(0,"mw-ra-icon",22)}function cv(i,e){if(i&1&&(a(0,"div"),h(1,"mw-ra-icon",23),d(2),c()),i&2){let r=m().ngIf;l(2),me(" ",r.groupState.currentMana,"/",r.groupStats.maxMana," ")}}function lv(i,e){if(i&1&&(a(0,"div"),h(1,"mw-ra-icon",24),d(2),c()),i&2){let r=m().ngIf;l(2),M(" ",r.groupStats.totalHealth," ")}}function pv(i,e){if(i&1&&h(0,"mw-unit-group-spell",25),i&2){let r=e.$implicit,t=m(2);u("hintPos",t.spellsHintsPosition)("spell",r)("hero",t.playerInfo.hero)("owner",t.unitGroup)("onCooldown",t.unitGroup.fightInfo.spellsOnCooldown)("currentUnit",t.attackingUnitGroup)}}function uv(i,e){if(i&1&&h(0,"mw-unit-group-buff",26),i&2){let r=e.$implicit,t=m(2);u("hintPos",t.spellsHintsPosition)("buff",r)("ownerUnit",t.unitGroup)}}function dv(i,e){if(i&1&&h(0,"mw-value-bar",27),i&2){let r=m(2);u("side",r.side)("showMax",!0)("currentValue",r.unitGroup.tailUnitHp)("maxValue",r.unitGroup.type.baseStats.health)("barHeight",14)}}function mv(i,e){if(i&1){let r=R();a(0,"div",3),S("mouseenter",function(){E(r);let n=m();return I(n.onCardHover(!0))})("mouseleave",function(){E(r);let n=m();return I(n.onCardHover(!1))}),a(1,"div",4)(2,"div",5)(3,"div",6),d(4),c(),a(5,"div",7)(6,"div"),h(7,"mw-ra-icon",8),d(8),c(),a(9,"div"),g(10,sv,1,0,"mw-ra-icon",9)(11,av,1,0,"ng-template",null,0,Q),d(13),c(),a(14,"div"),h(15,"mw-ra-icon",10),d(16),h(17,"span",11),c(),a(18,"div",12),g(19,cv,3,2,"div",13),c(),g(20,lv,3,1,"div",13),c()(),a(21,"div",14)(22,"div",15),g(23,pv,1,6,"mw-unit-group-spell",16),c(),a(24,"div",15),g(25,uv,1,3,"mw-unit-group-buff",17),c()()(),a(26,"div",18),h(27,"mw-unit-group-portrait",19),g(28,dv,1,5,"mw-value-bar",20),c()()}if(i&2){let r=e.ngIf,t=ne(12),n=m();de("active",n.mwBattleStateService.currentPlayer===n.playerInfo&&n.attackingUnitGroup===n.unitGroup)("inactive",!n.unitGroup.turnsLeft&&n.unitGroup.fightInfo.isAlive)("defeated",!n.unitGroup.fightInfo.isAlive),u("ngClass",n.side==="left"?"card-left":"card-right"),l(2),$("background",n.playerInfo.color),de("current-group",n.mwBattleStateService.currentPlayer===n.playerInfo&&n.attackingUnitGroup===n.unitGroup)("hovered-enemy",n.isCardHovered&&n.isEnemyCard&&n.canCurrentPlayerAttack),l(2),me(" ",n.unitGroup.type.name," (",n.unitGroup.count,") "),l(4),me(" (",n.unitGroup.turnsLeft,"/",n.unitGroup.type.defaultTurnsPerRound,") "),l(2),u("ngIf",n.isGroupMelee)("ngIfElse",t),l(3),M(" ",r.groupStats.avgTotalDamage," "),l(),de("defence",r.groupStats.defends),l(2),M(" ",r.groupStats.baseSpeed," "),l(),u("mwNumberModifier",r.groupStats.speedBonus),l(2),u("ngIf",r.groupStats.maxMana),l(),u("ngIf",!n.isBoss||n.unitGroup.type.isHero),l(),u("ngClass",n.side),l(2),u("ngForOf",n.spells),l(2),u("ngForOf",n.effects),l(2),u("unitGroup",n.unitGroup)("toRight",n.side==="left")("isHero",n.unitGroup.type.isHero),l(),u("ngIf",n.isBoss||n.unitGroup.type.isHero)}}var Ss=(()=>{let e=class e extends ce(){constructor(t,n,o,s,p,f){super(),this.hostElem=t,this.mwBattleStateService=n,this.playersService=o,this.unitsService=s,this.units=p,this.renderer=f,this.side="left",this.cardReady=new bt,this.groupDies=new bt,this.isCardHovered=!1,this.canCurrentPlayerAttack=!1,this.isGroupMelee=!1,this.initialCount=0,this.spells=[],this.effects=[],this.isBoss=!1,this.destroy$=new Dt}ngOnInit(){this.spellsHintsPosition="above",this.isGroupMelee=!this.unitsService.isUnitGroupRanged(this.unitGroup),this.isEnemyCard=this.playersService.getCurrentPlayer()!==this.playerInfo,this.initialCount=this.unitGroup.count,this.isBoss=this.unitGroup.type.defaultModifiers?.isBoss,this.cardReady.next(this),this.unitStats$=this.unitGroup.listenStats(),this.unitGroup.modGroup.getModValue("isSummon")&&this.renderer.addClass(this.hostElem.nativeElement,"summoned"),this.updateSpellsAndEffects(),this.events.eventStream$.pipe(et(this.destroyed$)).subscribe(()=>{let n=this.mwBattleStateService.currentUnitGroup;this.attackingUnitGroup=n,this.canCurrentPlayerAttack=this.mwBattleStateService.currentPlayer===this.playersService.getCurrentPlayer()}),this.events.onEvent(dn).pipe(et(this.destroyed$)).subscribe(n=>{n.unitGroup===this.unitGroup&&this.updateSpellsAndEffects()})}onDestroyed(){this.destroy$.next(),this.destroy$.complete(),this.events.dispatch(Ti({hoverType:Ct.Unhover})),this.groupDies.next()}onCardHover(t){if(this.isCardHovered=t,t){if(!this.unitGroup.fightInfo.isAlive){this.events.dispatch(Ti({hoverType:Ct.Unhover}));return}this.events.dispatch(Ti({hoverType:this.isEnemyCard?Ct.EnemyCard:Ct.AllyCard,currentCard:this.mwBattleStateService.currentUnitGroup,hoveredCard:this.unitGroup}))}else this.events.dispatch(Ti({hoverType:Ct.Unhover}))}getUnitGroup(){return this.unitGroup}updateSpellsAndEffects(){let t=this.unitGroup.spells;this.effects=t.filter(n=>n.isEffect()),this.spells=t.filter(n=>!n.isEffect())}};e.\u0275fac=function(n){return new(n||e)(y(ht),y(wt),y(k),y(Ia),y(ke),y(je))},e.\u0275cmp=v({type:e,selectors:[["mw-unit-group-card"]],inputs:{unitGroup:"unitGroup",playerInfo:"playerInfo",side:"side"},outputs:{cardReady:"cardReady",groupDies:"groupDies"},features:[bs([{provide:Cs,useExisting:Yl(()=>e)}]),j],decls:3,vars:4,consts:[["rangedIcon",""],[3,"containerId"],["class","card-top",3,"active","ngClass","inactive","defeated","mouseenter","mouseleave",4,"ngIf"],[1,"card-top",3,"mouseenter","mouseleave","ngClass"],[1,"card-wrapper"],[1,"card"],[2,"padding-bottom","3px","font-weight","500","white-space","nowrap"],[2,"font-size","12px"],["icon","spinning-sword"],["icon","sword",4,"ngIf","ngIfElse"],["icon","feather-wing"],[3,"mwNumberModifier"],[1,"secondary-stats"],[4,"ngIf"],[1,"abilities",3,"ngClass"],[1,"column-data"],[3,"hintPos","spell","hero","owner","onCooldown","currentUnit",4,"ngFor","ngForOf"],[3,"hintPos","buff","ownerUnit",4,"ngFor","ngForOf"],[1,"portrait-container"],[3,"unitGroup","toRight","isHero"],["class","health-bar","barStyle","normal","color","rgb(201, 45, 45)",3,"side","showMax","currentValue","maxValue","barHeight",4,"ngIf"],["icon","sword"],["icon","crossbow"],["icon","crystal-ball"],["icon","health"],[3,"hintPos","spell","hero","owner","onCooldown","currentUnit"],[3,"hintPos","buff","ownerUnit"],["barStyle","normal","color","rgb(201, 45, 45)",1,"health-bar",3,"side","showMax","currentValue","maxValue","barHeight"]],template:function(n,o){n&1&&(a(0,"mw-vfx-container",1),g(1,mv,29,33,"div",2),re(2,"async"),c()),n&2&&(u("containerId",o.unitGroup.id),l(),u("ngIf",oe(2,2,o.unitStats$)))},styles:["@keyframes _ngcontent-%COMP%_summonedAnimation{0%{opacity:0;height:0;width:0px}to{opacity:100%;height:100px;width:115px}}.summoned[_nghost-%COMP%]{animation:_ngcontent-%COMP%_summonedAnimation .6s ease-in-out}.secondary-stats[_ngcontent-%COMP%]{position:absolute}.card-right[_ngcontent-%COMP%]   .secondary-stats[_ngcontent-%COMP%]{right:0}.card-top[_ngcontent-%COMP%]{display:flex;position:relative;transition:.5s;left:0;right:0}.portrait-container[_ngcontent-%COMP%]{position:absolute;top:-25px}.card-left[_ngcontent-%COMP%]   .portrait-frame[_ngcontent-%COMP%]{scale:-1 1}.vertical[_nghost-%COMP%]   .card-left[_ngcontent-%COMP%]   .portrait-container[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-left[_ngcontent-%COMP%]   .portrait-container[_ngcontent-%COMP%]{right:79%}.vertical[_nghost-%COMP%]   .card-right[_ngcontent-%COMP%]   .portrait-container[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-right[_ngcontent-%COMP%]   .portrait-container[_ngcontent-%COMP%]{left:79%}.horizontal[_nghost-%COMP%]   .portrait-container[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .portrait-container[_ngcontent-%COMP%]{z-index:-1;right:0;top:-94px;left:-10px}.health-bar[_ngcontent-%COMP%]{position:relative;overflow:hidden;top:-42px;width:70px;border-radius:7px;border:1px solid gold}.card-left[_ngcontent-%COMP%]   .health-bar[_ngcontent-%COMP%]{left:24px}.card-right[_ngcontent-%COMP%]   .health-bar[_ngcontent-%COMP%]{right:-23px}.card-left[_ngcontent-%COMP%]{text-align:right}.card-right[_ngcontent-%COMP%]{text-align:left}.card-wrapper[_ngcontent-%COMP%]{position:relative}.abilities[_ngcontent-%COMP%]{position:absolute;font-size:12px;top:0;display:flex}.vertical[_nghost-%COMP%]   .abilities.left[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .abilities.left[_ngcontent-%COMP%]{right:185%;flex-direction:row-reverse}.vertical[_nghost-%COMP%]   .abilities.right[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .abilities.right[_ngcontent-%COMP%]{left:185%}.horizontal[_nghost-%COMP%]   .abilities[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .abilities[_ngcontent-%COMP%]{top:-62%;left:-42px;flex-direction:column}.card[_ngcontent-%COMP%]{display:block;width:115px;height:100px;border-radius:6px;align-items:center;box-sizing:border-box;font-size:13px;padding:4px 15px 0;color:#fff;border:3px solid transparent;-webkit-user-select:none;user-select:none}.card.current-group[_ngcontent-%COMP%]{border:3px solid gold}.hovered-enemy[_ngcontent-%COMP%]{border:3px solid rgba(240,113,113,.906)}.column-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:0 4px}[_nghost-%COMP%]{position:relative}.card-top[_ngcontent-%COMP%]{transition:.5s;filter:brightness(100%) drop-shadow(0 0 0 rgba(0,0,0,.721))}.card-top.active[_ngcontent-%COMP%]{filter:brightness(100%) drop-shadow(2px 4px 6px rgba(0,0,0,.721))}.card-top.inactive[_ngcontent-%COMP%]{filter:brightness(85%) drop-shadow(0 0 0 rgba(0,0,0,.721))}.card-top.defeated[_ngcontent-%COMP%]{filter:brightness(55%) drop-shadow(0 0 0 rgba(0,0,0,.721))}.vertical[_nghost-%COMP%]   .card-top.active.card-left[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.active.card-left[_ngcontent-%COMP%]{left:32px}.vertical[_nghost-%COMP%]   .card-top.active.card-right[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.active.card-right[_ngcontent-%COMP%]{right:32px}.vertical[_nghost-%COMP%]   .card-top.inactive.card-left[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.inactive.card-left[_ngcontent-%COMP%]{left:-32px}.vertical[_nghost-%COMP%]   .card-top.inactive.card-right[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.inactive.card-right[_ngcontent-%COMP%]{right:-32px}.vertical[_nghost-%COMP%]   .card-top.defeated.card-left[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.defeated.card-left[_ngcontent-%COMP%]{left:-32px}.vertical[_nghost-%COMP%]   .card-top.defeated.card-right[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.defeated.card-right[_ngcontent-%COMP%]{right:32px}.horizontal[_nghost-%COMP%]   .card-top.active.card-left[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.active.card-left[_ngcontent-%COMP%]{transform:translateY(-32px)}.horizontal[_nghost-%COMP%]   .card-top.active.card-right[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.active.card-right[_ngcontent-%COMP%]{transform:translateY(32px)}.horizontal[_nghost-%COMP%]   .card-top.inactive.card-left[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.inactive.card-left[_ngcontent-%COMP%]{transform:translateY(32px)}.horizontal[_nghost-%COMP%]   .card-top.inactive.card-right[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.inactive.card-right[_ngcontent-%COMP%]{transform:translateY(-32px)}.horizontal[_nghost-%COMP%]   .card-top.defeated.card-left[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.defeated.card-left[_ngcontent-%COMP%]{transform:translateY(32px)}.horizontal[_nghost-%COMP%]   .card-top.defeated.card-right[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.defeated.card-right[_ngcontent-%COMP%]{transform:translateY(-32px)}.defence[_ngcontent-%COMP%]{font-weight:700;color:gold}"]});let i=e;return i})();function fv(i,e){if(i&1){let r=R();a(0,"mw-unit-group-card",12),S("grupDies",function(){let n=E(r).$implicit,o=m();return I(o.onGroupDies(n))}),c()}if(i&2){let r=e.$implicit,t=m();u("playerInfo",t.mainPlayerInfo)("unitGroup",r)}}function hv(i,e){if(i&1){let r=R();a(0,"mw-unit-group-card",13),S("groupDies",function(){let n=E(r).$implicit,o=m();return I(o.onGroupDies(n))}),c()}if(i&2){let r=e.$implicit,t=m();u("playerInfo",t.enemyPlayerInfo)("unitGroup",r)}}function gv(i,e){if(i&1&&(a(0,"div",14)(1,"div"),d(2),c(),a(3,"div"),d(4),c(),a(5,"div"),d(6),c()()),i&2){let r=e.$implicit;$("background",r.ownerPlayer.color),l(2),H(r.type.name),l(2),H(r.count),l(2),M("turns: ",r.turnsLeft,"")}}var to=class to extends ce(){constructor(e,r,t,n,o,s,p,f,C){super(),this.mwPlayerState=e,this.players=r,this.mwBattleState=t,this.mwNeutralPlayer=n,this.cardsMapping=o,this.combatInteractor=s,this.vfx=p,this.cd=f,this.state=C,this.settings=this.state.settings,this.orientation=cn,this.currentUnitGroup$=this.mwBattleState.currentUnitGroup$,this.canDefend$=this.mwBattleState.currentUnitGroup$.pipe(Li(w=>!!(w&&!w.getState().groupStats.defends&&!this.players.isEnemyUnitGroup(w)))),this.defendActionMessage$=this.mwBattleState.currentUnitGroup$.pipe(Li(w=>!w||this.players.isEnemyUnitGroup(w)?"":w.getState().groupStats.defends?"Unit group is already defending":`Defend ${w.count} ${w.type.name}`))}ngOnInit(){this.mainPlayerUnitGroups=this.mwPlayerState.getUnitGroups(),this.neutralPlayerGroups=this.mwNeutralPlayer.getUnitGroups(),this.mainPlayerInfo=this.mwPlayerState.getPlayerInfo(),this.enemyPlayerInfo=this.mwNeutralPlayer.getPlayerInfo()}onGroupDies(e){this.cardsMapping.unregister(e)}ngAfterViewInit(){this.cards.forEach(e=>this.cardsMapping.register(e.unitGroup,e)),this.initInteractions(),this.cd.detectChanges()}initInteractions(){this.combatInteractor.onBattleBegins(),this.events.dispatch(Eo({players:[this.mainPlayerInfo,this.enemyPlayerInfo],unitGroups:[...this.mainPlayerUnitGroups,...this.neutralPlayerGroups]})),this.updateFightQueue(),this.events.eventStream$.pipe(et(this.destroyed$)).subscribe(()=>{this.updatePlayersUnitGroupsToShow()})}defend(){this.events.dispatch(So())}displayDamageVfxOverAttackedGroup(e){let r=e.attackingGroup.type.defaultModifiers?.isRanged;e.lifeStolen&&(this.vfx.createDroppingMessageForContainer(e.attackingGroup.id,gu(e.lifeStolenUnitsRestored,e.lifeStolen),{duration:1600}),this.vfx.createEffectAnimationForUnitGroup(e.attackingGroup,su,{duration:700,darkOverlay:!1})),this.vfx.createFloatingMessageForUnitGroup(e.attackedGroup,Ut(e.damage,e.loss,r,e.damageBlocked,e.isCritical),{duration:e.isCritical?1200:e.damageBlocked?1100:1e3})}registerSummonedUnit(e){this.updatePlayersUnitGroupsToShow(),this.cd.detectChanges(),this.cardsMapping.register(e.unitGroup,this.cards.find(r=>r.unitGroup===e.unitGroup))}updatePlayersUnitGroupsToShow(){this.mainPlayerUnitGroups=this.mwBattleState.heroesUnitGroupsMap.get(this.mainPlayerInfo),this.neutralPlayerGroups=this.mwBattleState.heroesUnitGroupsMap.get(this.enemyPlayerInfo),this.updateFightQueue()}updateFightQueue(){this.fightQueue=this.mwBattleState.getFightQueue()}};to.\u0275fac=function(r){return new(r||to)(y(om),y(k),y(wt),y(rm),y(Lr),y(En),y(ci),y(mi),y(J))},to.\u0275cmp=v({type:to,selectors:[["mw-gameboard"]],viewQuery:function(r,t){if(r&1&&De(Ss,5),r&2){let n;Ee(n=Ie())&&(t.cards=n)}},features:[j],decls:19,vars:10,consts:[[1,"columns-wrapper",3,"ngClass"],[1,"columns"],[1,"column"],["class","card","mwUnitGroupCombatAction","","mwUnitEventsCursor","","side","left",3,"playerInfo","unitGroup","grupDies",4,"ngFor","ngForOf"],["class","card","mwUnitGroupCombatAction","","mwUnitEventsCursor","","side","right",3,"playerInfo","unitGroup","groupDies",4,"ngFor","ngForOf"],[1,"abilities-panel"],["icon","shield",2,"width","60px","text-align","center","color","#ffe5a0","background","#505263",3,"click","disabled","mwActionHint"],[1,"queue-panel"],["class","queue-card",3,"background",4,"ngFor","ngForOf"],[1,"hint-panel"],[1,"history-log-panel"],[1,"items-panel"],["mwUnitGroupCombatAction","","mwUnitEventsCursor","","side","left",1,"card",3,"grupDies","playerInfo","unitGroup"],["mwUnitGroupCombatAction","","mwUnitEventsCursor","","side","right",1,"card",3,"groupDies","playerInfo","unitGroup"],[1,"queue-card"]],template:function(r,t){r&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),g(3,fv,1,2,"mw-unit-group-card",3),c(),a(4,"div",2),g(5,hv,1,2,"mw-unit-group-card",4),c()()(),a(6,"div",5)(7,"mw-icon-btn",6),re(8,"async"),re(9,"async"),S("click",function(){return t.defend()}),c(),h(10,"mw-battle-hero-abilities"),c(),a(11,"div",7),g(12,gv,7,5,"div",8),c(),h(13,"mw-action-hint",9),a(14,"div",10),h(15,"mw-history-log"),c(),a(16,"div",11),d(17," Items: "),h(18,"mw-items-panel"),c()),r&2&&(u("ngClass",t.settings.orientation===t.orientation.Horizontal?"horizontal":"vertical"),l(3),u("ngForOf",t.mainPlayerUnitGroups),l(2),u("ngForOf",t.neutralPlayerGroups),l(2),u("disabled",oe(8,6,t.canDefend$)===!1)("mwActionHint",oe(9,8,t.defendActionMessage$)),l(5),u("ngForOf",t.fightQueue))},styles:[".columns-wrapper[_ngcontent-%COMP%]{position:absolute;top:0;left:0;height:80%;width:100%;display:flex;align-items:center}.columns-wrapper.horizontal[_ngcontent-%COMP%]{top:90px;height:65%}.columns-wrapper.horizontal[_ngcontent-%COMP%]   .columns[_ngcontent-%COMP%]{flex-direction:column-reverse}.columns-wrapper.horizontal[_ngcontent-%COMP%]   .columns[_ngcontent-%COMP%] > .column[_ngcontent-%COMP%]{flex-direction:row;height:auto;justify-content:space-evenly;width:100%}.columns[_ngcontent-%COMP%]{display:flex;width:680px;height:100%;justify-content:space-between;margin:auto;align-items:center}.column[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;justify-content:center}.card[_ngcontent-%COMP%]{margin:6px}.queue-panel[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;position:absolute;bottom:0;left:0}.queue-card[_ngcontent-%COMP%]{height:64px;width:64px;border-radius:6px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:12px;color:#fff;text-align:center;margin:8px}.abilities-panel[_ngcontent-%COMP%]{position:fixed;left:100px;top:35%}.hint-panel[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;position:absolute;bottom:81px;left:0;font-size:12px}.history-log-panel[_ngcontent-%COMP%]{position:absolute;right:0;bottom:0;width:370px}.items-panel[_ngcontent-%COMP%]{position:absolute;left:16px;bottom:75px}"]});var In=to;_([G(Rn)],In.prototype,"displayDamageVfxOverAttackedGroup",null);_([G(fo)],In.prototype,"registerSummonedUnit",null);function vv(i,e){if(i&1&&(a(0,"span"),d(1),c()),i&2){let r=m().ngIf;l(),M(" (+",r.bonusAttack,") ")}}function Cv(i,e){if(i&1&&(a(0,"span"),d(1),c()),i&2){let r=m().ngIf;l(),M(" (+",r.bonusDefence,") ")}}function Sv(i,e){if(i&1&&(a(0,"div")(1,"div",1)(2,"div"),d(3),c(),a(4,"div"),d(5),c()(),a(6,"div",1)(7,"div"),d(8),c(),a(9,"div"),d(10),c()(),a(11,"div",1)(12,"div"),d(13),c(),a(14,"div"),d(15),c()(),a(16,"div",1)(17,"div"),d(18),c(),a(19,"div"),d(20),c()(),a(21,"div",1)(22,"div"),d(23,"Mana:"),c(),a(24,"div"),d(25),c()(),a(26,"div",1)(27,"div"),d(28,"Attack:"),c(),a(29,"div"),d(30),g(31,vv,2,1,"span",0),c()(),a(32,"div",1)(33,"div"),d(34,"Defence:"),c(),a(35,"div"),d(36),g(37,Cv,2,1,"span",0),c()(),a(38,"div",2)(39,"div")(40,"div"),d(41),c(),a(42,"div"),d(43),h(44,"mw-ra-icon",3),c()()()()),i&2){let r=e.ngIf,t=m();l(3),M("",t.resourceNames.gold,":"),l(2),H(t.currentPlayer.resources.gold),l(3),M("",t.resourceNames.wood,":"),l(2),H(t.currentPlayer.resources.wood),l(3),M("",t.resourceNames.redCrystals,":"),l(2),H(t.currentPlayer.resources.redCrystals),l(3),M("",t.resourceNames.gems,":"),l(2),H(t.currentPlayer.resources.gems),l(5),me("",r.currentMana,"/",r.maxMana,""),l(5),M(" ",r.baseAttack," "),l(),u("ngIf",r.bonusAttack),l(5),M(" ",r.baseDefence," "),l(),u("ngIf",r.bonusDefence),l(4),me(" Week: ",t.state.currentGame.week,", Day: ",t.state.currentGame.day," "),l(2),M(" Action Points: ",t.state.currentGame.actionPoints," ")}}var Tl=(()=>{let e=class e{constructor(t,n){this.playersService=t,this.state=n,this.resourceNames=ta,this.currentPlayer=this.playersService.getCurrentPlayer(),this.heroStats$=this.currentPlayer.hero.listenHeroStats()}};e.\u0275fac=function(n){return new(n||e)(y(k),y(J))},e.\u0275cmp=v({type:e,selectors:[["mw-player-resources"]],decls:2,vars:3,consts:[[4,"ngIf"],[1,"resource-info-row"],[1,"sub-info"],["icon","feather-wing"]],template:function(n,o){n&1&&(g(0,Sv,45,17,"div",0),re(1,"async")),n&2&&u("ngIf",oe(1,1,o.heroStats$))},dependencies:[le,se,yi],styles:[".resource-info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin:2px}[_nghost-%COMP%]{font-size:12px}.sub-info[_ngcontent-%COMP%]{margin-top:8px;font-size:13px}"]});let i=e;return i})();var xv=i=>[i],wm=i=>({data:i});function bv(i,e){i&1&&h(0,"mw-ra-icon",20)}function _v(i,e){if(i&1&&h(0,"mw-ra-icon",21),i&2){let r=m().$implicit,t=m();u("icon",r.controlType===t.controlTypes.AI?"guarded-tower":"player")}}function Mv(i,e){if(i&1&&(a(0,"div"),h(1,"mw-ra-icon",26),a(2,"span",27),d(3),c()()),i&2){let r=m().$implicit;l(),u("icon",r.selectedFaction.icon),l(2),M(" ",r.selectedFaction.title," ")}}function Pv(i,e){i&1&&(a(0,"div"),h(1,"mw-ra-icon",28),a(2,"span",27),d(3,"Random"),c()())}function Dv(i,e){if(i&1){let r=R();a(0,"mw-ra-icon",31),S("click",function(){let n=E(r).$implicit,o=m(2).$implicit,s=m();return I(s.selectFactionForPlayer(o,n))}),c()}if(i&2){let r=e.$implicit;u("icon",r.icon)}}function Ev(i,e){if(i&1){let r=R();a(0,"mw-ra-icon",29),S("click",function(){E(r);let n=m().$implicit,o=m();return I(o.selectFactionForPlayer(n))}),c(),g(1,Dv,1,1,"mw-ra-icon",30)}if(i&2){let r=m(2);l(),u("ngForOf",r.playableFactions)}}function Iv(i,e){if(i&1&&(a(0,"div"),h(1,"div",32),a(2,"span",27),d(3),c()()),i&2){let r=m().$implicit;l(),$("background-image","url('assets/"+r.selectedHero.image+"')"),l(2),H(r.selectedHero.name)}}function Tv(i,e){i&1&&(a(0,"div"),h(1,"mw-ra-icon",28),a(2,"span",27),d(3,"Random"),c()())}function Fv(i,e){if(i&1){let r=R();a(0,"div",36),S("mouseenter",function(){let n=E(r).$implicit,o=m(2).$implicit,s=m();return I(s.onHoverFactionHero(o,n))})("mouseleave",function(){let n=E(r).$implicit,o=m(2).$implicit,s=m();return I(s.onUnhoverFactionHero(o,n))})("click",function(){let n=E(r).$implicit,o=m(2).$implicit,s=m();return I(s.onSelectFactionHero(o,n))}),h(1,"div",32),a(2,"span",27),d(3),c()()}if(i&2){let r=e.$implicit;l(),$("background-image","url('assets/"+r.image+"')"),l(2),H(r.name)}}function Av(i,e){if(i&1){let r=R();a(0,"div",33)(1,"div",34),S("click",function(){E(r);let n=m().$implicit,o=m();return I(o.onRandomHeroClick(n))})("mouseenter",function(){E(r);let n=m().$implicit,o=m();return I(o.onHoverRandomHero(n))})("mouseleave",function(){E(r);let n=m().$implicit,o=m();return I(o.onUnhoverRandomHero(n))}),h(2,"mw-ra-icon",28),a(3,"span",27),d(4,"Random"),c()(),g(5,Fv,4,3,"div",35),c()}if(i&2){let r=m().$implicit;l(5),u("ngForOf",r.selectedFaction==null?null:r.selectedFaction.getAllHeroes())}}function Ov(i,e){if(i&1){let r=R();a(0,"div",38),S("click",function(){let n=E(r).$implicit,o=m(2).$implicit;return I(o.pickedColor=n)}),c()}if(i&2){let r=e.$implicit;$("background",r)}}function kv(i,e){if(i&1&&g(0,Ov,1,2,"div",37),i&2){let r=m(2);u("ngForOf",r.colors)}}function Gv(i,e){if(i&1){let r=R();a(0,"div",18),S("mouseenter",function(){let n=E(r).$implicit,o=m();return I(o.onPlayerRowHovered(n))})("mouseleave",function(){let n=E(r).$implicit,o=m();return I(o.onPlayerRowUnhovered(n))}),a(1,"div",19),S("click",function(){let n=E(r).$implicit,o=m();return I(o.toggleControlType(n))}),g(2,bv,1,0,"mw-ra-icon",20)(3,_v,1,1,"mw-ra-icon",21),d(4),c(),a(5,"div",10)(6,"mw-menu",22),g(7,Mv,4,2,"div",23)(8,Pv,4,0,"ng-template",null,2,Q),c(),g(10,Ev,2,1,"ng-template",null,3,Q),c(),a(12,"div",11)(13,"mw-menu",24),g(14,Iv,4,3,"div",23)(15,Tv,4,0,"ng-template",null,1,Q),c(),g(17,Av,6,1,"ng-template",null,4,Q),c(),a(19,"div",12)(20,"mw-menu",22),h(21,"div",25),c(),g(22,kv,1,1,"ng-template",null,5,Q),c()()}if(i&2){let r=e.$implicit,t=ne(9),n=ne(11),o=ne(18),s=ne(23);l(),u("mwActionHint",r.isMainPlayer?"":"Click to change player control type."),l(),Oe(r.isMainPlayer?2:3),l(2),M(" ",r.name," "),l(2),u("menuBody",n),l(),u("ngIf",r.selectedFaction)("ngIfElse",t),l(6),u("menuBody",o)("pos","below"),l(),u("ngIf",r.selectedHero)("ngIfElse",t),l(6),u("menuBody",s),l(),$("background",r.pickedColor)}}function Rv(i,e){if(i&1&&(a(0,"div",39),mp(1),a(2,"div"),d(3,"Hero"),c(),a(4,"div")(5,"div"),d(6),c(),h(7,"mw-ra-icon",40),a(8,"div",41)(9,"div",42)(10,"div"),h(11,"mw-ra-icon",43),d(12),c(),a(13,"div"),h(14,"mw-ra-icon",44),d(15),c(),a(16,"div"),h(17,"mw-ra-icon",45),d(18),c()(),a(19,"div",42)(20,"div",46)(21,"div"),d(22),c(),a(23,"div"),d(24),c()()()(),a(25,"div",47),h(26,"mw-description",48),c()()()),i&2){let r=e.data,t=m().getHero(r);l(6),M(" ",t.name," "),l(6),M(" ",t.initialState.stats.baseAttack," "),l(3),M(" ",t.initialState.stats.baseDefence," "),l(3),M(" ",t.initialState.stats.mana," "),l(4),M("Gold: ",t.initialState.resources.gold,""),l(2),M("Wood: ",t.initialState.resources.wood,""),l(2),u("descriptions",Ue(7,xv,t.generalDescription))}}function Uv(i,e){if(i&1&&(a(0,"span"),d(1),c()),i&2){let r=m(2);l(),me(" ",r.hoveredPlayer.name," plays as random hero of ",r.hoveredPlayer.selectedFaction.title," faction. ")}}function Bv(i,e){i&1&&(a(0,"span"),d(1,"Play as random hero of this faction."),c())}function Hv(i,e){i&1&&(a(0,"span"),d(1,"Play as random hero of any faction."),c())}function Lv(i,e){if(i&1&&(a(0,"div",39)(1,"div")(2,"div"),d(3,"Random Hero"),c(),h(4,"mw-ra-icon",49),a(5,"div",47),g(6,Uv,2,2,"span")(7,Bv,2,0,"span")(8,Hv,2,0,"span"),c()()()),i&2){let r=m();l(6),Oe(r.hoveredPlayer&&r.hoveredPlayer.selectedFaction&&!r.hoveredPlayer.selectedHero?6:-1),l(),Oe(r.hoveredPlayer?-1:7),l(),Oe(r.hoveredPlayer&&!r.hoveredPlayer.selectedFaction?8:-1)}}function Nv(i,e){i&1&&be(0)}function jv(i,e){if(i&1&&g(0,Nv,1,0,"ng-container",50),i&2){let r=m(2),t=ne(15);u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,wm,r.hoveredPlayer.selectedHero))}}function $v(i,e){i&1&&be(0)}function Vv(i,e){if(i&1&&g(0,$v,1,0,"ng-container",51),i&2){m(2);let r=ne(17);u("ngTemplateOutlet",r)}}function zv(i,e){if(i&1&&(d(0),g(1,jv,1,4,"ng-container")(2,Vv,1,1,"ng-container")),i&2){let r=m();me(" ",r.hoveredPlayer.name," plays ",(r.hoveredPlayer.selectedFaction==null?null:r.hoveredPlayer.selectedFaction.title)||"Random Faction"," as "),l(),Oe(r.hoveredPlayer.selectedHero?1:2)}}function Wv(i,e){i&1&&be(0)}function qv(i,e){if(i&1&&g(0,Wv,1,0,"ng-container",50),i&2){let r=m(),t=ne(15);u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,wm,r.hoveredHero))}}function Yv(i,e){i&1&&be(0)}function Qv(i,e){if(i&1&&g(0,Yv,1,0,"ng-container",51),i&2){m();let r=ne(17);u("ngTemplateOutlet",r)}}var Kv=[ze],xm=(()=>{let e=class e{constructor(t,n,o){this.events=t,this.state=n,this.gameObjectsManager=o,this.players=Pi([{id:"1",name:"Player 1",isMainPlayer:!0,selectedFaction:Ve,controlType:Lt.Player,pickedColor:kn.BLUE,selectedHero:Ve.getAllHeroes().find(s=>s.id==="#hero-helvetica")}]),this.playableFactions=kr.getAllFactions().filter(s=>!Kv.includes(s)),this.controlTypes=Lt,this.colors=[kn.BLUE,kn.RED,kn.GREEN],Oa(Gt.MainScreen)}startGame(){let t=this.players()[0],n=t.selectedFaction||V.randItem(this.playableFactions),o=n.getTownBase();this.state.createdGame={faction:n,selectedColor:t.pickedColor,selectedHero:t.selectedHero||V.randItem(n.heroes),town:this.gameObjectsManager.createNewGameObject(am,{townBase:o})},console.log(this.state.createdGame),this.events.dispatch(xo())}onPlayerRowHovered(t){this.hoveredPlayer=t}onPlayerRowUnhovered(t){this.hoveredPlayer=void 0}onRandomHeroClick(t){t.selectedHero=void 0,this.hoveredHero=void 0}onHoverRandomHero(t){this.hoveredHero=null}onUnhoverRandomHero(t){this.hoveredHero=void 0}onSelectFactionHero(t,n){t.selectedHero=n,this.hoveredHero=void 0}onHoverFactionHero(t,n){this.hoveredHero=n}onUnhoverFactionHero(t,n){this.hoveredHero=void 0}getHero(t){return t}returnToMainScreen(){this.events.dispatch(zn())}selectFactionForPlayer(t,n){t.selectedFaction=n,n?t.selectedHero=n.getAllHeroes()[0]:t.selectedHero=void 0}toggleControlType(t){t.isMainPlayer||(t.controlType=t.controlType===Lt.AI?Lt.Player:Lt.AI)}};e.\u0275fac=function(n){return new(n||e)(y(z),y(J),y(xe))},e.\u0275cmp=v({type:e,selectors:[["mw-new-game-screen"]],decls:28,vars:3,consts:[["heroInfo",""],["randomHero",""],["randomFaction",""],["factionsMenu",""],["heroesMenu",""],["colorsMenu",""],[1,"main-container"],[1,"players"],[1,"players-row"],[1,"name"],[1,"faction"],[1,"hero"],[1,"color"],[1,"player","players-row"],[1,"right-panel"],[1,"bottom-container"],[1,"buttons"],["mw-main-button","",3,"click"],[1,"player","players-row",3,"mouseenter","mouseleave"],[1,"name",3,"click","mwActionHint"],["icon","player-king"],[3,"icon"],["pos","below",3,"menuBody"],[4,"ngIf","ngIfElse"],[3,"menuBody","pos"],[1,"color-item",2,"position","relative","top","-6px"],[1,"item-icon",3,"icon"],[1,"icon-subtext"],["icon","perspective-dice-four",1,"item-icon"],["icon","perspective-dice-four",1,"item-icon",3,"click"],["class","item-icon",3,"icon","click",4,"ngFor","ngForOf"],[1,"item-icon",3,"click","icon"],[1,"item-icon","hero-icon"],[2,"display","flex","max-width","228px","padding","4px","justify-content","center","flex-wrap","wrap"],[1,"hero-option",3,"click","mouseenter","mouseleave"],["class","hero-option",3,"mouseenter","mouseleave","click",4,"ngFor","ngForOf"],[1,"hero-option",3,"mouseenter","mouseleave","click"],["class","color-item",3,"background","click",4,"ngFor","ngForOf"],[1,"color-item",3,"click"],[1,"hero-description"],["icon","aura",1,"hero-icon"],[1,"hero-stats"],[1,"column"],["icon","sword"],["icon","shield"],["icon","crystal-ball"],[2,"margin-top","16px"],[1,"description"],[3,"descriptions"],["icon","perspective-dice-four",1,"hero-icon"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngTemplateOutlet"]],template:function(n,o){if(n&1){let s=R();a(0,"div",6)(1,"div",7)(2,"div",8)(3,"div",9),d(4,"Player:"),c(),a(5,"div",10),d(6,"Faction:"),c(),a(7,"div",11),d(8,"Hero:"),c(),a(9,"div",12),d(10,"Color:"),c()(),ut(11,Gv,24,13,"div",13,Tt),c(),a(13,"div",14),g(14,Rv,27,9,"ng-template",null,0,Q)(16,Lv,9,3,"ng-template",null,1,Q)(18,zv,3,3)(19,qv,1,4,"ng-container")(20,Qv,1,1,"ng-container"),c()(),a(21,"div",15)(22,"div",16)(23,"button",17),S("click",function(){return E(s),I(o.startGame())}),d(24,"Start game"),c(),a(25,"button",17),S("click",function(){return E(s),I(o.returnToMainScreen())}),d(26,"Return"),c()()(),h(27,"mw-action-hint")}n&2&&(l(11),dt(o.players()),l(7),Oe(o.hoveredPlayer&&o.hoveredHero===void 0?18:-1),l(),Oe(o.hoveredHero?19:-1),l(),Oe(o.hoveredHero===null?20:-1))},dependencies:[q,se,yt,xt,Xt,Gi,le,rs,ae],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:100vh}.main-container[_ngcontent-%COMP%]{margin:8px;display:flex;flex-grow:1}.bottom-container[_ngcontent-%COMP%]{display:flex}.players[_ngcontent-%COMP%]{width:100%;height:200px;padding:20px;display:flex;flex-direction:column;gap:2px}.players-row[_ngcontent-%COMP%]{display:flex;padding:7px 15px 3px;align-items:center;font-size:13px}.players-row.player[_ngcontent-%COMP%]:hover{background-color:#27272725}.players-row[_ngcontent-%COMP%] > .name[_ngcontent-%COMP%]{flex:.1 0 80px;flex:0 0 100px;display:flex;align-items:center;justify-content:center;cursor:pointer;-webkit-user-select:none;user-select:none}.players-row[_ngcontent-%COMP%] > .name[_ngcontent-%COMP%] > mw-ra-icon[_ngcontent-%COMP%]{font-size:28px;margin-right:2px}.players-row.player[_ngcontent-%COMP%] > .name[_ngcontent-%COMP%]{padding-bottom:6px}.players-row[_ngcontent-%COMP%] > .faction[_ngcontent-%COMP%]{flex:.1 0 140px;display:flex;justify-content:center}.players-row[_ngcontent-%COMP%] > .hero[_ngcontent-%COMP%]{flex:.1 0 140px;display:flex;justify-content:center}.players-row[_ngcontent-%COMP%] > .color[_ngcontent-%COMP%]{display:flex;justify-content:center;flex:.1 0 140px}.item-icon[_ngcontent-%COMP%]{width:72px;height:42px;background-color:#545459;color:#fff;display:flex;font-size:30px;align-items:center;justify-content:center;border-radius:3px;cursor:pointer}.item-icon.hero-icon[_ngcontent-%COMP%]{background-size:cover;background-position:center center}.hero-option[_ngcontent-%COMP%]{padding:2px;cursor:pointer}.color-item[_ngcontent-%COMP%]{width:64px;height:36px;cursor:pointer}.color-item[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:2px}.icon-subtext[_ngcontent-%COMP%]{font-size:9px;text-align:center;display:block}.buttons[_ngcontent-%COMP%]{padding:20px;display:flex;margin-left:auto}.player[_ngcontent-%COMP%]{display:flex}.right-panel[_ngcontent-%COMP%]{flex:.1 0 300px;padding:10px;font-size:14px;text-align:center}.right-panel[_ngcontent-%COMP%]   .hero-description[_ngcontent-%COMP%]{padding-top:16px}.right-panel[_ngcontent-%COMP%]   .hero-description[_ngcontent-%COMP%]   .hero-icon[_ngcontent-%COMP%]{font-size:20px}.right-panel[_ngcontent-%COMP%]   .hero-description[_ngcontent-%COMP%]   .hero-stats[_ngcontent-%COMP%]{display:flex}.right-panel[_ngcontent-%COMP%]   .hero-description[_ngcontent-%COMP%]   .hero-stats[_ngcontent-%COMP%]   .column[_ngcontent-%COMP%]{font-size:13px;flex:1 0 100px;text-align:left;padding-left:53px}.right-panel[_ngcontent-%COMP%]   .hero-description[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:12px;margin-top:8px;padding:6px 20px;border-top:1px solid gainsboro}mw-action-hint[_ngcontent-%COMP%]{position:fixed;bottom:50px;left:0;right:0}"]});let i=e;return i})();function Xv(i,e){if(i&1){let r=R();ve(0),h(1,"mw-player-resources",3)(2,"mw-event-feed"),a(3,"div",4)(4,"mw-round-icon-btn",5),S("click",function(){E(r);let n=m();return I(n.openMainMenu())}),c()(),Ce()}}function Jv(i,e){i&1&&h(0,"mw-main-screen")}function eC(i,e){i&1&&h(0,"mw-new-game-screen")}function tC(i,e){i&1&&h(0,"mw-gameboard")}function iC(i,e){i&1&&h(0,"mw-structures-view")}function nC(i,e){i&1&&h(0,"mw-town-view")}var io=class io extends ce(){constructor(e){super(),this.cdr=e,this.currentView=Gt.MainScreen,this.viewTypes=Gt}openMainMenu(){this.events.dispatch(qn())}navigateToView({view:e}){this.currentView=e}initScreen(){this.events.dispatch(Ii({view:Gt.MainScreen}))}openMewGameScreen(){this.events.dispatch(Ii({view:Gt.NewGame}))}openMapStructuresScreen(){this.events.dispatch(Ii({view:Gt.Structures}))}playerAcceptsFight(){this.events.dispatch(Ii({view:Gt.Battleground})),this.cdr.detectChanges()}structIsCompleted(e){e.struct.isInactive=!0,this.events.dispatch(Ii({view:Gt.Structures})),this.events.dispatch(Ao({struct:e.struct}))}displayTown(){this.currentView=Gt.Town}};io.\u0275fac=function(r){return new(r||io)(y(mi))},io.\u0275cmp=v({type:io,selectors:[["mw-view-control"]],features:[j],decls:7,vars:7,consts:[[4,"ngIf"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"resources-panel"],[1,"menu-panel"],["mwActionHint","Main Menu","icon","repair",3,"click"]],template:function(r,t){r&1&&(g(0,Xv,5,0,"ng-container",0),ve(1,1),g(2,Jv,1,0,"mw-main-screen",2)(3,eC,1,0,"mw-new-game-screen",2)(4,tC,1,0,"mw-gameboard",2)(5,iC,1,0,"mw-structures-view",2)(6,nC,1,0,"mw-town-view",2),Ce()),r&2&&(u("ngIf",t.viewTypes.MainScreen!==t.currentView&&t.viewTypes.NewGame!==t.currentView),l(),u("ngSwitch",t.currentView),l(),u("ngSwitchCase",t.viewTypes.MainScreen),l(),u("ngSwitchCase",t.viewTypes.NewGame),l(),u("ngSwitchCase",t.viewTypes.Battleground),l(),u("ngSwitchCase",t.viewTypes.Structures),l(),u("ngSwitchCase",t.viewTypes.Town))},dependencies:[se,gi,ln,xt,ns,ba,In,Tl,um,xm,gl,Il],styles:[".resources-panel[_ngcontent-%COMP%]{position:fixed;left:0;top:0;display:flex;flex-direction:column;width:148px;padding:8px;z-index:1}mw-event-feed[_ngcontent-%COMP%]{position:fixed;right:50%;bottom:12%;max-width:400px;z-index:10000}.menu-panel[_ngcontent-%COMP%]{position:fixed;top:0;right:0;padding:7px}"]});var di=io;_([G(Ii)],di.prototype,"navigateToView",null);_([ee(zn)],di.prototype,"initScreen",null);_([ee(ko)],di.prototype,"openMewGameScreen",null);_([ee(Ur)],di.prototype,"openMapStructuresScreen",null);_([ee(Ln)],di.prototype,"playerAcceptsFight",null);_([G(Yi)],di.prototype,"structIsCompleted",null);_([ee(bo)],di.prototype,"displayTown",null);var oC=["hintsContainer"];function sC(i,e){if(i&1&&h(0,"mw-action-card",3),i&2){let r=e.$implicit;u("actionCard",r)}}var bm=[lt,ui,on,Cr,Kr,rn,Jt,pt,Bi,mt,sm],_m=(()=>{let e=class e{constructor(t,n){this.hintsService=t,this.events=n,this.actionCards=[fm,hm,gm,Sm,vm,Zo,ym,Sn,Cm],this.injectGlobalServices()}ngOnInit(){this.hintsService.containerRef=this.hintsContainer}ngAfterViewInit(){this.events.dispatch(wo())}injectGlobalServices(){bm.forEach(t=>L(t))}};e.\u0275fac=function(n){return new(n||e)(y($r),y(z))},e.\u0275cmp=v({type:e,selectors:[["app-root"]],viewQuery:function(n,o){if(n&1&&De(oC,7),n&2){let s;Ee(s=Ie())&&(o.hintsContainer=s.first)}},features:[bs(bm)],decls:9,vars:1,consts:[["hintsContainer",""],[1,"test",2,"display","none"],[3,"actionCard",4,"ngFor","ngForOf"],[3,"actionCard"]],template:function(n,o){n&1&&(h(0,"mw-view-control")(1,"mw-popup-container")(2,"mw-hints-container",null,0)(4,"mw-vfx-layer")(5,"mw-custom-cursor")(6,"mw-shared-templates"),a(7,"div",1),g(8,sC,1,1,"mw-action-card",2),c()),n&2&&(l(8),u("ngForOf",o.actionCards))},dependencies:[di,es,ls,ds,is,ha,ua,q],styles:[".test[_ngcontent-%COMP%]{position:absolute;left:100px;top:100px;display:flex;gap:12px;max-width:1000px;flex-wrap:wrap}"]});let i=e;return i})();var Mm=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-action-card-stack-item"]],inputs:{cardStack:"cardStack"},decls:3,vars:7,consts:[[3,"icon"],[2,"font-weight","600"]],template:function(n,o){n&1&&(h(0,"mw-ra-icon",0),a(1,"span",1),d(2),c()),n&2&&($("color",o.cardStack.card.iconColor)("background",o.cardStack.card.bgColor),u("icon",o.cardStack.card.icon),l(2),me("",o.cardStack.card.title," x",o.cardStack.count,""))},dependencies:[le],styles:["[_nghost-%COMP%]{display:block}mw-ra-icon[_ngcontent-%COMP%]{margin-right:3px}"],changeDetection:0});let i=e;return i})();var Fl=(()=>{let e=class e{transform(t){return oo(t)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275pipe=Ni({name:"infNum",type:e,pure:!0});let i=e;return i})();var aC=[Jr,Fl,Ht],cC=[ka,xr,Ra,Ga,xt,Oi],TH=[...cC,...aC,eo,es,ts,Mm,fa,cl,ls,Xt,ga,ya,ki,ai,lr,ps,Ma,us,zr,as,Ea,Pn,ds,is,ms,Aa,ns,il,ha,or,Gi,le,ua,pa,rs,sr,ae,Da,al,ba,ue,cs,cr,ss,xa,_a,Pa,Ca],Nt=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ye({type:e}),e.\u0275inj=qe({imports:[vt]});let i=e;return i})();Re(ts,[q,xt,es,le],[Fl]);Re(ls,[cl,Pn,le],[]);Re(ga,[Xt],[]);Re(ki,[pn,ga,ya,or,le],[]);Re(ai,[q,se,ya,ki,rs],[]);Re(lr,[Xt],[]);Re(ps,[Ma],[]);Re(Ma,[q,se,xr,Xt,us,zr,le],[yi]);Re(zr,[hi,se,pn,lr,or,le],[]);Re(as,[q,xt,Oi],[]);Re(ds,[Pn],[]);Re(is,[se,Pn],[]);Re(ms,[q,Pn],[]);Re(ns,[q,il],[]);Re(cs,[xt,le,sr],[]);Re(cr,[q,xt,Oi,ai,ss],[]);function lC(i,e){i&1&&h(0,"mw-ra-icon",4)}function pC(i,e){if(i&1){let r=R();a(0,"mw-spell-button",5),S("clicked",function(){let n=E(r).$implicit,o=m();return I(o.onAbilityClick(n))}),c()}if(i&2){let r=e.$implicit,t=m();u("spell",r)("player",t.currentPlayer)("hero",t.currentPlayer.hero)("disabled",t.currentPlayer.hero.stats.currentMana<r.currentManaCost||t.curPlayerState.spellsAreOnCooldown||!!r.cooldown)("isActive",t.curPlayerState.currentSpell===r)}}var Al=(()=>{let e=class e{constructor(t,n){this.players=t,this.curPlayerState=n,this.currentPlayer=this.players.getCurrentPlayer()}onAbilityClick(t){t.currentManaCost>this.currentPlayer.hero.stats.currentMana||this.curPlayerState.spellsAreOnCooldown||t.cooldown||this.curPlayerState.playerCurrentState!==Me.WaitsForTurn&&this.curPlayerState.onSpellClick(t)}};e.\u0275fac=function(n){return new(n||e)(y(k),y(We))},e.\u0275cmp=v({type:e,selectors:[["mw-battle-hero-abilities"]],decls:6,vars:3,consts:[[1,"abilities-list"],[1,"cd-icon"],["icon","hourglass",4,"ngIf"],[3,"spell","player","hero","disabled","isActive","clicked",4,"ngFor","ngForOf"],["icon","hourglass"],[3,"clicked","spell","player","hero","disabled","isActive"]],template:function(n,o){n&1&&(a(0,"div"),d(1),c(),a(2,"div",0)(3,"div",1),g(4,lC,1,0,"mw-ra-icon",2),c(),g(5,pC,1,5,"mw-spell-button",3),c()),n&2&&(l(),M(" ",o.curPlayerState.playerCurrentState,`
`),l(3),u("ngIf",o.curPlayerState.spellsAreOnCooldown),l(),u("ngForOf",o.currentPlayer.hero.spells))},styles:[".abilities-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:relative;width:56px}.cd-icon[_ngcontent-%COMP%]{position:absolute;top:50%;left:-27px;margin-top:-25%;font-size:24px}"]});let i=e;return i})();var uC=["historyLog"],Ua=i=>({log:i});function dC(i,e){i&1&&be(0)}function mC(i,e){if(i&1&&g(0,dC,1,0,"ng-container",8),i&2){let r=m().$implicit;m();let t=ne(7);u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,Ua,r))}}function fC(i,e){i&1&&be(0)}function hC(i,e){if(i&1&&g(0,fC,1,0,"ng-container",8),i&2){let r=m().$implicit;m();let t=ne(13);u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,Ua,r))}}function gC(i,e){i&1&&be(0)}function yC(i,e){if(i&1&&g(0,gC,1,0,"ng-container",8),i&2){let r=m().$implicit;m();let t=ne(11);u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,Ua,r))}}function vC(i,e){i&1&&be(0)}function CC(i,e){if(i&1&&g(0,vC,1,0,"ng-container",8),i&2){let r=m().$implicit;m();let t=ne(9);u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,Ua,r))}}function SC(i,e){if(i&1&&(a(0,"div",7),g(1,mC,1,4,"ng-container")(2,hC,1,4,"ng-container")(3,yC,1,4,"ng-container")(4,CC,1,4,"ng-container"),c()),i&2){let r,t=e.$implicit,n=m();l(),Oe((r=t.type)===n.types.SimpleMsg?1:r===n.types.RoundInfoMsg?2:r===n.types.DealtDamageMsg?3:r===n.types.Html?4:-1)}}function wC(i,e){if(i&1&&d(0),i&2){let r=e.log;M(" ",r.message,`
`)}}function xC(i,e){if(i&1&&(h(0,"div",9),re(1,"safeHtml")),i&2){let r=e.log;u("innerHTML",oe(1,1,r.message),jt)}}function bC(i,e){if(i&1&&(a(0,"div"),d(1),c()),i&2){let r=m().log;l(),M(" ",r.damageBlocked," damage was blocked ")}}function _C(i,e){if(i&1&&(a(0,"div")(1,"span"),d(2),c(),d(3),c()),i&2){let r=m().log;l(),$("color",r.attackingPlayer.color),l(),me("",r.attackersNumber," ",r.attacker.name,""),l(),me(" steal ",r.stolenLife," life, reviving ",r.stolenLifeUnitsRestored," units. ")}}function MC(i,e){if(i&1&&(a(0,"div")(1,"span"),d(2),c(),d(3),a(4,"span"),d(5),c(),d(6),g(7,bC,2,1,"div",10)(8,_C,4,6,"div",10),c()),i&2){let r=e.log;l(),$("color",r.attackingPlayer.color),l(),me("",r.attackersNumber," ",r.attacker.name,""),l(),me(" deal ",r.damage," ",r.isCritical?"critical":""," damage to "),l(),$("color",r.attackedPlayer.color),l(),me("",r.attackedNumber," ",r.attacked.name,""),l(),M(" , killing ",r.losses," units "),l(),u("ngIf",r.damageBlocked),l(),u("ngIf",r.stolenLife)}}function PC(i,e){if(i&1&&(a(0,"div",11),d(1),c()),i&2){let r=e.log;l(),M(" ",r.message," ")}}var Pm=(()=>{let e=class e{constructor(t){this.battleLogService=t,this.types=Gn,this.battleLogService.historyEvent$.pipe(os()).subscribe(()=>{let n=this.historyLogElem.nativeElement;setTimeout(()=>{n.scrollTo({top:n.scrollHeight,behavior:"smooth"})},0)})}};e.\u0275fac=function(n){return new(n||e)(y(Ai))},e.\u0275cmp=v({type:e,selectors:[["mw-history-log"]],viewQuery:function(n,o){if(n&1&&De(uC,7),n&2){let s;Ee(s=Ie())&&(o.historyLogElem=s.first)}},decls:14,vars:0,consts:[["historyLog",""],["simple",""],["htmlLog",""],["dealtDamageLog",""],["roundInfoMsg",""],[1,"history-panel"],[1,"history-log"],[1,"entry"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"innerHTML"],[4,"ngIf"],[2,"padding","8px","text-align","center"]],template:function(n,o){n&1&&(a(0,"div",5),d(1," Battle Log: "),a(2,"div",6,0),ut(4,SC,5,1,"div",7,Tt),c()(),g(6,wC,1,1,"ng-template",null,1,Q)(8,xC,2,3,"ng-template",null,2,Q)(10,MC,9,13,"ng-template",null,3,Q)(12,PC,2,1,"ng-template",null,4,Q)),n&2&&(l(4),dt(o.battleLogService.history))},dependencies:[se,yt,Ht],styles:[".history-log[_ngcontent-%COMP%]{height:200px;overflow-y:scroll;font-size:13px}.history-panel[_ngcontent-%COMP%]{background-color:#fff}.entry[_ngcontent-%COMP%]{margin-bottom:8px}"]});let i=e;return i})();function DC(i,e){if(i&1&&h(0,"mw-item-icon",2),i&2){let r=e.$implicit;u("item",r)("hintPos","after")}}var Ol=(()=>{let e=class e{constructor(t){this.players=t}ngOnInit(){this.currentPlayer=this.players.getCurrentPlayer(),this.equippedItems=this.currentPlayer.hero.inventory.getEquippedItems()}};e.\u0275fac=function(n){return new(n||e)(y(k))},e.\u0275cmp=v({type:e,selectors:[["mw-items-panel"]],decls:2,vars:1,consts:[[1,"items-container"],[3,"item","hintPos",4,"ngFor","ngForOf"],[3,"item","hintPos"]],template:function(n,o){n&1&&(a(0,"div",0),g(1,DC,1,2,"mw-item-icon",1),c()),n&2&&(l(),u("ngForOf",o.equippedItems))},styles:[".items-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;font-size:12px}"]});let i=e;return i})();var Dm=(i,e)=>({color:i,background:e});function EC(i,e){if(i&1&&(a(0,"div",3),h(1,"mw-ra-icon",4),a(2,"div",5)(3,"div"),d(4),c(),a(5,"div"),d(6),c()()(),a(7,"div",6),h(8,"mw-spell-description",7),c()),i&2){let r=m();l(),u("icon",r.icon().icon)("ngStyle",$t(8,Dm,r.icon().iconClr,r.icon().bgClr)),l(3),H(r.baseType().name),l(2),M("Level ",r.buff().currentLevel,""),l(2),u("ownerUnit",r.ownerUnit())("hero",r.ownerUnit().ownerPlayer.hero)("player",r.ownerUnit().ownerPlayer)("spell",r.buff())}}var kl=(()=>{let e=class e{constructor(){this.buff=Z.required(),this.ownerUnit=Z.required(),this.hintPos=Z("above"),this.baseType=Te(()=>this.buff().baseType),this.icon=Te(()=>this.baseType().icon)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-unit-group-buff"]],inputs:{buff:[1,"buff"],ownerUnit:[1,"ownerUnit"],hintPos:[1,"hintPos"]},decls:4,vars:7,consts:[["buffHint",""],[3,"hintBody","hintPos"],[1,"buff-icon",3,"icon","ngStyle"],[2,"display","flex"],[1,"hint-icon",3,"icon","ngStyle"],[2,"padding","4px","font-size","14px"],[2,"padding","4px","font-size","13px","max-width","240px"],[3,"ownerUnit","hero","player","spell"]],template:function(n,o){if(n&1&&(a(0,"mw-hover-hint",1),h(1,"mw-ra-icon",2),c(),g(2,EC,9,11,"ng-template",null,0,Q)),n&2){let s=ne(3);u("hintBody",s)("hintPos",o.hintPos()),l(),u("icon",o.icon().icon)("ngStyle",$t(4,Dm,o.icon().iconClr,o.icon().bgClr))}},styles:[".buff-icon[_ngcontent-%COMP%]{display:block;font-size:24px;border-radius:50%;margin:4px;text-align:center;font-size:18px;width:20px;height:20px}.hint-icon[_ngcontent-%COMP%]{width:38px;font-size:30px;text-align:center;padding-top:5px}"],changeDetection:0});let i=e;return i})();var Gl=(()=>{let e=class e{constructor(){this.curPlayerState=L(We),this.spell=Z.required(),this.owner=Z.required(),this.hero=Z(),this.currentUnit=Z(),this.onCooldown=Z(),this.hintPos=Z("above"),this.baseType=Te(()=>this.spell().baseType),this.icon=Te(()=>this.baseType().icon),this.isPassive=Te(()=>this.baseType().activationType===A.Passive),this.disabled=Te(()=>this.currentUnit()!==this.owner()&&!this.isPassive())}onSpellClick(t){t.stopPropagation();let n=(this.hero()?.getState().currentMana||0)+(this.currentUnit()?.getMana()||0);this.onCooldown()||this.disabled()||!this.owner().fightInfo.isAlive||this.isPassive()||n<this.spell().currentManaCost||this.curPlayerState.playerCurrentState!==Me.WaitsForTurn&&this.curPlayerState.onSpellClick(this.spell(),this.owner())}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=v({type:e,selectors:[["mw-unit-group-spell"]],inputs:{spell:[1,"spell"],owner:[1,"owner"],hero:[1,"hero"],currentUnit:[1,"currentUnit"],onCooldown:[1,"onCooldown"],hintPos:[1,"hintPos"]},decls:1,vars:6,consts:[[3,"click","disabled","owner","hintPos","hero","onCooldown","spell"]],template:function(n,o){n&1&&(a(0,"mw-unit-group-spell-icon",0),S("click",function(p){return o.onSpellClick(p)}),c()),n&2&&u("disabled",o.disabled())("owner",o.owner())("hintPos",o.hintPos())("hero",o.hero())("onCooldown",o.onCooldown())("spell",o.spell())},changeDetection:0});let i=e;return i})();var Ba=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ye({type:e}),e.\u0275inj=qe({imports:[Nt,vt]});let i=e;return i})();Re(Al,[le,q,se,ys],[]);Re(In,[Ra,Ga,xt,Oi,Gi,sr,hi,q,Al,Pm,Ol,Ss],[yi]);Re(Ol,[ki,q],[]);Re(ys,[lr,or,le,pn],[]);Re(Ss,[xr,us,ms,le,Da,hi,q,se,kl,Gl],[yi]);Re(kl,[lr,or,le,pn],[]);Re(Gl,[zr],[]);var Em=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ye({type:e}),e.\u0275inj=qe({imports:[vt,Nt]});let i=e;return i})();var Im=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ye({type:e}),e.\u0275inj=qe({imports:[vt,Nt]});let i=e;return i})();var Tm=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ye({type:e}),e.\u0275inj=qe({imports:[vt,Nt]});let i=e;return i})();var Fm=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ye({type:e}),e.\u0275inj=qe({imports:[vt,Nt]});let i=e;return i})();var Am=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ye({type:e}),e.\u0275inj=qe({imports:[vt,Nt,Ba,Em,Tm,Im,Fm]});let i=e;return i})();var Rl=class extends Er{constructor(){super(...arguments),this.feed=L(nn)}handleError(e){console.error(e),!e.message.startsWith("NG")&&this.feed.pushSystemError(e)}},Om=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ye({type:e,bootstrap:[_m]}),e.\u0275inj=qe({providers:[{provide:Er,useClass:Rl}],imports:[Ba,Am,Nt,Xp]});let i=e;return i})();var km={production:!0};km.production&&void 0;Zp().bootstrapModule(Om).catch(i=>console.error(i));
