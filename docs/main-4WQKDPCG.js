import{$ as ip,$a as Ae,$b as Tp,A as C,Aa as pt,Ab as wp,B as ze,Ba as ei,Bb as Ar,C as Re,Ca as La,Cb as We,D as Ui,Da as wt,Db as kn,E as Yl,Ea as St,Eb as Hi,F as Ql,Fa as a,Fb as mi,G as Bi,Ga as c,Gb as Sp,H as A,Ha as h,Hb as F,I as O,Ia as ye,Ib as P,J as Kl,Ja as ve,Jb as xp,K as dt,Ka as ke,Kb as bp,L as vs,La as R,Lb as Or,M as Pr,Ma as w,Mb as _p,N as Dr,Na as f,Nb as q,O as Zl,Oa as ti,Ob as Mp,P as ee,Pa as Et,Pb as Pp,Q as mt,Qa as Fr,Qb as Dp,R as Ct,Ra as Pe,Rb as no,S as Xl,Sa as De,Sb as Ep,T as Cs,Ta as Ee,Tb as xt,U as Jl,Ua as se,Ub as ft,V as Er,Va as d,Vb as Ip,W as Ba,Wa as B,Wb as qe,X as Tn,Xa as M,Xb as rn,Y as Ir,Ya as fe,Yb as Tt,Z as ep,Za as up,Zb as Ft,_ as tp,_a as xs,_b as Q,a as D,aa as np,ab as Ue,ac as Se,b as K,ba as rp,bb as Ht,bc as Fp,c as br,ca as op,cb as ie,d as Nl,da as sp,db as ne,e as jl,ea as Fn,eb as Y,f as Mt,fa as Bt,fb as dp,g as Pt,ga as ws,gb as bs,h as Ri,ha as An,hb as _s,i as _r,ia as l,ib as Na,j as Dt,ja as y,jb as mp,k as $l,ka as Tr,kb as fp,l as In,la as ap,lb as hp,m as Mr,ma as Le,mb as gp,n as Vl,na as Jt,nb as di,o as Xe,oa as _i,ob as yp,p as zl,pa as Ss,pb as ja,q as xi,qa as N,qb as vp,r as tn,ra as cp,rb as Cp,s as Wl,sa as lp,sb as Be,t as ql,ta as g,tb as Ms,u as T,ua as Ha,ub as $a,v as Ve,va as u,vb as On,w as bi,wa as $,wb as It,x,xa as pe,xb as V,y as H,ya as pp,yb as Mi,z as io,za as nn,zb as Ne}from"./chunk-GWQ3E5NJ.js";var Up=null;function Es(){return Up}function Bp(i){Up??=i}var Ps=class{};var Li=new bi("");function Hp(i,e){e=encodeURIComponent(e);for(let r of i.split(";")){let t=r.indexOf("="),[n,o]=t==-1?[r,""]:[r.slice(0,t),r.slice(t+1)];if(n.trim()===e)return decodeURIComponent(o)}return null}var Va=/\s+/,Ap=[],fi=(()=>{let e=class e{constructor(t,n){this._ngEl=t,this._renderer=n,this.initialClasses=Ap,this.stateMap=new Map}set klass(t){this.initialClasses=t!=null?t.trim().split(Va):Ap}set ngClass(t){this.rawClass=typeof t=="string"?t.trim().split(Va):t}ngDoCheck(){for(let n of this.initialClasses)this._updateState(n,!0);let t=this.rawClass;if(Array.isArray(t)||t instanceof Set)for(let n of t)this._updateState(n,!0);else if(t!=null)for(let n of Object.keys(t))this._updateState(n,!!t[n]);this._applyStateDiff()}_updateState(t,n){let o=this.stateMap.get(t);o!==void 0?(o.enabled!==n&&(o.changed=!0,o.enabled=n),o.touched=!0):this.stateMap.set(t,{enabled:n,changed:!0,touched:!0})}_applyStateDiff(){for(let t of this.stateMap){let n=t[0],o=t[1];o.changed?(this._toggleClass(n,o.enabled),o.changed=!1):o.touched||(o.enabled&&this._toggleClass(n,!1),this.stateMap.delete(n)),o.touched=!1}}_toggleClass(t,n){t=t.trim(),t.length>0&&t.split(Va).forEach(o=>{n?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}};e.\u0275fac=function(n){return new(n||e)(y(mt),y(Le))},e.\u0275dir=Re({type:e,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"},standalone:!0});let i=e;return i})(),Lp=(()=>{let e=class e{constructor(t){this._viewContainerRef=t,this.ngComponentOutlet=null,this._inputsUsed=new Map}_needToReCreateNgModuleInstance(t){return t.ngComponentOutletNgModule!==void 0||t.ngComponentOutletNgModuleFactory!==void 0}_needToReCreateComponentInstance(t){return t.ngComponentOutlet!==void 0||t.ngComponentOutletContent!==void 0||t.ngComponentOutletInjector!==void 0||this._needToReCreateNgModuleInstance(t)}ngOnChanges(t){if(this._needToReCreateComponentInstance(t)&&(this._viewContainerRef.clear(),this._inputsUsed.clear(),this._componentRef=void 0,this.ngComponentOutlet)){let n=this.ngComponentOutletInjector||this._viewContainerRef.parentInjector;this._needToReCreateNgModuleInstance(t)&&(this._moduleRef?.destroy(),this.ngComponentOutletNgModule?this._moduleRef=lp(this.ngComponentOutletNgModule,Op(n)):this.ngComponentOutletNgModuleFactory?this._moduleRef=this.ngComponentOutletNgModuleFactory.create(Op(n)):this._moduleRef=void 0),this._componentRef=this._viewContainerRef.createComponent(this.ngComponentOutlet,{injector:n,ngModuleRef:this._moduleRef,projectableNodes:this.ngComponentOutletContent})}}ngDoCheck(){if(this._componentRef){if(this.ngComponentOutletInputs)for(let t of Object.keys(this.ngComponentOutletInputs))this._inputsUsed.set(t,!0);this._applyInputStateDiff(this._componentRef)}}ngOnDestroy(){this._moduleRef?.destroy()}_applyInputStateDiff(t){for(let[n,o]of this._inputsUsed)o?(t.setInput(n,this.ngComponentOutletInputs[n]),this._inputsUsed.set(n,!1)):(t.setInput(n,void 0),this._inputsUsed.delete(n))}};e.\u0275fac=function(n){return new(n||e)(y(_i))},e.\u0275dir=Re({type:e,selectors:[["","ngComponentOutlet",""]],inputs:{ngComponentOutlet:"ngComponentOutlet",ngComponentOutletInputs:"ngComponentOutletInputs",ngComponentOutletInjector:"ngComponentOutletInjector",ngComponentOutletContent:"ngComponentOutletContent",ngComponentOutletNgModule:"ngComponentOutletNgModule",ngComponentOutletNgModuleFactory:"ngComponentOutletNgModuleFactory"},standalone:!0,features:[Bi]});let i=e;return i})();function Op(i){return i.get(cp).injector}var za=class{constructor(e,r,t,n){this.$implicit=e,this.ngForOf=r,this.index=t,this.count=n}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},z=(()=>{let e=class e{set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}constructor(t,n,o){this._viewContainer=t,this._template=n,this._differs=o,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let t=this._ngForOf;if(!this._differ&&t)if(0)try{}catch{}else this._differ=this._differs.find(t).create(this.ngForTrackBy)}if(this._differ){let t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){let n=this._viewContainer;t.forEachOperation((o,s,p)=>{if(o.previousIndex==null)n.createEmbeddedView(this._template,new za(o.item,this._ngForOf,-1,-1),p===null?void 0:p);else if(p==null)n.remove(s===null?void 0:s);else if(s!==null){let m=n.get(s);n.move(m,p),kp(m,o)}});for(let o=0,s=n.length;o<s;o++){let m=n.get(o).context;m.index=o,m.count=s,m.ngForOf=this._ngForOf}t.forEachIdentityChange(o=>{let s=n.get(o.currentIndex);kp(s,o)})}static ngTemplateContextGuard(t,n){return!0}};e.\u0275fac=function(n){return new(n||e)(y(_i),y(Tr),y(yp))},e.\u0275dir=Re({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0});let i=e;return i})();function kp(i,e){i.context.$implicit=e.item}var re=(()=>{let e=class e{constructor(t,n){this._viewContainer=t,this._context=new Wa,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=n}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){Gp("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){Gp("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,n){return!0}};e.\u0275fac=function(n){return new(n||e)(y(_i),y(Tr))},e.\u0275dir=Re({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let i=e;return i})(),Wa=class{constructor(){this.$implicit=null,this.ngIf=null}};function Gp(i,e){if(!!!(!e||e.createEmbeddedView))throw new Error(`${i} must be a TemplateRef, but received '${Wl(e)}'.`)}var Hm=!0,qa=class{constructor(e,r){this._viewContainerRef=e,this._templateRef=r,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(e){e&&!this._created?this.create():!e&&this._created&&this.destroy()}},hi=(()=>{let e=class e{constructor(){this._defaultViews=[],this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(t){this._ngSwitch=t,this._caseCount===0&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(t){this._defaultViews.push(t)}_matchCase(t){let n=Hm?t===this._ngSwitch:t==this._ngSwitch;return this._lastCasesMatched||=n,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),n}_updateDefaultCases(t){if(this._defaultViews.length>0&&t!==this._defaultUsed){this._defaultUsed=t;for(let n of this._defaultViews)n.enforceState(t)}}};e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=Re({type:e,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"},standalone:!0});let i=e;return i})(),on=(()=>{let e=class e{constructor(t,n,o){this.ngSwitch=o,o._addCase(),this._view=new qa(t,n)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}};e.\u0275fac=function(n){return new(n||e)(y(_i),y(Tr),y(hi,9))},e.\u0275dir=Re({type:e,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"},standalone:!0});let i=e;return i})();var sn=(()=>{let e=class e{constructor(t,n,o){this._ngEl=t,this._differs=n,this._renderer=o,this._ngStyle=null,this._differ=null}set ngStyle(t){this._ngStyle=t,!this._differ&&t&&(this._differ=this._differs.find(t).create())}ngDoCheck(){if(this._differ){let t=this._differ.diff(this._ngStyle);t&&this._applyChanges(t)}}_setStyle(t,n){let[o,s]=t.split("."),p=o.indexOf("-")===-1?void 0:An.DashCase;n!=null?this._renderer.setStyle(this._ngEl.nativeElement,o,s?`${n}${s}`:n,p):this._renderer.removeStyle(this._ngEl.nativeElement,o,p)}_applyChanges(t){t.forEachRemovedItem(n=>this._setStyle(n.key,null)),t.forEachAddedItem(n=>this._setStyle(n.key,n.currentValue)),t.forEachChangedItem(n=>this._setStyle(n.key,n.currentValue))}};e.\u0275fac=function(n){return new(n||e)(y(mt),y(ja),y(Le))},e.\u0275dir=Re({type:e,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0});let i=e;return i})(),At=(()=>{let e=class e{constructor(t){this._viewContainerRef=t,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(t){if(this._shouldRecreateView(t)){let n=this._viewContainerRef;if(this._viewRef&&n.remove(n.indexOf(this._viewRef)),!this.ngTemplateOutlet){this._viewRef=null;return}let o=this._createContextForwardProxy();this._viewRef=n.createEmbeddedView(this.ngTemplateOutlet,o,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(t){return!!t.ngTemplateOutlet||!!t.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(t,n,o)=>this.ngTemplateOutletContext?Reflect.set(this.ngTemplateOutletContext,n,o):!1,get:(t,n,o)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,n,o)}})}};e.\u0275fac=function(n){return new(n||e)(y(_i))},e.\u0275dir=Re({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[Bi]});let i=e;return i})();function Lm(i,e){return new xi(2100,!1)}var Ya=class{createSubscription(e,r){return Ms(()=>e.subscribe({next:r,error:t=>{throw t}}))}dispose(e){Ms(()=>e.unsubscribe())}},Qa=class{createSubscription(e,r){return e.then(r,t=>{throw t})}dispose(e){}},Nm=new Qa,jm=new Ya,gi=(()=>{let e=class e{constructor(t){this._latestValue=null,this.markForCheckOnValueUpdate=!0,this._subscription=null,this._obj=null,this._strategy=null,this._ref=t}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(t){if(!this._obj){if(t)try{this.markForCheckOnValueUpdate=!1,this._subscribe(t)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,n=>this._updateLatestValue(t,n))}_selectStrategy(t){if(mp(t))return Nm;if(fp(t))return jm;throw Lm(e,t)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,n){t===this._obj&&(this._latestValue=n,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}};e.\u0275fac=function(n){return new(n||e)(y(di,16))},e.\u0275pipe=Ui({name:"async",type:e,pure:!1,standalone:!0});let i=e;return i})();function $m(i,e){return{key:i,value:e}}var ii=(()=>{let e=class e{constructor(t){this.differs=t,this.keyValues=[],this.compareFn=Rp}transform(t,n=Rp){if(!t||!(t instanceof Map)&&typeof t!="object")return null;this.differ??=this.differs.find(t).create();let o=this.differ.diff(t),s=n!==this.compareFn;return o&&(this.keyValues=[],o.forEachItem(p=>{this.keyValues.push($m(p.key,p.currentValue))})),(o||s)&&(this.keyValues.sort(n),this.compareFn=n),this.keyValues}};e.\u0275fac=function(n){return new(n||e)(y(ja,16))},e.\u0275pipe=Ui({name:"keyvalue",type:e,pure:!1,standalone:!0});let i=e;return i})();function Rp(i,e){let r=i.key,t=e.key;if(r===t)return 0;if(r===void 0)return 1;if(t===void 0)return-1;if(r===null)return 1;if(t===null)return-1;if(typeof r=="string"&&typeof t=="string")return r<t?-1:1;if(typeof r=="number"&&typeof t=="number")return r-t;if(typeof r=="boolean"&&typeof t=="boolean")return r<t?-1:1;let n=String(r),o=String(t);return n==o?0:n<o?-1:1}var ht=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ze({type:e}),e.\u0275inj=Ve({});let i=e;return i})(),Np="browser",Vm="server";function Ka(i){return i===Vm}var Ds=class{};var Ja=class extends Ps{constructor(){super(...arguments),this.supportsDOMEvents=!0}},ec=class i extends Ja{static makeCurrent(){Bp(new i)}onAndCancel(e,r,t){return e.addEventListener(r,t),()=>{e.removeEventListener(r,t)}}dispatchEvent(e,r){e.dispatchEvent(r)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,r){return r=r||this.getDefaultDocument(),r.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,r){return r==="window"?window:r==="document"?e:r==="body"?e.body:null}getBaseHref(e){let r=Wm();return r==null?null:qm(r)}resetBaseElement(){ro=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Hp(document.cookie,e)}},ro=null;function Wm(){return ro=ro||document.querySelector("base"),ro?ro.getAttribute("href"):null}function qm(i){return new URL(i,document.baseURI).pathname}var tc=class{addToWindow(e){tn.getAngularTestability=(t,n=!0)=>{let o=e.findTestabilityInTree(t,n);if(o==null)throw new xi(5103,!1);return o},tn.getAllAngularTestabilities=()=>e.getAllTestabilities(),tn.getAllAngularRootElements=()=>e.getAllRootElements();let r=t=>{let n=tn.getAllAngularTestabilities(),o=n.length,s=function(){o--,o==0&&t()};n.forEach(p=>{p.whenStable(s)})};tn.frameworkStabilizers||(tn.frameworkStabilizers=[]),tn.frameworkStabilizers.push(r)}findTestabilityInTree(e,r,t){if(r==null)return null;let n=e.getTestability(r);return n??(t?Es().isShadowRoot(r)?this.findTestabilityInTree(e,r.host,!0):this.findTestabilityInTree(e,r.parentElement,!0):null)}},Ym=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac});let i=e;return i})(),ic=new bi(""),zp=(()=>{let e=class e{constructor(t,n){this._zone=n,this._eventNameToPlugin=new Map,t.forEach(o=>{o.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,n,o){return this._findPluginFor(n).addEventListener(t,n,o)}getZone(){return this._zone}_findPluginFor(t){let n=this._eventNameToPlugin.get(t);if(n)return n;if(n=this._plugins.find(s=>s.supports(t)),!n)throw new xi(5101,!1);return this._eventNameToPlugin.set(t,n),n}};e.\u0275fac=function(n){return new(n||e)(x(ic),x(Jt))},e.\u0275prov=T({token:e,factory:e.\u0275fac});let i=e;return i})(),Is=class{constructor(e){this._doc=e}},Za="ng-app-id",Wp=(()=>{let e=class e{constructor(t,n,o,s={}){this.doc=t,this.appId=n,this.nonce=o,this.platformId=s,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Ka(s),this.resetHostNodes()}addStyles(t){for(let n of t)this.changeUsageCount(n,1)===1&&this.onStyleAdded(n)}removeStyles(t){for(let n of t)this.changeUsageCount(n,-1)<=0&&this.onStyleRemoved(n)}ngOnDestroy(){let t=this.styleNodesInDOM;t&&(t.forEach(n=>n.remove()),t.clear());for(let n of this.getAllStyles())this.onStyleRemoved(n);this.resetHostNodes()}addHost(t){this.hostNodes.add(t);for(let n of this.getAllStyles())this.addStyleToHost(t,n)}removeHost(t){this.hostNodes.delete(t)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(t){for(let n of this.hostNodes)this.addStyleToHost(n,t)}onStyleRemoved(t){let n=this.styleRef;n.get(t)?.elements?.forEach(o=>o.remove()),n.delete(t)}collectServerRenderedStyles(){let t=this.doc.head?.querySelectorAll(`style[${Za}="${this.appId}"]`);if(t?.length){let n=new Map;return t.forEach(o=>{o.textContent!=null&&n.set(o.textContent,o)}),n}return null}changeUsageCount(t,n){let o=this.styleRef;if(o.has(t)){let s=o.get(t);return s.usage+=n,s.usage}return o.set(t,{usage:n,elements:[]}),n}getStyleElement(t,n){let o=this.styleNodesInDOM,s=o?.get(n);if(s?.parentNode===t)return o.delete(n),s.removeAttribute(Za),s;{let p=this.doc.createElement("style");return this.nonce&&p.setAttribute("nonce",this.nonce),p.textContent=n,this.platformIsServer&&p.setAttribute(Za,this.appId),t.appendChild(p),p}}addStyleToHost(t,n){let o=this.getStyleElement(t,n),s=this.styleRef,p=s.get(n)?.elements;p?p.push(o):s.set(n,{elements:[o],usage:1})}resetHostNodes(){let t=this.hostNodes;t.clear(),t.add(this.doc.head)}};e.\u0275fac=function(n){return new(n||e)(x(Li),x(Cs),x(Ba,8),x(Er))},e.\u0275prov=T({token:e,factory:e.\u0275fac});let i=e;return i})(),Xa={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},rc=/%COMP%/g,qp="%COMP%",Qm=`_nghost-${qp}`,Km=`_ngcontent-${qp}`,Zm=!0,Xm=new bi("",{providedIn:"root",factory:()=>Zm});function Jm(i){return Km.replace(rc,i)}function ef(i){return Qm.replace(rc,i)}function Yp(i,e){return e.map(r=>r.replace(rc,i))}var jp=(()=>{let e=class e{constructor(t,n,o,s,p,m,v,S=null){this.eventManager=t,this.sharedStylesHost=n,this.appId=o,this.removeStylesOnCompDestroy=s,this.doc=p,this.platformId=m,this.ngZone=v,this.nonce=S,this.rendererByCompId=new Map,this.platformIsServer=Ka(m),this.defaultRenderer=new oo(t,p,v,this.platformIsServer)}createRenderer(t,n){if(!t||!n)return this.defaultRenderer;this.platformIsServer&&n.encapsulation===io.ShadowDom&&(n=K(D({},n),{encapsulation:io.Emulated}));let o=this.getOrCreateRenderer(t,n);return o instanceof Ts?o.applyToHost(t):o instanceof so&&o.applyStyles(),o}getOrCreateRenderer(t,n){let o=this.rendererByCompId,s=o.get(n.id);if(!s){let p=this.doc,m=this.ngZone,v=this.eventManager,S=this.sharedStylesHost,E=this.removeStylesOnCompDestroy,L=this.platformIsServer;switch(n.encapsulation){case io.Emulated:s=new Ts(v,S,n,this.appId,E,p,m,L);break;case io.ShadowDom:return new nc(v,S,t,n,p,m,this.nonce,L);default:s=new so(v,S,n,E,p,m,L);break}o.set(n.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(n){return new(n||e)(x(zp),x(Wp),x(Cs),x(Xm),x(Li),x(Er),x(Jt),x(Ba))},e.\u0275prov=T({token:e,factory:e.\u0275fac});let i=e;return i})(),oo=class{constructor(e,r,t,n){this.eventManager=e,this.doc=r,this.ngZone=t,this.platformIsServer=n,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,r){return r?this.doc.createElementNS(Xa[r]||r,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,r){($p(e)?e.content:e).appendChild(r)}insertBefore(e,r,t){e&&($p(e)?e.content:e).insertBefore(r,t)}removeChild(e,r){e&&e.removeChild(r)}selectRootElement(e,r){let t=typeof e=="string"?this.doc.querySelector(e):e;if(!t)throw new xi(-5104,!1);return r||(t.textContent=""),t}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,r,t,n){if(n){r=n+":"+r;let o=Xa[n];o?e.setAttributeNS(o,r,t):e.setAttribute(r,t)}else e.setAttribute(r,t)}removeAttribute(e,r,t){if(t){let n=Xa[t];n?e.removeAttributeNS(n,r):e.removeAttribute(`${t}:${r}`)}else e.removeAttribute(r)}addClass(e,r){e.classList.add(r)}removeClass(e,r){e.classList.remove(r)}setStyle(e,r,t,n){n&(An.DashCase|An.Important)?e.style.setProperty(r,t,n&An.Important?"important":""):e.style[r]=t}removeStyle(e,r,t){t&An.DashCase?e.style.removeProperty(r):e.style[r]=""}setProperty(e,r,t){e!=null&&(e[r]=t)}setValue(e,r){e.nodeValue=r}listen(e,r,t){if(typeof e=="string"&&(e=Es().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${r}`);return this.eventManager.addEventListener(e,r,this.decoratePreventDefault(t))}decoratePreventDefault(e){return r=>{if(r==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(r)):e(r))===!1&&r.preventDefault()}}};function $p(i){return i.tagName==="TEMPLATE"&&i.content!==void 0}var nc=class extends oo{constructor(e,r,t,n,o,s,p,m){super(e,o,s,m),this.sharedStylesHost=r,this.hostEl=t,this.shadowRoot=t.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let v=Yp(n.id,n.styles);for(let S of v){let E=document.createElement("style");p&&E.setAttribute("nonce",p),E.textContent=S,this.shadowRoot.appendChild(E)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,r){return super.appendChild(this.nodeOrShadowRoot(e),r)}insertBefore(e,r,t){return super.insertBefore(this.nodeOrShadowRoot(e),r,t)}removeChild(e,r){return super.removeChild(this.nodeOrShadowRoot(e),r)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},so=class extends oo{constructor(e,r,t,n,o,s,p,m){super(e,o,s,p),this.sharedStylesHost=r,this.removeStylesOnCompDestroy=n,this.styles=m?Yp(m,t.styles):t.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Ts=class extends so{constructor(e,r,t,n,o,s,p,m){let v=n+"-"+t.id;super(e,r,t,o,s,p,m,v),this.contentAttr=Jm(v),this.hostAttr=ef(v)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,r){let t=super.createElement(e,r);return super.setAttribute(t,this.contentAttr,""),t}},tf=(()=>{let e=class e extends Is{constructor(t){super(t)}supports(t){return!0}addEventListener(t,n,o){return t.addEventListener(n,o,!1),()=>this.removeEventListener(t,n,o)}removeEventListener(t,n,o){return t.removeEventListener(n,o)}};e.\u0275fac=function(n){return new(n||e)(x(Li))},e.\u0275prov=T({token:e,factory:e.\u0275fac});let i=e;return i})(),Vp=["alt","control","meta","shift"],nf={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},rf={alt:i=>i.altKey,control:i=>i.ctrlKey,meta:i=>i.metaKey,shift:i=>i.shiftKey},of=(()=>{let e=class e extends Is{constructor(t){super(t)}supports(t){return e.parseEventName(t)!=null}addEventListener(t,n,o){let s=e.parseEventName(n),p=e.eventCallback(s.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Es().onAndCancel(t,s.domEventName,p))}static parseEventName(t){let n=t.toLowerCase().split("."),o=n.shift();if(n.length===0||!(o==="keydown"||o==="keyup"))return null;let s=e._normalizeKey(n.pop()),p="",m=n.indexOf("code");if(m>-1&&(n.splice(m,1),p="code."),Vp.forEach(S=>{let E=n.indexOf(S);E>-1&&(n.splice(E,1),p+=S+".")}),p+=s,n.length!=0||s.length===0)return null;let v={};return v.domEventName=o,v.fullKey=p,v}static matchEventFullKeyCode(t,n){let o=nf[t.key]||t.key,s="";return n.indexOf("code.")>-1&&(o=t.code,s="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),Vp.forEach(p=>{if(p!==o){let m=rf[p];m(t)&&(s+=p+".")}}),s+=o,s===n)}static eventCallback(t,n,o){return s=>{e.matchEventFullKeyCode(s,t)&&o.runGuarded(()=>n(s))}}static _normalizeKey(t){return t==="esc"?"escape":t}};e.\u0275fac=function(n){return new(n||e)(x(Li))},e.\u0275prov=T({token:e,factory:e.\u0275fac});let i=e;return i})();function sf(){ec.makeCurrent()}function af(){return new Pr}function cf(){return Xl(document),document}var lf=[{provide:Er,useValue:Np},{provide:Jl,useValue:sf,multi:!0},{provide:Li,useFactory:cf,deps:[]}],Qp=hp(vp,"browser",lf),pf=new bi(""),uf=[{provide:bs,useClass:tc,deps:[]},{provide:dp,useClass:_s,deps:[Jt,Na,bs]},{provide:_s,useClass:_s,deps:[Jt,Na,bs]}],df=[{provide:Yl,useValue:"root"},{provide:Pr,useFactory:af,deps:[]},{provide:ic,useClass:tf,multi:!0,deps:[Li,Jt,Er]},{provide:ic,useClass:of,multi:!0,deps:[Li]},jp,Wp,zp,{provide:ap,useExisting:jp},{provide:Ds,useClass:Ym,deps:[]},[]],Kp=(()=>{let e=class e{constructor(t){}static withServerTransition(t){return{ngModule:e,providers:[{provide:Cs,useValue:t.appId}]}}};e.\u0275fac=function(n){return new(n||e)(x(pf,12))},e.\u0275mod=ze({type:e}),e.\u0275inj=Ve({providers:[...df,...uf],imports:[ht,Cp]});let i=e;return i})();var oc=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=T({token:e,factory:function(n){let o=null;return n?o=new(n||e):o=x(mf),o},providedIn:"root"});let i=e;return i})(),mf=(()=>{let e=class e extends oc{constructor(t){super(),this._doc=t}sanitize(t,n){if(n==null)return null;switch(t){case Fn.NONE:return n;case Fn.HTML:return Ir(n,"HTML")?Tn(n):sp(this._doc,String(n)).toString();case Fn.STYLE:return Ir(n,"Style")?Tn(n):n;case Fn.SCRIPT:if(Ir(n,"Script"))return Tn(n);throw new xi(5200,!1);case Fn.URL:return Ir(n,"URL")?Tn(n):op(String(n));case Fn.RESOURCE_URL:if(Ir(n,"ResourceURL"))return Tn(n);throw new xi(5201,!1);default:throw new xi(5202,!1)}}bypassSecurityTrustHtml(t){return ep(t)}bypassSecurityTrustStyle(t){return tp(t)}bypassSecurityTrustScript(t){return ip(t)}bypassSecurityTrustUrl(t){return np(t)}bypassSecurityTrustResourceUrl(t){return rp(t)}};e.\u0275fac=function(n){return new(n||e)(x(Li))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var pc={};br(pc,{CombatAttackInteraction:()=>cn,FightEnds:()=>yi,FightNextRoundStarts:()=>Lt,GroupAttacked:()=>Ni,GroupCounterAttacked:()=>lc,GroupDamagedByGroup:()=>Gn,GroupDies:()=>pn,GroupModifiersChanged:()=>Fs,GroupSpeedChanged:()=>po,GroupSpellsChanged:()=>ln,GroupTakesDamage:()=>cc,PlayerCastsInstantSpell:()=>lo,PlayerTargetsSpell:()=>co,RoundGroupSpendsTurn:()=>mo,RoundGroupTurnEnds:()=>As,RoundPlayerCountinuesAttacking:()=>fo,RoundPlayerTurnStarts:()=>ji,UnitHealed:()=>Rn,UnitSummoned:()=>uo});var Xp=0;function Oe(i=""){let e={__id:Xp,__name:i,__type:null},r=function(t={}){return D({__eventType:e},t)};return r.__typeInfo=e,e.__type=r,Xp++,r}var an={logEvents:!1,logGameObjects:!0,logObjectsOnRightClick:!0,showLocationsIds:!1};var j=(()=>{let e=class e{dispatch(t){this.eventStream$.next(t)}constructor(){this.eventStream$=new Mt,an.logEvents&&this.eventStream$.subscribe(t=>console.log(`[${t.__eventType.__name}]`,t))}onEvent(t){return this.eventStream$.pipe(In(n=>n.__eventType.__id===t.__typeInfo.__id))}events(...t){let n=new Map;return t.forEach(o=>n.set(o.eventType.__typeInfo.__id,o.fn)),this.eventStream$.pipe(In(o=>{let s=n.get(o.__eventType.__id);return s?(s(o),!0):!1}))}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();function rt({events:i,prefix:e}){return Object.entries(i).forEach(([r,t])=>{let n=t.__typeInfo.__name;t.__typeInfo.__name=`${e}:${r}`+(n?`, ${n}`:"")}),{events:i,getEventByName(r){return i[r]}}}var ao=Symbol("Class members configs"),sc=Symbol("Class type marker");function ac(i,e){let r=Object.getPrototypeOf(i);return r?r[sc]===e?r:ac(r,e):null}function Jp(i,e,r,t,n,o){let s=r.value,p=i.constructor,m=ac(p,"store");if(!m)throw new Error(`[Store Feature] ${n} Error. Class ${p.name} must extend StoreClient(). Method ${p.name}.${e}.`);if(typeof s!="function")throw new Error(`[Store Feature] ${n} Error. ${n} in ${p.name}.${e} must be applied to method.`);m[ao].push({type:o,method:s,event:t})}function J(i){return function(e,r,t){Jp(e,r,t,i,`@Notify(${i.name})`,"notify")}}function G(i){return function(e,r,t){Jp(e,r,t,i,`@WireEvent(${i.name})`,"wire")}}function ae(){var r;var i,e;return r=class{constructor(){this.events=H(j),this.destroyed$=new Mt,this.plainSubscriptions=new Nl,this.untilDestroyed=s=>s.pipe(Xe(this.destroyed$));let n=this;Object.getPrototypeOf(this).constructor[ao].forEach(s=>{let p=s.event;if(s.type==="wire-prop")return;let m=s.method;switch(s.type){case"wire":this.events.onEvent(p).pipe(this.untilDestroyed).subscribe(S=>{m.apply(this,[S])});break;case"notify":this.events.onEvent(p).pipe(this.untilDestroyed).subscribe(()=>{m.apply(this)});break;case"subscribeEvent":let v=m.apply(n,[this.events.onEvent(p)]);this.plainSubscriptions.add(v);break}})}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete(),this.plainSubscriptions.unsubscribe()}},i=ao,e=sc,r[i]=[],r[e]="store",r}var Je=Oe,co=Je(""),lo=Je(),Ni=Je(),cn=Je(),po=Je(),ln=Je(),Fs=Je(),Gn=Je(),cc=Je(),uo=Je(),lc=Je(),pn=Je(),mo=Je(),As=Je(),ji=Je(),fo=Je(),Lt=Je(),yi=Je("Fight Ends"),Rn=Je();var uc={};br(uc,{AddCombatModifiersToUnit:()=>ho,DefendAction:()=>vo,RegisterUnitLoss:()=>yo,RemoveCombatModifiersFromUnit:()=>go});var Os=Oe,ho=Os(),go=Os(),yo=Os(),vo=Os();var ff=rt({prefix:"Battle",events:pc}),hf=rt({prefix:"BattleCommands",events:uc}),A1=D(D({},ff.events),hf.events);var ni=function(i){return i.GroupAttacks="attacks",i.GroupCounterattacks="counterattacks",i.AttackInteractionCompleted="completed",i}(ni||{});var fc={};br(fc,{BeforeBattleInit:()=>Do,DisplayPopup:()=>kr,DisplayReward:()=>To,FightStarts:()=>Nt,GameCreated:()=>wo,GameStarted:()=>Co,NewDayStarted:()=>Io,NewWeekStarted:()=>zi,OpenGarrisonPopup:()=>Ln,OpenSplitUnitGroupPopup:()=>bo,OpenUnitSlotsActionPopup:()=>_o,PlayerEntersTown:()=>So,PlayerEquipsItem:()=>jn,PlayerLeavesTown:()=>xo,PlayerLevelsUp:()=>Fo,PlayerLosesItem:()=>Nn,PlayerOpensActionCards:()=>Mo,PlayerOpensHeroInfo:()=>Un,PlayerReceivesItem:()=>vi,PlayerStartsFight:()=>Po,PlayerUnequipsItem:()=>un,PlayersInitialized:()=>$i,ScheduleAction:()=>$n,ShowGameOverPopup:()=>Eo,StructCompleted:()=>Vi,StructFightConfirmed:()=>Hn,StructSelected:()=>Bn,UnitGroupAddedToHero:()=>dc,UnitGroupRemovedFromHero:()=>mc});var be=Oe,Co=be(),wo=be(),$i=be(),So=be(),xo=be(),Un=be(),bo=be(),_o=be(),Mo=be(),Bn=be(),Po=be(),Do=be(),Nt=be(),Vi=be(),Eo=be(),Io=be(),zi=be(),To=be(),Hn=be(),kr=be(),Ln=be(),vi=be(),Nn=be(),jn=be(),un=be(),Fo=be(),dc=be(),mc=be(),$n=be();var Ot=function(i){return i.MainScreen="main-screen",i.NewGame="new-game",i.Structures="structures",i.Battleground="battleground",i.Town="town",i}(Ot||{});var hc={};br(hc,{ActivateActionCard:()=>Yn,AddActionCardsToPlayer:()=>Wi,CleanUpHandlersOnFightEnd:()=>ks,DisplayPlayerRewardPopup:()=>Oo,GameOpenMainScreen:()=>Vn,GameOpenMapStructuresScreen:()=>Gr,InitBuilding:()=>Uo,InitGameObjectApi:()=>ko,InitItem:()=>Ro,InitSpell:()=>Go,InitStructure:()=>Bo,MapPanCameraCenterTo:()=>dn,NavigateToView:()=>Pi,OpenMainMenu:()=>Wn,OpenNewGameScreen:()=>Ao,OpenSettings:()=>zn,PushEventFeedMessage:()=>qn,PushPlainEventFeedMessage:()=>Ci,RemoveActionPoints:()=>jt});var et=Oe,ks=et("Clear spells and items registries on fight end"),dn=et("Pan camera on the map"),Vn=et("Open Main Screen"),Ao=et("Open New Game Screen"),zn=et("Open Game settings"),Wn=et("Open Main menu"),Pi=et("Navigate To View"),Gr=et("Open map structures screen"),Oo=et(),ko=et(),Go=et(),Ro=et(),Uo=et(),Bo=et(),qn=et(),Ci=et(),jt=et(),Yn=et(),Wi=et();var gf=rt({events:fc,prefix:"GameEvents"}),yf=rt({events:hc,prefix:"GameCommands"}),z1=D(D({},gf.events),yf.events);var gc={};br(gc,{DisplayUnitGroupInfo:()=>mn,PlayerClicksAllyGroup:()=>No,PlayerClicksEnemyGroup:()=>Lo,PlayerHoversGroupCard:()=>Di,PlayerRightClicksUnitGroup:()=>jo});var Ho=Oe,Lo=Ho(),No=Ho(),Di=Ho(),jo=Ho(),mn=Ho();var gt=function(i){return i[i.EnemyCard=0]="EnemyCard",i[i.AllyCard=1]="AllyCard",i[i.Unhover=2]="Unhover",i}(gt||{});var vf=rt({events:gc,prefix:"UI"}),nw=vf.events;var yc={};br(yc,{GamePreparationFinished:()=>wf,PrepareGameEvent:()=>Cf});var eu=Oe,Cf=eu("Player started new game, waiting for GamePreparationFinished event to prepare the map."),wf=eu("Map is prepared, player can start the game");var Sf=rt({events:yc,prefix:"Triggers"}),Rr=Sf.events;var $o=function(i){return i.Normal="normal",i}($o||{});var I=function(i){return i.Target="target",i.Instant="instant",i.Passive="passive",i.Debuff="debuff",i.Buff="buff",i}(I||{}),xf=[I.Buff,I.Debuff],bf=[I.Buff,I.Debuff,I.Passive],_w=[I.Instant,I.Passive,I.Target];function _f(i){return xf.includes(i.baseType.activationType)}var Gs=(()=>{let e=class e extends Tt{constructor(){super(...arguments),this.currentLevel=1}create({spellBaseType:t,initialLevel:n,state:o}){this.baseType=t,this.currentLevel=n,this.name=this.baseType.name,this.state=o,this.sourceInfo={},this.updateCurrentManaCost()}updateCurrentManaCost(){this.currentManaCost=this.baseType.config.spellConfig.getManaCost?.(this)||0}setOwnerObjectId(t){this.sourceInfo.ownerUnitObjectId=t}setSourceGameObjectId(t){this.sourceInfo.gameObjectId=t}levelUp(){this.currentLevel+=1,this.updateCurrentManaCost();let t=this.sourceInfo.ownerUnitObjectId;t&&this.baseType.config.spellConfig.onAcquired?.({spellInstance:this,ownerUnit:this.getApi().gameObjects.getObjectByFullId(t)})}isEffect(){return _f(this)}isPassive(){return bf.includes(this.baseType.activationType)}};e.categoryId="spell";let i=e;return i})();var qi=function(i){return i[i.Icon=0]="Icon",i[i.Html=1]="Html",i[i.Customizable=2]="Customizable",i}(qi||{}),Yi=function(i){return i[i.VfxElement=0]="VfxElement",i}(Yi||{});var Z=(i,e)=>({icon:i,id:e,type:qi.Icon}),tu=i=>({id:i,type:qi.Html}),Vo=i=>({id:i,type:qi.Customizable}),Ie=i=>{let e={config:{layout:"default"},elements:[],elemsKeyframes:{},elemsDefaultStyles:{}};return i.forEach(([r,t,n])=>{e.elements.push(r),e.elemsKeyframes[r.id]=t,e.elemsDefaultStyles[r.id]=n}),e},kt=()=>[{opacity:"0"},{opacity:"1",offset:.25},{opacity:"1",offset:.35},{offset:.76,opacity:"0"},{opacity:"0"}],ot=()=>[{filter:"blur(10px)"},{filter:"blur(0px)",offset:.4},{filter:"blur(0px)",opacity:0}],Qn=()=>[{opacity:"0"},{opacity:"0.2",transform:"translate(-50%, -50%) scale(1.2)",offset:.25},{opacity:"0.3",transform:"translate(-50%, -50%) scale(1.5)",offset:.35},{offset:.76,transform:"translate(-50%, -50%) scale(1.6)",opacity:"0"},{opacity:"0"}];var Qe=(i=0,e=0)=>{let r="translate(-50%, -50%) scale(1)";return[{opacity:0+e,offset:.001+i},{opacity:.3+e,transform:r,offset:.3+i},{opacity:.3+e,transform:r,offset:.5+i},{opacity:.3+e,transform:r},{opacity:0+e,transform:r}]};var fn=(i,e="rgb(244 162 124)")=>Ie([[Z(i,"fire-main"),kt(),{fontSize:"64px",color:e,opacity:"1"}],[Z(i,"fire-blur"),ot(),{fontSize:"64px",color:e,filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"}],[Z(i,"fire-pulse"),Qn(),{fontSize:"64px",color:e,opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"}]]);function Qi(i,e){let r=()=>({transform:"translate(-50%, -50%) scale(3)",fontSize:"64px",color:"rgb(213 197 223)",opacity:"0"});return Ie([[Z(i,"bw-1"),Qe(),r()],[Z(i,"bw-2"),Qe(.2),r()],[Z(i,"bw-3"),Qe(.4),r()],[Z(i,"bw-blur"),[{filter:"blur(10px)"},{filter:"blur(10px)",offset:.4,opacity:1},{filter:"blur(0px)",opacity:0,transform:"translate(-50%, -50%) scale(1)"}],{transform:"translate(-50%, -50%) scale(1.5)",fontSize:"64px",color:e,filter:"blur(6px)",opacity:"0",mixBlendMode:"hard-light"}]])}var iu=Ie([[Z("focused-lightning","l-main"),[{opacity:"0"},{opacity:"1",offset:.05},{opacity:"1",offset:.15},{opacity:"0",offset:.16},{opacity:"0",offset:.2},{opacity:"1",offset:.23},{opacity:"0"}],{fontSize:"64px",color:"#eaefff",opacity:"1"}],[Z("focused-lightning","l-blur"),[{filter:"blur(10px)"},{filter:"blur(10px)",offset:.4},{filter:"blur(0px)",opacity:0,transform:"translate(-50%, -50%) scale(1)"}],{transform:"translate(-50%, -50%) scale(1.5)",fontSize:"64px",color:"#98abff",filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"}]]),Rs=fn("fire"),nu=Qi("batwings","rgba(218, 137, 204, 0.78)"),ru=Qi("bat-sword","rgba(245, 10, 20, 0.8)"),ou=Ie([[Z("fire-ring","fr-main"),kt(),{fontSize:"64px",color:"white",opacity:"1"}],[Z("fire-ring","fr-blur"),ot(),{fontSize:"64px",color:"violet",filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"}],[Z("fire-ring","fr-pulse"),Qn(),{fontSize:"64px",color:"pink",opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"}]]);var vc={textShadow:"0px 0px 5px rgba(0, 0, 0, 1)"},su=Ie([[Vo("elem"),[],D({fontSize:"24px",position:"relative",top:"17px",left:"10px",color:"white"},vc)]]),au=Ie([[Vo("elem"),[],D({fontSize:"24px",color:"white"},vc)]]),cu=Ie([[Z("burning-book","bm"),[],D({fontSize:"34px",color:"#bfcbff",opacity:.7},vc)],[Z("burning-book","bm2"),Qe(0,.2),{fontSize:"34px",color:"#bfcbff",mixBlendMode:"screen"}],[Z("burning-book","book-blur"),Qn(),{fontSize:"36px",filter:"blur(6px)",color:"#98abff",mixBlendMode:"screen"}],[Z("burning-book","book-blur2"),Qn(),{fontSize:"36px",filter:"blur(6px)",color:"#98abff"}]]);var lu=Ie([[Vo("msg"),[{fontSize:"13px"},{offset:.3,opacity:1,transform:"translate(10px, -50px) scale(1.5)"},{opacity:0,transform:"translate(20px, -100px) scale(0.8)"}],{opacity:.3,fontSize:"15px"}]]),pu=Ie([[tu("msg"),[{offset:0,opacity:0,transform:"translate(0, -50px)"},{offset:.2,opacity:1,transform:"translate(0, -10px)"},{offset:.8,opacity:1,transform:"translate(0, -10px)"},{opacity:0,transform:"translate(0, 0px)"}],{fontSize:"15px"}]]);var zo=({icon:i,iconColor:e="white",bgColor:r="transparent"})=>`<i class='ra ra-${i}' style="background: ${r}; color: ${e}"></i>`,Mf=({icon:i,iconColor:e,bgColor:r})=>`<i class='ra ra-${i}' style="background: ${r}; color: ${e}"></i>`,Kn=i=>`${Mf(i)} <span style="font-weight: 600;">${i.title}</span>`;var Cc=i=>`${Math.round(i*100)}`,Us=i=>`${Math.round(i*100)}%`,uu=(i,e)=>i===e?`${i} `:`${i}-${e} `,du=i=>i===0?i:i>0?`+${i}`:`-${i}`;var $t=(i,e,r=!1,t=0,n=!1)=>({parts:[{type:"plainPart",icon:r?"broadhead-arrow":"sword",text:`<span style="${n?"font-weight: 800;":""}">${i}</span>`,color:n?"#ff8100":"red"},...t?[{type:"plainPart",icon:"shield",color:"yellow",text:t}]:[],{type:"plainPart",icon:"skull",text:e,color:"white"}]}),Bs=(i,e)=>({parts:[{type:"plainPart",icon:"double-team",text:i,color:"white"},{type:"plainPart",icon:"health",text:e,color:"#5fc960"}]}),wi=(i,{fontSize:e=15,width:r=100}={})=>`<div style="margin-top: 4px; text-align: center; width: ${r}px; font-size:${e}px; background:rgba(0,0,0,0.6); padding: 2px; border-radius: 5px;">${i}</div>`,fu=(i,e)=>({html:wi(`
      <div style="">${zo({icon:"bat-sword",iconColor:"red"})} ${e}</div>
      <div style="">${zo({icon:"double-team",iconColor:"#91edb8"})}${du(i)}</div>
    `,{width:50})}),mu=(i,e=i.count)=>`<span style="color: ${i.ownerPlayer.color}; font-weight: 500">${e} ${i.type.name}</span>`,hu=({attacker:i,attacked:e,originalNumber:r,damage:t,unitLoss:n})=>`${mu(i)} retaliated! Dealing ${t} damage to ${mu(e,r)}, ${n} units perish.`;var U=i=>(Mi(i),i),st=({isEnemy:i,unitGroup:e})=>i&&e.fightInfo.isAlive;var hn=({isEnemy:i,unitGroup:e})=>!i,ri={bgClr:It.DefautlDebuffBg,iconClr:It.DefautlDebuffClr},Hs={bgClr:It.DefautlBuffBg,iconClr:It.DefautlBuffClr};var gu=(i,e)=>r=>i+(r-1)*e;var pS=U({id:"#spell-blindness",name:"Blindness",activationType:I.Instant,icon:{icon:"sunbeams"},getDescription(){return{descriptions:[P("Decreases damage of target enemy group by 15%.")]}},config:{spellConfig:{getManaCost(i){return 0},init:()=>{}}}});var wc=17,Sc=U({id:"#spell-enchant-buff",name:"Enchanted",activationType:I.Debuff,icon:D({icon:"fire-ring"},ri),getDescription(){return{descriptions:[P(`Incoming damage from spells is increased by ${wc}%.`)]}},config:{spellConfig:{init:({events:i,actions:e,vfx:r})=>{let t=e.createModifiers({amplifiedTakenMagicDamagePercent:wc/100});i.on({SpellPlacedOnUnitGroup(n){r.createEffectForUnitGroup(n.target,ou,{duration:1e3}),e.addModifiersToUnitGroup(n.target,t)}})}}}}),yu=U({id:"#spell-enchant",name:"Enchant",activationType:I.Target,icon:{icon:"fire-ring"},getDescription(){return{descriptions:[P(`Enchants an enemy to receive increased damage from spells by ${wc}%`)]}},config:{spellConfig:{targetCastConfig:{canActivate:st},getManaCost(i){return{1:2,2:2,3:3,4:3}[i.currentLevel]},init:({events:i,actions:e,ownerPlayer:r})=>{i.on({PlayerTargetsSpell(t){let n=e.createSpellInstance(Sc);e.addSpellToUnitGroup(t.target,n,r),e.historyLog("Enemy is enchanted")}})}}}});var Ls="hospital-cross",xc={fontSize:"64px",color:"rgb(200 244 124)"},Pf=Ie([[Z(Ls,"fire-main"),kt(),K(D({},xc),{opacity:"1"})],[Z(Ls,"fire-blur"),ot(),K(D({},xc),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[Z(Ls,"fire-pulse"),Qe(),K(D({},xc),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),bc=20,_c=U({id:"#spell-revitalize",name:"Revitalize",activationType:I.Target,icon:{icon:Ls},getDescription(i){let e=i.ownerUnit,r=e.count,t=e.type.name,n=r*bc;return{descriptions:[P(`Heals friendly unit group by ${n}. Heal increases by ${bc} per each Firebird in current group.`)]}},config:{spellConfig:{targetCastConfig:{canActivate:hn},getManaCost(i){return 2},init:({events:i,actions:e,ownerUnit:r,vfx:t})=>{i.on({PlayerTargetsSpell(n){let o=r,s=o.count*bc,p=n.target,m=p.type.name,v=e.healUnit(p,s);t.createEffectForUnitGroup(p,Pf,{duration:800});let S=v.revivedUnitsCount;e.historyLog(`${o.count} ${o.type.name} heal ${m} by ${s}.`),e.historyLog(`${S} of ${m} are brought back to life.`),t.createFloatingMessageForUnitGroup(n.target,Bs(S,s),{duration:1600})}})}}}});var Cu=.25,wu=Cu*100,vu=U({id:"#spell-fright-debuff",name:"Fright",activationType:I.Debuff,icon:D({icon:"batwings"},ri),getDescription(){return{descriptions:[P(`This unit group is frightened, dealing ${wu}% less damage to the one who scared it.`)]}},config:{spellConfig:{init({actions:i,events:e,spellInstance:r,vfx:t,ownerHero:n}){e.on({SpellPlacedOnUnitGroup({target:o}){let s=n.modGroup.getModValue("specialtyNecromancy")||0,p=i.createModifiers({__attackConditionalModifiers(m){return!s&&m.attacked===r.state?.frighter?{baseDamagePercentModifier:-Cu}:s>=1?m.attacked===r.state?.frighter?{baseDamagePercentModifier:-.25}:m.attacked.modGroup.getModValue("isGhost")?{baseDamagePercentModifier:-.17}:{baseDamagePercentModifier:-.12}:{}}});t.createEffectForUnitGroup(o,nu,{duration:1e3}),i.addModifiersToUnitGroup(o,p)}})}}}}),Mc=U({id:"#spell-fright",name:"Fright",activationType:I.Passive,icon:{icon:"batwings"},getDescription(i){return{descriptions:[P(`Scares enemy group on attack, reducing damage against this group by ${wu}%.  Ability Improves with Necromancy, reducing damage against all your units.`)]}},config:{spellConfig:{init({actions:i,events:e,ownerPlayer:r,ownerUnit:t}){e.on({UnitGroupAttacks({attacked:n,attacker:o}){if(t!==o||n.spells.find(p=>p.baseType===vu))return;let s=i.createSpellInstance(vu,{state:{frighter:o}});i.addSpellToUnitGroup(n,s,r)}})}}}});var Ce=function(i){return i.PhysicalAttack="physAttack",i.Physical="physical",i.Magic="magic",i.Fire="fire",i.Cold="cold",i.Poison="poison",i.Lightning="lightning",i.Astral="astral",i}(Ce||{});var Ns="frost-emblem",Pc={fontSize:"64px",color:"#a9bee2"},Df=Ie([[Z(Ns,"fire-main"),kt(),K(D({},Pc),{opacity:"1"})],[Z(Ns,"fire-blur"),ot(),K(D({},Pc),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[Z(Ns,"fire-pulse"),Qe(),K(D({},Pc),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),Su=40,js=4,$s=3,Ef=U({id:"#spell-frost-arrow-debuff",name:"Freeze",activationType:I.Debuff,icon:K(D({icon:Ns},ri),{bgClr:"#a9bee2"}),getDescription(i){return{descriptions:[P(`Unit group is slowed down by ${js}, attack rating reduced by ${$s}.`)]}},config:{spellConfig:{init:({events:i,actions:e,vfx:r,thisSpell:t})=>{let n=e.createModifiers({unitGroupSpeedBonus:-js,heroBonusAttack:-$s});i.on({SpellPlacedOnUnitGroup({target:o}){r.createEffectForUnitGroup(o,Df,{duration:800}),e.addModifiersToUnitGroup(o,n),e.historyLog(`${o.type.name} receives ${t.name} debuff, slowed by ${js} and gains -${$s} attack rating penalty.`)}})}}}}),xu=U({id:"#spell-frost-arrow",name:"Frost Arrow",activationType:I.Target,icon:{icon:"frozen-arrow"},getDescription(i){return{descriptions:[P(`Deals ${Su} magic damage, slows enemy by ${js} and reduces attack rating by ${$s}.`)]}},config:{spellConfig:{targetCastConfig:{canActivate:st},getManaCost(i){return{1:2,2:2,3:3,4:3}[i.currentLevel]},init:({events:i,actions:e,ownerPlayer:r,ownerHero:t,thisSpell:n,vfx:o})=>{i.on({PlayerTargetsSpell:s=>{let p=e.createSpellInstance(Ef);e.addSpellToUnitGroup(s.target,p,r),e.dealDamageTo(s.target,Su,Ce.Cold,({finalDamage:m,unitLoss:v})=>{let S=s.target.type.name;e.historyLog(`${t.name} deals ${m} damage to ${S} with ${n.name}, ${v} ${S} perishes`),o.createFloatingMessageForUnitGroup(s.target,$t(m,v),{duration:1e3})})}})}}}});var Wo="boot-stomp",Dc={fontSize:"64px",color:"rgb(200 244 124)"},If=Ie([[Z(Wo,"fire-main"),kt(),K(D({},Dc),{opacity:"1"})],[Z(Wo,"fire-blur"),ot(),K(D({},Dc),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[Z(Wo,"fire-pulse"),Qe(),K(D({},Dc),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),Ec=5,Tf=U({id:"#spell-haste-buff",name:"Haste",activationType:I.Buff,icon:D({icon:Wo},Hs),getDescription(){return{descriptions:[P(`Unit group is speeded up by ${Ec}.`)]}},config:{spellConfig:{init:({events:i,actions:e,vfx:r})=>{let t=e.createModifiers({unitGroupSpeedBonus:Ec});i.on({SpellPlacedOnUnitGroup(n){r.createEffectForUnitGroup(n.target,If,{duration:800}),e.addModifiersToUnitGroup(n.target,t)}})}}}}),bu=U({id:"#spell-haste",name:"Haste",activationType:I.Target,icon:{icon:Wo},getDescription(){return{descriptions:[P(`Target unit group is speeding up by ${Ec}.`),P("When upgraded, increases the speed bonus and starts to grant a chance to gain additional turn to units.")]}},config:{spellConfig:{targetCastConfig:{canActivate:hn},getManaCost(i){return{1:2,2:2,3:3,4:3}[i.currentLevel]},init:({events:i,actions:e,ownerPlayer:r})=>{i.on({PlayerTargetsSpell(t){let n=e.createSpellInstance(Tf);e.addSpellToUnitGroup(t.target,n,r)}})}}}});var Vs="hospital-cross",Ic={fontSize:"64px",color:"rgb(200 244 124)"},Ff=Ie([[Z(Vs,"fire-main"),kt(),K(D({},Ic),{opacity:"1"})],[Z(Vs,"fire-blur"),ot(),K(D({},Ic),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[Z(Vs,"fire-pulse"),Qe(),K(D({},Ic),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),QS=U({id:"#spell-heal",name:"Heal",activationType:I.Target,icon:{icon:Vs},getDescription(i){return{descriptions:[]}},config:{spellConfig:{targetCastConfig:{canActivate:hn},getManaCost(i){return{1:2,2:2,3:3,4:3}[i.currentLevel]},init:({events:i,actions:e,ownerPlayer:r,ownerUnit:t,vfx:n})=>{i.on({PlayerTargetsSpell(o){let p=o.target.count,m=o.target;e.healUnit(m,64),n.createEffectForUnitGroup(m,Ff,{duration:800});let v=o.target.count,S=m.type.name,E=v-p;e.historyLog(`${r.hero.name} heals ${S} by 64.`),e.historyLog(`${E} of ${S} are brought back to life.`),n.createFloatingMessageForUnitGroup(o.target,Bs(E,64),{duration:1e3})}})}}}});var Tc=50,_u="player-despair",Af=U({id:"#spell-kneeling-light-debuff",name:"Slowed",activationType:I.Debuff,icon:D({icon:_u},ri),getDescription(i){return{descriptions:[P(`Unit group is slowed down by ${Tc}%.`)]}},config:{spellConfig:{init:({events:i,actions:e,vfx:r})=>{i.on({SpellPlacedOnUnitGroup(t){let n=t.target.type.baseStats.speed,o=e.createModifiers({unitGroupSpeedBonus:-(n*(Tc/100))});r.createEffectForUnitGroup(t.target,Qi("player-despair","rgb(227, 240, 113)"),{duration:1e3}),e.addModifiersToUnitGroup(t.target,o)}})}}}}),Mu=U({id:"#spell-kneeling-light",name:"Kneeling Light",icon:{icon:_u},getDescription(i){return{descriptions:[P(`Makes light so heavy for the enemy target that it loses ${Tc}% of the speed.`)]}},activationType:I.Target,config:{spellConfig:{targetCastConfig:{canActivate:st},getManaCost(i){return{1:2,2:2,3:3,4:3}[i.currentLevel]},init:({events:i,actions:e,ownerPlayer:r})=>{i.on({PlayerTargetsSpell(t){let n=e.createSpellInstance(Af);e.addSpellToUnitGroup(t.target,n,r)}})}}}});var Pu=82,Du=124,Eu=31,zs=U({id:"#spell-meteor",name:"Meteor",activationType:I.Instant,icon:{icon:"burning-meteor"},getDescription({spellInstance:i}){let e=Eu*i.currentLevel;return{descriptions:[P(`Meteor deals ${Pu+e}-${Du+e} fire damage to random enemy group, next 2 unit groups after current group in fight queue (enemies or allies) will be stunned and will lose their turns.`)]}},config:{spellConfig:{getManaCost:i=>({1:6,2:7,3:7,4:8})[i.currentLevel],init({events:i,actions:e,thisSpell:r,ownerHero:t,vfx:n,spellInstance:o}){i.on({PlayerCastsInstantSpell(s){let p=e.getRandomEnemyPlayerGroup(),m=Eu*o.currentLevel;n.createEffectForUnitGroup(p,fn("burning-meteor"),{duration:1e3}),e.dealDamageTo(p,q.randIntInRange(Pu+m,Du+m),Ce.Fire,({unitLoss:E,initialUnitCount:L,finalDamage:le})=>{e.historyLog(`${t.name} deals ${le} damage to ${L} ${p.type.name} with ${r.name}, ${E} units perish`),n.createFloatingMessageForUnitGroup(p,$t(le,E),{duration:1e3})});let v=e.getUnitsFromFightQueue(),S=q.selectItems(v,2,1);console.log(v,S),S.forEach(E=>{e.removeTurnsFromUnitGroup(E),n.createDroppingMessageForUnitGroup(E.id,{html:wi("Stunned!")})})}})}}}});var Oc=5,Tu=34,Fu=46,Au=`${Tu}-${Fu}`,Of=2,Fc="bomb-explosion",Ac={fontSize:"64px",color:"rgb(172 202 120)"},Iu=Ie([[Z(Fc,"fire-main"),[{opacity:"0",transform:"translate(-50%, -50%) scale(0.8)"},{opacity:"1",offset:.25,transform:"translate(-50%, -50%)  scale(1.2)"},{opacity:"1",offset:.35,transform:"translate(-50%, -50%)  scale(1.6)"},{offset:.76,opacity:"0",transform:"translate(-50%, -50%)  scale(1.9)"},{opacity:"0",transform:"translate(-50%, -50%)  scale(2.1)"}],K(D({},Ac),{opacity:"1"})],[Z(Fc,"fire-blur"),ot(),K(D({},Ac),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[Z(Fc,"fire-pulse"),Qe(),K(D({},Ac),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),kf=U({id:"#spell-poison-cloud-debuff",name:"Poisoned",activationType:I.Debuff,icon:D({icon:"poison-cloud"},ri),getDescription(i){return{descriptions:[P(`Takes ${Au} damage at the beginning of round, attack rating is lowered by ${Oc}. Rounds left: ${i.spellInstance.state?.debuffRoundsLeft}.`)]}},config:{spellConfig:{init({events:i,actions:e,thisSpell:r,spellInstance:t,vfx:n}){i.on({SpellPlacedOnUnitGroup({target:o}){let s={debuffRoundsLeft:Of};t.state=s;let p=e.createModifiers({heroBonusAttack:-Oc});n.createEffectForUnitGroup(o,Iu),e.addModifiersToUnitGroup(o,p),e.historyLog(`${o.type.name} gets negative effect "${r.name}"`),i.on({NewRoundBegins(m){e.dealDamageTo(o,q.randIntInRange(Tu,Fu),Ce.Poison,v=>{e.historyLog(`Poison deals ${v.finalDamage} damage to ${o.type.name}, ${v.unitLoss} units perish`),n.createEffectForUnitGroup(o,Iu),n.createFloatingMessageForUnitGroup(o,$t(v.finalDamage,v.unitLoss),{duration:1e3})}),s.debuffRoundsLeft--,s.debuffRoundsLeft||(e.removeSpellFromUnitGroup(o,t),e.removeModifiresFromUnitGroup(o,p))}})}})}}}}),Ou=U({id:"#spell-poison-cloud",name:"Poison Cloud",activationType:I.Target,icon:{icon:"poison-cloud"},getDescription(i){return{descriptions:[P(`Poisons target, lowering attack rating by ${Oc} and dealing ${Au} damage at the beginning of each round. Lasts 2 rounds.`)]}},config:{spellConfig:{targetCastConfig:{canActivate:st},getManaCost(i){return{1:2,2:3,3:4,4:5}[i.currentLevel]},init({events:i,actions:e,ownerPlayer:r,ownerHero:t,thisSpell:n}){i.on({PlayerTargetsSpell(o){e.historyLog(`${t.name} casts "${n.name}" against ${o.target.type.name}`);let s=e.createSpellInstance(kf);e.addSpellToUnitGroup(o.target,s,r)}})}}}});var Ru=65,Uu=25,ku=gu(Ru,Uu),Zn=3,Gu=[{targets:1,damage:[.3]},{targets:1,damage:[.6]},{targets:2,damage:[.65,.25]}],Ws=U({id:"#spell-rain-of-fire",name:"Rain of Fire",activationType:I.Target,icon:{icon:"fire"},getDescription({ownerHero:i,spellInstance:e}){let r=i.specialtiesModGroup.getModValue("specialtyFireMastery")||0,t=[P(`Deals ${Ru} +${Uu} damage per level (${ku(e.currentLevel)}) to the target.`),P("<br>Improves with Fire Mastery: gains additional targets.")];if(r){let n=Gu[r-1];t.push(P(`<hr/>Fire Mastery ${r}:<br>Additional targets: ${n.targets}<br>Damage: ${n.damage.map(Us).join(", ")}`))}return{descriptions:t}},config:{spellConfig:{targetCastConfig:{canActivate:st},init:({events:i,actions:e,thisSpell:r,ownerHero:t,vfx:n,spellInstance:o})=>{i.on({PlayerTargetsSpell(s){let p=ku(o.currentLevel);function m(S,E,L){e.dealDamageTo(S,E,Ce.Fire,le=>{e.historyLog(`${t.name} deals ${le.finalDamage} damage to ${le.initialUnitCount} ${S.type.name} with ${r.name}, ${le.unitLoss} units perish.`),setTimeout(()=>{n.createEffectForUnitGroup(S,Rs,{duration:850}),n.createFloatingMessageForUnitGroup(S,$t(le.finalDamage,le.unitLoss),{duration:1200})},L*250)})}m(s.target,p,0);let v=t.specialtiesModGroup.getModValue("specialtyFireMastery")||0;if(v){let S=Gu[v-1],E=e.getAliveUnitGroupsOfPlayer(s.target.ownerPlayer);q.removeItem(E,s.target),E.length&&q.getRandomItems(E,S.targets).forEach((le,he)=>{m(le,p*S.damage[he],he+1)})}}})},getManaCost:i=>({1:Zn,2:Zn,3:Zn+1,4:Zn+1,5:Zn+2,6:Zn+2,7:Zn+2})[i.currentLevel]}}});var Bu=2,Hu=.17,Lu=U({id:"#spell-wind-bless-buff",name:"Wind Bless",icon:{icon:"feather-wing",bgClr:It.DefautlBuffBg,iconClr:It.DefautlBuffClr},activationType:I.Buff,getDescription(){return xp(`Attack of ranged units increased by ${Bu} and Block-Piercing by ${Us(Hu)}.`)},config:{spellConfig:{init:({events:i,actions:e,spellInstance:r})=>{i.on({SpellPlacedOnUnitGroup(t){let n=e.createModifiers({heroBonusAttack:Bu,blockPiercingPercent:Hu});r.state={roundsLeft:1,target:t.target,mods:n},e.addModifiersToUnitGroup(t.target,n)},NewRoundBegins(t){let n=r.state;--n.roundsLeft||(e.removeSpellFromUnitGroup(n.target,r),e.removeModifiresFromUnitGroup(n.target,n.mods))}})}}}});var Nu=20,ju=30,$u=2,Gf=fn("dragon-breath"),Vu=U({id:"#spell-fire-breath",name:"Fire Breath",activationType:I.Passive,icon:{icon:"dragon-breath"},getDescription({ownerUnit:i}){return{descriptions:[P(`${i?.type.name} covers ground with fire breath at the beginning of each round, dealing ${Nu}-${ju} fire damage to ${$u} random enemy groups.`)]}},config:{spellConfig:{init({actions:i,vfx:e,ownerPlayer:r,ownerUnit:t,events:n,thisSpell:o}){n.on({NewRoundBegins(){let s=i.getAliveUnitGroupsOfPlayer(i.getEnemyOfPlayer(r)),p=q.getRandomItems(s,$u);i.historyLog(`${t?.type.name} casts ${o.name}.`),p.forEach(m=>{let v=q.randIntInRange(Nu,ju);e.createEffectForUnitGroup(m,Gf,{duration:1300}),i.dealDamageTo(m,v,Ce.Fire,S=>{i.historyLog(`${t?.type.name} deals ${S.finalDamage} damage to ${S.initialUnitCount} ${m.type.name} with ${o.name}, ${S.unitLoss} units perish`),e.createFloatingMessageForUnitGroup(m,$t(S.finalDamage,S.unitLoss),{duration:1800})})})}})}}}});var Xn=(i,e)=>i!==e?` (${e}% against ranged units)`:"",Jn=i=>{let{icon:e,name:r,blockConfig:t,description:n}=i;return U({id:i.id,name:r,activationType:I.Passive,icon:{icon:e},getDescription({ownerUnit:o,spellInstance:s}){let p=s.currentLevel-1,m=t.minDamage[p],v=t.maxDamage[p],S=Cc(t.chance[p]),E=Cc(t.chanceAgainstRange[p]);return{descriptions:[P(n({meleeChance:S,rangedChance:E,blockValue:uu(m,v)}))]}},config:{spellConfig:{onAcquired({ownerUnit:o,spellInstance:s}){console.log("Aquired",s),s.state?.damageBlockMod&&o.removeSpellMods(s.state.damageBlockMod),s.state={damageBlockMod:{__attackConditionalModifiers({attacker:p}){let m=s.currentLevel-1,v=t.minDamage[m],S=t.maxDamage[m];return p?.modGroup.getModValue("isRanged")?{damageBlockMin:v,damageBlockMax:S,chanceToBlock:t.chanceAgainstRange[m]}:{damageBlockMin:v,damageBlockMax:S,chanceToBlock:t.chance[m]}}}},o.addSpellMods(s.state.damageBlockMod)},init(){}}}})};var zu=Jn({id:"#spell-knight-block",name:"Damage Block",icon:"heavy-shield",blockConfig:{minDamage:[14,22,34,45,120],maxDamage:[20,28,42,58,160],chance:[.6,.65,.7,.77,.68],chanceAgainstRange:[.6,.65,.72,.8,.7]},description:({blockValue:i,meleeChance:e,rangedChance:r})=>`Knights can block ${i} damage with ${e}% chance${Xn(e,r)}.`}),Wu=Jn({id:"#spell-tower-shields-block",name:"Tower Shields",icon:"heavy-shield",blockConfig:{minDamage:[14,22,34,45,120],maxDamage:[20,28,42,58,160],chance:[.6,.65,.7,.77,.68],chanceAgainstRange:[.6,.65,.72,.8,.7]},description:({blockValue:i,meleeChance:e,rangedChance:r})=>`Tower shields can block ${i} damage with ${e}% chance${Xn(e,r)}.`});var cb=U({id:"#spell-protection-aura",name:"Protected",activationType:I.Buff,icon:{icon:"spear-head"},getDescription:()=>({descriptions:["Unit is being protected"]}),config:{spellConfig:{onAcquired({ownerUnit:i,spellInstance:e}){},init({}){}}}}),qu=U({id:"#spell-protection",name:"Protection",icon:{icon:"spear-head"},activationType:I.Passive,getDescription:()=>({descriptions:["An aura that affects allies in range of 1 and gives damage block plus bonus armor."]}),config:{flags:{isAura:!0},spellConfig:{onAcquired({spellInstance:i,ownerUnit:e}){},init({ownerUnit:i,events:e,actions:r}){e.on({AuraCheck({target:t}){}})}}}});var bt=([[i,e],r,t,n,o])=>({damageInfo:{minDamage:i,maxDamage:e},attackRating:r,defence:t,health:n,speed:o});function Vt(i){return Ne(i)}var kc={createRandomArmy(i){let e=q.randIntInRange(i.minUnitGroups,i.maxUnitGroups),r=[],t=[...i.units],n=t.reduce((o,s)=>{let[p,m,v,S=1/0]=s;return o.set(s,{unitType:p,min:m,max:v,maxGroupsOfThisType:S,createdTimes:0}),o},new Map);console.log("options ->>",i),console.log("Units Map ->>",n);for(let o=0;o<e;o++){let s=q.randItem(t),p=n.get(s),m=p.unitType,S={count:q.randIntInRange(p.min,p.max),unitType:m};r.push(S),p.createdTimes++,p.createdTimes>=p.maxGroupsOfThisType&&(console.log("this unit was generated max times"),n.delete(s),q.removeItem(t,s))}return console.log("generated groups",r),r}},Ge=i=>()=>({descriptions:i});var Yu={experience:0,gold:0};We.defineUnitType({id:"#unit-h00",name:"Pikemen",level:1,mainPortraitUrl:V.Pikemen,baseRequirements:{gold:55},getDescription:Ge([F("Tier 1 Castle unit. Can be upgraded into Halberdier."),F("<br>While possessing good average stats, Pikemen also strikes back at any attacker."),F("<br>Receives bonuses from Combat Tactics speciality.")]),defaultSpells:[qu],defaultModifiers:{counterattacks:!0,retaliationDamagePercent:.7},baseStats:{damageInfo:{minDamage:2,maxDamage:3},attackRating:2,defence:2,health:8,speed:13},upgradeDetails:{target:"#unit-h01",upgradeCost:{gold:15}},neutralReward:Yu});We.defineUnitType({id:"#unit-h01",mainPortraitUrl:V.Pikemen,name:"Halberdier",level:1,baseStats:bt([[3,3],2,3,8,14]),getDescription:Ge([F("Tier 1 Castle unit. Upgraded version of Pikemen."),F("<br>More durable and strong version of Pikemen, also retains ability to counterattack any attacker."),F("<br>Receives bonuses from Combat Tactics speciality.")]),defaultModifiers:{counterattacks:!0,retaliationDamagePercent:.85,__auraModifiers({remoteness:i,target:e,thisUnit:r}){if(i===1){let t=r.count*.8;return{chanceToBlock:1,damageBlockMin:t,damageBlockMax:t}}return null}},baseRequirements:{gold:70,redCrystals:0},upgraded:!0,neutralReward:Yu});We.defineUnitType({id:"#unit-h10",mainPortraitUrl:V.Archer,name:"Archers",level:2,getDescription:Ge([F("Tier 2 Castle ranged unit. Can be upgraded into Crossbowmen."),F("<br>Archers are one of the fastest units, allowing hero to have an early turn against most early foes. Attacks twice per turn."),F("<br>In return to their advantages, they are also costly and relatively fragile."),F("<br>Receives bonuses from Archery specialty, granting bonus Attack Rating and Block-piercing.")]),baseStats:{damageInfo:{minDamage:3,maxDamage:4},attackRating:1,defence:2,health:9,speed:21},upgradeDetails:{target:"#unit-h11",upgradeCost:{gold:25}},getUnitTypeSpecialtyModifiers(i){return i.specialtyArchery===1?{heroBonusAttack:1,blockPiercingPercent:.15}:i.specialtyArchery>=2?{heroBonusAttack:2,blockPiercingPercent:.25}:{}},defaultModifiers:{isRanged:!0},minQuantityPerStack:12,defaultTurnsPerRound:2,baseRequirements:{gold:95},neutralReward:{experience:3,gold:5}});We.defineUnitType({id:"#unit-h11",mainPortraitUrl:V.Archer,name:"Crossbowmen",level:2,getDescription:Ge([F("Tier 2 Castle ranged unit. Upgraded version of Archers."),F("<br>Crossbowmen are one of the fastest units, allowing hero to have an early turn against most early foes. Attacks twice per turn."),F("<br>Crossbowmen have higher base stats and less fragile than Archers, but also have 35% block-piercing attack."),F("<br>Receives bonuses from Archery specialty, granting bonus Attack Rating and Block-piercing.")]),baseStats:{damageInfo:{minDamage:3,maxDamage:4},attackRating:4,defence:3,health:14,speed:21},defaultTurnsPerRound:2,getUnitTypeSpecialtyModifiers(i){return i.specialtyArchery===1?{heroBonusAttack:1,blockPiercingPercent:.2}:i.specialtyArchery>=2?{heroBonusAttack:2,blockPiercingPercent:.3}:{}},defaultModifiers:{isRanged:!0,blockPiercingPercent:.35},upgraded:!0,baseRequirements:{gold:120},neutralReward:{experience:4.5,gold:7}});We.defineUnitType({id:"#unit-h20",mainPortraitUrl:V.UnitMelee,name:"Knights",level:3,getDescription:Ge([F("Tier 3 Castle unit."),F("<br>Knights are possessing high armor and attack. "),F("<br>Chance-based ability to block damage along with +12% to Fire, Cold and Lightning resistances makes them durable fighters.")]),baseStats:bt([[6,9],6,5,17,11]),baseRequirements:{gold:120},defaultSpells:[zu],defaultModifiers:{resistFire:12,resistCold:12,resistLightning:12},neutralReward:{experience:10,gold:7}});We.defineUnitType({id:"#unit-h30",name:"Cavalry",mainPortraitUrl:V.UnitMelee,getDescription:Ge([F("Tier 4 Castle cavalry unit, can be upgraded into Heavy Cavalry."),F("<br>Cavalry is armored unit type that also deals heavy damage with 55% block-piercing attack.")]),level:4,baseStats:{damageInfo:{minDamage:14,maxDamage:19},attackRating:9,defence:10,health:33,speed:16},defaultModifiers:{blockPiercingPercent:.55,isCavalry:!0},baseRequirements:{gold:225,wood:1},neutralReward:{experience:20,gold:25},upgradeDetails:{target:"#unit-h31",upgradeCost:{gold:85}}});We.defineUnitType({id:"#unit-h31",name:"Heavy Cavalry",mainPortraitUrl:V.UnitMelee,getDescription:Ge([F("Tier 4 Castle cavalry unit, upgraded version of Cavalry."),F("<br>Cavalry is armored unit type that also deals heavy damage with 55% block-piercing attack.")]),level:4,baseStats:{damageInfo:{minDamage:14,maxDamage:19},attackRating:9,defence:10,health:33,speed:16},defaultModifiers:{blockPiercingPercent:.55,isCavalry:!0},baseRequirements:{gold:310,wood:1},neutralReward:{experience:25,gold:35},upgraded:!0});We.defineUnitType({id:"#unit-h40",name:"Mystic Birds",mainPortraitUrl:V.FireBird,level:5,getDescription:Ge([F("Tier 5 Castle magical creatures of fire. Can be upgraded to Firebirds."),F("<br>Majestic and powerful creatures of fire that can heal and resurrect allied units, also has 10% resist against fire."),F("<br>Deal 20% more damage against magical creatures.")]),baseStats:bt([[18,26],8,10,46,16]),defaultSpells:[_c],defaultModifiers:{resistFire:10,isMagical:!0,__attackConditionalModifiers({attacked:i}){return i.modGroup.getModValue("isMagical")?{baseDamagePercentModifier:.2}:{}}},baseRequirements:{gold:350,wood:1},upgradeDetails:{target:"#unit-h41",upgradeCost:{gold:125}},neutralReward:{experience:40,gold:60}});We.defineUnitType({id:"#unit-h41",name:"Firebirds",mainPortraitUrl:V.FireBird,level:5,getDescription:Ge([F("Tier 5 Castle magical creatures of fire, an upgraded version of Mystic Birds."),F("<br>Majestic and powerful of fire that can heal and resurrect allied units, has better stats than Mystical Birds and +17% fire resistance."),F("<br>Deal 30% more damage against magical creatures.")]),baseStats:bt([[23,29],12,14,57,17]),defaultModifiers:{resistFire:17,isMagical:!0,__attackConditionalModifiers({attacked:i}){return i.modGroup.getModValue("isMagical")?{baseDamagePercentModifier:.3}:{}}},defaultSpells:[_c],baseRequirements:{gold:475,wood:1},neutralReward:{experience:45,gold:60}});var Gc=rt({prefix:"Spells",events:{PlayerTargetsSpell:Oe(),SpellPlacedOnUnitGroup:Oe(),NewRoundBegins:Oe(),PlayerCastsInstantSpell:Oe(),UnitGroupAttacks:Oe(""),AuraCheck:Oe()}}),gn=Gc.events;var Qu=U({id:"#spell-unit-poison-arrows-debuff",name:"Poisoned",icon:{icon:"chemical-arrow",bgClr:"green"},activationType:I.Passive,getDescription:({ownerUnit:i})=>({descriptions:[P("This group is poisoned, receiving poison damage.")]}),config:{spellConfig:{init({events:i,actions:e,vfx:r,spellInstance:t}){i.on({SpellPlacedOnUnitGroup({target:n}){r.createDroppingMessageForUnitGroup(n.id,{html:wi("Poisoned!")}),e.dealDamageTo(n,t.state?.poisonDamage||0,Ce.Poison)}})}}}}),Rc=U({id:"#spell-unit-poison-arrows",name:"Poison Arrows",icon:{icon:"chemical-arrow"},activationType:I.Passive,getDescription:({ownerUnit:i})=>({descriptions:[P(`Poisons enemy on attack, dealing ${i.count*2} poison damage (2 damage per unit).`)]}),config:{spellConfig:{init({events:i,actions:e,vfx:r,ownerUnit:t,ownerPlayer:n}){i.on({UnitGroupAttacks({attacker:o,attacked:s}){if(o!==t)return;let p=e.createSpellInstance(Qu);p.state={poisonDamage:o.count*2},!s.spells.some(m=>m.baseType===Qu)&&e.addSpellToUnitGroup(s,p,n)}})}}}});var qs={experience:0,gold:0};Ft.defineUnitType({id:"#unit-f00",mainPortraitUrl:V.UnitMelee,name:"Raiders",level:1,baseStats:{damageInfo:{minDamage:1,maxDamage:2},attackRating:1,speed:16,defence:2,health:9},getDescription:Ge([F("Tier 1 Fort unit. Can be upgraded into Clan."),F("<br>The main attacking mass of the Fort, the goblins with long sharp spears. They are cheap and fragile, but swift, allowing to get an earlier turn and can be dangerous due to the chance of dealing critical damage.")]),defaultModifiers:{counterattacks:!0,criticalDamageChance:.35,criticalDamageMul:1},baseRequirements:{gold:35,redCrystals:0},upgradeDetails:{target:"#unit-f01",upgradeCost:{gold:20}},neutralReward:qs});Ft.defineUnitType({id:"#unit-f01",mainPortraitUrl:V.UnitMelee,name:"Clan",level:1,baseStats:{damageInfo:{minDamage:2,maxDamage:2},attackRating:3,speed:17,defence:3,health:9},getDescription:Ge([F("Tier 1 Fort unit, upgraded version of Raiders."),F("<br>The main attacking mass of the Fort, the goblins with long sharp spears. They are cheap and fragile, but swift, allowing to get an earlier turn and can be dangerous due to the chance of dealing critical damage.")]),defaultModifiers:{counterattacks:!0,criticalDamageChance:.35,criticalDamageMul:1},baseRequirements:{gold:55,redCrystals:0},upgraded:!0,neutralReward:qs});Ft.defineUnitType({id:"#unit-f10",mainPortraitUrl:V.UnitRanged,name:"Goblin Archers",level:2,baseStats:{damageInfo:{minDamage:1,maxDamage:1},attackRating:1,speed:14,defence:3,health:14},getDescription:Ge([F("Tier 2 ranged unit of the Fort. Can be upgraded into Goblin Shooters."),F("<br>Basic archers that deal very low damage due to poor technologies, but mitigate that weakness by adding poison to their arrows. Attacks twice per turn.")]),defaultTurnsPerRound:2,defaultModifiers:{isRanged:!0},defaultSpells:[Rc],baseRequirements:{gold:60,redCrystals:0},upgradeDetails:{target:"#unit-f11",upgradeCost:{gold:20}},neutralReward:qs});Ft.defineUnitType({id:"#unit-f11",mainPortraitUrl:V.UnitRanged,name:"Goblin Shooters",level:2,baseStats:{damageInfo:{minDamage:1,maxDamage:1},attackRating:1,speed:14,defence:4,health:18},getDescription:Ge([F("Tier 2 ranged unit of the Fort. Upgraded version of Goblin Archers."),F("<br>Basic archers that deal very low damage due to poor technologies, but mitigate that weakness by adding poison to their arrows."),F("<br>As an improved version of Goblin Archers they are equipped with primitive but fast-reloading crossbows, allowing them to attack 3 times per round.")]),defaultModifiers:{isRanged:!0},defaultTurnsPerRound:3,defaultSpells:[Rc],baseRequirements:{gold:60,redCrystals:0},upgraded:!0,neutralReward:qs});var zt=Ar.createFaction({id:"#faction-constellation",title:"Constellation",icon:"arrow-cluster"});var Ku=U({id:"#spell-dream-aura",name:"Dream Aura",icon:{icon:"overmind"},getDescription(){return{descriptions:["Damage dealt to nearby allies becomes part of Star Dragon's dream. Increases All Resist (+17%) and Defence(6) for closest allies."]}},activationType:I.Passive,config:{spellConfig:{init(){}}}});var Rf=U({id:"#spell-essence-leak-debuff",activationType:I.Debuff,icon:{icon:"implosion"},getDescription:()=>({descriptions:[P("Attacker will heal himself.")]}),name:"Life loss",config:{spellConfig:{getManaCost:()=>0,init(){},targetCastConfig:{}}}}),Zu=U({id:"#spell-essence-leak",name:"Essence Leak",icon:{icon:"implosion"},activationType:I.Target,getDescription:()=>({descriptions:[P("Places a curse on enemy. Any time target is attacked, the attacker will be healed by 1 point per each Sprite in the current group")]}),config:{spellConfig:{getManaCost:()=>2,init({events:i,actions:e,ownerUnit:r,vfx:t}){i.on({PlayerTargetsSpell({target:n}){let o=e.createSpellInstance(Rf,{initialLevel:1});n.addSpell(o),t.createEffectForUnitGroup(n,Qi("implosion","rgb(223 165 255)"),{duration:1e3})}})},targetCastConfig:{canActivate:st}}}});zt.defineUnitType({id:"#unit-c00",name:"Sprite",level:1,mainPortraitUrl:V.UnitMelee,baseRequirements:{gold:75},getDescription:()=>({descriptions:[P("Tier 1 units of the Constellation."),P("<br>One of the strongest tier 1 unit types due to high-value abilities. Sprites can curse specific enemy to heal allied attackers.")]}),defaultSpells:[Zu],baseStats:{damageInfo:{minDamage:2,maxDamage:3},speed:8,defence:4,health:14,attackRating:4},neutralReward:{experience:12,gold:8}});zt.defineUnitType({id:"#unit-c10",name:"Fencer",level:2,mainPortraitUrl:V.UnitMelee,baseRequirements:{gold:75},baseStats:{damageInfo:{minDamage:2,maxDamage:4},speed:7,defence:2,health:13,attackRating:5},neutralReward:{experience:12,gold:8}});zt.defineUnitType({id:"#unit-c20",name:"Saggitar",level:3,mainPortraitUrl:V.UnitRanged,baseRequirements:{gold:95},defaultModifiers:{isRanged:!0},baseStats:{damageInfo:{minDamage:6,maxDamage:8},speed:17,defence:4,health:17,attackRating:5},neutralReward:{experience:18,gold:14}});zt.defineUnitType({id:"#unit-c30",name:"Chariot",level:4,mainPortraitUrl:V.UnitMelee,baseRequirements:{gold:185},baseStats:{damageInfo:{minDamage:15,maxDamage:24},speed:24,defence:8,health:35,attackRating:9},neutralReward:{experience:18,gold:14}});zt.defineUnitType({id:"#unit-c60",name:"Star Dragon",level:7,mainPortraitUrl:V.UnitMelee,baseRequirements:{gold:1e3,gems:1,redCrystals:1},upgradeDetails:{target:"#unit-c61",upgradeCost:{gold:500,gems:1}},baseStats:{damageInfo:{minDamage:40,maxDamage:60},speed:20,defence:18,health:175,attackRating:16},neutralReward:{experience:180,gold:150}});zt.defineUnitType({id:"#unit-c61",name:"Night Wyvern",level:7,mainPortraitUrl:V.UnitMelee,baseRequirements:{gold:1500,gems:2,redCrystals:1},baseStats:{damageInfo:{minDamage:47,maxDamage:64},speed:22,defence:21,health:245,attackRating:17},defaultModifiers:{counterattacks:!0,retaliationDamagePercent:.5},defaultSpells:[Ku],neutralReward:{experience:180,gold:150},upgraded:!0});var je=Ar.createFaction({id:"#faction-neutrals",title:"Neutrals",icon:"monster-skull"});je.defineUnitType({id:"#unit-neut-gnoll-0",mainPortraitUrl:V.UnitMelee,name:"Gnolls",level:1,baseStats:bt([[3,4],1,1,10,12]),getDescription:Ge([F("Gnolls are tier 1 forest dwellers with average stats."),F("Mostly known for being bandits, they possess a fire resistant fur, giving them +10% to Fire Resist.")]),defaultModifiers:{resistFire:10,isForest:!0},baseRequirements:{gold:100},neutralReward:{experience:3.3,gold:3.2}});je.defineUnitType({id:"#unit-neut-poison-ivy-0",mainPortraitUrl:V.UnitMelee,name:"Poison Ivy",level:2,baseStats:bt([[3,4],1,1,10,10]),getDescription:Ge([F("Tier 2 forest dweller."),F("A mutated plant, a sturdy enemy with venomous attack, but vulnerable to any magic damage.")]),defaultModifiers:{resistAll:-20,isForest:!0},baseRequirements:{gold:10},neutralReward:{experience:4.5,gold:3.2}});je.defineUnitType({id:"#unit-neut-thief-0",mainPortraitUrl:V.UnitMelee,name:"Thieves",level:2,getDescription:Ge([F("Tier 2 forest dweller."),F("<br>Thieves are very dangerous despite being fragile. Their high speed allows them to have their turn earlier, and ability to attack twice, along with high damage, can result in heavy losses.")]),baseStats:bt([[6,7],2,1,9,16]),defaultTurnsPerRound:2,defaultModifiers:{isForest:!0},baseRequirements:{},neutralReward:{experience:4.55,gold:4.7}});je.defineUnitType({id:"#unit-neut-forest-troll-0",mainPortraitUrl:V.UnitMelee,name:"Forest Trolls",level:3,getDescription:Ge([F("Tier 3 forest dweller."),F("<br>Durable and strong, groups of Forest Trolls can absorb big damage, but their slowness usually makes them use their move last.")]),baseStats:bt([[5,7],3,4,17,10]),defaultModifiers:{isForest:!0},baseRequirements:{},neutralReward:{experience:6,gold:6}});je.defineUnitType({id:"#unit-neut-fire-spirit-0",name:"Fire Spirits",mainPortraitUrl:V.UnitMelee,baseRequirements:{},level:3,baseStats:bt([[9,13],3,3,17,18]),defaultModifiers:{resistFire:20,resistCold:15,isMagical:!0},getDescription:Ge([F("Tier 3 Neutral magical creature of fire."),F("<br>Tenacious and strong. Have increased resists against Fire (+20%) and Ice (+15%).")]),neutralReward:{experience:20,gold:20},defaultSpells:[]});var Xu=Jn({id:"#spell-skeleton-block",name:"Damage Block",icon:"heavy-shield",blockConfig:{minDamage:[8,24,45,86,120],maxDamage:[16,36,55,96,160],chance:[.2,.3,.35,.4,.45],chanceAgainstRange:[.55,.65,.7,.75,.8]},description:({blockValue:i,meleeChance:e,rangedChance:r})=>`Skeletons can block ${i} damage with ${e}% chance${Xn(e,r)}.`});je.defineUnitType({id:"#unit-neut-ghost-0",mainPortraitUrl:V.UnitMelee,name:"Ghosts",level:1,baseRequirements:{gold:30},getDescription(i){return{descriptions:[F("Undead unit."),F("<br>Possesses no outstanding qualities outside of low price and passive ability Fright. Gains improvements from Necromancy."),F("<br>Can be upgraded into Wraiths, faster unit with better stats, inheriting Fright ability.")]}},getUnitTypeSpecialtyModifiers:i=>i.specialtyNecromancy>1?{unitGroupSpeedBonus:4,heroBonusDefence:1}:null,baseStats:bt([[2,3],1,2,6,8]),defaultSpells:[Mc],neutralReward:{experience:2.3,gold:3},upgradeDetails:{target:"#unit-neut-ghost-1",upgradeCost:{gold:25}},defaultModifiers:{isGhost:!0}});je.defineUnitType({id:"#unit-neut-ghost-1",mainPortraitUrl:V.UnitMelee,name:"Wraiths",level:1,baseRequirements:{gold:55},baseStats:bt([[3,3],2,4,12,12]),getDescription(i){return{descriptions:[F("Undead unit. Upgraded and faster version of Ghosts."),F("<br>While having increased stats, inherits passive ability Fright."),F("<br>Gains improvements from Necromancy.")]}},getUnitTypeSpecialtyModifiers:i=>i.specialtyNecromancy===1?{unitGroupSpeedBonus:4,heroBonusDefence:2}:i.specialtyNecromancy>=2?{unitGroupSpeedBonus:4,heroBonusDefence:2,resistCold:10,resistFire:10}:null,defaultSpells:[Mc],defaultModifiers:{isGhost:!0},neutralReward:{experience:2.3,gold:2.4},upgraded:!0});je.defineUnitType({id:"#unit-neut-skeleton-0",name:"Skeletons",mainPortraitUrl:V.UnitMelee,level:1,getDescription(){return{descriptions:[F("Undead unit."),F("Usually found in big numbers, Skeletons also have ability to block damage with some chance.")]}},baseStats:{damageInfo:{minDamage:1,maxDamage:2},attackRating:1,defence:2,health:9,speed:11},defaultSpells:[Xu],baseRequirements:{gold:55},neutralReward:{experience:3,gold:2}});je.defineUnitType({id:"#unit-neut-lich-0",name:"Liches",mainPortraitUrl:V.UnitMelee,level:4,getDescription(){return{descriptions:[F("Tier 4 Undead unit. Can be upgraded into Master Liches."),F("<br>Powerful undead creatures, standing in the head of undead armies. Masterful wielders of long swords, they also possess 25% lifesteal and cannot be slowed down.")]}},baseStats:{damageInfo:{minDamage:13,maxDamage:17},attackRating:6,defence:5,health:32,speed:14},defaultModifiers:{lifesteal:25,isGhost:!0,cannotBeSlowed:!0},baseRequirements:{gold:400},neutralReward:{experience:30,gold:2},upgradeDetails:{target:"#unit-neut-lich-1",upgradeCost:{gold:100}}});var w_=je.defineUnitType({id:"#unit-neut-lich-1",name:"Master Liches",mainPortraitUrl:V.UnitMelee,level:4,getDescription(){return{descriptions:[F("Tier 4 Undead unit, an upgraded version of Liches."),F("<br>Powerful undead creatures, standing in the head of undead armies. Masterful wielders of long swords, they possess improved 45% lifesteal and cannot be slowed down.")]}},baseStats:{damageInfo:{minDamage:14,maxDamage:19},attackRating:7,defence:7,health:35,speed:15},defaultModifiers:{lifesteal:45,isGhost:!0,cannotBeSlowed:!0},baseRequirements:{gold:400},neutralReward:{experience:40,gold:2}});je.defineUnitType({id:"#unit-neut-imperial-guard",name:"Imperial Guard",level:3,neutralReward:{experience:10,gold:0},baseStats:{attackRating:3,defence:3,damageInfo:{maxDamage:3,minDamage:3},health:14,speed:12},defaultModifiers:{retaliationDamagePercent:.5,counterattacks:!0},defaultSpells:[Wu],getDescription:()=>({descriptions:[P("Imperial Guards, a part of the imperial army, well trained with combat tactics. They can block damage and retaliate.")]}),baseRequirements:{}});var Ju=Jn({id:"#spell-devastator-block",name:"Scale Armor",icon:"dragon-wing",blockConfig:{minDamage:[16],maxDamage:[24],chance:[.35],chanceAgainstRange:[.65]},description:({blockValue:i,meleeChance:e,rangedChance:r})=>`Sturdy scales of Devastator give a ${e}% chance to block ${i} damage${Xn(e,r)}.`});je.defineUnitType({id:"#unit-neut-boss-devastator",name:"Devastator",mainPortraitUrl:V.UnitMelee,level:8,getDescription:Ge([F("An evil dragon of fire."),F("<br>Dangerous boss unit with large health pool. Resistant to magic, has +50% to Fire Resist and +20% to All Other Resists, also posseses Fire Breath ability that damages random enemies with fire."),F("<br>His scales allow him to block some damage. Cannot be slowed.")]),baseStats:{damageInfo:{minDamage:32,maxDamage:47},attackRating:9,defence:9,health:820,speed:14},defaultSpells:[Vu,Ju],defaultModifiers:{isBoss:!0,resistAll:20,resistFire:30,cannotBeSlowed:!0},baseRequirements:{},neutralReward:{experience:120,gold:340},upgraded:!1});je.defineUnitType({id:"#unit-neut-ranger-0",name:"Rangers",level:2,baseStats:{attackRating:4,damageInfo:{maxDamage:8,minDamage:6},defence:4,health:14,speed:16},defaultModifiers:{__attackConditionalModifiers({attacked:i}){return i.modGroup.getModValue("isForest")?{baseDamagePercentModifier:.75}:{}}},defaultSpells:[],getDescription(i){return{descriptions:[P("Tier 2 Neutral unit."),P("Efficient against forest dwellers, dealing 75% more damage to them.")]}},neutralReward:{experience:1,gold:1},baseRequirements:{gold:100}});var ed=18,td=Se({id:"#item-blacklich-swords",name:"Black Lich Sword",icon:"bat-sword",slot:Q.Weapon,stats:{heroBonusAttack:3,specialtyNecromancy:1,__unitConditionalMods(i){return i.type.level<=4&&!i.modGroup.getModValue("isRanged")?{lifesteal:ed}:null}},cost:{gold:1e3,gems:1},description({thisItemBase:i}){return{descriptions:[qe(i),P(`Grants ${ed}% Lifesteal to non-ranged units up to level 4.`)]}}});var nM=Se({id:"#item-doomstring",name:"Doomstring",slot:Q.Weapon,icon:"crossbow",stats:{heroBonusAttack:8,specialtyOffence:3,specialtyArchery:2,specialtyFireMastery:1},cost:{gold:5e3,redCrystals:2,gems:1},description:({thisItemBase:i})=>({descriptions:[qe(i),P("An ancient ballista made in infernal abyss."),P("Grants ability: Doom. Doomed target looses 50% of armor and receives 50% increased physical damage.")]})});var id=Se({id:"#item-eclipse-wand",name:"Eclipse Wand",slot:Q.Weapon,stats:{specialtyMagic:1,specialtyMagicRecovery:1,heroMaxMana:5},icon:"crystal-wand",cost:{gold:550},sellingCost:{gold:300},description({thisItemBase:i}){return{descriptions:[qe(i),P("At the beginning of the battle, applies level 1 Enchant to all enemy groups.")]}},config:{init:({actions:i,events:e,ownerPlayer:r})=>{e.on({NewRoundBegins(t){if(t.round===0){let n=i.getEnemyOfPlayer(r);i.getUnitGroupsOfPlayer(n).forEach(s=>{let p=i.createSpellInstance(Sc,{initialLevel:1});i.addSpellToUnitGroup(s,p,r)})}}})}}});var Uc=rt({prefix:"Items",events:{NewRoundBegins:Oe("")}}),Bc=Uc.events;var Ys=class Ys{constructor(){this.inventoryItemsMap=new Map,this.equipedItemsSet=new Set}static getSlotTypes(){return this.slotTypes}static getExtendedSlotTypes(){return[...this.extendedSlotsMap.values()]}static getSlotExtendedInfo(e){return this.extendedSlotsMap.get(e)}static filterItemsForSlot(e,r){return r.filter(t=>t.baseType.slotType===e)}equipItem(e){let r=e.baseType.slotType,t=this.inventoryItemsMap.get(r);this.inventoryItemsMap.set(r,e),t&&this.equipedItemsSet.delete(t),this.equipedItemsSet.add(e)}unequipItem(e){this.inventoryItemsMap.delete(this.getItemSlotType(e)),this.equipedItemsSet.delete(e)}unequipSlot(e){let r=this.inventoryItemsMap.get(e);r&&(this.inventoryItemsMap.delete(e),this.equipedItemsSet.delete(r))}getItemInSlot(e){return this.inventoryItemsMap.get(e)||null}isSlotEquipped(e){return this.inventoryItemsMap.has(e)}isItemEquipped(e){return this.equipedItemsSet.has(e)}getEquippedItems(){return[...this.equipedItemsSet]}getItemSlotType(e){return e.baseType.slotType}};Ys.slotTypes=[Q.Headgear,Q.Amulet,Q.Weapon,Q.Armor,Q.Shield,Q.Boots],Ys.extendedSlotsMap=new Map([[Q.Headgear,{slotType:Q.Headgear,name:"Headgear",icon:"knight-helmet"}],[Q.Amulet,{slotType:Q.Amulet,name:"Amulet",icon:"gem-pendant"}],[Q.Weapon,{slotType:Q.Weapon,name:"Weapon",icon:"sword"}],[Q.Armor,{slotType:Q.Armor,name:"Armor",icon:"vest"}],[Q.Shield,{slotType:Q.Shield,name:"Shield",icon:"shield"}],[Q.Boots,{slotType:Q.Boots,name:"Boots",icon:"boot-stomp"}]]);var Wt=Ys;var nd=Se({id:"#item-ice-bow",name:"Ice Bow",slot:Q.Weapon,icon:"frozen-arrow",stats:{heroBonusAttack:1,specialtyArchery:1},cost:{gold:500},sellingCost:{gold:400},description({thisItemBase:i}){return{descriptions:[qe(i),P("Bow which radiates cold, grants level 1 Frost Arrow")]}},spells:[{level:1,spell:xu}]});var Qs=Se({id:"#item-irton-plate",name:"Irton Plate",slot:Q.Armor,icon:"vest",cost:{gold:300},sellingCost:{gold:175},stats:{heroBonusDefence:3}});var rd=50,IM=Se({id:"#item-lifeform",name:"Lifeform",slot:Q.Armor,icon:"vest",stats:{heroBonusDefence:7,resistFire:25,resistPoison:20,resistLightning:15,resistCold:15},description({thisItemBase:i}){return{descriptions:[qe(i),P(`An incredible artifact that shimmers with bright colors and emits life aura. Heals all units by ${rd} in the beginning of each round.`)]}},config:{init({events:i,actions:e,ownerPlayer:r}){i.on({NewRoundBegins:()=>{e.getUnitGroupsOfPlayer(r).forEach(n=>{e.healUnit(n,rd)})}})}}});var od=Se({id:"#item-meteor-sword",name:"Meteor Swords",slot:Q.Weapon,icon:"dervish-swords",stats:{heroBonusAttack:2,specialtyFireMastery:1},cost:{gold:1100},sellingCost:{gold:450},spells:[{spell:zs,level:1}],description({thisItemBase:i}){return{descriptions:[qe(i),P("Two large black swords with an astronomical map depicted in gold on the blade. Grants Level 1 Meteor ability.")]}}});var Ur=Se({id:"#item-wind-crest",name:"Wind Crest",slot:Q.Headgear,stats:{heroBonusDefence:1},icon:"feather-wing",cost:{gold:500},sellingCost:{gold:250},description({thisItem:i,thisItemBase:e}){return{descriptions:[qe(e),P("At the beginning of the fight, grants Wind Blessing (level 1) effect to your ranged units for 1 round.")]}},config:{init:({actions:i,events:e,ownerPlayer:r})=>{e.on({NewRoundBegins(t){t.round===0&&i.getUnitGroupsOfPlayer(r).filter(n=>n.type.defaultModifiers?.isRanged).forEach(n=>{let o=i.createSpellInstance(Lu);i.addSpellToUnitGroup(n,o,r)})}})}}});var sd=Se({id:"#item-wishmaster",name:"Wishmaster",slot:Q.Headgear,stats:{heroBonusAttack:5,heroBonusDefence:4,resistAll:13},icon:"feather-wing",description({thisItem:i,thisItemBase:e}){return{descriptions:[qe(e),P("An artefact of incredible strength.")]}}});var ad=50,YM=Se({id:"#item-rising-sun",name:"Rising Sun",icon:"gem-pendant",slot:Q.Amulet,stats:{heroBonusDefence:2},description({thisItemBase:i}){return{descriptions:[qe(i),P(`Each round heals your units by ${ad}`)]}},config:{init({events:i,actions:e,ownerPlayer:r}){i.on({NewRoundBegins:()=>{e.getUnitGroupsOfPlayer(r).forEach(n=>{e.healUnit(n,ad)})}})}}});var XM=Se({id:"#item-iron-pike",name:"Iron Pike",icon:"spear-head",slot:Q.Weapon,cost:{gold:420},sellingCost:{gold:250},stats:{specialtyCombatTactics:1,heroBonusAttack:1}});var cd=U({id:"#spell-charged-strike",name:"Charged Strike",activationType:I.Target,icon:{icon:"lightning"},getDescription:()=>({descriptions:[P("Makes current unit group attack enemy with additional lightning damage."),P("If current unit group is cavalry type, damage is doubled, as well as critical damage is added"),P("Consumes Turn.")]}),config:{spellConfig:{init({actions:i,events:e,vfx:r}){e.on({PlayerTargetsSpell({target:t}){let n=i.getCurrentUnitGroup(),o=n.modGroup.getModValue("isCavalry"),s=i.createModifiers({criticalDamageMul:o?.2:.35,criticalDamageChance:1});i.addModifiersToUnitGroup(n,s),i.dealDamageTo(t,40,Ce.Lightning),r.createEffectForUnitGroup(t,iu),i.unitGroupAttack(n,t),i.removeModifiresFromUnitGroup(n,s)}})},getManaCost(){return 2}}}});var lP=Se({id:"#item-storm-pike",name:"Storm Pike",icon:"spear-head",slot:Q.Weapon,cost:{gold:750},abilityDescription:"Grants ability Charged Strike that supplements unit attacks with lightning damage with additional effectiveness for any cavalry.",sellingCost:{gold:340},stats:{heroBonusAttack:3},spells:[{level:1,spell:cd}]});var fP=Se({id:"#item-battlemage-sword",name:"Sword of the Battle Mage",slot:Q.Weapon,icon:"sword",stats:{heroBonusAttack:3,heroMaxMana:8,specialtyMagicRecovery:2,specialtyFireMastery:1,specialtyColdMastery:1,specialtyLightningMastery:1},cost:{gold:1e3,redCrystals:1},sellingCost:{gold:600},description({thisItem:i,thisItemBase:e}){return{descriptions:[qe(e)]}}});var vP=Se({id:"#item-kite-shield",name:"Kite Shield",icon:"shield",slot:Q.Shield,cost:{gold:450},sellingCost:{gold:400},stats:{__attackConditionalModifiers(){return{damageBlockMax:14,damageBlockMin:10,chanceToBlock:1}},heroBonusDefence:1},abilityDescription:"100% chance to block 10-14 damage"});var LP=We.createHero({id:"#hero-helvetica",name:"Helvetica",generalDescription:F("Helvetica is the mage who supports her own army with offensive fire spells as well as increasing their speed."),image:V.HeroHelvetica,abilities:[Ws,bu],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-h00",20,32,1],["#unit-h10",12,18,1],["#unit-h20",6,11,1]]}],items:[Ur],resources:{gems:0,gold:750,redCrystals:0,wood:4},stats:{mana:12,baseAttack:1,baseDefence:0},defaultModifiers:{}});var Hc=2,ld=Hc+3,Ks=Se({id:"#item-light-boots",name:"Light Boots",icon:"boot-stomp",slot:Q.Boots,cost:{gold:425},sellingCost:{gold:200},stats:{heroBonusDefence:1,__unitConditionalMods(i){return i.type.level===1?i.type.upgraded?{unitGroupSpeedBonus:ld}:{unitGroupSpeedBonus:Hc}:null}},abilityDescription:`Increases speed of tier 1 units by ${Hc} (${ld} if unit is upgraded).`});var qo="fire-shield",Lc={fontSize:"64px",color:"#ffbc6c"},Uf=Ie([[Z(qo,"fire-main"),kt(),K(D({},Lc),{opacity:"1"})],[Z(qo,"fire-blur"),ot(),K(D({},Lc),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[Z(qo,"fire-pulse"),Qe(),K(D({},Lc),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]);var Bf=U({id:"#spell-fire-shield-buff",name:"Fire Shield",activationType:I.Buff,icon:D({icon:qo},Hs),getDescription(){return{descriptions:[P("Unit is protected by Fire Shield, blocking 14-18 damage with 100% and receiving 15% Fire Resist.")]}},config:{spellConfig:{init:({events:i,actions:e,vfx:r})=>{let t=e.createModifiers({__attackConditionalModifiers(){return{chanceToBlock:1,damageBlockMax:18,damageBlockMin:14,resistFire:15}}});i.on({SpellPlacedOnUnitGroup(n){r.createEffectForUnitGroup(n.target,Uf,{duration:800}),e.addModifiersToUnitGroup(n.target,t)}})}}}}),pd=U({id:"#spell-fire-shield",name:"Fire Shield",activationType:I.Target,icon:{icon:qo},getDescription(){return{descriptions:[P("Protects allied unit with a fire shield that blocks damage.")]}},config:{spellConfig:{targetCastConfig:{canActivate:hn},getManaCost(i){return{1:2,2:2,3:3,4:3}[i.currentLevel]},init:({events:i,actions:e,ownerPlayer:r,ownerUnit:t})=>{i.on({PlayerTargetsSpell(n){let o=e.createSpellInstance(Bf);e.addSpellToUnitGroup(n.target,o,r)}})}}}});var ud=3,dd=2,md=U({id:"#spell-summon-fire-spirits",name:"Fire Spirits",activationType:I.Instant,icon:{icon:"aura"},getDescription({spellInstance:i}){return{descriptions:[P(`Summon ${ud+dd*i.currentLevel} Fire Spirits that fight on your side.`),P("<br>Spirits have active ability Fire Shield and disappear when the fight is over.")]}},config:{spellConfig:{getManaCost(i){return 2+i.currentLevel},init({actions:i,spellInstance:e,ownerPlayer:r,events:t,vfx:n}){t.on({PlayerCastsInstantSpell(){let o=i.summonUnitsForPlayer(r,"#unit-neut-fire-spirit-0",ud+dd*e.currentLevel),s=i.createSpellInstance(pd,{initialLevel:1});i.addSpellToUnitGroup(o,s,r),n.createEffectForUnitGroup(o,Rs,{duration:1e3});let p=i.getAliveUnitGroupsOfPlayer(i.getEnemyOfPlayer(r))}})}}}});var Ei={gems:0,gold:1250,redCrystals:0,wood:2},fd={gems:0,gold:0,redCrystals:0,wood:0},hd=i=>{let{id:e,abilities:r,army:t,items:n,name:o,resources:s,stats:p,generalDescription:m,image:v}=i,S={id:e,name:o,generalDescription:m,initialState:{abilities:r,army:t,items:n,resources:s,stats:p},image:v??V.HeroMage};return Mi(S),S};var gd=12,fD=We.createHero({id:"#hero-taltir",name:"Taltir",generalDescription:F(`Taltir specializes at utilizing Fire Spells, summoning Fire Spirits and devastating Meteors. Knowledge in magic defenses makes him start with +${gd}% to all resists.`),image:V.HeroTaltir,abilities:[md,zs],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-h20",6,11,2],["#unit-h30",3,6,2],["#unit-h00",25,30,1]]}],items:[Qs,Ks],resources:Ei,stats:{mana:14,baseAttack:2,baseDefence:2},defaultModifiers:{resistAll:gd}});var yd=.14,vd=Sp(yd),$c=5,Cd=2,Nc="cracked-shield",jc={fontSize:"64px",color:"rgb(220 145 129)"},Hf=Ie([[Z(Nc,"fire-main"),[{opacity:"0",transform:"translate(-50%, -50%) scale(0.8)"},{opacity:"1",offset:.25,transform:"translate(-50%, -50%)  scale(1.2)"},{opacity:"1",offset:.35,transform:"translate(-50%, -50%)  scale(1.6)"},{offset:.76,opacity:"0",transform:"translate(-50%, -50%)  scale(1.9)"},{opacity:"0",transform:"translate(-50%, -50%)  scale(2.1)"}],K(D({},jc),{opacity:"1"})],[Z(Nc,"fire-blur"),ot(),K(D({},jc),{filter:"blur(6px)",opacity:"1",mixBlendMode:"hard-light"})],[Z(Nc,"fire-pulse"),Qe(),K(D({},jc),{opacity:"0.2",transform:"translate(-50%, -50%) scale(1)",mixBlendMode:"hard-light"})]]),Lf=U({id:"#spell-corrosive-fog-debuff",name:"Corrosion",activationType:I.Debuff,icon:D({icon:"cracked-shield"},ri),getDescription(i){return{descriptions:[P(`Defence is lowered by ${$c}, damage by ${vd}. Rounds left: ${i.spellInstance.state?.debuffRoundsLeft}.`)]}},config:{spellConfig:{init({events:i,actions:e,thisSpell:r,spellInstance:t,vfx:n}){i.on({SpellPlacedOnUnitGroup({target:o}){let s={debuffRoundsLeft:Cd};t.state=s;let p=e.createModifiers({baseDamagePercentModifier:-yd,heroBonusDefence:-$c});n.createEffectForUnitGroup(o,Hf),e.addModifiersToUnitGroup(o,p),e.historyLog(`${o.type.name} gets negative effect "${r.name}"`),i.on({NewRoundBegins(m){s.debuffRoundsLeft--,s.debuffRoundsLeft||(e.removeSpellFromUnitGroup(o,t),e.removeModifiresFromUnitGroup(o,p))}})}})}}}}),wd={id:"#spell-corrosive-fog",name:"Corrosive Fog",activationType:I.Target,icon:{icon:"cracked-shield"},getDescription(i){return{descriptions:[P(`Surrounds an enemy with corrosive fog, reducing defence by ${$c} and outgoing damage by ${vd}. Lasts ${Cd} rounds.`)]}},config:{spellConfig:{targetCastConfig:{canActivate:st},getManaCost(i){return{1:2,2:2,3:3,4:4}[i.currentLevel]},init({events:i,actions:e,ownerPlayer:r,ownerHero:t,thisSpell:n}){i.on({PlayerTargetsSpell(o){e.historyLog(`${t.name} casts "${n.name}" against ${o.target.type.name}`);let s=e.createSpellInstance(Lf);e.addSpellToUnitGroup(o.target,s,r)}})}}}};var ED=We.createHero({id:"#hero-veasin",name:"Veasin",generalDescription:F("Veasin makes use of her poison abilities, weakening enemies and dealing damage over time."),image:V.HeroMage,abilities:[Ou,wd],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-h01",10,18,2],["#unit-h20",6,11,1],["#unit-h30",3,5,1]]}],items:[Ur],resources:{gold:1100,wood:2,gems:0,redCrystals:0},stats:{mana:14,baseAttack:4,baseDefence:2}});var Nf=U({id:"#spell-onslaught-buff",name:"Onslaught",icon:{icon:"spear-head",bgClr:"orange",iconClr:"#f10c0c"},activationType:I.Buff,getDescription:()=>({descriptions:[P("This group of Raiders has increased stats and 40% lifesteal.")]}),config:{spellConfig:{getManaCost:()=>3,init({events:i,actions:e,vfx:r}){let t=e.createModifiers({lifesteal:40,heroBonusAttack:3,heroBonusDefence:2});i.on({SpellPlacedOnUnitGroup({target:n}){e.addModifiersToUnitGroup(n,t)}})}}}}),Sd=U({id:"#spell-onslaught",name:"Onslaught",icon:{icon:"spear-head"},activationType:I.Target,getDescription:()=>({descriptions:[P("Can only be casted on Raiders. Increases their stats and grants lifesteal.")]}),config:{spellConfig:{getManaCost:()=>1,init({events:i,actions:e,vfx:r,ownerPlayer:t}){i.on({PlayerTargetsSpell({target:n}){r.createEffectForUnitGroup(n,Qi("spear-head","orange"));let o=e.createSpellInstance(Nf,{initialLevel:1});e.addSpellToUnitGroup(n,o,t)}})},targetCastConfig:{canActivate:({isEnemy:i,unitGroup:e})=>!i&&e.type.name==="Raiders"}}}});var HD=Ft.createHero({id:"#hero-toothpick",name:"Toothpick",generalDescription:F("Toothpick is a famous captain of Raiders, their effectiveness excels under his command."),image:V.HeroKnight,abilities:[Sd],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-f00",16,18,1],["#unit-f10",10,10,1]]}],items:[],resources:Ei,stats:{mana:10,baseAttack:2,baseDefence:2},defaultModifiers:{}});var xd=U({id:"#spell-life-transfer",name:"Life Transfer",icon:{icon:"health-decrease"},activationType:I.Instant,getDescription:()=>({descriptions:[P("Reallocates health from enemies, dealing 20 damage to all enemies and equally distributing the dealt damage as healing among your army.")]}),config:{spellConfig:{getManaCost:()=>3,init({events:i,actions:e,vfx:r,ownerPlayer:t}){i.on({PlayerCastsInstantSpell(){let n=e.getEnemyOfPlayer(t),o=e.getAliveUnitGroupsOfPlayer(n),s=o.length;o.forEach(S=>{e.dealDamageTo(S,20,Ce.Magic)});let p=s*20,m=e.getUnitGroupsOfPlayer(t),v=Math.round(p/m.length);m.forEach(S=>e.healUnit(S,v))}})}}}});var bd=U({id:"#spell-obelisk",name:"Life Obelisk",icon:{icon:"arena"},activationType:I.Target,getDescription:()=>({descriptions:[P("Stuns selected target and summons an Obelisk with 100 health. Obelisk possesses aura that increases the armor by 4."),P("Obelisk cannot attack, but can be attacked and destroyed."),P("Some of Blight's abilities interact with obelisk."),P("Cannot be casted while there is another obelisk.")]}),config:{spellConfig:{getManaCost:()=>3,init({events:i,actions:e,vfx:r}){i.on({PlayerTargetsSpell({target:t}){r.createDroppingMessageForUnitGroup(t.id,{html:wi("Stunned!")}),e.removeTurnsFromUnitGroup(t,2)}})},targetCastConfig:{canActivate:st}}}});var t2=Ft.createHero({id:"#hero-blight",name:"Blight",generalDescription:F("A rotting ent called Blight. His army is weakened by -10% All Resist and -5 Defence, but compensating it with abilities and providing many ways to heal."),image:V.HeroKnight,abilities:[bd,xd],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-f00",13,16,2],["#unit-f10",10,14,1]]}],items:[],resources:Ei,stats:{mana:16,baseAttack:2,baseDefence:0},defaultModifiers:{heroBonusDefence:-5,resistAll:-10}});var _d=U({id:"#spell-firestorm",name:"Firestorm",icon:{icon:"flaming-claw"},activationType:I.Target,getDescription:()=>({descriptions:[P("Deals 100 damage to the target as fire damage while converting 30% of it to pure damage. Your current unit is going to suffer 25% of that damage as fire damage.")]}),config:{spellConfig:{getManaCost:()=>3,init({events:i,actions:e,vfx:r}){i.on({PlayerTargetsSpell({target:t}){e.dealDamageTo(t,70,Ce.Fire),e.dealDamageTo(t,30,Ce.Magic),e.dealDamageTo(e.getCurrentUnitGroup(),100*.25,Ce.Fire)}})},targetCastConfig:{canActivate:st}}}});var d2=Ft.createHero({id:"#hero-firebrand",name:"Firebrand",generalDescription:F("A half-troll who harnessed the chaotic nature of fire magic, which ends up unfortunately both for his enemies and allies. All Fort units will start with -15% Fire Resist."),image:V.HeroKnight,abilities:[_d],army:[{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-f00",16,18,1],["#unit-f10",10,10,1]]}],items:[],resources:Ei,stats:{mana:10,baseAttack:2,baseDefence:2},defaultModifiers:{__unitConditionalMods(i){return i.type.faction===Ft?{resistFire:-15}:null}}});var Md=4,Pd=U({id:"#spell-summon-sagittar",name:"Summon Sagittar",activationType:I.Instant,icon:{icon:"arrow-cluster"},getDescription(i){return{descriptions:[P(`Summons ${Md} Sagittars that fight on your side.`)]}},config:{spellConfig:{getManaCost(){return 2},init({actions:i,ownerHero:e,ownerPlayer:r,events:t,vfx:n,thisSpell:o}){t.on({PlayerCastsInstantSpell(){let s=i.summonUnitsForPlayer(r,"#unit-c00",Md);n.createEffectForUnitGroup(s,fn("arrow-cluster","rgb(190, 190, 231)"),{duration:1e3})}})}}}});zt.createHero({id:"#hero-blackbird",name:"Blackbird",image:V.HeroBlackbird,abilities:[Ws,Pd,Mu],army:[{maxUnitGroups:3,minUnitGroups:3,units:[["#unit-c00",6,11,2],["#unit-c10",3,5,1]]},{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-c00",12,18,1],["#unit-c10",7,12,1]]},{maxUnitGroups:3,minUnitGroups:3,units:[["#unit-c00",6,10,1],["#unit-c10",4,6,2]]}],generalDescription:F("Blackbird is a hero who specializes at Astral and Fire magic, as well as Summoning."),items:[sd],stats:{baseAttack:2,baseDefence:4,mana:15},resources:{gems:1,gold:1e3,redCrystals:1,wood:1}});var tt=function(i){return i[i.Event=0]="Event",i[i.LocationAction=1]="LocationAction",i[i.PlayerAction=2]="PlayerAction",i}(tt||{});var Dd=i=>`<i class="ra ra-${i}"></i>`,Ed=i=>i+Dd("feather-wing"),Yo=i=>i+Dd("crystal-ball");function yt(i){return Mi(i),i}var Zs=yt({id:"#acard-setup-camp",title:"Set up Camp",icon:"campfire",type:tt.PlayerAction,bgColor:"gray",iconColor:"#ffae66",description:"You set up camp, skipping this day.",config:{onUsedInstantly({events:i,actions:e}){i.dispatch(jt({points:e.getActionPointsLeft()}))}}}),Qo=yt({id:"#acard-skip-the-day",title:"Skip the day",icon:"moon-sun",type:tt.PlayerAction,bgColor:"#283761",iconColor:"rgb(255 198 90)",borderColor:"rgb(255 198 90)",description:"You will immediately skip this day and receive 200 gold for each remaining action point left.",config:{onUsedInstantly({events:i,players:e,actions:r}){let t=e.getCurrentPlayer(),n=r.getActionPointsLeft(),o=n*200;i.dispatch(jt({points:n})),e.giveResourcesToPlayer(t,{gold:o}),i.dispatch(qn({message:[{type:mi.FreeHtml,htmlContent:`${Kn(Qo)}:<hr/>+${o} Gold`}]}))}}}),yn=yt({id:"#acard-meditate",title:"Meditate",icon:"barrier",bgColor:"rgb(39 57 89)",iconColor:"#d9f2fd",type:tt.PlayerAction,description:`You restore ${Yo(3)} mana (+${Yo(2)} per point of Restoration specialty), consumes ${Ed(2)} action points. Action restored every week.`,actionPoints:2,config:{onUsedInstantly({events:i,players:e}){let r=e.getCurrentPlayer(),o=3+(r.hero.specialtiesModGroup.getModValue("specialtyMagicRecovery")||0)*2;e.addManaToPlayer(r,o),i.dispatch(qn({message:[{type:mi.FreeHtml,htmlContent:`${Kn(yn)}: Restored ${Yo(o)} Mana.`}]}))}}}),jf=yt({id:"#acard-restore-mana",title:"Restore Mana",icon:"barrier",bgColor:"rgb(39 57 89)",iconColor:"#d9f2fd",type:tt.PlayerAction,description:"You restore 3 points of mana (+2 per point of Restoration specialty), consumes 1 action point.",actionPoints:1,config:{onUsedInstantly({events:i,players:e}){let r=e.getCurrentPlayer(),o=3+(r.hero.specialtiesModGroup.getModValue("specialtyMagicRecovery")||0)*2;e.addManaToPlayer(r,o),i.dispatch(qn({message:[{type:mi.FreeHtml,htmlContent:`${Kn(jf)}: Restored ${Yo(o)} Mana.`}]}))}}}),L2=yt({id:"#acard-recruit",title:"Recruit",icon:"knight-helmet",bgColor:"rgb(39 57 89)",iconColor:"#d9f2fd",type:tt.PlayerAction,description:"Gives you additional units below tier 3, consumes 2 action points."}),Id=yt({id:"#acard-rangers-horn",title:"Ranger's Horn",description:"8 Rangers will join your army for 3 days. Rangers are effective against forest dwellers.",bgColor:"#3c843c",icon:"hood",type:tt.PlayerAction,config:{onUsedInstantly({actions:i,players:e,events:r}){let t="#unit-neut-ranger-0",n=e.getCurrentPlayer(),o=8;e.addUnitGroupToPlayer(n,t,o),r.dispatch(Ci({message:`${o} Rangers joined your army.`})),i.scheduleAction(()=>{e.removeUnitTypeFromPlayer(n,t,o),r.dispatch(Ci({message:"Summoned Rangers have left your army."}))},2)}}});var it=function(i){return i[i.Hiring=0]="Hiring",i[i.Garrison=1]="Garrison",i[i.ItemsSelling=2]="ItemsSelling",i}(it||{}),Td=(()=>{let e=class e extends Tt{constructor(){super(...arguments),this.currentLevel=0,this.built=!1}create(t){this.base=t.base,this.currentBuilding=t.base.levels[0].building}};e.categoryId="building";let i=e;return i})();function me(i){return Mi(i),i}function Ko(i,e,r,t=!1){return{type:it.Hiring,hiring:{unitTypeId:i,growth:e,refillDaysInterval:7},unitGrowthGroup:r,growth:e,growthIntervalDays:7,upgrade:t}}function vn(i,e,r,t=!1){return{type:it.Hiring,hiring:{unitTypeId:i,growth:e,refillDaysInterval:7},unitGrowthGroup:r,growth:e,growthIntervalDays:7,upgrade:t}}var $f=me({id:"#build-castle-town-center",name:"Town Center",description:"Earns 500 gold each day.",config:{init({players:i,localEvents:e}){e.on({NewDayBegins(){i.giveResourcesToPlayer(i.getCurrentPlayer(),{gold:500})}})}}}),Vf=me({id:"#build-castle-market",name:"Market"}),zf=me({id:"#build-castle-high-tower",name:"High Tower",description:"Gives 1 Meditation action card instantly and at the beginning of each week.",config:{init({localEvents:i,players:e,globalEvents:r}){r.dispatch(Wi({actionCardStacks:[{card:yn,count:1}],player:e.getCurrentPlayer()})),i.on({NewWeekStarts(){r.dispatch(Wi({actionCardStacks:[{card:yn,count:1}],player:e.getCurrentPlayer()}))}})}}}),Wf=me({id:"#build-castle-tavern",activity:{type:it.Garrison},name:"Tavern",description:"Allows to hire more units, including neutral ones, from your garrison",config:{init({globalEvents:i,players:e,localEvents:r}){i.dispatch(Wi({actionCardStacks:[{card:Id,count:1}],player:e.getCurrentPlayer()})),r.on({Built(){e.getCurrentPlayer().garrisons.set("castle-tavern",{groups:[{cost:{gold:200},count:8,type:Ne("#unit-neut-ranger-0")}],name:"Castle Tavern"})},NewWeekStarts(){e.getCurrentPlayer().garrisons.set("castle-tavern",{groups:[{cost:{gold:200},count:8,type:Ne("#unit-neut-ranger-0")}],name:"Castle Tavern"})}})}}}),qf=me({id:"#build-castle-taining-camp-1",name:"Training Camp",description:"Allows to train Pikemans that can be upgraded.",activity:vn("#unit-h00",18,"pikeman")}),Yf=me({id:"#build-castle-taining-camp-2",name:"Upg. Training Camp",description:"Allows to hire and upgrade Halberdiers",activity:vn("#unit-h00",18,"pikeman",!0)}),Qf=me({id:"#build-castle-archers-1",name:"Archers Outpost",description:"Allows to train Archers",activity:vn("#unit-h10",12,"archers")}),Kf=me({id:"#build-castle-archers-2",name:"Upg. Archers Outpost",description:"Allows to train Archers and Crossbowmen",activity:vn("#unit-h10",12,"archers",!0)}),Zf=me({id:"#build-castle-knights-1",name:"Halls of Knights",description:"Allows to train Knights",activity:vn("#unit-h20",4,"knights")}),Xf=me({id:"#build-castle-cavalry-1",name:"Cavalry Stalls",description:"Allows to train Cavalry",activity:vn("#unit-h30",2,"cavalry")}),Jf=me({id:"#build-castle-magic-tower-1",name:"Magic Tower",description:"Allows to train Mystical Birds",activity:vn("#unit-h40",2,"firebirds")}),eh=me({id:"#build-castle-magic-tower-2",name:"Upg. Magic Tower",description:"Allows to train Mystical Birds and Firebirds",activity:vn("#unit-h40",2,"firebirds",!0)}),th=me({id:"#build-castle-items-market",name:"Item market",activity:{type:it.ItemsSelling},description:"Sells items",config:{init({localEvents:i,thisBuilding:e}){i.on({Built(){e.addCustomData({items:["#item-iron-pike","#item-irton-plate","#item-kite-shield","#item-storm-pike","#item-battlemage-sword"],selling:!0})}})}}}),ih=me({id:"#build-castle-halls-of-fate",name:"Halls of Fate"}),nh=me({id:"#build-castle-garrison",name:"Garrison",description:"Allows to hire groups of units temporarily for reduced cost.",activity:{type:it.Garrison},config:{init({localEvents:i,players:e}){i.on({Built(){e.getCurrentPlayer().garrisons.set("castle-garrison",{groups:[{cost:{gold:200},type:Ne("#unit-h00"),count:16},{cost:{gold:340},type:Ne("#unit-h20"),count:6}],name:"Castle Garrison"})},NewWeekStarts(){e.getCurrentPlayer().garrisons.set("castle-garrison",{groups:[{cost:{gold:200},type:Ne("#unit-h00"),count:16},{cost:{gold:340},type:Ne("#unit-h20"),count:6}],name:"Castle Garrison"})}})}}}),rh={id:"#town-castle",name:"Castle",availableBuildings:{"town-center":{baseName:"Town Center",description:"Grants you daily income",levels:[{building:$f,cost:{gold:1e3}}],icon:"capitol",tier:1},"items-market":{baseName:"Items Market",description:"Sells items",icon:"key-basic",levels:[{building:th,cost:{gold:500}}],tier:1},market:{baseName:"Market",description:"Allows to trade resources",levels:[{building:Vf,cost:{gold:1500,wood:2}}],icon:"gavel",tier:2},"magic-school":{baseName:"Magic School",description:"Allows you to learn spells for your hero",levels:[{building:zf,cost:{gold:1e3,gems:2}}],icon:"burning-book",tier:2},tavern:{baseName:"Tavern",description:"Allows to hire neutral units",levels:[{building:Wf,cost:{gold:850,wood:1}}],icon:"hood",tier:2},garrison:{baseName:"Garrison",description:"Allows to hire units temorary",icon:"guarded-tower",tier:1,levels:[{building:nh,cost:{wood:2,gold:500}}]},"fate-halls":{baseName:"Halls of Fate",description:"Allows to develop your hero",levels:[{building:ih,cost:{gold:1e3}}],icon:"barrier",tier:3},"training-camp":{baseName:"Training Camp",description:"Trains Pikemans",levels:[{building:qf,cost:{gold:450}},{building:Yf,cost:{gold:150,wood:2}}],icon:"spear-head",tier:1},"archers-outpost":{baseName:"Archers Outpost",description:"Trains Archers",levels:[{building:Qf,cost:{gold:500,wood:2}},{building:Kf,cost:{gold:400,wood:2}}],icon:"arrow-cluster",tier:1},"halls-of-knights":{baseName:"Halls of Knights",description:"Trains Knights",levels:[{building:Zf,cost:{gold:1e3,wood:5}}],icon:"crossed-swords",tier:2},"cavalry-halls":{baseName:"Cavalry Halls",description:"Trains Cavalry",levels:[{building:Xf,cost:{gold:1e3,wood:5}}],icon:"horseshoe",tier:3},"magic-tower":{baseName:"Magic Tower",description:"Trains Firebirds and Mystical Birds",levels:[{building:Jf,cost:{gold:1500,wood:5}},{building:eh,cost:{gold:600,wood:5}}],icon:"tower",tier:4}}};We.setTownBase(rh);var oh=me({id:"#build-fort-town-hall-1",name:"Town Hall",description:"Earns 400 gold each day and gives 1 additional reserve slot.",config:{init({players:i,localEvents:e}){e.on({NewDayBegins(){i.giveResourcesToPlayer(i.getCurrentPlayer(),{gold:400})},Built(){i.getCurrentPlayer().hero.addReserveSlots(1)}})}}}),sh=me({id:"#build-fort-market",name:"Market"}),ah=me({id:"#build-fort-tavern",name:"Tavern"}),ch=me({id:"#build-fort-rocky-caves",name:"Rocky Caves",description:"Allows to hire units temporarily",activity:{type:it.Garrison},config:{init({localEvents:i,players:e}){i.on({Built(){e.getCurrentPlayer().garrisons.set("rocky-caves",{groups:[{cost:{gold:100},count:8,type:Ne("#unit-f00")},{cost:{gold:100},count:8,type:Ne("#unit-f00")},{cost:{gold:100},count:8,type:Ne("#unit-f00")}],name:"Rocky Caves"})},NewWeekStarts(){e.getCurrentPlayer().garrisons.set("rocky-caves",{groups:[{cost:{gold:100},count:8,type:Ne("#unit-f00")},{cost:{gold:100},count:8,type:Ne("#unit-f00")},{cost:{gold:100},count:8,type:Ne("#unit-f00")}],name:"Rocky Caves"})}})}}}),lh=me({id:"#build-fort-goblin-huts-1",name:"Goblin Huts",description:"Allows to train Raiders that can be upgraded.",activity:Ko("#unit-f00",18,"raiders")}),ph=me({id:"#build-fort-goblin-huts-2",name:"Upg. Goblin Huts",description:"Allows to train Raiders and Clan.",activity:Ko("#unit-f00",18,"raiders",!0)}),uh=me({id:"#build-fort-stockade-1",name:"Stockade",description:"Allows to train Goblin Archers that can be upgraded.",activity:Ko("#unit-f10",18,"goblinArcher")}),dh=me({id:"#build-fort-stockade-2",name:"Upg. Stockade",description:"Allows to train Goblin Archers and Goblin Shooters.",activity:Ko("#unit-f10",18,"goblinArcher",!0)}),mh={id:"#town-fort",name:"Castle",availableBuildings:{"town-hall":{baseName:"Town Hall",description:"Grants you daily income",levels:[{building:oh,cost:{gold:1e3}}],icon:"capitol",tier:1},market:{baseName:"Market",description:"Allows to trade resources",levels:[{building:sh,cost:{gold:1500,wood:2}}],icon:"gavel",tier:1},"rocky-caves":{baseName:"Rocky Caves",description:"Allows to hire units temporarily",icon:"guarded-tower",levels:[{building:ch,cost:{gold:200,wood:2}}],tier:1},tavern:{baseName:"Tavern",description:"Allows to hire neutral units",levels:[{building:ah,cost:{gold:1250,wood:3}}],icon:"hood",tier:2},"goblin-huts":{baseName:"Golbin Huts",description:"Trains Goblin Huts",levels:[{building:lh,cost:{gold:475}},{building:ph,cost:{gold:150,wood:2}}],icon:"spear-head",tier:1},stockade:{baseName:"Stockade",description:"Trains Goblin Archers",levels:[{building:uh,cost:{gold:700}},{building:dh,cost:{gold:150,wood:2}}],icon:"spear-head",tier:1}}};Ft.setTownBase(mh);function Fd(i,e,r,t=!1){return{type:it.Hiring,hiring:{unitTypeId:i,growth:e,refillDaysInterval:7},unitGrowthGroup:r,growth:e,growthIntervalDays:7,upgrade:t}}var fh=me({id:"#build-stellar-town-center-1",name:"Town Center"}),hh=me({id:"#build-stellar-market",name:"Market"}),gh=me({id:"#build-stellar-high-tower",name:"High Tower"}),yh=me({id:"#build-stellar-tavern",name:"Tavern"}),vh=me({id:"#build-stellar-solar-gate",name:"Solar Gate",description:"Allows to hire units temporarily",activity:{type:it.Garrison},config:{init({localEvents:i,players:e}){i.on({Built(){e.getCurrentPlayer().garrisons.set("solar-gate",{name:"Solar Gate",groups:[{cost:{gold:130},count:8,type:Ne("#unit-c00")},{cost:{gold:130},count:8,type:Ne("#unit-c00")},{cost:{gold:180},count:8,type:Ne("#unit-c20")}]})}})}}}),Ch=me({id:"#build-stellar-spirit-towers",name:"Spirit Towers",description:"Allows to train Sprites.",activity:Fd("#unit-c00",10,"sprite")}),wh=me({id:"#build-stellar-moon-arch-1",name:"Moon Arch",activity:Fd("#unit-c00",8,"saggitar")}),Sh=me({id:"#build-stellar-fate-halls",name:"Halls of Fate"}),xh={id:"#town-constellation",name:"Constellation",availableBuildings:{"town-center":{baseName:"Town Center",description:"Grants you daily income",levels:[{building:fh,cost:{gold:2e3}}],icon:"capitol",tier:1},market:{baseName:"Market",description:"Allows to trade resources",levels:[{building:hh,cost:{gold:1350}}],icon:"gavel",tier:1},"star-gate":{baseName:"Solar Gate",description:"Allows to temporarily summon units for reduced cost",icon:"heavy-fall",tier:1,levels:[{building:vh,cost:{gold:500,wood:1}}]},"magic-school":{baseName:"Magic School",description:"Allows you to learn spells for your hero",levels:[{building:gh,cost:{gold:1500,gems:1}}],icon:"burning-book",tier:2},tavern:{baseName:"Tavern",description:"Allows to hire neutral units",levels:[{building:yh,cost:{gold:1250}}],icon:"hood",tier:2},"fate-halls":{baseName:"Halls of Fate",description:"Allows to develop your hero",levels:[{building:Sh,cost:{gold:1500}}],icon:"barrier",tier:2},"spirit-towers":{baseName:"Spirit Towers",description:"Trains Sprites",levels:[{building:Ch,cost:{gold:450}}],icon:"spear-head",tier:1},"moon-arch":{baseName:"Moon Arch",description:"Trains Sagittars",levels:[{building:wh,cost:{gold:500,wood:1}}],icon:"arrow-cluster",tier:1}}};zt.setTownBase(xh);var Xs=class{constructor(e){this.mapSize=D({},e.mapDimensions),this.structures=e.structures,this.startingLocId=e.startLocId}};var we=function(i){return i.Neutral="neutral",i.EnemyPlayer="enemy",i}(we||{}),_t=function(i){return i[i.Scripted=0]="Scripted",i}(_t||{}),He=function(i){return i.SingleResource="resource",i.Resources="resources",i.Item="item",i.UnitsHire="hire",i.Mines="mines",i.UnitsUpgrade="upgrading",i.Scripted="scripted",i.NoReward="no-reward",i}(He||{});function Me(i){return Mi(i),i}function Js({id:i,name:e,guard:r,unitsForHire:t}){return{id:i,name:e,actionPoints:1,control:we.Neutral,generateGuard:()=>r,generateReward:()=>({type:He.UnitsHire,units:t})}}function Ki(i,e){return e.map(r=>K(D({},r),{id:`${i}.${r.id}`,pathTo:r.pathTo?r.toOuterBranch?r.pathTo:`${i}.${r.pathTo}`:void 0}))}var er=(()=>{let e=class e extends Tt{constructor(){super(...arguments),this.name="",this.x=0,this.y=0,this.parentStructs=new Set,this.icon="",this.isInactive=!1,this.isCompleted=!1,this.actionPoints=0}create({iconName:t,x:n,y:o,isRoot:s,generator:p,guardingPlayer:m,pathTo:v,actionPoints:S,structParams:E}){this.x=n,this.y=o,this.icon=t,this.isRoot=s,this.generator=p,this.structParams=E,p&&(this.name=p.description?.({thisStruct:this}).name??p.name),this.actionPoints=S||p?.actionPoints||0,this.guardingPlayer=m,this.pathTo=v}setControls(t){this.controls?this.controls=D(D({},this.controls),t):this.controls=t}getStructParams(){return this.structParams}};e.categoryId="structure";let i=e;return i})();var Ad=Js({id:"#struct-archers-outpost",name:"Archers Outpost",guard:{maxUnitGroups:3,minUnitGroups:3,units:[["#unit-h10",8,11,3]]},unitsForHire:[{unitTypeId:"#unit-h10",maxCount:12}]});var ge=function(i){return i.Gold="gold",i.Wood="wood",i.RedCrystals="redCrystals",i.Gems="gems",i}(ge||{});var ea={[ge.Gems]:"Gems",[ge.Gold]:"Gold",[ge.RedCrystals]:"Red Crystals",[ge.Wood]:"Wood"};function ta(i){return Object.entries(i).map(([e,r])=>({resName:ea[e],type:e,count:r}))}function bh(i){return Object.entries(i).map(([e,r])=>`+${r} ${ea[e]}`)}function ia(i){return bh(i).join(`
`)}var Zi=Me({id:"#struct-bandit-camp",name:"Bandit Camp",actionPoints:1,control:we.Neutral,generateGuard:()=>({maxUnitGroups:2,minUnitGroups:1,units:[["#unit-neut-thief-0",14,24,1],["#unit-neut-gnoll-0",14,24,3]]}),generateReward:()=>q.randBoolean()?{type:He.Resources,resourceGroups:[[{type:ge.Gold,count:450},{type:ge.Gems,count:1}],[{type:ge.Gold,count:800},{type:ge.Wood,count:2}]]}:{type:He.Item,itemGroups:[[q.randBoolean()?Ur:Ks],[id],[od],[nd]]}});var Od=Me({id:"#struct-big-camp",name:"Big Camp",actionPoints:1,generateGuard(){return{maxUnitGroups:3,minUnitGroups:3,units:[["#unit-neut-forest-troll-0",23,25,1],["#unit-neut-gnoll-0",28,36,1],["#unit-neut-thief-0",15,18,1]]}},control:we.Neutral,generateReward:()=>({type:He.Scripted,description:`Big camp is defeated! 

 +450 Experience`,onAccept({playersApi:i}){let e=i.getCurrentPlayer();i.addExperienceToPlayer(e,450)}})});var kd=Js({id:"#struct-cavalry-stalls",name:"Cavalry Stalls",guard:{maxUnitGroups:2,minUnitGroups:2,units:[["#unit-h30",3,3,2]]},unitsForHire:[{unitTypeId:"#unit-h30",maxCount:4}]});var Gd=Me({id:"#struct-graveyard",name:"Graveyard",actionPoints:1,control:we.Neutral,generateGuard:()=>({maxUnitGroups:2,minUnitGroups:3,units:[["#unit-neut-ghost-0",14,18,3]]}),generateReward:()=>({type:He.UnitsHire,units:[{unitTypeId:"#unit-neut-ghost-0",maxCount:24}]})}),Rd=Me({id:"#struct-undead-beacon",name:"Beacon of the Undead",control:we.Neutral,description:()=>({descriptions:["Allows to upgrade your ghost units below level 4."]}),generateReward:()=>({type:He.UnitsUpgrade,getUnits:i=>i.getCurrentPlayerUnitGroups().filter(e=>{let r=e.type;return!r.upgraded&&r.level<=4&&r.defaultModifiers?.isGhost})})});var Ud=Me({id:"#struct-magic-river",control:we.Neutral,actionPoints:1,name:"Magic River",description:()=>({descriptions:[`Walking near magic river, you feel your magical powers restored.

+4 to mana and +2 to max mana`]}),type:_t.Scripted,config:{init({localEvents:i,players:e,thisStruct:r}){i.on({StructVisited({visitingPlayer:t}){e.addMaxManaToPlayer(t,2),e.addManaToPlayer(t,4),r.visited=!0}})}}});var Bd=Me({id:"#struct-mountain-nest",control:we.Neutral,actionPoints:2,name:"Mountain Nest",description:({thisStruct:i})=>{let e=[P(`Walking through mountains, you find a very bright birdnest... 

1-2 Firebirds join your army.`)];return i.controls?.accept===!1&&e.push(P("You have no free slots.")),{descriptions:e}},type:_t.Scripted,config:{init({localEvents:i,players:e,thisStruct:r}){i.on({StructVisited({visitingPlayer:t}){e.addUnitGroupToPlayer(t,"#unit-h40",q.randIntInRange(1,2)),r.visited=!0},StructInspected(){r.setControls({accept:e.getCurrentPlayer().hero.hasFreeUnitSlots()})}})}}});var Hd=Me({id:"#struct-witch-hut",control:we.Neutral,actionPoints:1,name:"Witch Hut",description:()=>({descriptions:[`Walking trough the woods, you find an abandoned Witch Hut.

Learn "Enchant" level 2`]}),type:_t.Scripted,config:{init({localEvents:i,players:e,thisStruct:r,spells:t}){i.on({StructVisited({visitingPlayer:n}){let o=t.createSpellInstance(yu,{initialLevel:2});e.addSpellToPlayerHero(n,o),r.visited=!0}})}}});var Ld=Me({id:"#struct-thief-lair",name:"Thieves' Lair",actionPoints:2,control:we.Neutral,generateGuard:()=>({maxUnitGroups:3,minUnitGroups:3,units:[["#unit-neut-thief-0",12,14,2],["#unit-neut-gnoll-0",14,24,3]]}),generateReward:()=>({type:He.Item,itemGroups:[[Qs],[td],[Fp]]})});var Nd=Me({id:"#struct-rocky-passage",name:"Rocky Passage",actionPoints:2,description:()=>({descriptions:["A rocky passage held by a powerful dragon."]}),disableWeeklyGuardRise:!0,generateGuard(){return{minUnitGroups:1,maxUnitGroups:1,units:[["#unit-neut-boss-devastator",1,1,1]]}},control:we.Neutral,generateReward:()=>({type:He.NoReward})});var jd=Me({id:"#struct-dark-arts-school",control:we.Neutral,actionPoints:2,name:"School of Dark Arts",description:()=>({descriptions:[`You are visiting the school of dark arts.

+1 to Necromancy specialty`]}),type:_t.Scripted,config:{init({localEvents:i,players:e,thisStruct:r}){i.on({StructVisited({visitingPlayer:t}){t.hero.addStatsMods({specialtyNecromancy:1}),r.visited=!0}})}}});var $d=Me({id:"#struct-fire-ring",name:"Fire Ring",actionPoints:2,generateGuard(){return{maxUnitGroups:3,minUnitGroups:3,units:[["#unit-neut-fire-spirit-0",7,9,3]]}},control:we.Neutral,generateReward:()=>({type:He.NoReward})}),Vd=Me({id:"#struct-guard-lock",name:"Fire Ring",actionPoints:2,description:({thisStruct:i})=>{let{name:e}=i.getStructParams();return{name:e,descriptions:[]}},generateGuard({thisStruct:i}){let{guards:e}=i.getStructParams();return e},control:we.Neutral,generateReward:()=>({type:He.NoReward})});var zd=Me({id:"#struct-mausoleum",name:"Mausoleum",actionPoints:1,control:we.Neutral,generateGuard:()=>({minUnitGroups:3,maxUnitGroups:3,units:[["#unit-neut-skeleton-0",22,34,2],["#unit-neut-lich-0",3,4,1]]})});var Vc=Me({id:"#struct-daily-res-mine",name:"Mine with Resources",control:we.Neutral,description:({thisStruct:i})=>({descriptions:[`You found a mine with resources, each day it will bring you:

`+ia(i.structParams)]}),type:_t.Scripted,config:{init({localEvents:i,players:e,thisStruct:r,eventFeed:t}){i.on({StructVisited(){r.visited=!0,e.giveResourcesToPlayer(e.getCurrentPlayer(),r.structParams),i.on({NewDayBegins(){e.giveResourcesToPlayer(e.getCurrentPlayer(),r.structParams)}})}})}}});var tr=Me({id:"#struct-res-pile",name:"Pile of Resources",control:we.Neutral,description:({thisStruct:i})=>{let e=i.structParams,r=ta(e);return{name:r.length>1?"Pile of Resources":`Pile of ${r[0].resName}`,descriptions:[`You found a pile of resources 

`+ia(e)]}},type:_t.Scripted,config:{init({localEvents:i,players:e,thisStruct:r}){i.on({StructVisited({visitingPlayer:t}){r.visited=!0,e.giveResourcesToPlayer(t,r.structParams)}})}}});var zc=(i,e)=>({x:i+1700,y:e+1500}),Wd=Ki("const-start",[K(D({id:"start"},zc(0,0)),{icon:"campfire"}),K(D({id:"1",pathTo:"start"},zc(90,-60)),{icon:"gold-bar",actionPoints:2,struct:tr,structParams:{gold:650}}),K(D({id:"2",pathTo:"start"},zc(10,-70)),{icon:"sword",struct:Zi})]);var Mh=476,Cn="start";function W(i){return i+Mh}var Ph=Ki("start-bottom-right",[{id:"entry",x:W(60),y:W(30),icon:"tombstone",pathTo:Cn,toOuterBranch:!0,struct:Gd,tags:[""]},{id:"1",x:W(120),y:W(40),icon:"sword",pathTo:"entry",struct:Zi},{id:"1-1",x:W(140),y:W(-10),icon:"hand-saw",pathTo:"1",actionPoints:1,struct:tr,structParams:{wood:4}},{id:"witch",x:W(180),y:W(60),icon:"book",pathTo:"1",struct:Hd},{id:"5",x:W(120),y:W(90),icon:"sword",pathTo:"1",struct:Zi},{id:"pre-boss",x:W(40),y:W(80),icon:"sword",pathTo:"5",struct:Zi},{id:"7",x:W(170),y:W(141),icon:"horseshoe",pathTo:"5",struct:kd},{id:"7-1",pathTo:"7",x:W(165),y:W(201),icon:"scroll-unfurled",struct:jd},{id:"7-2",actionPoints:2,x:W(240),y:W(148),icon:"hand-saw",pathTo:"7",struct:Vc,structParams:{wood:1}},{id:"boss",x:W(45),y:W(145),icon:"monster-skull",pathTo:"pre-boss",actionPoints:2,struct:Od}]),Dh=Ki("five",[{id:"1",pathTo:Cn,toOuterBranch:!0,x:W(-30),y:W(70),icon:"gold-bar",actionPoints:1,struct:tr,structParams:{gold:650}}]),Eh=Ki("start-bottom-left",[{id:"entry",x:W(-70),y:W(10),icon:"sword",pathTo:Cn,toOuterBranch:!0,struct:Zi},{id:"1",x:W(-120),y:W(-100),icon:"mountains",pathTo:"entry",struct:Bd},{id:"2",x:W(-130),y:W(55),icon:"sword",pathTo:"entry",struct:Zi},{id:"3",x:W(-120),y:W(-10),icon:"campfire",pathTo:"2",struct:Ld},{id:"4",actionPoints:4,x:W(-180),y:W(-80),icon:"crystals",pathTo:"3",struct:Vc,structParams:{redCrystals:1}},{id:"pre-boss",x:W(-190),y:W(20),icon:"fire-ring",pathTo:"2",struct:$d,actionPoints:2},{id:"boss",x:W(-250),y:W(-50),icon:"monster-skull",pathTo:"pre-boss",struct:Nd,actionPoints:2},{id:"post-boss",pathTo:"boss",icon:"capitol",x:W(-300),y:W(-80),actionPoints:2,struct:zd},{id:"wagon",x:W(-190),y:W(90),icon:"mine-wagon",pathTo:"2",struct:tr,structParams:{gold:450,redCrystals:1,gems:1}}]),Ih=Ki("start-top-left",[{id:"entry",x:W(-60),y:W(-60),icon:"sword",pathTo:Cn,toOuterBranch:!0,struct:Zi},{id:"river",x:W(-40),y:W(-120),icon:"incense",pathTo:"entry",struct:Ud,actionPoints:1},{id:"1",x:W(50),y:W(-110),icon:"tower",pathTo:"entry",struct:Ad,actionPoints:1},{id:"gems",x:W(70),y:W(-170),icon:"emerald",pathTo:"1",struct:tr,structParams:{gems:3}}]),Th=Ki("post-boss-1",[{id:"entry",x:194,y:338,actionPoints:1,icon:"sword",pathTo:"start-bottom-left.post-boss",toOuterBranch:!0,struct:Vd,structParams:{name:"Swamp",guards:{units:[["#unit-neut-poison-ivy-0",20,20,3]],maxUnitGroups:3,minUnitGroups:3}}}]),Fh=Ki("start-top-right",[{id:"beacon",x:W(35),y:W(-50),icon:"lighthouse",pathTo:Cn,toOuterBranch:!0,struct:Rd}]),qd=[{id:Cn,x:W(0),y:W(0),icon:"campfire"},...Dh,...Ph,...Eh,...Ih,...Fh,...Wd,...Th];var ir={registryMap:new Map,register(i,e){this.registryMap.has(i)?this.registryMap.get(i).push(e):this.registryMap.set(i,[e])}};ir.register(Rr.PrepareGameEvent,{fn:(i,{events:e})=>{if(i.gameMode!==$o.Normal)return;let r=Cn;i.selectedFaction,zt,console.log("Structures are prepared.");let t=new Xs({mapDimensions:{heightInCells:27,widthInCells:34,cellSize:86},structures:qd,startLocId:r});e.dispatch(Rr.GamePreparationFinished({map:t}))}});ir.register($i,{fn:(i,e)=>{let r=[{card:Zs,count:1/0},{card:yn,count:1},{card:Qo,count:1}],t=e.players.getCurrentPlayer();e.events.dispatch(Wi({player:t,actionCardStacks:r}))}});ir.register(zi,{fn:(i,e)=>{e.actions.getMapStructures().filter(t=>!t.visited&&t.guard?.length&&!t.generator?.disableWeeklyGuardRise).forEach(t=>{t.guard?.forEach(n=>n.addUnitsCount(Math.round(n.count*.4)))}),e.events.dispatch(Ci({message:"Guards in locations raised by 40%"}))}});ir.register(Fo,{fn:(i,{events:e,players:r})=>{e.dispatch(Oo({title:`You reached level ${i.newLevel}`,subTitle:"Choose your reward",rewards:[...i.hero.spells.filter(t=>i.hero.base.initialState.abilities.includes(t.baseType)).map(t=>({display:{icon:t.baseType.icon.icon,title:`Level ${t.currentLevel+1} ${t.name}`},onSumbit:()=>{t&&t.levelUp()}})),{display:{icon:"crystal-ball",title:"+4 to Max/Current Mana"},onSumbit:()=>{let t=r.getCurrentPlayer(),n=4;r.addMaxManaToPlayer(t,n),r.addManaToPlayer(t,n)}}]}))}});var Ii=(()=>{let e=class e{constructor(){this.history=[],this.historyEvent$=new Mt}logHtmlMessage(t){let n={type:kn.Html,message:t};this.pushMessage(n)}logSimpleMessage(t){let n={type:kn.SimpleMsg,message:t};this.pushMessage(n)}logRoundInfoMessage(t){let n={type:kn.RoundInfoMsg,message:t};this.pushMessage(n)}logDealtDamageMessage(t){let n=D({type:kn.DealtDamageMsg},t);this.pushMessage(n)}pushMessage(t){this.history.push(t),this.historyEvent$.next()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();function na(i){i.next(),i.complete()}var qt=function(i){return i.HeroMods="hMods",i.CombatMods="cMods",i.AuraMods="aMods",i.SpecialtyAndConditionalMods="scMods",i.SpellMods="sMods",i}(qt||{}),ra=(()=>{let e=class e extends Tt{constructor(){super(...arguments),this.modGroup=xt.empty(),this.unitStats$=new Pt({baseAttack:0,bonusAttack:0,finalAttack:0,baseDefence:0,bonusDefence:0,finalDefence:0,defends:!1,baseSpeed:0,speedBonus:0,finalSpeed:0,fireResist:0,coldResist:0,lightningResist:0,poisonResist:0,totalHealth:0,totalMinDamage:0,totalMaxDamage:0,avgTotalDamage:0,position:0}),this.destroyed$=new Mt}get count(){return this._count}get tailUnitHp(){return this._tailUnitHp}get ownerHero(){return this._ownerHero}get ownerPlayer(){return this._ownerPlayer}get spells(){return this._spells}create({count:t,unitBase:n,ownerHero:o}){(t<=0||!t)&&(console.warn(`Cannot create unit group with ${t} units. Setting count to 1.`,this),t=1),this.type=n,o&&(this.assignOwnerHero(o),this.assignOwnerPlayer(o.ownerPlayer)),this.turnsLeft=n.defaultTurnsPerRound||1,this._tailUnitHp=n.baseStats.health,this.type.defaultModifiers&&this.modGroup.addModsRef(ft.fromMods(this.type.defaultModifiers)),this.fightInfo={initialCount:t,isAlive:!0,spellsOnCooldown:!1},this.setUnitsCount(t),this.modGroup.attachNamedParentGroup(qt.CombatMods,xt.empty()),this.modGroup.attachNamedParentGroup(qt.SpecialtyAndConditionalMods,xt.empty()),this.modGroup.attachNamedParentGroup(qt.SpellMods,xt.empty()),this._spells=[],this.type.defaultSpells&&this.type.defaultSpells.map(s=>this.getApi().spells.createSpellInstance(s)).forEach(s=>this.addSpell(s)),this.setupStatsUpdating()}setPosition(t){let n=this.getStats();n.position!==t&&(n.position=t,this.unitStats$.next(n))}assignOwnerHero(t){this._ownerHero=t,this._ownerPlayer=t.ownerPlayer,this.modGroup.detachNamedParentGroup(qt.HeroMods),this.modGroup.attachNamedParentGroup(qt.HeroMods,this._ownerHero.modGroup)}onDestroy(){na(this.destroyed$),this.spells.forEach(t=>this.getApi().gameObjects.destroyObject(t))}assignOwnerPlayer(t){this._ownerPlayer=t}addUnitsCount(t){this.setUnitsCount(this._count+t)}setUnitsCount(t){this._count=t>=0?t:0,this.recalcHealthBasedStats()}addTailUnitHp(t){this.setTailUnitHp((this._tailUnitHp??0)+t)}setTailUnitHp(t){this._tailUnitHp=t,this.recalcHealthBasedStats()}listenStats(){return this.unitStats$.pipe(Xe(this.destroyed$))}addSpell(t){this._spells.push(t),t.setOwnerObjectId(this.id),t.baseType.config.spellConfig.onAcquired?.({spellInstance:t,ownerUnit:this}),this.getApi().events.dispatch(ln({unitGroup:this}))}removeSpell(t){q.removeItem(this._spells,t)}removeDefendingMod(){let t=this.modGroup.getNamedGroup(qt.CombatMods);if(!t)return;let n=t?.getAllRefs().find(o=>o.getModValue("defending"));n&&t?.removeModsRef(n)}getStats(){return this.unitStats$.getValue()}attachSpecialtyMods(t){this.getSpecialtyAndConditionalModsGroup().addModsRef(ft.fromMods(t))}clearSpecialtyAndConditionalMods(){this.getSpecialtyAndConditionalModsGroup().clearOwnModRefs()}clearCombatMods(){this.modGroup.getNamedGroup(qt.CombatMods).clearOwnModRefs()}addCombatMods(t){this.modGroup.getNamedGroup(qt.CombatMods).addModsRef(ft.fromMods(t))}removeCombatMods(t){this.modGroup.getNamedGroup(qt.CombatMods).removeRefByModInstance(t)}addSpellMods(t){this.modGroup.getNamedGroup(qt.SpellMods).addModsRef(ft.fromMods(t))}removeSpellMods(t){this.modGroup.getNamedGroup(qt.SpellMods).removeRefByModInstance(t)}recalcHealthBasedStats(){let t=this.unitStats$.getValue(),n=this.type.baseStats,o=this._count;t.totalHealth=n.health*(o-1)+(this.tailUnitHp??0),t.totalMinDamage=o*n.damageInfo.minDamage,t.totalMaxDamage=o*n.damageInfo.maxDamage,t.avgTotalDamage=(t.totalMinDamage+t.totalMaxDamage)/2,this.unitStats$.next(t)}getSpecialtyAndConditionalModsGroup(){return this.modGroup.getNamedGroup(qt.SpecialtyAndConditionalMods)}setupStatsUpdating(){this.modGroup.onValueChanges().pipe(Xe(this.destroyed$)).subscribe(t=>{let n=this.type.baseStats,o=this.ownerPlayer?.hero.base.initialState.stats,s=n.attackRating,p=(t.heroBonusAttack||0)+(o?.baseAttack||0),m=n.defence,v=(t.heroBonusDefence||0)+(o?.baseDefence||0),S=n.speed,E=t.unitGroupSpeedBonus||0;E<0&&t.cannotBeSlowed&&(E=0),t.fixedSpeed&&(E=0,S=t.fixedSpeed||5);let L=t.resistAll||0,le=this.unitStats$.getValue(),he={baseAttack:s,bonusAttack:p,finalAttack:s+p,defends:t.defending,baseDefence:m,bonusDefence:v,finalDefence:m+v,baseSpeed:S,speedBonus:E,finalSpeed:S+E,fireResist:(t.resistFire||0)+L,coldResist:(t.resistCold||0)+L,lightningResist:(t.resistLightning||0)+L,poisonResist:(t.resistPoison||0)+L,totalHealth:le.totalHealth,totalMinDamage:le.totalMinDamage,totalMaxDamage:le.totalMaxDamage,avgTotalDamage:le.avgTotalDamage,position:le.position};this.unitStats$.next(he)})}};e.categoryId="unit-group";let i=e;return i})();var qc=":";function oa(i,e){return`${i}${qc}${e}`}function Ah(i){return i.split(qc)}var xe=(()=>{let e=class e{constructor(t){this.events=t,this.internalRegistries=new Map,this.allObjects=new Map,this.objectsCustomData=new Map,window.gameObjects=this}createNewGameObject(t,n,o){let s=t.categoryId,p=this.getOrCreateCategoryRegistry(s),m;if(o){let S=oa(s,o);if(this.allObjects.has(S))throw console.error(`Game object with id '${S}' already exists! New params/old object:`,n,this.allObjects.get(S)),new Error(`Game object with id '${S}' already exists!`);m=S}else m=oa(s,p.latestId++);let v=new t(m);return this.events.dispatch(ko({gameObject:v})),v.create(n),p.objects.add(v),this.allObjects.set(m,v),an.logGameObjects&&console.log(v),v}getObjectById(t,n){return this.getObjectByFullId(oa(t.categoryId,n))}getObjectByFullId(t){if(Ah(t).length!==2)throw new Error(`Getting object by id '${t}' failed, id doesn't follow format 'CategoryId${qc}ObjectId'`);let o=this.allObjects.get(t);if(!o)throw new Error(`Failed to get object by '${t}' id: Object doens't exist`);return o}destroyObject(t){let o=Object.getPrototypeOf(t).categoryId;this.internalRegistries.get(o)?.objects.delete(t),t.onDestroy(),this.objectsCustomData.delete(t.id),this.allObjects.delete(t.id)}getObjectId(t,n){let o=n.split(":");return o.length===2&&o[0]===t.categoryId?n:oa(t.categoryId,n)}addCustomData(t,n){let o=typeof t=="object"?t.id:t,s=this.objectsCustomData.get(o);this.objectsCustomData.set(o,D(D({},s),n))}getCustomData(t){let n=this.objectsCustomData.get(typeof t=="string"?t:t.id);return console.log("Getting custom data:",n),n}getOrCreateCategoryRegistry(t){let n=this.internalRegistries.get(t);return n||(this.initializeRegistryForCategory(t),this.internalRegistries.get(t))}initializeRegistryForCategory(t){this.internalRegistries.set(t,{latestId:0,objects:new Set})}};e.\u0275fac=function(n){return new(n||e)(x(j))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var wn=(()=>{let e=class e{constructor(t){this.gameObjectManager=t}createSpellInstance(t,n={}){let o=n.initialLevel??1,s=t.icon;return s.bgClr||(s.bgClr=It.DefaultItemIconBg),s.iconClr||(s.iconClr=It.DefaultItemIconClr),this.gameObjectManager.createNewGameObject(Gs,{spellBaseType:t,initialLevel:o,state:n.state})}createModifiers(t){return t}canSpellBeCastOnUnit(t,n,o){let p=t.baseType.config.spellConfig.targetCastConfig?.canActivate;return p?p({unitGroup:n,isEnemy:o}):!0}};e.\u0275fac=function(n){return new(n||e)(x(xe))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Fe=(()=>{let e=class e{constructor(t,n,o){this.spells=t,this.gameObjectsManager=n,this.events=o}createUnitGroup(t,n,o){return this.gameObjectsManager.createNewGameObject(ra,{count:n.count,ownerHero:o,unitBase:Vt(t)})}createUnitGroupFromGenModel(t){return kc.createRandomArmy(t).map(n=>this.createUnitGroup(n.unitType,{count:n.count}))}createUnitGroupFromGenModelForPlayer(t,n){return kc.createRandomArmy(t).map(o=>this.createUnitGroup(o.unitType,{count:o.count},n))}addModifierToUnitGroup(t,n){this.events.dispatch(ho({mods:n,unit:t}))}removeModifiers(t,n){this.events.dispatch(go({mods:n,unit:t}))}clearUnitModifiers(t){t.clearCombatMods()}getUnitGroupSpeed(t){return t.getStats().finalSpeed}healUnit(t,n){let o=t.type.baseStats.health,s=Math.floor(n/o),p=s*o,m=n-p,v=t.fightInfo.initialCount,S=t.count,E=v-S,L=t.tailUnitHp||o,le=o-L,he=E*o+le;if(he===0||n<=0)return{revivedUnitsCount:0,totalHealedHp:0};if(t.fightInfo.isAlive=!0,n>he)return t.setTailUnitHp(o),t.setUnitsCount(v),{revivedUnitsCount:E,totalHealedHp:he};let $e=s;return m>le?($e+=1,t.setTailUnitHp(L+m-o)):t.tailUnitHp===0&&m===0&&$e>0?t.setTailUnitHp(o):t.addTailUnitHp(m),t.addUnitsCount($e),{revivedUnitsCount:$e,totalHealedHp:n}}};e.\u0275fac=function(n){return new(n||e)(x(wn),x(xe),x(j))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var vt=(()=>{let e=class e{constructor(t,n){this.units=t,this.events=n,this.battleEvent$=new Pt(void 0),this.heroesUnitGroupsMap=new Map,this.currentGroupTurnsLeft=0,this.round=1,this.playerLosses={},this.playersRivalryMap=new Map,this.currentUnitGroup$=new Pt(null)}resetCurrentPlayer(){this.currentPlayer=null}initBattleState(t,n){this.initialUnitGroups=t,this.players=n,this.playersRivalryMap.set(n[0],n[1]),this.playersRivalryMap.set(n[1],n[0]),this.initPlayerLossesMap(),this.initPlayerUnitGroupsMap(t),this.resetFightQueue(),this.updateGroupsTailHpAndCombatInfo(),this.refreshUnitGroups()}initNextTurnByQueue(t=!1){if(t&&this.currentUnitGroup.count&&this.fightQueue.shift(),!this.fightQueue.length){this.getAllUnits().forEach(s=>{s.modGroup.getModValue("defending")&&s.removeDefendingMod()}),this.resetFightQueue(),this.resetGroupsTurnsLeft(),this.round++,this.events.dispatch(Lt({round:this.round}));return}let n=this.fightQueue[0],o=this.currentPlayer;this.currentPlayer=n.ownerPlayer,this.currentUnitGroup=n,this.currentUnitGroup$.next(n),this.currentUnitGroup.modGroup.getModValue("defending")?this.currentGroupTurnsLeft=this.currentUnitGroup.turnsLeft:this.currentGroupTurnsLeft=this.currentUnitGroup.turnsLeft||1,this.currentPlayer!==o?this.events.dispatch(ji({currentPlayer:this.currentPlayer,previousPlayer:o})):this.events.dispatch(fo())}getFightQueue(){return this.fightQueue}handleDefeatedUnitGroup(t){let n=t.ownerPlayer,o=this.heroesUnitGroupsMap.get(n),s=o?.indexOf(t);t.fightInfo.isAlive=!1,this.heroesUnitGroupsMap.set(n,o);let p=this.fightQueue.indexOf(t);p!==-1&&this.fightQueue.splice(p,1)}getEnemyOfPlayer(t){return this.playersRivalryMap.get(t)}processAiPlayer(){setTimeout(()=>{let t=this.getAliveUnitsOfPlayer(this.getEnemyOfPlayer(this.currentPlayer)),n=Math.round(Math.random()*(t.length-1)),o=t[n];this.events.dispatch(Ni({attackedGroup:o,attackingGroup:this.currentUnitGroup}))},1e3)}getUnitGroupTotalDamage(t){return t.count*t.type.baseStats.damageInfo.maxDamage}resortFightQueue(t=!1){if(t){this.fightQueue=this.getUnitsSortedBySpeed(this.fightQueue);return}this.fightQueue=[this.fightQueue[0],...this.getUnitsSortedBySpeed(this.fightQueue.slice(1))]}removeUnitsWithoutTurnsFromFightQueue(){this.fightQueue=this.fightQueue.filter(t=>t.turnsLeft)}getAliveUnitsOfPlayer(t){return this.heroesUnitGroupsMap.get(t).filter(n=>n.fightInfo.isAlive)}getDeadUnitsOfPlayer(t){return this.heroesUnitGroupsMap.get(t).filter(n=>!n.fightInfo.isAlive)}getSummonsOfPlayer(t){return this.heroesUnitGroupsMap.get(t).filter(n=>n.modGroup.getModValue("isSummon"))}playerHasAnyAliveUnits(t){return this.getAliveUnitsOfPlayer(t).length!==0}summonUnitForPlayer(t,n,o){let s=this.units.createUnitGroup(n,{count:o},t.hero),p=this.heroesUnitGroupsMap.get(t),m=p.length;return p.push(s),s.setPosition(m),this.units.addModifierToUnitGroup(s,{isSummon:!0}),this.resortFigthQueueWithNewUnits(),s}registerPlayerUnitLoss(t,n){let o=this.playerLosses[t.ownerPlayer.id],s=t.type,p=o.get(s);if(p){let m=p+n;m>0?o.set(s,m):o.delete(s)}else o.set(s,n)}initPlayerLossesMap(){this.players.forEach(t=>{this.playerLosses[t.id]=new Map})}resetGroupsTurnsLeft(){this.fightQueue.forEach(t=>t.turnsLeft=t.type.defaultTurnsPerRound||1)}getUnitsSortedBySpeed(t){return[...t].sort((n,o)=>this.units.getUnitGroupSpeed(o)-this.units.getUnitGroupSpeed(n))}resetFightQueue(){this.fightQueue=this.getUnitsSortedBySpeed([...this.getAliveUnitsOfPlayer(this.players[0]),...this.getAliveUnitsOfPlayer(this.players[1])])}getAllUnits(){return[...this.getAliveUnitsOfPlayer(this.players[0]),...this.getAliveUnitsOfPlayer(this.players[1])]}initPlayerUnitGroupsMap(t){this.heroesUnitGroupsMap.clear(),t.forEach(n=>{let o=n.ownerPlayer,s=this.heroesUnitGroupsMap.get(o);s?s.push(n):this.heroesUnitGroupsMap.set(o,[n])}),this.heroesUnitGroupsMap.forEach(n=>{n.forEach((o,s)=>{o.setPosition(s)})})}updateGroupsTailHpAndCombatInfo(){this.players.forEach(t=>{t.hero.unitGroups.forEach(n=>{n.tailUnitHp||n.setTailUnitHp(n.type.baseStats.health),n.fightInfo.initialCount=n.count})})}refreshUnitGroups(){this.players.forEach(t=>{t.hero.unitGroups.forEach(n=>{n.turnsLeft=n.type.defaultTurnsPerRound||1})})}resortFigthQueueWithNewUnits(){this.fightQueue=[this.fightQueue[0],...this.getUnitsSortedBySpeed(this.getAllAliveUnitsWithTurnsExcept(this.fightQueue[0]))]}getAllAliveUnitsWithTurnsExcept(t){return this.getAllAliveUnitsExcept(this.fightQueue[0]).filter(n=>n.turnsLeft)}getAllAliveUnitsExcept(t){return[...this.heroesUnitGroupsMap.values()].flat().filter(n=>n.fightInfo.isAlive&&n!==t)}};e.\u0275fac=function(n){return new(n||e)(x(Fe),x(j))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Br=(()=>{let e=class e{constructor(){this.mapping=new Map}register(t,n){this.mapping.set(t,n)}unregister(t){this.mapping.delete(t)}get(t){return this.mapping.get(t)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Qc={[Ce.Cold]:"coldResist",[Ce.Fire]:"fireResist",[Ce.Lightning]:"lightningResist",[Ce.Poison]:"poisonResist"},Kc=60;var Sn=(()=>{let e=class e{constructor(){this.hintMessage$=new Pt(null),this.disableActionHint$=new Pt(!1)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var nr=class{constructor(){this.triggerMapsByRefsMap=new Map}registerHandlerByRef(e,r,t){let n=this.triggerMapsByRefsMap.get(e);if(n){let o=n.get(r);o?o.push(t):n.set(r,[t])}else this.triggerMapsByRefsMap.set(e,new Map([[r,[t]]]))}triggerAllHandlersByEvent(e){this.triggerMapsByRefsMap.forEach(r=>{r.forEach((t,n)=>t.forEach(o=>{n===e.__eventType.__type&&o(e)}))})}triggerRefEventHandlers(e,r){let t=this.triggerMapsByRefsMap.get(e);t&&t.forEach((n,o)=>{n.forEach(s=>{o===r.__eventType.__type&&s(r)})})}removeAllHandlersForRef(e){this.triggerMapsByRefsMap.delete(e)}removeAllHandlers(){this.triggerMapsByRefsMap.clear()}};var X=(()=>{let e=class e{constructor(){this.currentGame={day:1,globalDay:1,week:1,actionPoints:4},this.settings={orientation:rn.Vertical,mapDebug:!0},this.mainMenu={},this.mapCamera={cameraInitialized:!1,x:0,y:0},this.eventHandlers={spells:new nr,items:new nr,buildings:new nr,structures:new nr},this.unitsAppliedModifiers=new Map}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var ue=(()=>{let e=class e{constructor(){}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-ra-icon"]],inputs:{icon:"icon"},decls:1,vars:2,consts:[[1,"ra"]],template:function(n,o){n&1&&h(0,"i",0),n&2&&nn("ra-"+o.icon)}});let i=e;return i})();var Gt=(()=>{let e=class e{constructor(t){this.domSanitizer=t}transform(t){return this.domSanitizer.bypassSecurityTrustHtml(t)}};e.\u0275fac=function(n){return new(n||e)(y(oc,16))},e.\u0275pipe=Ui({name:"safeHtml",type:e,pure:!0});let i=e;return i})();var Xo=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-action-card"]],inputs:{actionCard:"actionCard"},decls:7,vars:11,consts:[[1,"icon"],[3,"icon"],[1,"content"],[1,"title"],[1,"description",3,"innerHtml"]],template:function(n,o){n&1&&(a(0,"div",0),h(1,"mw-ra-icon",1),c(),a(2,"div",2)(3,"div",3),d(4),c(),h(5,"div",4),ie(6,"safeHtml"),c()),n&2&&(l(),$("color",o.actionCard.iconColor)("background",o.actionCard.bgColor)("border-color",o.actionCard.borderColor),u("icon",o.actionCard.icon),l(3),M(" ",o.actionCard.title," "),l(),u("innerHtml",ne(6,9,o.actionCard.description),Bt))},dependencies:[ue,Gt],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center;cursor:pointer}.icon[_ngcontent-%COMP%]{width:84px;height:84px;position:relative;bottom:-14px;display:flex}.icon[_ngcontent-%COMP%]   mw-ra-icon[_ngcontent-%COMP%]{width:74px;height:74px;display:flex;background-color:gray;font-size:74px;border-radius:50%;border:4px solid rgb(82,82,82);color:#fff;margin:auto}.content[_ngcontent-%COMP%]{border:3px solid gray;border-radius:5px;padding:14px 8px 8px;display:flex;flex-direction:column;align-items:center;color:#fff;width:135px;min-height:74px;text-align:center;background-color:#636363;-webkit-user-select:none;user-select:none}.content[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:20px;margin-bottom:6px;padding-bottom:4px;border-bottom:2px solid #8d8d8d;width:100%}.content[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:13px}"]});let i=e;return i})();var ca=new bi("Popup Reference");var te=class{constructor(){this.popup=H(ca),this.data=this.popup.data}close(){this.popup.close()}};var Lr=(()=>{let e=class e{constructor(){this.keyPress$=Dt(document,"keyup"),this.escape$=this.keyPress$.pipe(In(t=>t.key==="Escape"))}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var oi=(()=>{let e=class e{constructor(){this.popups=[],H(Lr).escape$.subscribe(t=>{if(!this.popups.length)return;let n=this.popups[this.popups.length-1];(n.isCloseable||n.escape)&&this.removePopup(n)})}createPopup(t){this.popups.push(t)}createBasicPopup(t){this.createPopup(t)}removePopup(t){q.removeItem(this.popups,t)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();function Gh(i,e){i&1&&ke(0)}function Rh(i,e){i&1&&h(0,"div",2)}var la=(()=>{let e=class e{constructor(t,n,o){this.popups=t,this.hostElemRef=n,this.renderer=o,this.isInactive=!1}ngOnInit(){this.popupData.class&&this.renderer.addClass(this.hostElemRef.nativeElement,this.popupData.class),this.injector=vs.create({providers:[{provide:ca,useValue:{data:this.popupData.data,close:()=>{this.popups.removePopup(this.popupData)}}}]})}preventClick(t){t.stopPropagation()}};e.\u0275fac=function(n){return new(n||e)(y(oi),y(mt),y(Le))},e.\u0275cmp=C({type:e,selectors:[["mw-popup-wrapper"]],hostBindings:function(n,o){n&1&&w("click",function(p){return o.preventClick(p)})},inputs:{popupData:"popupData",isInactive:"isInactive"},decls:2,vars:3,consts:[[4,"ngComponentOutlet","ngComponentOutletInjector"],["class","inactive-overlay",4,"ngIf"],[1,"inactive-overlay"]],template:function(n,o){n&1&&g(0,Gh,1,0,"ng-container",0)(1,Rh,1,0,"div",1),n&2&&(u("ngComponentOutlet",o.popupData.component)("ngComponentOutletInjector",o.injector),l(),u("ngIf",o.isInactive))},dependencies:[Lp,re],styles:[".inactive-overlay[_ngcontent-%COMP%]{width:100%;height:100%;position:absolute;left:0;top:0;background-color:#48484846}.small-padding[_nghost-%COMP%]{padding:12px}.transparent[_nghost-%COMP%]{background:transparent;width:100%;pointer-events:none;padding:0}"]});let i=e;return i})();var Ti=(()=>{let e=class e{constructor(){this.mwNoContextMenu=new Ct}preventContextMenu(t){return t.stopPropagation(),t.preventDefault(),this.mwNoContextMenu.emit(),!1}};e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=Re({type:e,selectors:[["","mwNoContextMenu",""],["","mwUnitGroupCombatAction",""]],hostBindings:function(n,o){n&1&&w("contextmenu",function(p){return o.preventContextMenu(p)})},outputs:{mwNoContextMenu:"mwNoContextMenu"}});let i=e;return i})();function Bh(i,e){i&1&&h(0,"div",2)}function Hh(i,e){if(i&1&&h(0,"mw-popup-wrapper",5),i&2){let r=e.$implicit,t=e.last;u("ngClass",r.class)("popupData",r)("isInactive",!t)}}function Lh(i,e){if(i&1){let r=R();a(0,"div",3),w("click",function(n){A(r);let o=f();return O(o.handleOverlayClick(n))}),g(1,Hh,1,3,"mw-popup-wrapper",4),c()}if(i&2){let r=f();l(),u("ngForOf",r.popupsService.popups)}}var pa=(()=>{let e=class e{constructor(t){this.popupsService=t}handleOverlayClick(t){t.preventDefault();let n=this.popupsService.popups,o=Mp(n);o.isCloseable&&this.popupsService.removePopup(o)}};e.\u0275fac=function(n){return new(n||e)(y(oi))},e.\u0275cmp=C({type:e,selectors:[["mw-popup-container"]],decls:2,vars:2,consts:[["class","overlay",4,"ngIf"],["mwNoContextMenu","","class","popups-container",3,"click",4,"ngIf"],[1,"overlay"],["mwNoContextMenu","",1,"popups-container",3,"click"],["class","popup",3,"ngClass","popupData","isInactive",4,"ngFor","ngForOf"],[1,"popup",3,"ngClass","popupData","isInactive"]],template:function(n,o){n&1&&g(0,Bh,1,0,"div",0)(1,Lh,2,1,"div",1),n&2&&(u("ngIf",o.popupsService.popups.length),l(),u("ngIf",o.popupsService.popups.length))},dependencies:[fi,z,re,Ti,la],styles:["@keyframes _ngcontent-%COMP%_overlay-appear{0%{background-color:#0000000d}to{background-color:#000000a7}}.popups-container[_ngcontent-%COMP%]{left:0;z-index:9200;top:0;position:fixed;height:100%;width:100%}.overlay[_ngcontent-%COMP%]{left:0;top:0;z-index:4000;position:fixed;height:100%;width:100%;background-color:#0000;animation:_ngcontent-%COMP%_overlay-appear 1s;animation-fill-mode:forwards}.popup[_ngcontent-%COMP%]{position:absolute;display:block;min-width:400px;left:50%;z-index:9500;top:50%;transform:translate(-50%,-50%);background-color:#fff}.dark[_ngcontent-%COMP%]{background-color:#484852}"]});let i=e;return i})();function jh(i,e){if(i&1){let r=R();a(0,"div",6)(1,"mw-action-card",7),w("click",function(){let n=A(r).$implicit,o=f();return O(o.handleCardClick(n))}),c(),a(2,"div",8),d(3),ie(4,"infNum"),c()()}if(i&2){let r=e.$implicit;l(),u("actionCard",r.card)("mwActionHint","Use "+r.card.title),l(2),M("Left: ",ne(4,3,r.count),"")}}var Jo=(()=>{let e=class e extends te{constructor(){super(...arguments),this.state=H(X),this.playersService=H(k),this.events=H(j),this.cards=this.playersService.getCurrentPlayer().actionCards,this.actionPointsLeft=this.state.currentGame.actionPoints}handleCardClick(t){this.events.dispatch(Yn({player:this.playersService.getCurrentPlayer(),cardStack:t})),this.close()}};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=dt(e)))(o||e)}})(),e.\u0275cmp=C({type:e,selectors:[["mw-action-cards-popup"]],features:[N],decls:11,vars:2,consts:[[1,"header"],[1,"action-points"],[1,"points"],["icon","feather-wing"],[1,"cards"],["class","card-stack",4,"ngFor","ngForOf"],[1,"card-stack"],[3,"click","actionCard","mwActionHint"],[1,"cards-left"]],template:function(n,o){n&1&&(a(0,"div",0),d(1," Available action cards "),a(2,"div",1),d(3," Remaining action points for this day: "),h(4,"br"),a(5,"span",2),h(6,"mw-ra-icon",3),d(7),c()(),h(8,"hr"),c(),a(9,"div",4),g(10,jh,5,5,"div",5),c()),n&2&&(l(7),M(" ",o.actionPointsLeft," "),l(3),u("ngForOf",o.cards))},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center;background-color:#0000009c;padding:40px 0}.header[_ngcontent-%COMP%]{color:#fff;text-align:center;font-size:24px}.header[_ngcontent-%COMP%]   .action-points[_ngcontent-%COMP%]{font-size:16px;font-weight:100;line-height:32px}.header[_ngcontent-%COMP%]   .action-points[_ngcontent-%COMP%]   .points[_ngcontent-%COMP%]{font-size:32px}.cards[_ngcontent-%COMP%]{display:flex;pointer-events:all;gap:14px;padding-top:15px}.card-stack[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;padding:0 16px 8px;border-radius:6px;background-color:#fff0;transform:translateY(0);transition:.2s}.card-stack[_ngcontent-%COMP%]:hover{background-color:#ffffff31;transform:translateY(-20px)}.cards-left[_ngcontent-%COMP%]{color:#fff;text-align:center;font-size:15px;padding-top:4px}"]});let i=e;return i})();var ua=(()=>{let e=class e{constructor(){}registerCursorComponent(t){this.cursorComponent=t}setCustomCursor(t,n,o){this.cursorComponent.showCustomCursor=!0,this.updateCursorComponent(),this.cursorComponent.customCursorRef.clearAnimation(),this.cursorComponent.customCursorRef.playAnimation(t,n,o)}setCustomCursorPos(t,n){this.cursorComponent.customCursorPos.x=t,this.cursorComponent.customCursorPos.y=n,this.updateCursorComponent()}clearCustomCursor(){this.updateCursorComponent(),this.cursorComponent.customCursorRef&&(this.cursorComponent.customCursorRef.clearAnimation(),this.cursorComponent.showCustomCursor=!1)}updateCursorComponent(){this.cursorComponent.cdr.detectChanges()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Vh=["customCursorRef"];function zh(i,e){if(i&1&&h(0,"mw-vfx-element",2,0),i&2){let r=f();$("top",r.customCursorPos.y-5,"px")("left",r.customCursorPos.x-2,"px")}}var es=(()=>{let e=class e{constructor(t,n){this.cursor=t,this.cdr=n,this.showCustomCursor=!1,this.customCursorPos={x:0,y:0},this.cursor.registerCursorComponent(this)}};e.\u0275fac=function(n){return new(n||e)(y(ua),y(di))},e.\u0275cmp=C({type:e,selectors:[["mw-custom-cursor"]],viewQuery:function(n,o){if(n&1&&Pe(Vh,5),n&2){let s;De(s=Ee())&&(o.customCursorRef=s.first)}},decls:1,vars:1,consts:[["customCursorRef",""],["class","custom-cursor",3,"top","left",4,"ngIf"],[1,"custom-cursor"]],template:function(n,o){n&1&&g(0,zh,2,4,"mw-vfx-element",1),n&2&&u("ngIf",o.showCustomCursor)},styles:["[_nghost-%COMP%]{position:fixed;left:0;top:0;width:0;height:0}.custom-cursor[_ngcontent-%COMP%]{pointer-events:none;position:absolute;z-index:100000;font-size:24px;color:#fff;transform:scaleX(-1)}"]});let i=e;return i})();var qh=i=>({$implicit:i});function Yh(i,e){i&1&&ke(0)}function Qh(i,e){if(i&1&&(ye(0),g(1,Yh,1,0,"ng-container",2),ve()),i&2){let r=e.$implicit;f();let t=se(2);l(),u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,qh,r))}}function Kh(i,e){if(i&1&&(h(0,"div",3),ie(1,"safeHtml")),i&2){let r=e.$implicit;u("innerHTML",ne(1,1,r.htmlContent),Bt)}}var Zh=i=>i.map(e=>typeof e=="string"?{htmlContent:e}:e),Kt=(()=>{let e=class e{constructor(){this.descriptions=ee.required({transform:Zh})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-description"]],inputs:{descriptions:[1,"descriptions"]},decls:3,vars:1,consts:[["freeHtml",""],[4,"ngFor","ngForOf"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"innerHTML"]],template:function(n,o){n&1&&g(0,Qh,2,4,"ng-container",1)(1,Kh,2,3,"ng-template",null,0,Y),n&2&&u("ngForOf",o.descriptions())},dependencies:[z,At,Gt],styles:[`mw-description>.spell-descr{font-size:13px}mw-description .spell-stats{padding:7px 3px 3px;font-size:12px;line-height:18px;color:#434040}mw-description .spell-stats>.stat>.value{font-weight:600}mw-description .item-mods{padding:0 5px 5px}mw-description .item-mods>.item-mod{font-size:12px}
`],encapsulation:2,changeDetection:0});let i=e;return i})();function Xh(i,e){if(i&1&&(ye(0,1),h(1,"div",2),ie(2,"safeHtml"),ve()),i&2){let r=e.$implicit;u("ngSwitch",r.type),l(),u("innerHTML",ne(2,2,r.htmlContent),Bt)}}var Qd=2e3,Jc=(()=>{let e=class e{constructor(t,n){this.elementRef=t,this.renderer=n,this.messageExpired=new Ct,this.type=mi}ngOnInit(){setTimeout(()=>{this.renderer.addClass(this.elementRef.nativeElement,"visible")},0),setTimeout(()=>{this.renderer.addClass(this.elementRef.nativeElement,"hidden")},(this.message.delay||Qd)-400),setTimeout(()=>{this.messageExpired.emit()},this.message.delay||Qd)}};e.\u0275fac=function(n){return new(n||e)(y(mt),y(Le))},e.\u0275cmp=C({type:e,selectors:[["mw-event-feed-message"]],inputs:{message:"message"},outputs:{messageExpired:"messageExpired"},decls:1,vars:1,consts:[[3,"ngSwitch",4,"ngFor","ngForOf"],[3,"ngSwitch"],[3,"innerHTML"]],template:function(n,o){n&1&&g(0,Xh,3,4,"ng-container",0),n&2&&u("ngForOf",o.message.message)},dependencies:[z,hi,Gt],styles:["[_nghost-%COMP%]{background:#414141;display:inline-block;color:#fff;font-size:13px;border-radius:4px;display:block;padding:3px 10px 3px 5px;overflow:hidden;height:0;opacity:0;position:relative;translate:50% -20px;transition:.4s;text-align:center}.visible[_nghost-%COMP%]{height:100%;translate:50% 0px;opacity:1}.hidden[_nghost-%COMP%]{height:0;opacity:0}"]});let i=e;return i})();var Xi=(()=>{let e=class e{constructor(){this.visibleMessages=[],this.allMessages=[]}pushEventFeedMessage(t){this.allMessages.push(t),this.visibleMessages.push(t)}pushPlainMessage(t){let n={message:[{htmlContent:t,type:mi.FreeHtml}],delay:2600};this.pushEventFeedMessage(n)}pushSystemError(t){let n={message:[{htmlContent:`<div style="background: red; font-size: 15px; font-weight: 500">${t}</div>`,type:mi.FreeHtml}],delay:5e3};this.pushEventFeedMessage(n)}removeMessage(t){q.removeItem(this.visibleMessages,t)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();function Jh(i,e){if(i&1){let r=R();a(0,"mw-event-feed-message",1),w("messageExpired",function(){let n=A(r).$implicit,o=f();return O(o.removeMessage(n))}),c()}if(i&2){let r=e.$implicit;u("message",r)}}var ts=(()=>{let e=class e{constructor(t){this.eventFeed=t}removeMessage(t){this.eventFeed.removeMessage(t)}};e.\u0275fac=function(n){return new(n||e)(y(Xi))},e.\u0275cmp=C({type:e,selectors:[["mw-event-feed"]],decls:1,vars:1,consts:[[3,"message","messageExpired",4,"ngFor","ngForOf"],[3,"messageExpired","message"]],template:function(n,o){n&1&&g(0,Jh,1,1,"mw-event-feed-message",0),n&2&&u("ngForOf",o.eventFeed.visibleMessages)},styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;pointer-events:none;-webkit-user-select:none;user-select:none}mw-event-feed-message[_ngcontent-%COMP%]{margin-bottom:3px}"]});let i=e;return i})();var tg=["mw-main-button",""],ig=["*"],oe=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["button","mw-main-button",""]],attrs:tg,ngContentSelectors:ig,decls:1,vars:0,template:function(n,o){n&1&&(ti(),Et(0))},styles:["[_nghost-%COMP%]{display:block;max-width:100%;padding:10px;background:#6478bb;color:#fff;text-align:center;margin:4px;cursor:pointer;-webkit-user-select:none;user-select:none;border:none;font-family:segoe ui;font-size:15px}[_nghost-%COMP%]:hover{background:#5a6793}[_nghost-%COMP%]:active{background:#4f5a7e}[_nghost-%COMP%]:disabled{background:#939ec4;color:#cfcfcf}"]});let i=e;return i})();var ng=[[["","popupHeader",""]],[["","popupContent",""]],"*"],rg=["[popupHeader]","[popupContent]","*"],ce=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-popup-base-content"]],ngContentSelectors:rg,decls:3,vars:0,template:function(n,o){n&1&&(ti(ng),Et(0),Et(1,1),Et(2,2,["ngProjectAs","[popupButtons]",5,["","popupButtons",""]]))},styles:[`mw-popup-base-content{display:block;padding:16px}mw-popup-base-content [popupHeader]{text-align:center;margin-bottom:4px}mw-popup-base-content [popupContent]{text-align:center}mw-popup-base-content [popupContent] .sub-info p{margin:0;font-size:12px}mw-popup-base-content [popupButtons]{display:flex;justify-content:center;gap:4px;margin-top:4px}
`],encapsulation:2});let i=e;return i})();var ma=(()=>{let e=class e extends te{constructor(){super()}goToMainScreen(){location.reload()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-game-over-popup"]],features:[N],decls:8,vars:0,consts:[["popupHeader",""],["popupContent",""],["popupButtons",""],["mw-main-button","",2,"margin","auto",3,"click"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2,"Game Over"),c(),a(3,"div",1),d(4,"Go to main menu?"),c(),a(5,"div",2)(6,"button",3),w("click",function(){return o.goToMainScreen()}),d(7,"Accept"),c()()())},dependencies:[oe,ce],styles:["[_nghost-%COMP%]{text-align:center}"]});let i=e;return i})();function og(i,e){i&1&&ke(0)}function sg(i,e){if(i&1&&(a(0,"div",1),g(1,og,1,0,"ng-container",2),c()),i&2){let r=e.$implicit;pp(r.style),$("top",r.offsetTop,"px")("right",r.offsetRight,"px")("left",r.offsetLeft,"px")("bottom",r.offsetBottom,"px"),l(),u("ngTemplateOutlet",r.template)}}var fa=(()=>{let e=class e{constructor(){this.hints=[]}createHint(t,n,o){let s=t.nativeElement,{left:p,top:m,bottom:v}=s.getBoundingClientRect(),S=null,E=m+s.clientHeight/2,L=null,le="transform: translateY(-50%)",he=null;switch(o){case"after":S=p+s.clientWidth;break;case"before":L=window.innerWidth-p;break;case"above":E=null,le="transform: translateX(-50%)",he=window.innerHeight-v+s.clientHeight,S=p+s.clientWidth/2;break;case"below":E=v,le="transform: translateX(-50%)",S=p+s.clientWidth/2}let $e={targetElement:t,template:n,offsetLeft:S,offsetBottom:he,offsetTop:E,offsetRight:L,style:le};return this.hints.push($e),$e}removeHint(t){let n=this.hints.indexOf(t);this.hints.splice(n,1)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-hints-container"]],decls:1,vars:1,consts:[["class","hint",3,"top","right","left","bottom","style",4,"ngFor","ngForOf"],[1,"hint"],[4,"ngTemplateOutlet"]],template:function(n,o){n&1&&g(0,sg,2,11,"div",0),n&2&&u("ngForOf",o.hints)},dependencies:[z,At],styles:[".container[_ngcontent-%COMP%]{width:0}.hint[_ngcontent-%COMP%]{position:absolute;z-index:10000}"]});let i=e;return i})();var Nr=(()=>{let e=class e{constructor(){this.activeMenusCount=0,this.activeMenus=new Set,this.clickOutsideMenu$=Dt(window,"click").pipe(In(()=>this.activeMenusCount>0)),this.clickOutsideMenu$.subscribe(t=>{let n=t.target,o=n.closest(".menu-hint"),s=n.closest("mw-menu");!o&&!s&&this.closeAllActiveMenus(),s||this.closeClosableMenus()})}closeAllActiveMenus(){this.activeMenus.forEach(t=>this.containerRef.removeHint(t.currentHintRef)),this.activeMenus.clear()}closeClosableMenus(){this.activeMenus.forEach(t=>{t.closeOnClick&&this.containerRef.removeHint(t.currentHintRef),this.activeMenus.delete(t)})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var cg=["elem"],lg=["generalHint"],pg=["*"];function ug(i,e){i&1&&ke(0)}function dg(i,e){if(i&1&&(a(0,"div",3),g(1,ug,1,0,"ng-container",4),c()),i&2){let r=f();$("transition",r.transition,"s"),u("ngClass",r.showHintAnimation?"show-hint":"hide-hint"),l(),u("ngTemplateOutlet",r.hintBody)}}var rr=(()=>{let e=class e{constructor(t){this.hintsService=t,this.transition=.15,this.hintPos="after",this.showHintAnimation=!1,this.showTimeoutId=null,this.currentHintRef=null}ngOnDestroy(){this.onMouseLeave()}onMouseEnter(){this.currentHintRef=this.hintsService.containerRef.createHint(this.elem,this.generalHint,this.hintPos),this.showTimeoutId=window.setTimeout(()=>{this.clearShowTimeout(),this.showHintAnimation=!0},0)}onMouseLeave(){this.clearShowTimeout(),this.showHintAnimation=!1;let t=this.currentHintRef;this.currentHintRef=null,window.setTimeout(()=>{this.hintsService.containerRef.removeHint(t)},this.transition*1e3)}clearShowTimeout(){this.showTimeoutId&&window.clearTimeout(this.showTimeoutId),this.showTimeoutId=null}};e.\u0275fac=function(n){return new(n||e)(y(Nr))},e.\u0275cmp=C({type:e,selectors:[["mw-hover-hint"]],viewQuery:function(n,o){if(n&1&&(Pe(cg,7),Pe(lg,7)),n&2){let s;De(s=Ee())&&(o.elem=s.first),De(s=Ee())&&(o.generalHint=s.first)}},inputs:{hintBody:"hintBody",transition:"transition",hintPos:"hintPos"},ngContentSelectors:pg,decls:5,vars:0,consts:[["elem",""],["generalHint",""],[3,"mouseenter","mouseleave"],[1,"hint",3,"ngClass"],[4,"ngTemplateOutlet"]],template:function(n,o){if(n&1){let s=R();ti(),a(0,"div",2,0),w("mouseenter",function(){return A(s),O(o.onMouseEnter())})("mouseleave",function(){return A(s),O(o.onMouseLeave())}),Et(2),c(),g(3,dg,2,4,"ng-template",null,1,Y)}},dependencies:[fi,At],styles:["[_nghost-%COMP%]{position:relative}.hint[_ngcontent-%COMP%]{background:#fff;box-shadow:4px 4px 8px #223c504e;display:inline-block;opacity:0}.show-hint[_ngcontent-%COMP%]{opacity:1}.hide-hint[_ngcontent-%COMP%]{opacity:0}"]});let i=e;return i})();var fg=["*"];function hg(i,e){if(i&1&&h(0,"i",1),i&2){let r=f();nn("ra-"+r.icon)}}var or=(()=>{let e=class e{constructor(){this.disabled=!1}click(){return!this.disabled}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-icon-btn"]],hostVars:2,hostBindings:function(n,o){n&1&&w("click",function(){return o.click()}),n&2&&pe("disabled",o.disabled)},inputs:{icon:"icon",disabled:"disabled"},ngContentSelectors:fg,decls:2,vars:1,consts:[["class","ra",3,"class",4,"ngIf"],[1,"ra"]],template:function(n,o){n&1&&(ti(),g(0,hg,1,2,"i",0),Et(1)),n&2&&u("ngIf",o.icon)},dependencies:[re],styles:["[_nghost-%COMP%]{display:inline-block;font-size:30px;color:#fff;background:#55575a;cursor:pointer;border-radius:5px}.disabled[_nghost-%COMP%]{filter:brightness(.7);pointer-events:none}"]});let i=e;return i})();var ha=(()=>{let e=class e{constructor(){}ngOnInit(){let t=this.item?.baseType||this.itemBase;this.descriptions=t.description({thisItem:this.item,thisItemBase:t}).descriptions}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-item-description"]],inputs:{item:"item",itemBase:"itemBase"},decls:1,vars:1,consts:[[3,"descriptions"]],template:function(n,o){n&1&&h(0,"mw-description",0),n&2&&u("descriptions",o.descriptions)},changeDetection:0});let i=e;return i})();var gg=(i,e)=>({color:i,background:e}),ga=(()=>{let e=class e{constructor(){}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-item-icon-base"]],inputs:{icon:"icon",itemColor:"itemColor",bgColor:"bgColor"},decls:2,vars:5,consts:[[1,"player-item","item-icon",3,"ngStyle"],[3,"icon"]],template:function(n,o){n&1&&(a(0,"div",0),h(1,"mw-ra-icon",1),c()),n&2&&(u("ngStyle",Ht(2,gg,o.itemColor,o.bgColor)),l(),u("icon",o.icon))},dependencies:[sn,ue],styles:[".player-item[_ngcontent-%COMP%]{width:64px;height:32px;padding:6px 0;box-sizing:border-box;border:1px solid gray;border-radius:6px;margin:1px}.item-icon[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-size:32px;overflow:hidden}"]});let i=e;return i})();var yg=(i,e)=>({color:i,background:e});function vg(i,e){if(i&1&&(a(0,"div",3)(1,"div",4)(2,"div",5),h(3,"mw-ra-icon",6),c(),a(4,"div",7),d(5),a(6,"div",8),d(7),c()()(),a(8,"div",9),h(9,"mw-item-description",10),c()()),i&2){let r=f();l(2),u("ngStyle",Ht(6,yg,r._itemBase.icon.iconClr,r._itemBase.icon.bgClr)),l(),u("icon",r._itemBase.icon.icon),l(2),M(" ",r._itemBase.name," "),l(2),B(r._itemBase.slotType),l(2),u("item",r._item)("itemBase",r._itemBase)}}var Fi=(()=>{let e=class e{constructor(){this.hintPos="above"}set item(t){this._itemBase=t.baseType,this._item=t}set itemBase(t){this._itemBase=t}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-item-icon"]],inputs:{item:"item",itemBase:"itemBase",hintPos:"hintPos"},decls:4,vars:5,consts:[["hint",""],[3,"hintBody","hintPos"],[3,"icon","itemColor","bgColor"],[2,"max-width","200px"],[2,"display","flex"],[1,"tooltip-icon",3,"ngStyle"],[3,"icon"],[2,"padding","4px 8px 8px","font-size","14px"],[2,"font-size","9px","color","gray"],[2,"padding","0 8px 8px","font-size","13px"],[3,"item","itemBase"]],template:function(n,o){if(n&1&&(a(0,"mw-hover-hint",1),h(1,"mw-item-icon-base",2),g(2,vg,10,9,"ng-template",null,0,Y),c()),n&2){let s=se(3);u("hintBody",s)("hintPos",o.hintPos),l(),u("icon",o._itemBase.icon.icon)("itemColor",o._itemBase.icon.iconClr)("bgColor",o._itemBase.icon.bgClr)}},styles:[".tooltip-icon[_ngcontent-%COMP%]{height:32px;width:32px;overflow:hidden;font-size:28px;display:flex;align-items:center;justify-content:center}"]});let i=e;return i})();function _(i,e,r,t){var n=arguments.length,o=n<3?e:t===null?t=Object.getOwnPropertyDescriptor(e,r):t,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(i,e,r,t);else for(var p=i.length-1;p>=0;p--)(s=i[p])&&(o=(n<3?s(o):n>3?s(e,r,o):s(e,r))||o);return n>3&&o&&Object.defineProperty(e,r,o),o}function Cg(i,e){if(i&1&&(a(0,"div"),h(1,"mw-item-icon",5),c()),i&2){let r=f();l(),u("item",r.equippedItem)("itemBase",r.equippedItem.baseType)("hintPos",r.hintPos)}}function wg(i,e){if(i&1&&h(0,"mw-item-icon-base",6),i&2){let r=f();u("icon",r.slotInfo.icon)}}function Sg(i,e){if(i&1){let r=R();a(0,"mw-item-icon",10),w("click",function(){let n=A(r).$implicit,o=f(3);return O(o.equipItem(n))}),c()}if(i&2){let r=e.$implicit;u("item",r)("itemBase",r.baseType)}}function xg(i,e){if(i&1){let r=R();ye(0),a(1,"div",7)(2,"mw-item-icon-base",8),w("click",function(){A(r);let n=f(2);return O(n.unequipSlot())}),c(),g(3,Sg,1,2,"mw-item-icon",9),c(),ve()}if(i&2){let r=f(2);l(3),u("ngForOf",r.availableItemsForSlot)}}function bg(i,e){if(i&1&&g(0,xg,4,1,"ng-container",4),i&2){let r=f(),t=se(7);u("ngIf",r.availableItemsForSlot.length)("ngIfElse",t)}}function _g(i,e){if(i&1&&(a(0,"div",11),d(1),c()),i&2){let r=f();l(),M(' No items For "',r.slotInfo.name,'" slot ')}}var jr=class jr extends ae(){constructor(e){super(),this.playersService=e,this.hintPos="after",this.isEquipped=!1,this.equippedItem=null,this.availableItemsForSlot=[],this.hero=this.playersService.getCurrentPlayer().hero}ngOnChanges(e){let r=e.itemSlot;if(r){let t=r.currentValue;this.slotInfo=Wt.getSlotExtendedInfo(t);let n=this.hero.inventory;this.isEquipped=n.isSlotEquipped(t),this.equippedItem=n.getItemInSlot(t),this.availableItemsForSlot=Wt.filterItemsForSlot(t,this.hero.itemsBackpack)}}updateItems(e){e.item.baseType.slotType===this.itemSlot&&(this.availableItemsForSlot=Wt.filterItemsForSlot(this.itemSlot,this.hero.itemsBackpack))}removeItem(e){e.item.baseType.slotType===this.itemSlot&&(this.availableItemsForSlot=Wt.filterItemsForSlot(this.itemSlot,this.hero.itemsBackpack),this.equippedItem=null,this.isEquipped=!1)}updateSlotOnEquip(e){e.item.baseType.slotType===this.itemSlot&&(this.equippedItem=e.item,this.isEquipped=!0)}updateSlotOnUnequip(e){e.item.baseType.slotType===this.itemSlot&&(this.equippedItem=null,this.isEquipped=!1)}equipItem(e){this.equippedItem!==e&&(this.equippedItem&&this.unequipSlot(),this.events.dispatch(jn({item:e,player:this.playersService.getCurrentPlayer()})))}unequipSlot(){this.isEquipped&&this.equippedItem&&this.events.dispatch(un({item:this.equippedItem,player:this.playersService.getCurrentPlayer()}))}};jr.\u0275fac=function(r){return new(r||jr)(y(k))},jr.\u0275cmp=C({type:jr,selectors:[["mw-item-slot"]],inputs:{itemSlot:"itemSlot",hintPos:"hintPos"},features:[N,Bi],decls:8,vars:3,consts:[["isUnequipped",""],["itemsMenuBody",""],["noItemsForSlot",""],["pos","below",3,"menuBody"],[4,"ngIf","ngIfElse"],[1,"hoverable",3,"item","itemBase","hintPos"],["bgColor","white","itemColor","gray",1,"hoverable",3,"icon"],[1,"items-menu"],["bgColor","white","itemColor","gray","icon","cancel",1,"hoverable",3,"click"],["class","hoverable","hintPos","above",3,"item","itemBase","click",4,"ngFor","ngForOf"],["hintPos","above",1,"hoverable",3,"click","item","itemBase"],[1,"no-items"]],template:function(r,t){if(r&1&&(a(0,"mw-menu",3),g(1,Cg,2,3,"div",4)(2,wg,1,1,"ng-template",null,0,Y),c(),g(4,bg,1,2,"ng-template",null,1,Y)(6,_g,2,1,"ng-template",null,2,Y)),r&2){let n=se(3),o=se(5);u("menuBody",o),l(),u("ngIf",t.isEquipped)("ngIfElse",n)}},styles:["mw-item-icon-base[_ngcontent-%COMP%]{cursor:pointer}.items-menu[_ngcontent-%COMP%]{max-width:233px;width:200px;display:flex;flex-wrap:wrap;padding:6px;justify-content:center}.no-items[_ngcontent-%COMP%]{text-align:center;width:150px;font-size:12px;color:gray;padding:10px}.hoverable[_ngcontent-%COMP%]{cursor:pointer}"]});var si=jr;_([G(vi)],si.prototype,"updateItems",null);_([G(Nn)],si.prototype,"removeItem",null);_([G(jn)],si.prototype,"updateSlotOnEquip",null);_([G(un)],si.prototype,"updateSlotOnUnequip",null);function ya(i){let e=H(Lr).escape$.subscribe(()=>i());H(Dr).onDestroy(()=>e.unsubscribe())}var va=(()=>{let e=class e extends te{constructor(){super(),this.events=H(j),this.state=H(X),this.state.mainMenu.isOpen=!0,ya(()=>this.close())}ngOnDestroy(){this.state.mainMenu.isOpen=!1}openSettings(){this.events.dispatch(zn())}quitTheGame(){location.reload()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-main-menu-popup"]],features:[N],decls:9,vars:0,consts:[[2,"text-align","center"],[2,"display","flex","flex-direction","column"],["mw-main-button","",3,"click"]],template:function(n,o){n&1&&(a(0,"div",0),d(1,"Main Menu"),c(),a(2,"div",1)(3,"button",2),w("click",function(){return o.close()}),d(4,"Return to the Game"),c(),a(5,"button",2),w("click",function(){return o.openSettings()}),d(6,"Settings"),c(),a(7,"button",2),w("click",function(){return o.quitTheGame()}),d(8,"Quit"),c()())},dependencies:[oe],styles:["[_nghost-%COMP%]{padding:10px;display:block}button[_ngcontent-%COMP%]{min-width:165px;font-weight:600}"]});let i=e;return i})();var Pg=["elem"],Dg=["generalHint"],Eg=["*"];function Ig(i,e){i&1&&ke(0)}function Tg(i,e){if(i&1&&(a(0,"div",3),g(1,Ig,1,0,"ng-container",4),c()),i&2){let r=f();$("transition",r.transition,"s"),u("ngClass",r.showHintAnimation?"show-hint":"hide-hint"),l(),u("ngTemplateOutlet",r.menuBody)}}var is=(()=>{let e=class e{constructor(t,n){this.host=t,this.hintsService=n,this.transition=.15,this.pos="after",this.closeOnClick=!0,this.disabled=!1,this.showHintAnimation=!1,this.currentHintRef=null}onClick(){this.disabled||(this.hintsService.closeAllActiveMenus(),this.showHintAnimation=!0,this.hintsService.activeMenusCount+=1,this.hintsService.activeMenus.add(this),this.currentHintRef=this.hintsService.containerRef.createHint(this.elem,this.generalHint,this.pos))}clearHint(){this.currentHintRef=null}};e.\u0275fac=function(n){return new(n||e)(y(mt),y(Nr))},e.\u0275cmp=C({type:e,selectors:[["mw-menu"]],viewQuery:function(n,o){if(n&1&&(Pe(Pg,7),Pe(Dg,7)),n&2){let s;De(s=Ee())&&(o.elem=s.first),De(s=Ee())&&(o.generalHint=s.first)}},inputs:{menuBody:"menuBody",transition:"transition",pos:"pos",closeOnClick:"closeOnClick",disabled:"disabled"},ngContentSelectors:Eg,decls:5,vars:0,consts:[["elem",""],["generalHint",""],[3,"click"],[1,"hint","menu-hint",3,"ngClass"],[4,"ngTemplateOutlet"]],template:function(n,o){if(n&1){let s=R();ti(),a(0,"div",2,0),w("click",function(){return A(s),O(o.onClick())}),Et(2),c(),g(3,Tg,2,4,"ng-template",null,1,Y)}},dependencies:[fi,At],styles:["[_nghost-%COMP%]{position:relative}.hint[_ngcontent-%COMP%]{background:#fff;box-shadow:4px 4px 8px #223c504e;display:inline-block;opacity:0}.show-hint[_ngcontent-%COMP%]{opacity:1}.hide-hint[_ngcontent-%COMP%]{opacity:0}"]});let i=e;return i})();function ns(i){i||(Ql(ns),i=H(Dr));let e=new jl(r=>i.onDestroy(r.next.bind(r)));return r=>r.pipe(Xe(e))}var nl=i=>({hint:i});function Ag(i,e){i&1&&ke(0)}function Og(i,e){if(i&1&&(ye(0),g(1,Ag,1,0,"ng-container",7),ve()),i&2){let r=f().ngIf;f();let t=se(5);l(),u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,nl,r))}}function kg(i,e){i&1&&ke(0)}function Gg(i,e){if(i&1&&(ye(0),g(1,kg,1,0,"ng-container",7),ve()),i&2){let r=f().ngIf;f();let t=se(7);l(),u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,nl,r))}}function Rg(i,e){i&1&&ke(0)}function Ug(i,e){if(i&1&&(ye(0),g(1,Rg,1,0,"ng-container",7),ve()),i&2){let r=f().ngIf;f();let t=se(3);l(),u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,nl,r))}}function Bg(i,e){if(i&1&&(a(0,"div",4),ye(1,5),g(2,Og,2,4,"ng-container",6)(3,Gg,2,4,"ng-container",6)(4,Ug,2,4,"ng-container",6),ve(),c()),i&2){let r=e.ngIf,t=f();l(),u("ngSwitch",r.type),l(),u("ngSwitchCase",t.hintActionTypes.OnHoverEnemyCard),l(),u("ngSwitchCase",t.hintActionTypes.OnTargetSpell),l(),u("ngSwitchCase",t.hintActionTypes.CustomHtml)}}function Hg(i,e){if(i&1&&(h(0,"div",8),ie(1,"safeHtml")),i&2){let r=e.hint;u("innerHTML",ne(1,1,r.html),Bt)}}function Lg(i,e){if(i&1&&(ye(0),d(1),ve()),i&2){let r=f().hint;l(),M("-",r.maxDamage,"")}}function Ng(i,e){if(i&1&&(ye(0),d(1),ve()),i&2){let r=f().hint;l(),M("-",r.maxCountLoss,"")}}function jg(i,e){if(i&1&&(a(0,"span"),d(1,"Attack"),c(),a(2,"span"),d(3),c(),a(4,"span"),d(5," dealing "),c(),a(6,"span"),d(7),g(8,Lg,2,1,"ng-container",9),c(),a(9,"span"),d(10," damage, killing "),c(),a(11,"span"),d(12),g(13,Ng,2,1,"ng-container",9),c(),a(14,"span"),d(15," units "),c()),i&2){let r=e.hint;l(2),$("color",r.attackedGroup.ownerPlayer.color),l(),M(" ",r.attackedGroup.type.name," "),l(4),M(" ",r.minDamage,""),l(),u("ngIf",!r.noDamageSpread),l(4),M(" ",r.minCountLoss,""),l(),u("ngIf",!r.noLossSpread)}}function $g(i,e){if(i&1&&(a(0,"div")(1,"span"),d(2," Cast "),c(),a(3,"span"),d(4),c(),a(5,"span"),d(6," on "),c(),a(7,"span"),d(8),c()(),a(9,"div"),d(10," Press RMB to cancel "),c()),i&2){let r=e.hint;l(4),M(" ",r.spell.name," "),l(4),M(" ",r.target.type.name," ")}}var xn=(()=>{let e=class e{constructor(t,n,o){this.players=t,this.events=n,this.actionHintService=o,this.hintActionTypes=Hi,this.hint$=new Pt(null),_r([this.actionHintService.disableActionHint$,this.actionHintService.hintMessage$]).pipe(Ri(([s,p])=>s?null:p),zl(s=>this.hint$.next(s)),ns()).subscribe()}};e.\u0275fac=function(n){return new(n||e)(y(k),y(j),y(Sn))},e.\u0275cmp=C({type:e,selectors:[["mw-action-hint"]],decls:8,vars:3,consts:[["customHtml",""],["simple",""],["onTargetSpell",""],["style","text-align: center;",4,"ngIf"],[2,"text-align","center"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"innerHTML"],[4,"ngIf"]],template:function(n,o){n&1&&(g(0,Bg,5,4,"div",3),ie(1,"async"),g(2,Hg,2,3,"ng-template",null,0,Y)(4,jg,16,7,"ng-template",null,1,Y)(6,$g,11,2,"ng-template",null,2,Y)),n&2&&u("ngIf",ne(1,1,o.hint$))},dependencies:[re,At,hi,on,gi,Gt],styles:["[_nghost-%COMP%]{pointer-events:none;width:fit-content;margin:auto}"]});let i=e;return i})();var bn=function(i){return i.HeroStatMods="hsMods",i.HeroItemMods="hiMods",i.CommonCombatMods="ccMods",i}(bn||{});function Ca(i,e){let r=i.unitGroup;i.unitGroup=e.unitGroup,e.unitGroup=r}function Zd(i){return i.filter(e=>!e.unitGroup).length}var Xd=(()=>{let e=class e extends Tt{constructor(){super(...arguments),this.experience=0,this.level=1,this.freeSkillpoints=0,this.spells=[],this.modGroup=xt.empty(),this.unitAurasModGroup=xt.empty(),this.specialtiesModGroup=xt.empty(),this.itemsBackpack=[],this.inventory=new Wt,this._unitGroups=[],this.heroStats$=new Pt({baseAttack:0,bonusAttack:0,finalAttack:0,baseDefence:0,bonusDefence:0,finalDefence:0,fireResist:0,coldResist:0,lightningResist:0,poisonResist:0,currentMana:0,maxMana:0}),this.destroyed$=new Mt,this.mainUnitSlots=[{unitGroup:null},{unitGroup:null},{unitGroup:null},{unitGroup:null}],this.reserveUnitSlots=[{unitGroup:null,isReserve:!0},{unitGroup:null,isReserve:!0}]}get ownerPlayer(){return this._ownerPlayer}get unitGroups(){return this._unitGroups}create({heroBase:t,unitGroups:n,ownerPlayer:o}){this.base=t,this.name=t.name;let s=t.initialState.stats;o&&(this._ownerPlayer=o),this.stats={currentMana:s.mana},n&&this.setUnitGroups(n),t.initialState.defaultModifiers&&this.modGroup.addModsRef(ft.fromMods(t.initialState.defaultModifiers))}addReserveSlots(t){for(let n=0;n<t;n++)this.reserveUnitSlots.push({unitGroup:null,isReserve:!0})}hasFreeUnitSlots(){return this.hasFreeMainSlots()||this.hasFreeReserveSlots()}hasFreeMainSlots(){return this.getFreeMainSlotsCount()!==0}hasFreeReserveSlots(){return this.getFreeReserveSlotsCount()!==0}getFreeUnitSlotsCount(){return this.getFreeMainSlotsCount()+this.getFreeReserveSlotsCount()}getFreeMainSlotsCount(){return Zd(this.mainUnitSlots)}getFreeReserveSlotsCount(){return Zd(this.reserveUnitSlots)}getMainFilledUnitSlots(){return this.mainUnitSlots.filter(t=>t.unitGroup)}updateUnitGroupPositions(){this.getMainFilledUnitSlots().forEach((t,n)=>{t?.unitGroup?.setPosition(n)})}getAllSlots(){return[...this.mainUnitSlots,...this.reserveUnitSlots]}getAllUnitsFromSlots(){return this.getAllSlots().map(t=>t.unitGroup).filter(Ep)}setUnitGroups(t,n=!0){this._unitGroups=t,this._unitGroups.forEach((o,s)=>{n&&(this.mainUnitSlots[s].unitGroup=o),this.updateUnitGroup(o)}),this.updateUnitGroupPositions()}addUnitGroup(t){let n=this.unitGroups.includes(t);if(this._unitGroups.push(t),this.updateUnitGroup(t),n)return;let o=this.mainUnitSlots.find(p=>!p.unitGroup);if(o){o.unitGroup=t,this.refreshUnitGroupsOrderBySlots();return}let s=this.reserveUnitSlots.find(p=>!p.unitGroup);s&&(s.unitGroup=t),this.refreshUnitGroupsOrderBySlots(),this.getApi().events.dispatch(dc({hero:this,unitGroup:t})),this.updateUnitGroupPositions()}removeUnitGroup(t){q.removeItem(this.unitGroups,t),this.getApi().events.dispatch(mc({hero:this,unitGroup:t})),this.updateUnitGroupPositions()}refreshUnitGroupsOrderBySlots(){this._unitGroups=this.mainUnitSlots.map(t=>t.unitGroup).filter(Boolean)}assignOwnerPlayer(t){this._ownerPlayer=t;let n=this.base,o=n.initialState;this.spells=o.abilities.map(s=>this.getApi().spells.createSpellInstance(s)),this.initParentModGroups(),this.setupStatsUpdating(n),this.updateUnitGroupPositions()}onDestroy(){na(this.destroyed$)}getStats(){return this.heroStats$.getValue()}listenHeroStats(){return this.heroStats$.pipe(Xe(this.destroyed$))}addItem(t){this.itemsBackpack.push(t)}removeItem(t){q.removeItem(this.itemsBackpack,t),this.inventory.isItemEquipped(t)&&this.unequipItem(t)}equipItem(t){this.inventory.equipItem(t);let n=this.getItemModsGroup(),o=t.baseType;if(o.staticMods){let s=ft.fromMods(o.staticMods);n?.addModsRef(s)}o.bonusAbilities&&o.bonusAbilities.forEach(s=>{let p=this.getApi().spells.createSpellInstance(s.spell,{initialLevel:s.level});p.setSourceGameObjectId(t.id),this.spells.push(p)})}unequipItem(t){this.inventory.unequipItem(t);let n=this.getItemModsGroup();t.baseType.staticMods&&n&&n.removeRefByModInstance(t.baseType.staticMods),this.spells=this.spells.filter(o=>o.sourceInfo.gameObjectId!==t.id)}addCommonCombatMods(t){this.modGroup.getNamedGroup(bn.CommonCombatMods)?.addModsRef(t)}clearCommonCombatMods(){this.modGroup.getNamedGroup(bn.CommonCombatMods)?.clearOwnModRefs()}updateUnitsSpecialtyAndConditionalMods(){this.unitGroups.forEach(t=>this.updateUnitSpecialtyAndConditionalMods(t))}updateUnitSpecialtyAndConditionalMods(t){t.clearSpecialtyAndConditionalMods(),this.modGroup.getAllModValues("__unitConditionalMods").map(p=>p(t)).filter(Boolean).forEach(p=>t.attachSpecialtyMods(p));let o=t.type.getUnitTypeSpecialtyModifiers;if(!o)return;let s=o?.(this.specialtiesModGroup.getMods());s&&t.attachSpecialtyMods(s)}addStatsMods(t){this.modGroup.getNamedGroup(bn.HeroStatMods)?.addModsRef(ft.fromMods(t))}addMana(t){this.stats.currentMana+=t;let n=this.getStats().maxMana;this.stats.currentMana>n&&(this.stats.currentMana=n);let o=this.heroStats$.getValue();this.heroStats$.next(K(D({},o),{currentMana:this.stats.currentMana}))}updateUnitGroup(t){t.assignOwnerPlayer(this.ownerPlayer),t.assignOwnerHero(this),this.updateUnitSpecialtyAndConditionalMods(t)}getItemModsGroup(){return this.modGroup.getNamedGroup(bn.HeroItemMods)}initParentModGroups(){this.modGroup.attachNamedParentGroup(bn.HeroItemMods,xt.empty()),this.modGroup.attachNamedParentGroup(bn.HeroStatMods,xt.empty()),this.modGroup.attachNamedParentGroup(bn.CommonCombatMods,xt.empty())}setupStatsUpdating(t){this.modGroup.onValueChanges().pipe(Xe(this.destroyed$)).subscribe(n=>{this.specialtiesModGroup.clearOwnModRefs(),this.specialtiesModGroup.addModsRef(ft.fromMods(Ip(n))),this.updateUnitsSpecialtyAndConditionalMods();let{baseAttack:o,baseDefence:s,mana:p}=t.initialState.stats,m=n.heroBonusAttack||0,v=n.heroBonusDefence||0,S=n.resistAll||0,E=(n.heroMaxMana||0)+p;this.stats.currentMana>E&&(this.stats.currentMana=E);let L={baseAttack:o,bonusAttack:m,finalAttack:o+m,baseDefence:s,bonusDefence:v,finalDefence:s+v,fireResist:(n.resistFire||0)+S,coldResist:(n.resistCold||0)+S,lightningResist:(n.resistLightning||0)+S,poisonResist:(n.resistPoison||0)+S,currentMana:this.stats.currentMana,maxMana:E};this.heroStats$.next(L)})}};e.categoryId="hero";let i=e;return i})();var sr={1:0,2:285,3:400,4:475,5:545,6:600,7:650,8:700};var rs=(()=>{let e=class e{constructor(t){this.players=t,this.currentPlayer=this.players.getCurrentPlayer(),this.xpToNextLevel=sr[this.currentPlayer.hero.level+1]}};e.\u0275fac=function(n){return new(n||e)(y(k))},e.\u0275cmp=C({type:e,selectors:[["mw-experience-bar"]],decls:2,vars:2,consts:[[1,"experience-bar"],[1,"experience-progress"]],template:function(n,o){n&1&&(a(0,"div",0),h(1,"div",1),c()),n&2&&(l(),$("width",o.currentPlayer.hero.experience/o.xpToNextLevel*100,"%"))},styles:["[_nghost-%COMP%]{display:block}.experience-bar[_ngcontent-%COMP%]{background:#80808074}.experience-progress[_ngcontent-%COMP%]{background:#4c1f5e;height:3px}"]});let i=e;return i})();function zg(i,e){if(i&1&&h(0,"mw-item-slot",7),i&2){let r=e.$implicit;u("mwActionHint",r.name)("itemSlot",r.slotType)}}function Wg(i,e){if(i&1){let r=R();a(0,"div",9),w("click",function(){A(r);let n=f().$implicit,o=f();return O(o.displayUnitGroupInfo(n.unitGroup))})("mwNoContextMenu",function(){A(r);let n=f().$implicit,o=f();return O(o.displayUnitGroupInfo(n.unitGroup))}),a(1,"div",10),d(2),c(),a(3,"div"),d(4),c()()}if(i&2){let r=f().$implicit,t=f();$("background",t.player.color),u("mwActionHint","Inspect group of "+r.unitGroup.count+" "+r.unitGroup.type.name),l(2),B(r.unitGroup.type.name),l(2),B(r.unitGroup.count)}}function qg(i,e){if(i&1&&g(0,Wg,5,5,"div",8),i&2){let r=e.$implicit;pt(r.unitGroup?0:-1)}}function Yg(i,e){if(i&1){let r=R();a(0,"div",12),w("click",function(){A(r);let n=f().$implicit,o=f();return O(o.displayUnitGroupInfo(n.unitGroup))})("mwNoContextMenu",function(){A(r);let n=f().$implicit,o=f();return O(o.displayUnitGroupInfo(n.unitGroup))}),a(1,"div",10),d(2),c(),a(3,"div"),d(4),c()()}if(i&2){let r=f().$implicit,t=f();$("background",t.player.color),u("mwActionHint","Inspect group of "+r.unitGroup.count+" "+r.unitGroup.type.name),l(2),B(r.unitGroup.type.name),l(2),B(r.unitGroup.count)}}function Qg(i,e){if(i&1&&g(0,Yg,5,5,"div",11),i&2){let r=e.$implicit;pt(r.unitGroup?0:-1)}}var ar=(()=>{let e=class e{constructor(t,n,o){this.players=t,this.state=n,this.events=o,this.player=this.players.getCurrentPlayer(),this.itemSlots=Wt.getExtendedSlotTypes()}openPlayerInfo(){this.events.dispatch(Un())}getHeroActionHint(){let t=this.player.hero,n=t.level+1;return`
    <div>${sr[n]-t.experience}xp is required to reach Level ${n}</div>
    <div>(${t.experience}/${sr[n]})</div>
    `}displayUnitGroupInfo(t){this.events.dispatch(mn({unitGroup:t}))}};e.\u0275fac=function(n){return new(n||e)(y(k),y(X),y(j))},e.\u0275cmp=C({type:e,selectors:[["mw-player-info-panel"]],decls:13,vars:6,consts:[["mwActionHint","Inspect Hero",1,"hero-image",2,"cursor","pointer",3,"click","mwNoContextMenu"],[1,"hero-info"],[2,"display","flex","flex-direction","row"],["class","info-small-icons","hintPos","above",3,"mwActionHint","itemSlot",4,"ngFor","ngForOf"],[3,"mwActionHint"],[2,"width","270px"],[1,"groups-container"],["hintPos","above",1,"info-small-icons",3,"mwActionHint","itemSlot"],[1,"player-group-card",3,"background","mwActionHint"],[1,"player-group-card",3,"click","mwNoContextMenu","mwActionHint"],[1,"group-name"],[1,"player-group-card","reserve",3,"background","mwActionHint"],[1,"player-group-card","reserve",3,"click","mwNoContextMenu","mwActionHint"]],template:function(n,o){n&1&&(a(0,"div",0),w("click",function(){return o.openPlayerInfo()})("mwNoContextMenu",function(){return o.openPlayerInfo()}),c(),a(1,"div",1)(2,"div")(3,"div",2),g(4,zg,1,2,"mw-item-slot",3),c()(),a(5,"div",4),d(6),h(7,"mw-experience-bar",5),c(),a(8,"div",6),wt(9,qg,1,1,null,null,La),wt(11,Qg,1,1,null,null,La),c()()),n&2&&($("background-image","url('assets/"+o.player.hero.base.image+"')"),l(4),u("ngForOf",o.itemSlots),l(),u("mwActionHint",o.getHeroActionHint()),l(),fe(" ",o.player.hero.name,", Level: ",o.player.hero.level," "),l(3),St(o.player.hero.mainUnitSlots),l(2),St(o.player.hero.reserveUnitSlots))},styles:["[_nghost-%COMP%]{display:flex}.groups-container[_ngcontent-%COMP%]{display:flex}.hero-info[_ngcontent-%COMP%]{align-self:end;margin-bottom:6px}.hero-image[_ngcontent-%COMP%]{background-size:cover;width:100px;height:100px;border-radius:50%;border:4px solid gray;margin:8px;align-self:end}.player-group-card[_ngcontent-%COMP%]{height:48px;width:48px;color:#fff;display:flex;flex-direction:column;justify-content:center;text-align:center;border-radius:4px;font-size:11px;margin:3px;cursor:pointer}.player-group-card.reserve[_ngcontent-%COMP%]{height:40px;width:40px;font-size:10px;filter:brightness(.7)}.group-name[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis}.skillpoints[_ngcontent-%COMP%]{border:1px solid gold;padding:3px;font-size:12px;cursor:pointer;margin:3px;max-width:200px}"]});let i=e;return i})();function Kg(i,e){if(i&1){let r=R();a(0,"div",2),w("click",function(){let n=A(r).$implicit,o=f();return O(o.displayUnitGroupInfo(n))})("mwNoContextMenu",function(){let n=A(r).$implicit,o=f();return O(o.displayUnitGroupInfo(n))}),a(1,"div"),d(2),c(),a(3,"div"),d(4),c()()}if(i&2){let r=e.$implicit;$("background",r.ownerPlayer.color),u("mwActionHint","Inspect "+r.count+" "+r.type.name),l(2),B(r.type.name),l(2),B(r.count)}}var os=(()=>{let e=class e{constructor(t){this.events=t}displayUnitGroupInfo(t){this.events.dispatch(mn({unitGroup:t}))}};e.\u0275fac=function(n){return new(n||e)(y(j))},e.\u0275cmp=C({type:e,selectors:[["mw-unit-groups-list"]],inputs:{unitGroups:"unitGroups"},decls:2,vars:1,consts:[[1,"list"],["class","group",3,"mwActionHint","background","click","mwNoContextMenu",4,"ngFor","ngForOf"],[1,"group",3,"click","mwNoContextMenu","mwActionHint"]],template:function(n,o){n&1&&(a(0,"div",0),g(1,Kg,5,5,"div",1),c()),n&2&&(l(),u("ngForOf",o.unitGroups))},styles:[".list[_ngcontent-%COMP%]{display:flex;justify-content:center}.group[_ngcontent-%COMP%]{height:64px;width:64px;font-size:13px;display:flex;justify-content:center;flex-direction:column;align-items:center;text-align:center;color:#fff;margin:3px;border-radius:5px;cursor:pointer}"]});let i=e;return i})();var ss=(()=>{let e=class e{constructor(){this.state=H(X),this.events=H(j),this.players=H(k),this.currentPlayer=this.players.getCurrentPlayer()}goToTown(){this.events.dispatch(So())}openPlayerInfo(){this.events.dispatch(Un())}openActionCards(){this.events.dispatch(Mo())}openGarrison(){this.events.dispatch(Ln())}setupCampAction(){let t=this.players.getCurrentPlayer();this.events.dispatch(Yn({player:t,cardStack:t.actionCards.find(n=>n.card===Zs)}))}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-player-map-actions-panel"]],decls:13,vars:8,consts:[["icon","castle-emblem",3,"click","mwActionHint"],["mwActionHint","Inspect Hero","icon","aura",3,"click"],[1,"action-points",3,"click","mwActionHint"],[1,"action-info"],["icon","feather-wing"],["mwActionHint","Learn new abilities"],["icon","barrier",3,"disabled"],[3,"mwActionHint"],["icon","guarded-tower",3,"click","disabled"],[1,"camp-action",3,"click","mwActionHint"],["icon","campfire"]],template:function(n,o){n&1&&(a(0,"mw-icon-btn",0),w("click",function(){return o.goToTown()}),c(),a(1,"mw-icon-btn",1),w("click",function(){return o.openPlayerInfo()}),c(),a(2,"mw-icon-btn",2),w("click",function(){return o.openActionCards()}),a(3,"div",3),h(4,"mw-ra-icon",4),a(5,"span"),d(6),c()()(),a(7,"div",5),h(8,"mw-icon-btn",6),c(),a(9,"div",7)(10,"mw-icon-btn",8),w("click",function(){return o.openGarrison()}),c()(),a(11,"mw-icon-btn",9),w("click",function(){return o.setupCampAction()}),h(12,"mw-ra-icon",10),c()),n&2&&(Fr("mwActionHint","Go to ",o.state.createdGame.faction.title,""),l(2),u("mwActionHint","Action Cards<hr>"+o.state.currentGame.actionPoints+" action points left"),l(4),B(o.state.currentGame.actionPoints),l(2),u("disabled",!0),l(),u("mwActionHint",o.currentPlayer.garrisons.size!==0?"Garrison":"Garrison <hr> No garrisons to hire"),l(),u("disabled",o.currentPlayer.garrisons.size===0),l(),u("mwActionHint","Set up Camp<hr>Skips current day"))},styles:["mw-icon-btn[_ngcontent-%COMP%]{text-align:center;min-width:70px;max-width:70px;min-height:40px;margin-bottom:4px}mw-icon-btn.action-points[_ngcontent-%COMP%]{font-weight:100;font-size:23px;padding-top:4px;box-sizing:border-box}mw-icon-btn[_ngcontent-%COMP%] > .action-info[_ngcontent-%COMP%]{margin-left:-2px}"]});let i=e;return i})();function Jg(i,e){if(i&1){let r=R();a(0,"div",7),w("click",function(){let n=A(r).$implicit,o=f();return O(o.setActiveReward(n))}),h(1,"mw-ra-icon",8),a(2,"div",9),d(3),c()()}if(i&2){let r=e.$implicit,t=f();pe("active",r===t.activeReward),l(),u("icon",r.display.icon),l(2),B(r.display.title)}}var wa=(()=>{let e=class e extends te{setActiveReward(t){this.activeReward=t}acceptReward(){this.activeReward.onSumbit(),this.close()}};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=dt(e)))(o||e)}})(),e.\u0275cmp=C({type:e,selectors:[["mw-reward-popup"]],features:[N],decls:12,vars:4,consts:[["popupHeader",""],["popupContent",""],[1,"sub-info"],[1,"rewards"],["class","reward",3,"active","click",4,"ngFor","ngForOf"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],[1,"reward",3,"click"],[3,"icon"],[1,"reward-title"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2),c(),a(3,"div",1)(4,"div",2)(5,"p"),d(6),c()(),a(7,"div",3),g(8,Jg,4,4,"div",4),c()(),a(9,"div",5)(10,"button",6),w("click",function(){return o.acceptReward()}),d(11," Accept "),c()()()),n&2&&(l(2),M(" ",o.data.title," "),l(4),B(o.data.subTitle),l(2),u("ngForOf",o.data.rewards),l(2),u("disabled",!o.activeReward))},dependencies:[z,ue,oe,ce],styles:[".title[_ngcontent-%COMP%]{font-size:16px;text-align:center}.sub-title[_ngcontent-%COMP%]{font-size:13px;text-align:center}.rewards[_ngcontent-%COMP%]{display:flex;padding-top:10px;width:100%;justify-content:center}.reward[_ngcontent-%COMP%]{display:flex;width:120px;height:80px;align-items:center;justify-content:center;border:1px solid gray;flex-direction:column;margin:10px;cursor:pointer;-webkit-user-select:none;user-select:none}.reward.active[_ngcontent-%COMP%]{border:1px solid gold}.reward[_ngcontent-%COMP%]   mw-ra-icon[_ngcontent-%COMP%]{font-size:30px}.reward[_ngcontent-%COMP%]   .reward-title[_ngcontent-%COMP%]{font-size:13px;text-align:center}"]});let i=e;return i})();var ol=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-round-icon"]],inputs:{icon:"icon"},decls:1,vars:1,consts:[[3,"icon"]],template:function(n,o){n&1&&h(0,"mw-ra-icon",0),n&2&&u("icon",o.icon)},dependencies:[ue],styles:["[_nghost-%COMP%]{border:5px solid rgb(105,105,105);border-radius:50%;width:28px;height:28px;background-color:gray;color:#fff;display:flex;font-size:20px;justify-content:center;align-items:center}"]});let i=e;return i})(),Sa=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-round-icon-btn"]],inputs:{icon:"icon"},decls:1,vars:1,consts:[[3,"icon"]],template:function(n,o){n&1&&h(0,"mw-round-icon",0),n&2&&u("icon",o.icon)},dependencies:[ol],styles:["mw-round-icon[_ngcontent-%COMP%]:hover{filter:brightness(1.1)}mw-round-icon[_ngcontent-%COMP%]:active{filter:brightness(.7)}"]});let i=e;return i})();var sl=(()=>{let e=class e{constructor(t){this.template=t}ngOnInit(){console.log("------->>",this.templateName)}};e.\u0275fac=function(n){return new(n||e)(y(Tr))},e.\u0275dir=Re({type:e,selectors:[["","mwSharedTemplate",""]],inputs:{templateName:[0,"mwSharedTemplate","templateName"]}});let i=e;return i})();function t0(i,e){if(i&1&&h(0,"mw-ra-icon",2),i&2){let r=e.data;u("icon",r.icon)}}function i0(i,e){i&1&&h(0,"mw-vfx-element")}var as=(()=>{let e=class e{constructor(){}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-shared-templates"]],decls:2,vars:0,consts:[["mwSharedTemplate","icon"],["mwSharedTemplate","animation"],[3,"icon"]],template:function(n,o){n&1&&g(0,t0,1,1,"ng-template",0)(1,i0,1,0,"ng-template",1)}});let i=e;return i})();var cr=(()=>{let e=class e{constructor(){this.spell=ee.required(),this.hero=ee(),this.player=ee.required(),this.ownerUnit=ee(),this.descriptions=Be(()=>this.spell().baseType.getDescription({thisSpell:this.spell().baseType,spellInstance:this.spell(),ownerHero:this.hero(),ownerPlayer:this.player(),ownerUnit:this.ownerUnit()}).descriptions)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-spell-description"]],inputs:{spell:[1,"spell"],hero:[1,"hero"],player:[1,"player"],ownerUnit:[1,"ownerUnit"]},decls:1,vars:1,consts:[[3,"descriptions"]],template:function(n,o){n&1&&h(0,"mw-description",0),n&2&&u("descriptions",o.descriptions())},changeDetection:0});let i=e;return i})();var xa=(()=>{let e=class e extends te{constructor(){super(...arguments),this.players=H(k),this.gameObjects=H(xe),this.toSplit=0}upgadeValue(t){this.toSplit=Number(t.target.value)}split(){if(this.toSplit===0){this.close();return}let t=this.data.unitGroup,n=this.players.getCurrentPlayer().hero,o=this.gameObjects.createNewGameObject(ra,{count:this.toSplit,unitBase:t.type,ownerHero:n});n.addUnitGroup(o),t.addUnitsCount(-this.toSplit),this.close()}closePopup(){this.close()}};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=dt(e)))(o||e)}})(),e.\u0275cmp=C({type:e,selectors:[["mw-split-units-popup"]],features:[N],decls:15,vars:5,consts:[["popupHeader",""],["popupContent",""],["type","range","min","0",3,"input","max","value"],["popupButtons",""],["mw-main-button","",3,"click"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2," Splitting Group "),c(),a(3,"div",1)(4,"div"),d(5),c(),a(6,"div")(7,"input",2),w("input",function(p){return o.upgadeValue(p)}),c(),a(8,"div"),d(9),c()()(),a(10,"div",3)(11,"button",4),w("click",function(){return o.split()}),d(12," Split "),c(),a(13,"button",4),w("click",function(){return o.closePopup()}),d(14," Close "),c()()()),n&2&&(l(5),fe(" ",o.popup.data.unitGroup.type.name," ",o.popup.data.unitGroup.count," "),l(2),u("max",o.popup.data.unitGroup.count-1)("value",o.toSplit),l(2),M(" To split: ",o.toSplit," "))},dependencies:[oe,ce],encapsulation:2});let i=e;return i})();var cs=(()=>{let e=class e extends te{};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=dt(e)))(o||e)}})(),e.\u0275cmp=C({type:e,selectors:[["mw-unit-group-info-popup"]],features:[N],decls:1,vars:1,consts:[[3,"unitGroup"]],template:function(n,o){n&1&&h(0,"mw-unit-group-info",0),n&2&&u("unitGroup",o.data.unitGroup)},encapsulation:2});let i=e;return i})();function o0(i,e){if(i&1&&h(0,"mw-description",20),i&2){let r=f(2);u("descriptions",r.description.descriptions)}}function s0(i,e){i&1&&d(0," No Description. ")}function a0(i,e){if(i&1&&h(0,"mw-unit-group-spell-icon",24),i&2){let r=e.$implicit,t=f(3);u("hero",t.unitGroup.ownerPlayer.hero)("spell",r)("hintPos","above")("owner",t.unitGroup)}}function c0(i,e){if(i&1&&(a(0,"div",21),h(1,"hr"),a(2,"div",5),d(3," Abilities: "),c(),a(4,"div",22),g(5,a0,1,4,"mw-unit-group-spell-icon",23),c()()),i&2){let r=f(2);l(5),u("ngForOf",r.spells)}}function l0(i,e){if(i&1&&h(0,"mw-unit-group-spell-icon",24),i&2){let r=e.$implicit,t=f(3);u("hero",t.unitGroup.ownerPlayer.hero)("spell",r)("hintPos","above")("owner",t.unitGroup)}}function p0(i,e){if(i&1&&(a(0,"div",21),h(1,"hr"),a(2,"div",5),d(3," Effects: "),c(),a(4,"div",22),g(5,l0,1,4,"mw-unit-group-spell-icon",23),c()()),i&2){let r=f(2);l(5),u("ngForOf",r.effects)}}function u0(i,e){if(i&1&&(ye(0),h(1,"mw-unit-group-portrait",2),a(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),d(6),c(),a(7,"div",7),d(8),c()(),a(9,"div",8)(10,"div",9)(11,"div",10),h(12,"mw-ra-icon",11),d(13),c(),a(14,"div",10),h(15,"mw-ra-icon",12),d(16),c()(),a(17,"div",9)(18,"div",10),h(19,"mw-ra-icon",13),d(20),c()()()(),a(21,"div",14),h(22,"hr"),g(23,o0,1,1,"mw-description",15)(24,s0,1,0,"ng-template",null,0,Y),c()(),a(26,"div",16)(27,"div",5),d(28,"Group Stats"),c(),h(29,"hr"),a(30,"div",8)(31,"div",9)(32,"div",10),h(33,"mw-ra-icon",11),d(34),c(),a(35,"div",10),h(36,"mw-ra-icon",12),d(37),c(),h(38,"hr"),a(39,"div",17)(40,"div",10)(41,"div"),d(42,"Attack:"),c(),a(43,"div"),d(44),h(45,"span",18),c()(),a(46,"div",10)(47,"div"),d(48,"Defence:"),c(),a(49,"div"),d(50),h(51,"span",18),c()(),a(52,"div",10)(53,"div"),d(54,"Speed"),c(),a(55,"div"),d(56),h(57,"span",18),c()()(),g(58,c0,6,1,"div",19)(59,p0,6,1,"div",19),c()()(),ve()),i&2){let r=e.ngIf,t=se(25),n=f();l(),u("unitGroup",n.unitGroup),l(5),fe(" ",n.unitGroup.count," ",n.unitGroup.type.name," "),l(2),M(" Tier ",n.unitGroup.type.level," "),l(5),fe(" ",n.baseStats.damageInfo.minDamage,"-",n.baseStats.damageInfo.maxDamage," "),l(3),M(" ",n.baseStats.health," "),l(4),M(" Turns per round: ",n.unitGroup.type.defaultTurnsPerRound," "),l(3),u("ngIf",n.description.descriptions.length)("ngIfElse",t),l(11),up(" ",r.totalMinDamage,"-",r.totalMaxDamage," (avg. ",r.avgTotalDamage,") "),l(3),M(" ",r.totalHealth," "),l(7),M(" ",r.baseAttack," "),l(),u("mwNumberModifier",r.bonusAttack),l(5),M(" ",r.baseDefence," "),l(),u("mwNumberModifier",r.bonusDefence),l(5),M(" ",r.baseSpeed," "),l(),u("mwNumberModifier",r.speedBonus),l(),u("ngIf",n.spells.length),l(),u("ngIf",n.effects.length)}}var ba=(()=>{let e=class e{ngOnChanges(t){this.unitStats$=this.unitGroup.listenStats(),this.baseStats=this.unitGroup.type.baseStats;let n=this.unitGroup.spells;this.effects=n.filter(o=>o.isEffect()),this.spells=n.filter(o=>!o.isEffect()),this.description=this.unitGroup.type.getDescription?.({unit:this.unitGroup,unitBase:this.unitGroup.type})||{descriptions:[]}}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-unit-group-info"]],inputs:{unitGroup:"unitGroup"},features:[Bi],decls:2,vars:3,consts:[["noDescription",""],[4,"ngIf"],["size","big",1,"unit-portrait",3,"unitGroup"],[1,"main-group"],[1,"info-header"],[1,"title"],[1,"group"],[1,"tier"],[1,"stats"],[1,"col"],[1,"stat"],["icon","sword"],["icon","health"],["icon","spinning-sword"],[1,"description"],[3,"descriptions",4,"ngIf","ngIfElse"],[1,"secondary-group"],[1,"hor-stats"],[3,"mwNumberModifier"],["class","abilities",4,"ngIf"],[3,"descriptions"],[1,"abilities"],[1,"abilities-list"],[3,"hero","spell","hintPos","owner",4,"ngFor","ngForOf"],[3,"hero","spell","hintPos","owner"]],template:function(n,o){n&1&&(g(0,u0,60,22,"ng-container",1),ie(1,"async")),n&2&&u("ngIf",ne(1,1,o.unitStats$))},styles:["[_nghost-%COMP%]{display:flex;width:570px}.unit-portrait[_ngcontent-%COMP%]{position:absolute;left:-60px;top:-42px}.info-header[_ngcontent-%COMP%]{display:flex;margin-left:64px;flex-direction:column;height:92px}.stats[_ngcontent-%COMP%]{margin-top:12px;font-size:13px;display:flex}.col[_ngcontent-%COMP%]{margin-left:8px}.tier[_ngcontent-%COMP%]{font-size:13px}.description[_ngcontent-%COMP%]{font-size:12px;max-width:360px}.secondary-group[_ngcontent-%COMP%]{width:202px;flex-grow:1;margin-left:8px}.secondary-group[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{text-align:center}.secondary-group[_ngcontent-%COMP%]   .col[_ngcontent-%COMP%]{width:100%}.secondary-group[_ngcontent-%COMP%]   .abilities-list[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:4px}.secondary-group[_ngcontent-%COMP%]   .hor-stats[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.secondary-group[_ngcontent-%COMP%]   .hor-stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]{display:flex;flex-direction:column}.secondary-group[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]{display:flex;justify-content:center;text-align:center}.secondary-group[_ngcontent-%COMP%]   .stats[_ngcontent-%COMP%]   .stat[_ngcontent-%COMP%]{padding-bottom:2px}"]});let i=e;return i})();var ls=(()=>{let e=class e{constructor(){this.toRight=!0}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-unit-group-portrait"]],hostVars:4,hostBindings:function(n,o){n&2&&(nn(o.size),pe("to-right",o.toRight))},inputs:{unitGroup:"unitGroup",toRight:"toRight",size:"size"},decls:2,vars:2,consts:[[1,"portrait",3,"src"],["src","../assets/common/common-unit-frame.png",1,"portrait-frame"]],template:function(n,o){n&1&&h(0,"img",0)(1,"img",1),n&2&&Fr("src","../assets/",o.unitGroup.type.mainPortraitUrl,"",ws)},styles:["[_nghost-%COMP%]{position:relative;-webkit-user-select:none;user-select:none;display:inline-block}.to-right[_nghost-%COMP%]{scale:-1 1}[_nghost-%COMP%]   .portrait-frame[_ngcontent-%COMP%]{height:130px;width:121px}[_nghost-%COMP%]   .portrait[_ngcontent-%COMP%]{position:absolute;z-index:-1;left:30px;width:64px;height:83px;top:20px}.big[_nghost-%COMP%]   .portrait-frame[_ngcontent-%COMP%]{height:170px;width:144px}.big[_nghost-%COMP%]   .portrait[_ngcontent-%COMP%]{width:78px;height:102px;top:26px}"],changeDetection:0});let i=e;return i})();var m0=i=>({disabled:i}),em=(i,e)=>({color:i,background:e});function f0(i,e){if(i&1&&(a(0,"div",7),d(1),c()),i&2){let r=f(2);l(),M(" Mana Cost: ",r.spell().currentManaCost," ")}}function h0(i,e){if(i&1&&(a(0,"div",4),h(1,"mw-ra-icon",5),a(2,"div",6)(3,"div"),d(4),c(),a(5,"div",7),d(6),c(),g(7,f0,2,1,"div",8),c()(),a(8,"div",9),h(9,"mw-spell-description",10),c()),i&2){let r=f();l(),u("icon",r.icon().icon)("ngStyle",Ht(9,em,r.icon().iconClr,r.icon().bgClr)),l(3),B(r.baseType().name),l(2),M("Level ",r.spell().currentLevel,""),l(),u("ngIf",!r.isPassive()),l(2),u("spell",r.spell())("player",r.owner().ownerPlayer)("ownerUnit",r.owner())("hero",r.hero())}}var $r=(()=>{let e=class e{constructor(){this.owner=ee.required(),this.spell=ee.required(),this.hero=ee(),this.disabled=ee(!1),this.onCooldown=ee(),this.hintPos=ee("above"),this.baseType=Be(()=>this.spell().baseType),this.icon=Be(()=>this.spell().baseType.icon),this.isPassive=Be(()=>this.spell().isPassive())}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-unit-group-spell-icon"]],inputs:{owner:[1,"owner"],spell:[1,"spell"],hero:[1,"hero"],disabled:[1,"disabled"],onCooldown:[1,"onCooldown"],hintPos:[1,"hintPos"]},decls:5,vars:10,consts:[["buffHint",""],[3,"hintBody","hintPos"],[3,"ngClass"],[1,"spell-icon",3,"icon","ngStyle"],[2,"display","flex"],[1,"hint-icon",3,"icon","ngStyle"],[2,"padding","4px","font-size","14px"],[2,"font-size","12px"],["style","font-size: 12px;",4,"ngIf"],[2,"padding","4px","font-size","13px","max-width","240px"],[3,"spell","player","ownerUnit","hero"]],template:function(n,o){if(n&1&&(a(0,"mw-hover-hint",1)(1,"div",2),h(2,"mw-ra-icon",3),c()(),g(3,h0,10,12,"ng-template",null,0,Y)),n&2){let s=se(4);u("hintBody",s)("hintPos",o.hintPos()),l(),u("ngClass",Ue(5,m0,o.onCooldown()||o.disabled())),l(),u("icon",o.icon().icon)("ngStyle",Ht(7,em,o.icon().iconClr,o.icon().bgClr))}},styles:[".spell-icon[_ngcontent-%COMP%]{font-size:26px;margin:3px;display:block;height:30px;width:28px;text-align:center}.hint-icon[_ngcontent-%COMP%]{width:38px;height:38px;font-size:26px;text-align:center;padding-top:5px}.disabled[_ngcontent-%COMP%]{filter:brightness(.5)}"],changeDetection:0});let i=e;return i})();var _a=(()=>{let e=class e extends te{constructor(){super(...arguments),this.players=H(k),this.gameObjects=H(xe)}swap(){Ca(this.data.sourceSlot,this.data.targetSlot),this.data.postAction(),this.close()}merge(){let t=this.players.getCurrentPlayer().hero;this.data.targetSlot.unitGroup.addUnitsCount(this.data.sourceSlot.unitGroup.count),this.gameObjects.destroyObject(this.data.sourceSlot.unitGroup),this.data.sourceSlot.unitGroup=null,t.removeUnitGroup(this.data.sourceSlot.unitGroup),this.data.postAction(),this.close()}};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=dt(e)))(o||e)}})(),e.\u0275cmp=C({type:e,selectors:[["mw-unit-slots-action-popup"]],features:[N],decls:14,vars:0,consts:[["popupHeader",""],["popupContent",""],["popupButtons",""],["mw-main-button","",3,"click"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0)(2,"div"),d(3," These groups are of the same type "),c()(),a(4,"div",1)(5,"div"),d(6," What do you want to do? "),c()(),a(7,"div",2)(8,"button",3),w("click",function(){return o.merge()}),d(9," Merge "),c(),a(10,"button",3),w("click",function(){return o.swap()}),d(11," Swap "),c(),a(12,"button",3),w("click",function(){return o.popup.close()}),d(13," Cancel "),c()()())},dependencies:[oe,ce],encapsulation:2});let i=e;return i})();function y0(i,e){if(i&1&&(ye(0),h(1,"div",4)(2,"div",5),ve()),i&2){let r=f();l(),$("width",r.uiBarWidth(),"%")("height",r.barHeight(),"px"),l(),$("background",r.color())("width",r.uiBarWidth(),"%")("height",r.barHeight(),"px")}}function v0(i,e){if(i&1&&(ye(0),h(1,"div",6),ve()),i&2){let r=f();l(),$("background",r.color)("height",r.barHeight,"px")}}function C0(i,e){if(i&1&&(ye(0),d(1),ve()),i&2){let r=f();l(),M("/",r.maxValue(),"")}}var Ma=(()=>{let e=class e{constructor(){this.hostElem=Or(),this.renderer=_p(),this.maxValue=ee.required(),this.barStyle=ee("normal"),this.showMax=ee(!1),this.currentValue=ee(0),this.color=ee("red"),this.barHeight=ee(3),this.side=ee("left"),this.uiBarWidth=Be(()=>this.currentValue()/this.maxValue()*100),$a(()=>{this.renderer.setStyle(this.hostElem,"height",`${this.barHeight()}px`)})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-value-bar"]],inputs:{maxValue:[1,"maxValue"],barStyle:[1,"barStyle"],showMax:[1,"showMax"],currentValue:[1,"currentValue"],color:[1,"color"],barHeight:[1,"barHeight"],side:[1,"side"]},decls:6,vars:7,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"values"],[4,"ngIf"],[1,"diff-bar"],[1,"main-bar"],[1,"main-bar",2,"width","100%"]],template:function(n,o){n&1&&(ye(0,0),g(1,y0,3,10,"ng-container",1)(2,v0,2,4,"ng-container",1),ve(),a(3,"span",2),d(4),g(5,C0,2,1,"ng-container",3),c()),n&2&&(u("ngSwitch",o.barStyle()),l(),u("ngSwitchCase","normal"),l(),u("ngSwitchCase","static"),l(),pe("left",o.side()==="left"),l(),M(" ",o.currentValue(),""),l(),u("ngIf",o.showMax))},dependencies:[re,hi,on],styles:["[_nghost-%COMP%]{position:relative;display:block;background:#373737;width:100%}.diff-bar[_ngcontent-%COMP%]{transition:1.1s;background:#ffffff9d;position:absolute;transition-timing-function:ease-in-out}.main-bar[_ngcontent-%COMP%]{transition:.4s;position:absolute}.values[_ngcontent-%COMP%]{position:absolute;left:50%;transform:translate(-50%,-2px);text-shadow:1px 2px black;font-size:11px;color:#fff}"],changeDetection:0});let i=e;return i})();var S0=["container"],x0=["iconSfx"],b0=["customizableVfx"],_0=["htmlSfx"],M0=i=>({part:i});function P0(i,e){if(i&1&&h(0,"mw-ra-icon",6),i&2){let r=e.icon;u("icon",r)}}function D0(i,e){if(i&1&&(h(0,"div",7),ie(1,"safeHtml")),i&2){let r=e.html;u("innerHTML",ne(1,1,r),Bt)}}function E0(i,e){i&1&&ke(0)}function I0(i,e){if(i&1&&(ye(0),g(1,E0,1,0,"ng-container",12),ve()),i&2){let r=f().$implicit;f(2);let t=se(10);l(),u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,M0,r))}}function T0(i,e){if(i&1&&(a(0,"div",10),g(1,I0,2,4,"ng-container",11),c()),i&2){let r=e.$implicit;$("color",r.color),u("ngSwitch",r.type),l(),u("ngSwitchCase","plainPart")}}function F0(i,e){if(i&1&&(a(0,"div",8),g(1,T0,2,4,"div",9),c()),i&2){let r=e.data;l(),u("ngForOf",r.parts)}}function A0(i,e){if(i&1&&(h(0,"mw-ra-icon",6)(1,"span",13),ie(2,"safeHtml")),i&2){let r=e.part;u("icon",r.icon),l(),u("innerHTML",ne(2,2,r.text),Bt)}}var _n=(()=>{let e=class e{constructor(t,n){this.renderer=t,this.hostElem=n,this.createdViews={},this.animationEnded=new Ct,this.created=new Ct}ngOnInit(){this.created.emit(this)}playAnimation(t,n={duration:1e3},o={}){t.config.layout==="default"&&this.renderer.addClass(this.hostElem.nativeElement,"default-layout");let s=[];return t.elements.forEach(p=>{let m=null;switch(p.type){case qi.Icon:m=this.viewContainerRef.createEmbeddedView(this.iconSfx,{icon:p.icon});break;case qi.Customizable:m=this.viewContainerRef.createEmbeddedView(this.customizableVfx,{data:o.custom});break;case qi.Html:m=this.viewContainerRef.createEmbeddedView(this.htmlSfx,{html:o.custom?.html})}this.createdViews[p.id]=m;let v=m.rootNodes[0];Object.entries(t.elemsDefaultStyles[p.id]).forEach(([L,le])=>{this.renderer.setStyle(v,L,le)}),n.skipDlClass||this.renderer.addClass(v,"dl-sfx");let S=t.elemsKeyframes[p.id],E=v.animate(S,{duration:n.duration??1e3,fill:n.type??"forwards",iterations:n.iterations??1});s.push(E)}),{elem:this,animationsList:s}}clearAnimation(){this.viewContainerRef.clear()}};e.\u0275fac=function(n){return new(n||e)(y(Le),y(mt))},e.\u0275cmp=C({type:e,selectors:[["mw-vfx-element"]],viewQuery:function(n,o){if(n&1&&(Pe(S0,7,_i),Pe(x0,7),Pe(b0,7),Pe(_0,7)),n&2){let s;De(s=Ee())&&(o.viewContainerRef=s.first),De(s=Ee())&&(o.iconSfx=s.first),De(s=Ee())&&(o.customizableVfx=s.first),De(s=Ee())&&(o.htmlSfx=s.first)}},outputs:{animationEnded:"animationEnded",created:"created"},decls:11,vars:0,consts:[["container",""],["iconSfx",""],["htmlSfx",""],["customizableVfx",""],["plainDamagePart",""],[1,"effect"],[3,"icon"],[2,"text-shadow","1px 1px 2px #202020","color","white",3,"innerHTML"],[2,"text-shadow","1px 1px #4e4e4e","z-index","10000"],[3,"ngSwitch","color",4,"ngFor","ngForOf"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"innerHTML"]],template:function(n,o){n&1&&(a(0,"div",5),ke(1,null,0),c(),g(3,P0,1,1,"ng-template",null,1,Y)(5,D0,2,3,"ng-template",null,2,Y)(7,F0,2,1,"ng-template",null,3,Y)(9,A0,3,4,"ng-template",null,4,Y))},dependencies:[z,At,hi,on,ue,Gt],styles:[".default-layout[_ngcontent-%COMP%] > .effect[_ngcontent-%COMP%]{pointer-events:none}.dl-sfx[_ngcontent-%COMP%]{position:absolute;transform:translate(-50%,-50%)}"]});let i=e;return i})();var al={darkOverlay:!0,duration:1e3},ai=(()=>{let e=class e{constructor(){this.latestVfxId=0,this.containersSet=new Map}registerLayerComponent(t){this.layerComponent=t}registerVfxContainer(t,n){this.containersSet.set(t,n)}unregisterVfxContainer(t){this.containersSet.delete(t)}getNewId(){return this.latestVfxId++}createXyVfx(t,n,o,s={}){this.layerComponent.createXyVfx(t,n,o,D(D({},al),s))}createVfxForUnitGroup(t,n,o={}){this.layerComponent.createVfxForUnitGroup(t,n,D(D({},al),o))}createEffectAnimationForUnitGroup(t,n,o={}){this.layerComponent.createVfxForUnitGroup(t,{type:Yi.VfxElement,animation:n},D(D({},al),o))}createEffectAnimationForContainer(t,n,o={}){this.containersSet.get(t)?.addAnimation(n)}createFloatingMessageForUnitGroup(t,n,o={}){this.layerComponent.createFloatingMessageForUnitGroup(t,{custom:n},o)}createDroppingMessageForContainer(t,n,o={}){this.containersSet.get(t)?.addAnimation(pu,D({skipDlClass:!0},o),{custom:n})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var k0=["effectsContainer"],G0=["vfxElement"];function R0(i,e){i&1&&h(0,"mw-vfx-element")}var ps=(()=>{let e=class e{constructor(t,n,o,s){this.vfxService=t,this.renderer=n,this.unitsCardsMapping=o,this.cdr=s,this.activeEffects=new Map,this.EffectTypes=Yi,this.effectsWithOverlay=0}ngOnInit(){this.vfxService.registerLayerComponent(this)}createXyVfx(t,n,o,s){let p=this.createNewEffect({bottom:0,left:t,right:0,top:n},o);this.instantiateEffect(o,s,p)}createVfxForUnitGroup(t,n,o){let p=this.unitsCardsMapping.get(t).hostElem.nativeElement,{left:m,top:v}=p.getBoundingClientRect(),S=this.createNewEffect({bottom:0,left:m+p.clientWidth/2,right:0,top:v+p.clientHeight/2},n);this.instantiateEffect(n,o,S)}createFloatingMessageForUnitGroup(t,n,o={}){let p=this.unitsCardsMapping.get(t).hostElem.nativeElement,{left:m,top:v}=p.getBoundingClientRect(),S={type:Yi.VfxElement,animation:lu},E=this.createNewEffect({bottom:0,left:m+p.clientWidth/2,right:0,top:v+p.clientHeight/2},S);this.instantiateEffect(S,D({darkOverlay:!1,duration:1e3},o),E,n)}createNewEffect(t,n){return{id:this.vfxService.getNewId(),offset:t,vfx:n}}instantiateEffect(t,n,o,s={}){switch(n.darkOverlay&&this.effectsWithOverlay++,this.activeEffects.set(o.id,o),t.type){case Yi.VfxElement:let p=t,m=this.effectsContainerRef.createComponent(_n),v=m.instance,S=v.playAnimation(p.animation,{duration:n.duration},s);_r(S.animationsList.map(E=>Dt(E,"finish"))).pipe(Mr(1)).subscribe(()=>{this.activeEffects.delete(o.id),n.darkOverlay&&this.effectsWithOverlay--,m.destroy()}),this.updateEffectElementPosition(v.hostElem.nativeElement,o)}}updateEffectElementPosition(t,n){this.renderer.setStyle(t,"position","fixed"),this.renderer.setStyle(t,"left",`${n.offset.left}px`),this.renderer.setStyle(t,"top",`${n.offset.top}px`)}};e.\u0275fac=function(n){return new(n||e)(y(ai),y(Le),y(Br),y(di))},e.\u0275cmp=C({type:e,selectors:[["mw-vfx-layer"]],viewQuery:function(n,o){if(n&1&&(Pe(k0,7,_i),Pe(G0,7)),n&2){let s;De(s=Ee())&&(o.effectsContainerRef=s.first),De(s=Ee())&&(o.vfxElementRef=s.first)}},decls:5,vars:2,consts:[["effectsContainer",""],["vfxElement",""],[1,"basic-overlay"]],template:function(n,o){n&1&&(h(0,"div",2),ke(1,null,0),g(3,R0,1,0,"ng-template",null,1,Y)),n&2&&pe("visible",o.effectsWithOverlay)},styles:["[_nghost-%COMP%]{position:fixed;pointer-events:none;inset:0}.vfx[_ngcontent-%COMP%]{position:fixed;pointer-events:none}.basic-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;opacity:0;background:#0000006b;transition:.3s;pointer-events:none}.basic-overlay.visible[_ngcontent-%COMP%]{opacity:1}"]});let i=e;return i})();var B0=["*"];function H0(i,e){if(i&1){let r=R();a(0,"mw-vfx-element",2),w("created",function(n){let o=A(r).$implicit,s=f();return O(s.playAnimation(n,o))}),c()}}var us=(()=>{let e=class e{constructor(){this.vfxService=H(ai),this.animations=[]}ngOnInit(){this.vfxService.registerVfxContainer(this.containerId,this)}ngOnDestroy(){this.vfxService.unregisterVfxContainer(this.containerId)}playAnimation(t,n){let o=t.playAnimation(n.anim,n.options,n.data);_r(o.animationsList.map(s=>Dt(s,"finish"))).pipe(Mr(1)).subscribe(()=>{q.removeItem(this.animations,n)})}addAnimation(t,n,o){this.animations.push({anim:t,options:n,data:o})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-vfx-container"]],inputs:{containerId:"containerId"},ngContentSelectors:B0,decls:3,vars:1,consts:[[2,"position","absolute","z-index","200","left","50%","top","20%"],[3,"created",4,"ngFor","ngForOf"],[3,"created"]],template:function(n,o){n&1&&(ti(),a(0,"div",0),g(1,H0,1,0,"mw-vfx-element",1),c(),Et(2)),n&2&&(l(),u("ngForOf",o.animations))},styles:["[_nghost-%COMP%]{display:block;position:relative}"]});let i=e;return i})();var Pa=(()=>{let e=class e{constructor(){this.unitType=ee.required(),this.count=ee.required()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-unit-group-preview"]],inputs:{unitType:[1,"unitType"],count:[1,"count"]},decls:4,vars:4,consts:[[2,"display","flex","flex-direction","column"],[3,"src"]],template:function(n,o){n&1&&(a(0,"div",0),h(1,"img",1),a(2,"div"),d(3),c()()),n&2&&(l(),Fr("src","../assets/",o.unitType().mainPortraitUrl,"",ws),l(2),fe(" ",o.unitType().name," (",o.count(),") "))},encapsulation:2,changeDetection:0});let i=e;return i})();var Pn=(()=>{let e=class e extends ae(){constructor(t,n,o,s,p,m,v,S){super(),this.battleState=t,this.actionHint=n,this.players=o,this.unitState=s,this.units=p,this.history=m,this.state=v,this.vfx=S}onBattleBegins(){this.initPlayersSpells()}dealDamageTo(t,n,o=Ce.PhysicalAttack,s,p={}){let m=n,v=0,S=0,E=0,L=!1;switch(o){case Ce.PhysicalAttack:if(p.attackerUnit){console.log("attacker?",p.attackerUnit);let $e={attacked:t,attacker:p.attackerUnit},Xt=p.attackerUnit.modGroup,Si=Xt.getAllModValues("__attackConditionalModifiers").map(Gi=>Gi($e)),Am=Xt.getAllModValues("__unitConditionalMods").map(Gi=>Gi(p.attackerUnit)),Om=t.modGroup.getAllModValues("__attackConditionalModifiers").map(Gi=>Gi($e)),to=xt.withRefs([...Si.map(ft.fromMods),...Am.filter(Dp).map(ft.fromMods),...Xt.getAllRefs()]),Rl=to.getModValue("criticalDamageChance");Rl&&q.chanceRoll(Rl)&&(L=!0,m=m+m*(to.getModValue("criticalDamageMul")||0));let Ra=xt.withRefs(Om.map(ft.fromMods)),Ua=Ra.getModValue("chanceToBlock"),km=Ra.getModValue("damageBlockMin"),Gm=Ra.getModValue("damageBlockMax");if(Ua){let Gi=q.chanceRoll(Ua);if(console.log("blocking -> chance to block",Ua,Gi),Gi){let Ll=q.randIntInRange(km,Gm),Rm=q.maxPercent(Xt.getModValue("blockPiercingPercent")||0);v=Math.round(Ll-Ll*Rm)}}let Ul=to.getModValue("baseDamagePercentModifier")||0,Bl=to.getModValue("lifesteal")||0;console.log(`damage reduced by ${Ul}%`),m=q.nonNegative(Math.round(m+m*Ul)-v);let Hl=to.getModValue("retaliationDamagePercent");p.isCounterattack&&Hl&&(m*=Hl),Bl&&(S=Math.round(m*(Bl/100)),console.log("Lifesteal: ",S))}break;default:if(Qc[o]){let Xt=t.modGroup.getModValue("amplifiedTakenMagicDamagePercent")||0;m+=n*Xt,m=Math.round(m);let Si=t.getStats()[Qc[o]];Si>Kc&&(Si=Kc),console.log(n,o,"resist:",Si),m=m-m*(Si/100)}}let le=t.count;if(m=Math.round(m),S&&p.attackerUnit){let $e=this.units.healUnit(p.attackerUnit,S);E=$e.revivedUnitsCount,this.events.dispatch(Rn({healedUnitsCount:$e.revivedUnitsCount,target:p.attackerUnit}))}let he=this.unitState.dealPureDamageToUnitGroup(t,m);return he.finalUnitLoss&&this.events.dispatch(yo({unit:t,loss:he.finalUnitLoss})),s&&s({unitLoss:he.finalUnitLoss,finalDamage:he.finalDamage,initialUnitCount:le}),o===Ce.PhysicalAttack?K(D({},he),{blockedDamage:v,stolenLife:S,stolenLifeUnitsRestored:E,isCritical:L}):(he.isDamageFatal&&(this.battleState.handleDefeatedUnitGroup(t),this.events.dispatch(pn({target:t,targetPlayer:t.ownerPlayer,loss:he.finalUnitLoss}))),he.finalUnitLoss&&this.events.dispatch(cc({unitLoss:he.finalUnitLoss,group:t})),K(D({},he),{blockedDamage:v,stolenLife:S,stolenLifeUnitsRestored:E,isCritical:L}))}handleAttackInteraction(t){let{attackingGroup:n,attackedGroup:o,action:s}=t,p=s===ni.GroupCounterattacks,m=p?o:n,v=p?n:o;this.triggerEventForAllSpellsHandler(gn.UnitGroupAttacks({attacked:v,attacker:m}));let S=this.unitState.getDetailedAttackInfo(m,v),E=this.unitState.getFinalDamageInfoFromDamageDetailedInfo(S),L=this.dealDamageTo(v,E.finalDamage,Ce.PhysicalAttack,void 0,{attackerUnit:m,isCounterattack:p});if(p&&(this.vfx.createDroppingMessageForContainer(v.id,{html:wi(`
          <div style="font-size: 14px">Retaliated! ${zo({icon:"skull"})} ${L.finalUnitLoss}</div>
        `,{width:130})},{duration:1500}),this.history.logHtmlMessage(hu({attacked:v,attacker:m,damage:L.finalDamage,originalNumber:S.originalAttackersCount,unitLoss:L.finalUnitLoss}))),p?this.events.dispatch(lc({attackingGroup:m,attackedGroup:v,loss:L.finalUnitLoss,damage:L.finalDamage})):(this.battleState.currentGroupTurnsLeft--,m.turnsLeft=this.battleState.currentGroupTurnsLeft,this.events.dispatch(Gn({attackingGroup:m,attackedGroup:v,attackedCount:S.originalAttackedCount,attackersCount:S.originalAttackersCount,loss:L.finalUnitLoss,damage:L.finalDamage,damageBlocked:L.blockedDamage,lifeStolen:L.stolenLife,lifeStolenUnitsRestored:L.stolenLifeUnitsRestored,isCritical:L.isCritical}))),L.isDamageFatal){this.battleState.handleDefeatedUnitGroup(v),this.events.dispatch(pn({target:v,targetPlayer:v.ownerPlayer,loss:L.finalUnitLoss})),t.action=ni.AttackInteractionCompleted,this.events.dispatch(cn(t));return}if(!p){S.enemyCanCounterattack?t.action=ni.GroupCounterattacks:t.action=ni.AttackInteractionCompleted,this.events.dispatch(cn(t));return}p&&(t.action=ni.AttackInteractionCompleted),this.events.dispatch(cn(t))}setDamageHintMessageOnCardHover(t){let n=this.getTargetAttackActionInfo(t.hoveredCard);this.actionHint.hintMessage$.next(n)}getTargetAttackActionInfo(t){let n=this.battleState.currentUnitGroup,o=this.unitState.getDetailedAttackInfo(n,t);return{type:Hi.OnHoverEnemyCard,attackedGroup:o.attacked,minDamage:o.multipliedMinDamage,maxDamage:o.multipliedMaxDamage,noDamageSpread:o.multipliedMinDamage===o.multipliedMaxDamage,minCountLoss:o.minUnitCountLoss,maxCountLoss:o.maxUnitCountLoss,noLossSpread:o.minUnitCountLoss===o.maxUnitCountLoss,attackSuperiority:o.attackSuperiority}}forEachUnitGroup(t){this.battleState.heroesUnitGroupsMap.forEach((n,o)=>{n.forEach(s=>{t(s,o)})})}applyDispellToUnitGroup(t){let n=[I.Buff,I.Debuff];t.spells.forEach(o=>{n.includes(o.baseType.activationType)&&this.removeSpellFromUnitGroup(t,o)}),this.units.clearUnitModifiers(t)}triggerEventForAllSpellsHandler(t){this.state.eventHandlers.spells.triggerAllHandlersByEvent(t)}triggerEventForSpellHandler(t,n){this.state.eventHandlers.spells.triggerRefEventHandlers(t,n)}initAllUnitGroupSpells(){this.forEachUnitGroup((t,n)=>{t.spells&&t.spells.forEach(o=>this.initSpell(o,n,t))})}resetAllUnitGroupsCooldowns(){this.forEachUnitGroup(t=>t.fightInfo.spellsOnCooldown=!1)}getRandomEnemyUnitGroup(){let t=this.players.getEnemyPlayer(),n=this.battleState.heroesUnitGroupsMap.get(t);return q.randItem(n.filter(o=>o.fightInfo.isAlive))}addSpellToUnitGroup(t,n,o){t.addSpell(n),this.events.dispatch(ln({unitGroup:t})),this.initSpell(n,o),this.triggerEventForSpellHandler(n,gn.SpellPlacedOnUnitGroup({target:t}))}removeSpellFromUnitGroup(t,n){t.removeSpell(n),this.state.eventHandlers.spells.removeAllHandlersForRef(n),this.events.dispatch(ln({unitGroup:t}))}initSpell(t,n,o){this.events.dispatch(Go({spell:t,player:n,ownerUnit:o}))}initPlayersSpells(){[this.players.getCurrentPlayer(),this.players.getEnemyPlayer()].forEach(t=>{t.hero.spells.forEach(n=>{this.initSpell(n,t)})})}};e.\u0275fac=function(n){return new(n||e)(x(vt),x(Sn),x(k),x(Da),x(Fe),x(Ii),x(X),x(ai))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Dn=function(i){return i.Player="Player",i.AI="AI",i}(Dn||{}),_e=function(i){return i.Normal="normal",i.SpellTargeting="spell-targeting",i.WaitsForTurn="waits-for-turn",i}(_e||{}),Vr=(()=>{let e=class e extends Tt{constructor(){super(...arguments),this.garrisons=new Map,this.actionCards=[]}create({color:t,hero:n,resources:o,type:s}){this.color=t,this.resources=o,this.type=s,this.hero=n,this.hero.assignOwnerPlayer(this),this.hero.updateUnitsSpecialtyAndConditionalMods()}addActionCards(t,n){let o=this.actionCards.find(s=>s.card===t);o?o.count+=n:this.actionCards.push({card:t,count:n})}};e.categoryId="player";let i=e;return i})();var j0=U({id:"#spell-null",activationType:I.Instant,name:"",icon:{icon:""},getDescription(i){return{descriptions:[]}},config:{spellConfig:{getManaCost(i){return 0},init:()=>{}}}}),lr=class lr extends ae(){constructor(e,r){super(),this.players=e,this.gameObjectsManager=r,this.NULL_SPELL_INSTANCE=this.gameObjectsManager.createNewGameObject(Gs,{initialLevel:0,spellBaseType:j0,state:{}},"null-spell"),this.currentSpell=this.NULL_SPELL_INSTANCE,this.playerCurrentState=_e.Normal,this.playerStateChanged$=new Pt(_e.Normal),this.spellsAreOnCooldown=!1}playersInit(){this.currentPlayer=this.players.getCurrentPlayer()}resetSpellsCooldowns(){this.spellsAreOnCooldown=!1}setSpellsOnCooldown(){this.currentCasterUnit?(this.currentCasterUnit.fightInfo.spellsOnCooldown=!0,this.currentCasterUnit=void 0):this.spellsAreOnCooldown=!0}onSpellClick(e,r){switch(this.currentSpell=e,this.currentCasterUnit=r,e.baseType.activationType){case"instant":this.onCurrentSpellCast(),this.events.dispatch(lo({player:this.currentPlayer,spell:e})),this.setSpellsOnCooldown();break;case"target":this.setPlayerState(_e.SpellTargeting);break;case"passive":break;default:break}}isSpellBeingCasted(){return this.currentSpell!==this.NULL_SPELL_INSTANCE}resetCurrentSpell(){this.currentSpell=this.NULL_SPELL_INSTANCE}cancelCurrentSpell(){this.resetCurrentSpell(),this.setPlayerState(_e.Normal),this.currentCasterUnit=void 0}onCurrentSpellCast(){this.currentPlayer.hero.addMana(-this.currentSpell.currentManaCost)}setPlayerState(e){this.playerCurrentState=e,this.playerStateChanged$.next(e)}};lr.\u0275fac=function(r){return new(r||lr)(x(k),x(xe))},lr.\u0275prov=T({token:lr,factory:lr.\u0275fac,providedIn:"root"});var nt=lr;_([J($i)],nt.prototype,"playersInit",null);var $0=hd({id:"#hero-non-player-neutral",name:"neutral-hero",generalDescription:F(""),abilities:[],army:[],items:[],resources:fd,stats:{mana:0,baseAttack:0,baseDefence:0}}),zr=(()=>{let e=class e{constructor(t,n){this.gameObjectsManager=t,this.unitGroups=n}addManaToHero(t,n){t.addMana(n)}addSpellToHero(t,n){t.spells.push(n)}createHero(t){return this.gameObjectsManager.createNewGameObject(Xd,{heroBase:t,unitGroups:t.initialState.army.length?this.unitGroups.createUnitGroupFromGenModel(t.initialState.army[0]):[]})}createNeutralHero(){return this.createHero($0)}};e.\u0275fac=function(n){return new(n||e)(x(xe),x(Fe))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Ai=(()=>{let e=class e{constructor(t,n,o){this.events=t,this.state=n,this.gameObjectsManager=o}createItem(t){let n=t.icon;return n.bgClr||(n.bgClr=It.DefaultItemIconBg),n.iconClr||(n.iconClr=It.DefaultItemIconClr),this.gameObjectsManager.createNewGameObject(Tp,{itemBase:t,state:t.defaultState})}registerItemsEventHandlers(t,n){this.events.dispatch(Ro({item:t,ownerPlayer:n}))}triggerEventForAllItemsHandlers(t){this.state.eventHandlers.items.triggerAllHandlersByEvent(t)}triggerEventForItemHandlers(t,n){this.state.eventHandlers.items.triggerRefEventHandlers(t,n)}};e.\u0275fac=function(n){return new(n||e)(x(j),x(X),x(xe))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Oi=function(i){return i.Main="main",i.Neutral="neutral",i}(Oi||{});var k=(()=>{let e=class e extends ae(){get playersMap(){return this.state.gameState.playersMap}constructor(t,n,o,s){super(),this.heroesService=t,this.unitGroups=n,this.state=o,this.gameObjectsManager=s,this.currentPlayerId=this.gameObjectsManager.getObjectId(Vr,Oi.Main)}createPlayer(t,n){return this.gameObjectsManager.createNewGameObject(Vr,n,t)}getCurrentPlayer(){return this.playersMap.get(this.currentPlayerId)}addResourceToPlayer(t,n,o){t.resources[n]+=o}addResourcesToPlayer(t,n){Object.entries(n).forEach(([o,s])=>t.resources[o]+=s)}removeResourcesFromPlayer(t,n){Object.entries(n).forEach(([o,s])=>t.resources[o]-=s)}playerHasResources(t,n){let o=t.resources;return Object.entries(n).every(([s,p])=>o[s]>=p)}getMissingResources(t,n){let o=t.resources;return Object.entries(n).reduce((s,[p,m])=>{let v=o[p]-m;return v<0&&(s[p]=Math.abs(v)),s},{})}getCurrentPlayerId(){return this.currentPlayerId}isEnemyUnitGroup(t){return this.getUnitGroupsOfPlayer(this.getEnemyPlayer().id).includes(t)}getPlayerUnitsCountOfType(t,n){return t.hero.unitGroups.reduce((o,s)=>o+(s.type.id===n?s.count:0),0)}addExperienceToPlayer(t,n){let s=this.getPlayerById(t).hero;s.experience+=n;let p=sr[s.level+1];p<=s.experience&&(s.level++,s.freeSkillpoints++,s.experience=s.experience-p,this.events.dispatch(Fo({newLevel:s.level,hero:s})))}getPlayerById(t){return this.playersMap.get(this.gameObjectsManager.getObjectId(Vr,t))}getNeutralPlayer(){return this.playersMap.get(this.gameObjectsManager.getObjectId(Vr,Oi.Neutral))}getEnemyPlayer(){return this.getNeutralPlayer()}getUnitGroupsOfPlayer(t){return this.playersMap.get(this.gameObjectsManager.getObjectId(Vr,t)).hero.unitGroups}addUnitGroupToTypeStack(t,n){let o=t.hero.unitGroups.find(s=>s.type===n.type);o?o.addUnitsCount(n.count):t.hero.addUnitGroup(n)}removeNUnitsFromGroup(t,n,o){if(n.addUnitsCount(-o),n.count<=0){t.hero.removeUnitGroup(n),this.gameObjectsManager.destroyObject(n);let s=n.ownerHero.getAllSlots().find(p=>p.unitGroup===n);s&&(s.unitGroup=null)}}removeUnitTypeCountFromPlayer(t,n,o){let s=t.hero.getAllUnitsFromSlots().filter(E=>E.type.id===n),p=s.reduce((E,L)=>L.count+E,0),m=p<o?p:o,v=m,S=0;for(;v>0;){let E=s[S++],L=E.count,le=v>L?L:v;this.removeNUnitsFromGroup(t,E,le),v-=le}return m}addManaToPlayer(t,n){t.hero.addMana(n)}addItemToPlayer(t,n){this.events.dispatch(vi({player:t,item:n}))}removeItemFromPlayer(t,n){this.events.dispatch(un({player:t,item:n}))}createPlayerWithHero(t,n,o){return{color:t,hero:this.heroesService.createHero(n),resources:n.initialState.resources,type:o}}};e.\u0275fac=function(n){return new(n||e)(x(zr),x(Fe),x(X),x(xe))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var im=(()=>{let e=class e{constructor(t){this.playersService=t}getPlayerInfo(){return this.playersService.getEnemyPlayer()}getUnitGroups(){return this.playersService.getUnitGroupsOfPlayer(Oi.Neutral)}};e.\u0275fac=function(n){return new(n||e)(x(k))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var nm=(()=>{let e=class e{constructor(t){this.playersService=t}getPlayerInfo(){return this.playersService.getCurrentPlayer()}getUnitGroups(){return this.playersService.getUnitGroupsOfPlayer(Oi.Main)}};e.\u0275fac=function(n){return new(n||e)(x(k))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var ci=(()=>{let e=class e{constructor(t,n,o,s){this.playersService=t,this.unitGroups=n,this.gameObjectsManager=o,this.events=s,this.initialStructs=[],this.availableStructuresMap={}}initStructures(t){this.neutralPlayer=this.playersService.getNeutralPlayer(),this.initialStructs=t.map.structures,this.startingLocationId=t.map.startingLocId,this.playerCurrentLocId=this.gameObjectsManager.getObjectId(er,this.startingLocationId),this.viewStructures=this.createViewStructures(this.initialStructs),this.updateParentLinks(),this.updateAvailableStructures()}updateParentLinks(){this.viewStructures.forEach(t=>{this.viewStructures.filter(o=>t.pathTo===o.id).forEach(o=>t.parentStructs.add(o.id))})}updateAvailableStructures(){Object.keys(this.availableStructuresMap).forEach(t=>{this.viewStructures.filter(o=>[...o.parentStructs].find(s=>this.gameObjectsManager.getObjectByFullId(this.gameObjectsManager.getObjectId(er,s))?.visited)&&o.parentStructs.has(t)).forEach(o=>this.availableStructuresMap[o.id]=!0)})}createViewStructures(t){let n=t.map(o=>this.gameObjectsManager.createNewGameObject(er,{iconName:o.icon,x:o.x,y:o.y,generator:o.struct,guardingPlayer:void 0,isRoot:o.id===this.startingLocationId,pathTo:o.pathTo?this.gameObjectsManager.getObjectId(er,o.pathTo):void 0,actionPoints:o.actionPoints,structParams:o.structParams},o.id));return n.map(o=>{this.events.dispatch(Bo({structure:o}));let s=o.pathTo;if(o.isRoot&&(o.isRoot=!0,o.visited=!0,this.availableStructuresMap[o.id]=!0),s){let p=n.find(Si=>Si.id===o.pathTo);o.pathTo=s;let{x:m,y:v}=o,S=Math.min(m,p.x),E=Math.min(v,p.y),L=Math.max(m,p.x),he=Math.max(v,p.y)-E,$e=L-S;o.svg={x:S,y:E,height:he,width:$e,ox:p.x>m?$e:0,oy:p.y>v?he:0,tx:m<p.x?0:$e,ty:v<p.y?0:he};let Xt=o.generator;Xt?.generateGuard&&(o.guard=this.unitGroups.createUnitGroupFromGenModel(Xt.generateGuard({thisStruct:o})),o.guard.forEach(Si=>Si.assignOwnerPlayer(this.playersService.getNeutralPlayer())),o.guardingPlayer=this.playersService.getNeutralPlayer()),Xt?.generateReward&&(o.reward=Xt.generateReward())}return o})}};e.\u0275fac=function(n){return new(n||e)(x(k),x(Fe),x(xe),x(j))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var Da=(()=>{let e=class e{constructor(t){this.units=t}getTailUnitHealth(t){let{tailUnitHp:n}=t;return n===0?0:n===void 0?t.type.baseStats.health:n}getUnitGroupTotalHp(t){return(t.count-1)*t.type.baseStats.health+this.getTailUnitHealth(t)}getUnitGroupDamage(t,n=0){let s=t.type.baseStats.damageInfo,p=t.count,m=s.minDamage*t.count,v=s.maxDamage*t.count,S=n*(n>=0?.05:.035),E=m+m*S,L=v+v*S;return{attacker:t,attackingUnitsCount:p,minDamage:m,maxDamage:v,attackSuperiority:n,damageMultiplier:S,multipliedMinDamage:Math.round(E),multipliedMaxDamage:Math.round(L)}}getDetailedAttackInfo(t,n){let s=n.type.baseStats,p=t.getStats(),m=n.getStats(),v=p.finalAttack,S=m.finalDefence,E=v-S,L=this.getUnitGroupDamage(t,E),le=this.calcUnitCountLoss(L.multipliedMinDamage,s.health,n.count),he=this.calcUnitCountLoss(L.multipliedMaxDamage,s.health,n.count),$e=this.canGroupCounterattack(n);return K(D({},L),{attacked:n,originalAttackedCount:n.count,originalAttackersCount:t.count,enemyCanCounterattack:$e,minUnitCountLoss:le,maxUnitCountLoss:he})}getFinalDamageInfoFromDamageDetailedInfo(t){let n=q.randIntInRange(t.multipliedMinDamage,t.multipliedMaxDamage);return this.getFinalDamageInfo(t.attacked,n)}getFinalDamageInfo(t,n){let o=t,s=o.type.baseStats,p=t.count,m=this.getUnitGroupTotalHp(o),v=m-n,S=n>=m,E=v%s.health,L=S?0:E===0?s.health:E,le=Math.ceil(v/s.health),he=p-le;return{finalDamage:n,finalUnitLoss:he>t.count?t.count:he,finalTotalUnitLoss:he,tailHpLeft:L,isDamageFatal:n>=m}}dealPureDamageToUnitGroup(t,n){let o=this.getFinalDamageInfo(t,n);return t.addUnitsCount(-o.finalTotalUnitLoss),t.setTailUnitHp(o.tailHpLeft),o}calcUnitCountLoss(t,n,o){let s=Math.floor(t/n);return s>o?o:s}canGroupCounterattack(t){return!!t.type.defaultModifiers?.counterattacks}isUnitGroupRanged(t){return!!t.type.defaultModifiers?.isRanged}rollDamage(t){return q.randIntInRange(t.multipliedMinDamage,t.multipliedMaxDamage)}};e.\u0275fac=function(n){return new(n||e)(x(Fe))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var li=(()=>{let e=class e{constructor(t,n,o,s,p,m,v,S){this.playersService=t,this.heroes=n,this.unitGroups=o,this.players=s,this.spells=p,this.events=m,this.state=v,this.structures=S}getPlayerApi(){return{removeUnitTypeFromPlayer:(t,n,o)=>this.players.removeUnitTypeCountFromPlayer(t,n,o),playerHasResources:(t,n)=>this.players.playerHasResources(t,n),removeResourcesFromPlayer:(t,n)=>this.players.removeResourcesFromPlayer(t,n),addExperienceToPlayer:(t,n)=>{this.players.addExperienceToPlayer(t.id,n)},addUnitGroupToPlayer:(t,n,o)=>{let s=this.unitGroups.createUnitGroup(n,{count:o},t.hero);this.players.addUnitGroupToTypeStack(t,s)},addManaToPlayer:(t,n)=>{this.heroes.addManaToHero(t.hero,n)},addMaxManaToPlayer:(t,n)=>{t.hero.addStatsMods({heroMaxMana:n})},giveResourceToPlayer:(t,n,o)=>this.playersService.addResourceToPlayer(t,n,o),addSpellToPlayerHero:(t,n)=>{this.heroes.addSpellToHero(t.hero,n)},getCurrentPlayer:()=>this.playersService.getCurrentPlayer(),getCurrentPlayerUnitGroups:()=>this.playersService.getUnitGroupsOfPlayer(this.playersService.getCurrentPlayer().id),giveResourcesToPlayer:(t,n)=>this.playersService.addResourcesToPlayer(t,n)}}getSpellsApi(){return{createSpellInstance:(t,n)=>this.spells.createSpellInstance(t,n)}}getGameApi(){return{events:{dispatch:t=>{this.events.dispatch(t)}},players:this.getPlayerApi(),actions:{getMapStructures:()=>this.structures.viewStructures,getActionPointsLeft:()=>this.state.currentGame.actionPoints,scheduleAction:(t,n)=>{this.events.dispatch($n({action:t,dayOffset:n}))}}}}getGlobalEventsApi(){return{dispatch:t=>this.events.dispatch(t)}}};e.\u0275fac=function(n){return new(n||e)(x(k),x(zr),x(Fe),x(k),x(wn),x(j),x(X),x(ci))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var rm=(()=>{let e=class e extends ae(){constructor(t){super(),this.apiProvider=t,this.initTriggersFromTriggersRegistry()}initTriggersFromTriggersRegistry(){ir.registryMap.forEach((t,n)=>{t.forEach(o=>{this.events.onEvent(n).subscribe(s=>{o.fn(s,this.apiProvider.getGameApi())})})})}};e.\u0275fac=function(n){return new(n||e)(x(li))},e.\u0275prov=T({token:e,factory:e.\u0275fac,providedIn:"root"});let i=e;return i})();var ur=class ur extends ae(){constructor(e){super(),this.battleLog=e}clearLogOnFightStart(){this.battleLog.history=[]}logGroupDamagedByGroup({attackingGroup:e,attackedGroup:r,damage:t,loss:n,attackedCount:o,attackersCount:s,damageBlocked:p,lifeStolen:m,lifeStolenUnitsRestored:v,isCritical:S}){this.battleLog.logDealtDamageMessage({attacked:r.type,attackedPlayer:r.ownerPlayer,attackersNumber:s,attackedNumber:o,attacker:e.type,attackingPlayer:e.ownerPlayer,damage:t,damageBlocked:p,losses:n,stolenLife:m,stolenLifeUnitsRestored:v,isCritical:S})}logPlayerStartsTurn(e){this.battleLog.logRoundInfoMessage(`Player ${e.currentPlayer.type} starts his turn`)}logFightEnds(e){this.battleLog.logRoundInfoMessage(e.win?"Win!":"Defeat")}logNextRoundStarts(e){this.battleLog.logRoundInfoMessage(`Round ${e.round} starts`)}};ur.\u0275fac=function(r){return new(r||ur)(x(Ii))},ur.\u0275prov=T({token:ur,factory:ur.\u0275fac});var Ji=ur;_([J(Nt)],Ji.prototype,"clearLogOnFightStart",null);_([G(Gn)],Ji.prototype,"logGroupDamagedByGroup",null);_([G(ji)],Ji.prototype,"logPlayerStartsTurn",null);_([G(yi)],Ji.prototype,"logFightEnds",null);_([G(Lt)],Ji.prototype,"logNextRoundStarts",null);var dr=class dr extends ae(){constructor(e,r,t,n,o,s,p,m){super(),this.battleState=e,this.curPlayerState=r,this.strucuresService=t,this.playersService=n,this.vfx=o,this.state=s,this.historyLog=p,this.gameObjectsManager=m}beforeBattleInit(){this.applyStaticModsFromEquippedItems()}prepareFightState(){this.battleState.resetCurrentPlayer(),this.battleState.initNextTurnByQueue()}defendAction(){let e=this.battleState.currentUnitGroup;e.addCombatMods({fixedSpeed:5,heroBonusDefence:5,defending:!0}),this.battleState.resortFightQueue(!0),this.vfx.createDroppingMessageForContainer(e.id,{html:wi("Defending!",{width:80})},{duration:1e3}),this.historyLog.logSimpleMessage(`${e.count} ${e.type.name} choose to defend. Their speed is fixed to 5, and armor is increased by 5.`),this.battleState.initNextTurnByQueue()}recalcTurnQueue(){this.battleState.initNextTurnByQueue()}updatePlayerState({currentPlayer:e}){e.type===Dn.AI?(this.curPlayerState.setPlayerState(_e.WaitsForTurn),this.battleState.processAiPlayer()):this.curPlayerState.setPlayerState(_e.Normal)}updateQueueOnGroupTurnEnd(){this.battleState.initNextTurnByQueue(!0)}registerHealedUnits(e){e.healedUnitsCount&&this.battleState.registerPlayerUnitLoss(e.target,-e.healedUnitsCount)}registerUnitLossOnAnyOtherDamageSources({loss:e,unit:r}){this.battleState.registerPlayerUnitLoss(r,e)}checkIfFightEndedOnUnitGroupDeath(){let e=this.strucuresService.currentStruct,r=this.playersService.getCurrentPlayer(),t=this.battleState.getAliveUnitsOfPlayer(r);if(!t.length){this.playersService.getCurrentPlayer().hero.setUnitGroups(t),this.events.dispatch(yi({struct:e,win:!1}));return}let n=this.battleState.getEnemyOfPlayer(r);if(!this.battleState.getAliveUnitsOfPlayer(n).length){let o=this.battleState.getDeadUnitsOfPlayer(r),s=this.battleState.getSummonsOfPlayer(r),p=this.battleState.getDeadUnitsOfPlayer(n);[...o,...p,...s].forEach(S=>{this.gameObjectsManager.destroyObject(S)});let m=t.filter(S=>!S.modGroup.getModValue("isSummon")),v=this.playersService.getCurrentPlayer().hero;v.unitGroups.filter(S=>!S.fightInfo.isAlive).forEach(S=>{let E=v.getAllSlots().find(L=>L.unitGroup===S);E&&(E.unitGroup=null)}),v.setUnitGroups(m,!1),e.isInactive=!0,this.events.dispatch(yi({struct:e,win:!0}));return}}processAiPlayer(){this.battleState.currentPlayer.type===Dn.AI&&this.enemyHasAnyLivingUnits()&&this.battleState.processAiPlayer()}checkControlWhenGroupRunsOutOfTurns({groupHasMoreTurns:e,groupPlayer:r,groupStillAlive:t}){r.type===Dn.AI&&e&&t&&this.enemyHasAnyLivingUnits()&&this.battleState.processAiPlayer(),(!e||!t)&&this.events.dispatch(As({playerEndsTurn:r}))}updateFightQueryDueToSpeedChange(){this.battleState.resortFightQueue()}cleanUpHandlersOnFightEnd(){this.cleanupStaticModsFromEquippedItems(),this.events.dispatch(ks())}cleanUpHandlers(){this.state.eventHandlers.spells.removeAllHandlers()}enemyHasAnyLivingUnits(){return this.battleState.playerHasAnyAliveUnits(this.battleState.getEnemyOfPlayer(this.battleState.currentPlayer))}applyStaticModsFromEquippedItems(){this.playersService.getCurrentPlayer().hero.inventory.getEquippedItems().forEach(e=>{console.log(e);let r=e.baseType.staticEnemyMods;r&&this.playersService.getEnemyPlayer().hero.addCommonCombatMods(ft.fromMods(r))})}cleanupStaticModsFromEquippedItems(){this.playersService.getCurrentPlayer().hero.clearCommonCombatMods(),this.playersService.getEnemyPlayer().hero.clearCommonCombatMods()}};dr.\u0275fac=function(r){return new(r||dr)(x(vt),x(nt),x(ci),x(k),x(ai),x(X),x(Ii),x(xe))},dr.\u0275prov=T({token:dr,factory:dr.\u0275fac});var ct=dr;_([J(Do)],ct.prototype,"beforeBattleInit",null);_([J(Nt)],ct.prototype,"prepareFightState",null);_([J(vo)],ct.prototype,"defendAction",null);_([J(Lt)],ct.prototype,"recalcTurnQueue",null);_([G(ji)],ct.prototype,"updatePlayerState",null);_([J(As)],ct.prototype,"updateQueueOnGroupTurnEnd",null);_([G(Rn)],ct.prototype,"registerHealedUnits",null);_([G(yo)],ct.prototype,"registerUnitLossOnAnyOtherDamageSources",null);_([J(pn)],ct.prototype,"checkIfFightEndedOnUnitGroupDeath",null);_([J(fo)],ct.prototype,"processAiPlayer",null);_([G(mo)],ct.prototype,"checkControlWhenGroupRunsOutOfTurns",null);_([J(po)],ct.prototype,"updateFightQueryDueToSpeedChange",null);_([J(yi)],ct.prototype,"cleanUpHandlersOnFightEnd",null);_([J(ks)],ct.prototype,"cleanUpHandlers",null);var mr=class mr extends ae(){constructor(e){super(),this.combatInteractor=e}dispellAllUnitsOnStructCompleted(){this.combatInteractor.forEachUnitGroup(e=>this.combatInteractor.applyDispellToUnitGroup(e))}prepareSpellsOnFightStart(){this.combatInteractor.initAllUnitGroupSpells(),this.combatInteractor.resetAllUnitGroupsCooldowns()}startCombatInteraction(e){this.events.dispatch(cn({action:ni.GroupAttacks,attackedGroup:e.attackedGroup,attackingGroup:e.attackingGroup}))}processCombatInteraction(e){switch(e.action){case ni.GroupAttacks:this.combatInteractor.handleAttackInteraction(e);break;case ni.GroupCounterattacks:this.combatInteractor.handleAttackInteraction(e);break;case ni.AttackInteractionCompleted:let r=e.attackingGroup;this.events.dispatch(mo({group:r,groupPlayer:r.ownerPlayer,groupStillAlive:!!r.count,groupHasMoreTurns:!!r.turnsLeft}))}}resetCooldownsAndEmitNewRoundEventToSpells(e){this.combatInteractor.triggerEventForAllSpellsHandler(gn.NewRoundBegins({round:e.round})),this.combatInteractor.resetAllUnitGroupsCooldowns()}dispelUnitOnDeath(e){this.combatInteractor.applyDispellToUnitGroup(e.target)}addCombatModsToUnit({mods:e,unit:r}){r.addCombatMods(e)}removeCombatModsToUnit({mods:e,unit:r}){r.removeCombatMods(e)}};mr.\u0275fac=function(r){return new(r||mr)(x(Pn))},mr.\u0275prov=T({token:mr,factory:mr.\u0275fac});var pi=mr;_([J(Vi)],pi.prototype,"dispellAllUnitsOnStructCompleted",null);_([J(Nt)],pi.prototype,"prepareSpellsOnFightStart",null);_([G(Ni)],pi.prototype,"startCombatInteraction",null);_([G(cn)],pi.prototype,"processCombatInteraction",null);_([G(Lt)],pi.prototype,"resetCooldownsAndEmitNewRoundEventToSpells",null);_([G(pn)],pi.prototype,"dispelUnitOnDeath",null);_([G(ho)],pi.prototype,"addCombatModsToUnit",null);_([G(go)],pi.prototype,"removeCombatModsToUnit",null);var Ea=Oe,ul=rt({prefix:"Structure",events:{NewDayBegins:Ea(),NewWeekBegins:Ea(),StructVisited:Ea(),StructInspected:Ea()}}),qr=ul.events;var om=(()=>{let e=class e extends Tt{create({townBase:t}){this.base=t,this.initTownBuildings(),this.initUnitGrowthAndAvailability(),this.getApi().events.on(zi).subscribe(n=>{this.updateAvailableUnitsByWeeklyGrowth(),this.getApi().eventFeed.pushPlainMessage(`The army of ${this.base.name} has grown`)})}updateAvailableUnitsByWeeklyGrowth(){this.getHiringBuildings().forEach(t=>{let n=t.currentBuilding.activity;this.unitsAvailableMap[n.unitGrowthGroup]+=n.growth})}initTownBuildings(){this.buildings=Object.keys(this.base.availableBuildings).reduce((t,n)=>K(D({},t),{[n]:this.getApi().gameObjects.createNewGameObject(Td,{base:this.base.availableBuildings[n]})}),{})}initUnitGrowthAndAvailability(){let t=this.getHiringBuildings();this.growthMap=t.reduce((n,o)=>{let s=o.currentBuilding.activity,p=s.unitGrowthGroup;return n[p]=s.growth,n},{}),this.unitsAvailableMap=t.reduce((n,o)=>{let s=o.currentBuilding.activity;return n[s.unitGrowthGroup]=s.growth,n},{})}getHiringBuildings(){return Object.values(this.buildings).filter(t=>t.currentBuilding.activity?.type===it.Hiring)}};e.categoryId="town";let i=e;return i})();var dl=Oe,ml=rt({prefix:"Building",events:{NewDayBegins:dl(),NewWeekStarts:dl(),Built:dl()}}),ms=ml.events;var fr=class fr extends ae(){constructor(e,r,t,n,o,s,p,m){super(),this.battleState=e,this.structuresService=r,this.players=t,this.heroesService=n,this.state=o,this.eventFeedUiService=s,this.gameApiProvider=p,this.eventFeed=m,this.scheduledActions=[]}openMainScreenOnGameStart(){this.events.dispatch(Vn())}initializeGameMap(e){this.state.mapsState={currentMap:e.map,maps:[e.map]},this.structuresService.initStructures(e)}initPlayersOnGameStart(){let e=this.players.createPlayer(Oi.Main,this.players.createPlayerWithHero(this.state.createdGame.selectedColor,this.state.createdGame.selectedHero,Dn.Player)),r=this.players.createPlayer(Oi.Neutral,{color:On.GRAY,type:Dn.AI,hero:this.heroesService.createNeutralHero(),resources:D({},Ei)});e.hero.assignOwnerPlayer(e),r.hero.assignOwnerPlayer(r),e.hero.unitGroups.forEach(t=>t.assignOwnerHero(e.hero)),r.hero.unitGroups.forEach(t=>t.assignOwnerHero(r.hero)),this.state.gameState={players:[e,r],currentPlayer:e,playersMap:new Map([[e.id,e],[r.id,r]])},this.events.dispatch($i({})),this.events.dispatch(Rr.PrepareGameEvent({gameMode:$o.Normal,selectedFaction:this.state.createdGame.faction})),this.events.dispatch(Gr())}notifyBuildingsNewDayStarted(){this.state.eventHandlers.buildings.triggerAllHandlersByEvent(ms.NewDayBegins()),this.state.eventHandlers.structures.triggerAllHandlersByEvent(qr.NewDayBegins());let e=this.state.currentGame.globalDay;this.scheduledActions.filter(t=>t.day===e).forEach(t=>t.action()),this.scheduledActions=this.scheduledActions.filter(t=>t.day!==e)}pushEventFeedMessage(e){this.eventFeedUiService.pushEventFeedMessage(e)}pushPlainEventFeedMessage(e){this.eventFeedUiService.pushEventFeedMessage({message:[{type:mi.FreeHtml,htmlContent:e.message}],delay:e.delay})}addActionCardsToPlayer(e){this.eventFeedUiService.pushPlainMessage(`Received action cards:<hr> ${e.actionCardStacks.map(({card:r,count:t})=>`x${no(t)} ${Kn(r)}`).join("<br>")}`),e.actionCardStacks.forEach(({card:r,count:t})=>{e.player.addActionCards(r,t)})}activateActionCard({player:e,cardStack:r}){console.log(r);let t=r.card;r.count--,t.actionPoints&&this.events.dispatch(jt({points:t.actionPoints})),r.count||q.removeItem(e.actionCards,r),this.eventFeed.pushPlainMessage(`${Kn(t)} is used. Left: ${no(r.count)}`),t.type===tt.PlayerAction&&t.config?.onUsedInstantly?.(this.gameApiProvider.getGameApi())}notifyBuildignsNewWeekStarted(e){this.eventFeedUiService.pushPlainMessage(`Week ${e.week} started`),this.state.eventHandlers.buildings.triggerAllHandlersByEvent(ms.NewWeekStarts()),this.state.eventHandlers.structures.triggerAllHandlersByEvent(qr.NewWeekBegins())}scheduleAction(e){this.scheduledActions.push({action:e.action,day:this.state.currentGame.globalDay+e.dayOffset})}openMapScreenWhenPlayerLeavesTown(){this.events.dispatch(Gr())}initFight(e){this.state.currentBattleState={currentPlayer:this.state.gameState.currentPlayer,enemyPlayer:e.struct.guardingPlayer}}fightStartInitQueue({players:e,unitGroups:r}){this.events.dispatch(Do()),this.battleState.initBattleState(r,e),this.events.dispatch(Nt({}))}onStructSelected(e){this.structuresService.currentStruct=e.struct}};fr.\u0275fac=function(r){return new(r||fr)(x(vt),x(ci),x(k),x(zr),x(X),x(Xi),x(li),x(Xi))},fr.\u0275prov=T({token:fr,factory:fr.\u0275fac});var lt=fr;_([J(Co)],lt.prototype,"openMainScreenOnGameStart",null);_([G(Rr.GamePreparationFinished)],lt.prototype,"initializeGameMap",null);_([J(wo)],lt.prototype,"initPlayersOnGameStart",null);_([J(Io)],lt.prototype,"notifyBuildingsNewDayStarted",null);_([G(qn)],lt.prototype,"pushEventFeedMessage",null);_([G(Ci)],lt.prototype,"pushPlainEventFeedMessage",null);_([G(Wi)],lt.prototype,"addActionCardsToPlayer",null);_([G(Yn)],lt.prototype,"activateActionCard",null);_([G(zi)],lt.prototype,"notifyBuildignsNewWeekStarted",null);_([G($n)],lt.prototype,"scheduleAction",null);_([J(xo)],lt.prototype,"openMapScreenWhenPlayerLeavesTown",null);_([G(Hn)],lt.prototype,"initFight",null);_([G(Po)],lt.prototype,"fightStartInitQueue",null);_([G(Bn)],lt.prototype,"onStructSelected",null);var hr=class hr extends ae(){constructor(e){super(),this.itemsService=e}triggerEventsForItems(e){this.itemsService.triggerEventForAllItemsHandlers(Bc.NewRoundBegins({round:e.round}))}trigger(){this.itemsService.triggerEventForAllItemsHandlers(Bc.NewRoundBegins({round:0}))}};hr.\u0275fac=function(r){return new(r||hr)(x(Ai))},hr.\u0275prov=T({token:hr,factory:hr.\u0275fac});var Yr=hr;_([G(Lt)],Yr.prototype,"triggerEventsForItems",null);_([J(Nt)],Yr.prototype,"trigger",null);var gr=class gr extends ae(){constructor(e,r,t){super(),this.curPlayerState=e,this.itemsService=r,this.state=t}resetCooldowns(){this.curPlayerState.resetSpellsCooldowns()}addItemToPlayer({item:e,player:r}){let t=r.hero;t.addItem(e),t.inventory.isSlotEquipped(e.baseType.slotType)||this.events.dispatch(jn({item:e,player:r}))}removeItemFromPlayer({item:e,player:r}){r.hero.removeItem(e)}equipItem({item:e,player:r}){r.hero.equipItem(e),this.itemsService.registerItemsEventHandlers(e,r)}unequipItem({player:e,item:r}){e.hero.unequipItem(r),this.state.eventHandlers.items.removeAllHandlersForRef(r)}};gr.\u0275fac=function(r){return new(r||gr)(x(nt),x(Ai),x(X))},gr.\u0275prov=T({token:gr,factory:gr.\u0275fac});var en=gr;_([J(Lt),J(Nt)],en.prototype,"resetCooldowns",null);_([G(vi)],en.prototype,"addItemToPlayer",null);_([G(Nn)],en.prototype,"removeItemFromPlayer",null);_([G(jn)],en.prototype,"equipItem",null);_([G(un)],en.prototype,"unequipItem",null);var yr=class yr extends ae(){constructor(e,r,t){super(),this.structuresService=e,this.state=r,this.gameObjectsManager=t}removeActionPoints({points:e}){let r=this.state.currentGame;r.actionPoints-=e,r.actionPoints<=0&&(r.day+=1,r.globalDay+=1,r.actionPoints+=4,this.events.dispatch(Io({day:r.day})),r.day%7===0&&(r.week+=1,r.day=1,this.events.dispatch(zi({week:r.week}))))}handleCompletedStructure(e){let r=e.struct.id;this.structuresService.availableStructuresMap[r]=!0,this.gameObjectsManager.getObjectByFullId(r).visited=!0,this.structuresService.playerCurrentLocId=r,this.structuresService.updateAvailableStructures(),this.events.dispatch(jt({points:e.struct.actionPoints}))}panMapCamera(e){this.state.mapCamera.x=e.x,this.state.mapCamera.y=e.y}};yr.\u0275fac=function(r){return new(r||yr)(x(ci),x(X),x(xe))},yr.\u0275prov=T({token:yr,factory:yr.\u0275fac});var vr=yr;_([G(jt)],vr.prototype,"removeActionPoints",null);_([G(Vi)],vr.prototype,"handleCompletedStructure",null);_([G(dn)],vr.prototype,"panMapCamera",null);var Cr=class Cr extends ae(){constructor(e,r,t,n,o){super(),this.combatInteractor=e,this.actionHint=r,this.curPlayerState=t,this.cardsMapping=n,this.popupService=o}handleEnemyCardClick(e){let r=this.curPlayerState.playerCurrentState;if(r===_e.Normal){this.events.dispatch(Ni({attackedGroup:e.attackedGroup,attackingGroup:e.attackingGroup}));return}r===_e.SpellTargeting&&(this.curPlayerState.onCurrentSpellCast(),this.events.dispatch(co({player:e.attackingPlayer,spell:this.curPlayerState.currentSpell,target:e.attackedGroup})),this.curPlayerState.setSpellsOnCooldown())}handleAllyGroupClick(e){if(this.curPlayerState.playerCurrentState===_e.SpellTargeting){this.curPlayerState.onCurrentSpellCast();let r=e.unitGroup;this.events.dispatch(co({player:r.ownerPlayer,spell:this.curPlayerState.currentSpell,target:r})),this.curPlayerState.setSpellsOnCooldown()}}handlePlayerHover(e){switch(e.hoverType){case gt.EnemyCard:if(this.curPlayerState.playerCurrentState===_e.Normal&&this.combatInteractor.setDamageHintMessageOnCardHover(e),this.curPlayerState.playerCurrentState===_e.SpellTargeting){let r={type:Hi.OnTargetSpell,spell:this.curPlayerState.currentSpell,target:e.hoveredCard};this.actionHint.hintMessage$.next(r)}break;case gt.AllyCard:if(this.curPlayerState.playerCurrentState===_e.SpellTargeting){let r={type:Hi.OnTargetSpell,spell:this.curPlayerState.currentSpell,target:e.hoveredCard};this.actionHint.hintMessage$.next(r)}break;case gt.Unhover:this.actionHint.hintMessage$.next(null)}}handleRightClick(e){this.events.dispatch(mn({unitGroup:e.unitGroup}))}displayUnitGroupInfo(e){an.logObjectsOnRightClick&&console.log("show info for:",e),this.popupService.createBasicPopup({data:{unitGroup:e.unitGroup},component:cs,isCloseable:!0,class:"small-padding"})}disableActionHintOnEnemyTurn(e){e.currentPlayer!==this.curPlayerState.currentPlayer?this.actionHint.disableActionHint$.next(!0):this.actionHint.disableActionHint$.next(!1)}enableActionHint(){this.actionHint.disableActionHint$.next(!1)}playerTargetsSpell(e){this.combatInteractor.triggerEventForSpellHandler(e.spell,gn.PlayerTargetsSpell({target:e.target})),this.curPlayerState.setPlayerState(_e.Normal),this.curPlayerState.resetCurrentSpell()}playerUsesInstantSpell(e){this.combatInteractor.triggerEventForSpellHandler(e.spell,gn.PlayerCastsInstantSpell({player:e.player,spell:e.spell}))}};Cr.\u0275fac=function(r){return new(r||Cr)(x(Pn),x(Sn),x(nt),x(Br),x(oi))},Cr.\u0275prov=T({token:Cr,factory:Cr.\u0275fac});var Zt=Cr;_([G(Lo)],Zt.prototype,"handleEnemyCardClick",null);_([G(No)],Zt.prototype,"handleAllyGroupClick",null);_([G(Di)],Zt.prototype,"handlePlayerHover",null);_([G(jo)],Zt.prototype,"handleRightClick",null);_([G(mn)],Zt.prototype,"displayUnitGroupInfo",null);_([G(ji)],Zt.prototype,"disableActionHintOnEnemyTurn",null);_([J(yi)],Zt.prototype,"enableActionHint",null);_([G(co)],Zt.prototype,"playerTargetsSpell",null);_([G(lo)],Zt.prototype,"playerUsesInstantSpell",null);var wr=class wr extends ae(){constructor(e,r,t,n,o,s,p,m,v,S,E,L,le){super(),this.combatInteractor=e,this.vfxService=r,this.battleState=t,this.spellsService=n,this.units=o,this.battleLog=s,this.players=p,this.itemsService=m,this.apiProvider=v,this.state=S,this.gameObjectsManager=E,this.eventFeed=L,this.structures=le}initPlayerItems(){let e=this.players.getCurrentPlayer();e.hero.base.initialState.items.forEach(r=>{this.events.dispatch(vi({player:e,item:this.itemsService.createItem(r)}))})}initSpell({spell:e,player:r,ownerUnit:t}){let n=e.baseType;n.config.flags?.isAura||n.config.spellConfig.init({actions:this.createActionsApiRef(),events:{on:o=>{Object.entries(o).forEach(([s,p])=>{let m=Gc.getEventByName(s);this.state.eventHandlers.spells.registerHandlerByRef(e,m,p)})}},vfx:{createEffectForUnitGroup:(o,s,p)=>{this.vfxService.createVfxForUnitGroup(o,{type:Yi.VfxElement,animation:s},p)},createFloatingMessageForUnitGroup:(o,s,p)=>{this.vfxService.createFloatingMessageForUnitGroup(o,s,p)},createDroppingMessageForUnitGroup:(o,s,p)=>{this.vfxService.createDroppingMessageForContainer(o,s,p)}},thisSpell:e.baseType,ownerPlayer:r,spellInstance:e,ownerHero:r.hero,ownerUnit:t})}initItem({item:e,ownerPlayer:r}){e.baseType.config.init({actions:this.createActionsApiRef(),events:{on:t=>{Object.entries(t).forEach(([n,o])=>{let s=Uc.getEventByName(n);this.state.eventHandlers.items.registerHandlerByRef(e,s,o)})}},ownerHero:r.hero,ownerPlayer:r,thisInstance:e})}initBuilding({building:e,player:r}){this.state.eventHandlers.buildings.removeAllHandlersForRef(e),e.currentBuilding.config?.init({players:this.apiProvider.getPlayerApi(),localEvents:{on:t=>{Object.entries(t).forEach(([n,o])=>{let s=ml.getEventByName(n);this.state.eventHandlers.buildings.registerHandlerByRef(e,s,o)})}},globalEvents:this.apiProvider.getGlobalEventsApi(),thisBuilding:e,gameObjects:this.gameObjectsManager})}initStructureGameObject({structure:e}){e.generator?.config?.init({structures:{updateAvailableLocations:()=>this.structures.updateAvailableStructures(),markLocationVisited:r=>{r.visited=!0,this.structures.updateAvailableStructures()}},players:this.apiProvider.getPlayerApi(),thisStruct:e,localEvents:{on:r=>{Object.entries(r).forEach(([t,n])=>{let o=ul.getEventByName(t);this.state.eventHandlers.structures.registerHandlerByRef(e,o,n)})}},eventFeed:{postEventFeedMessage:r=>this.eventFeed.pushEventFeedMessage(r),pushPlainMessage:r=>this.eventFeed.pushPlainMessage(r)},spells:this.apiProvider.getSpellsApi()})}initializeGameObjectApi(e){let r=e.gameObject;r.api={spells:this.apiProvider.getSpellsApi(),events:{on:t=>this.events.onEvent(t),dispatch:t=>this.events.dispatch(t)},gameObjects:this.gameObjectsManager,eventFeed:{postEventFeedMessage:t=>{this.eventFeed.pushEventFeedMessage(t)},pushPlainMessage:t=>this.eventFeed.pushPlainMessage(t)}}}createActionsApiRef(){return{getUnitsFromFightQueue:()=>this.battleState.getFightQueue(),removeTurnsFromUnitGroup:(e,r=e.turnsLeft)=>{e.turnsLeft-=r,e.turnsLeft<0&&(e.turnsLeft=0),this.battleState.removeUnitsWithoutTurnsFromFightQueue()},unitGroupAttack:(e,r)=>this.events.dispatch(Ni({attackingGroup:e,attackedGroup:r})),getCurrentUnitGroup:()=>this.battleState.currentUnitGroup,summonUnitsForPlayer:(e,r,t)=>{let n=this.battleState.summonUnitForPlayer(e,r,t);return this.events.dispatch(uo({unitGroup:n})),n},dealDamageTo:(e,r,t,n)=>{this.combatInteractor.dealDamageTo(e,r,t,n)},createSpellInstance:(e,r)=>this.spellsService.createSpellInstance(e,r),addModifiersToUnitGroup:(e,r)=>{this.units.addModifierToUnitGroup(e,r),r.unitGroupSpeedBonus&&this.events.dispatch(po({unitGroup:e})),this.events.dispatch(Fs({unitGroup:e}))},createModifiers:e=>this.spellsService.createModifiers(e),removeModifiresFromUnitGroup:(e,r)=>{this.units.removeModifiers(e,r),this.events.dispatch(Fs({unitGroup:e}))},addSpellToUnitGroup:(e,r,t)=>{this.combatInteractor.addSpellToUnitGroup(e,r,t)},removeSpellFromUnitGroup:(e,r)=>{this.combatInteractor.removeSpellFromUnitGroup(e,r)},getUnitGroupsOfPlayer:e=>this.battleState.heroesUnitGroupsMap.get(e),getAliveUnitGroupsOfPlayer:e=>this.battleState.getAliveUnitsOfPlayer(e),getRandomEnemyPlayerGroup:()=>this.combatInteractor.getRandomEnemyUnitGroup(),getEnemyOfPlayer:e=>this.battleState.getEnemyOfPlayer(e),historyLog:e=>{this.battleLog.logSimpleMessage(e)},healUnit:(e,r)=>{let t=this.units.healUnit(e,r);return this.events.dispatch(Rn({target:e,healedUnitsCount:t.revivedUnitsCount})),t}}}};wr.\u0275fac=function(r){return new(r||wr)(x(Pn),x(ai),x(vt),x(wn),x(Fe),x(Ii),x(k),x(Ai),x(li),x(X),x(xe),x(Xi),x(ci))},wr.\u0275prov=T({token:wr,factory:wr.\u0275fac});var ki=wr;_([J($i)],ki.prototype,"initPlayerItems",null);_([G(Go)],ki.prototype,"initSpell",null);_([G(Ro)],ki.prototype,"initItem",null);_([G(Uo)],ki.prototype,"initBuilding",null);_([G(Bo)],ki.prototype,"initStructureGameObject",null);_([G(ko)],ki.prototype,"initializeGameObjectApi",null);var V0=["mapCanvas"],z0=["underlay"],Qr=class Qr extends ae(){constructor(e,r,t){super(),this.state=e,this.ngZone=r,this.renderer=t,this.hostElem=Or(),this.mapDragEvent=new Ct,this.cellSize=0,this.windowWidth=0,this.windowHeight=0,this.windowWidthHalf=0,this.windowHeightHalf=0,this.mapTotalWidth=0,this.mapTotalHeight=0,this.offsetX=0,this.offsetY=0}ngOnInit(){this.canvasElem=this.mapCanvasRef.nativeElement,this.canvasCtx=this.canvasElem.getContext("2d"),this.underlayElem=this.underlayRef.nativeElement,this.currentMap=this.state.mapsState.currentMap,this.renderMapCellsGrid(),this.setupWindowResizingHandling(),this.setupMapDragging(),this.resetCanvasPosition()}onMapClick(e){gp()&&console.log({id:"new-id",x:e.clientX-this.offsetX,y:e.clientY-this.offsetY,icon:"sword"})}panCameraCenterTo(e){console.log("[Map View]: Pan camera center to",e);let r=-(e.x-this.windowWidthHalf),t=-(e.y-this.windowHeightHalf);this.setMapElementsPosition(r,t),this.mapDragEvent.emit({finalPosX:r,finalPosY:t})}setupMapDragging(){this.ngZone.runOutsideAngular(()=>{Dt(this.hostElem,"mousedown").pipe(Vl(e=>{let r=e,t=parseInt(this.canvasElem.style.left),n=parseInt(this.canvasElem.style.top);return Dt(window,"mousemove").pipe(Ri(o=>{let s=o;return{xDragOffset:s.clientX-r.clientX,yDragOffset:s.clientY-r.clientY,mapPosX:t,mapPosY:n}}),Xe($l(Dt(window,"mouseup"),Dt(window,"onfocusout")).pipe(Mr(1))))}),this.untilDestroyed).subscribe(e=>{let r=this.windowWidthHalf,t=this.windowHeightHalf,n=e.mapPosX+e.xDragOffset,o=e.mapPosY+e.yDragOffset,s=n,p=o;n>r?s=r:n<-(this.mapTotalWidth-r)&&(s=-(this.mapTotalWidth-r)),o>t?p=t:o<-(this.mapTotalHeight-t)&&(p=-(this.mapTotalHeight-t)),this.state.mapCamera.x=s*-1+r,this.state.mapCamera.y=p*-1+t,this.setMapElementsPosition(s,p),this.mapDragEvent.emit({finalPosX:s,finalPosY:p})})})}setMapElementsPosition(e,r){this.offsetX=e,this.offsetY=r,this.renderer.setStyle(this.canvasElem,"left",`${e}px`),this.renderer.setStyle(this.canvasElem,"top",`${r}px`)}resetCanvasPosition(){this.offsetX=0,this.offsetY=0,this.renderer.setStyle(this.canvasElem,"left","0px"),this.renderer.setStyle(this.canvasElem,"top","0px")}renderMapCellsGrid(){let{heightInCells:e,widthInCells:r,cellSize:t}=this.currentMap.mapSize;this.cellSize=t;let n=r*t,o=e*t;this.mapTotalWidth=n,this.mapTotalHeight=o,this.canvasElem.width=n,this.canvasElem.height=o;let s=this.canvasCtx;for(let p=0;p<=e;p++)s.moveTo(0,p*t),s.lineTo(n,p*t);for(let p=0;p<=r;p++)s.moveTo(p*t,0),s.lineTo(p*t,o);s.setLineDash([5,8]),s.lineWidth=.5,s.strokeStyle="gray",s.stroke()}setupWindowResizingHandling(){this.updateWindowSizeData(),this.updateUnderlaySize(),this.ngZone.runOutsideAngular(()=>{Dt(window,"resize").pipe(this.untilDestroyed).subscribe(()=>{this.updateWindowSizeData(),this.updateUnderlaySize(),this.panCameraCenterTo(this.state.mapCamera)})})}updateWindowSizeData(){this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.windowWidthHalf=this.windowWidth/2,this.windowHeightHalf=this.windowHeight/2}updateUnderlaySize(){this.renderer.setStyle(this.underlayElem,"width",`${this.windowWidth}px`),this.renderer.setStyle(this.underlayElem,"height",`${this.windowHeight}px`)}};Qr.\u0275fac=function(r){return new(r||Qr)(y(X),y(Jt),y(Le))},Qr.\u0275cmp=C({type:Qr,selectors:[["mw-map-canvas"]],viewQuery:function(r,t){if(r&1&&(Pe(V0,7),Pe(z0,7)),r&2){let n;De(n=Ee())&&(t.mapCanvasRef=n.first),De(n=Ee())&&(t.underlayRef=n.first)}},outputs:{mapDragEvent:"mapDragEvent"},features:[N],decls:4,vars:0,consts:[["underlay",""],["mapCanvas",""],[1,"underlay"],[3,"click"]],template:function(r,t){if(r&1){let n=R();h(0,"div",2,0),a(2,"canvas",3,1),w("click",function(s){return A(n),O(t.onMapClick(s))}),c()}},styles:[".underlay[_ngcontent-%COMP%]{background-color:#e9e9e9;z-index:-3;position:absolute;-webkit-user-select:none;user-select:none}canvas[_ngcontent-%COMP%]{position:absolute;background:#f5f5f5;z-index:-2;-webkit-user-select:none;user-select:none}"]});var Kr=Qr;_([G(dn)],Kr.prototype,"panCameraCenterTo",null);var Rt=(()=>{let e=class e{constructor(t){this.actionHint=t,this.mwActionHint=""}ngOnDestroy(){this.actionHint.hintMessage$.next(null)}showHint(){this.actionHint.hintMessage$.next({type:Hi.CustomHtml,html:this.mwActionHint})}hideHint(){this.actionHint.hintMessage$.next(null)}};e.\u0275fac=function(n){return new(n||e)(y(Sn))},e.\u0275dir=Re({type:e,selectors:[["","mwActionHint",""]],hostBindings:function(n,o){n&1&&w("mouseenter",function(){return o.showHint()})("mouseleave",function(){return o.hideHint()})},inputs:{mwActionHint:"mwActionHint"}});let i=e;return i})();function q0(i,e){if(i&1&&(a(0,"div",2),d(1),c()),i&2){let r=f();l(),M(" ",r.struct.actionPoints,`
`)}}var fl=(()=>{let e=class e{constructor(){this.isAvailable=!1,this.isCurrentLoc=!1,this.activeLocColor="",this.structSelected=new Ct}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-map-structure"]],inputs:{struct:"struct",isAvailable:"isAvailable",isCurrentLoc:"isCurrentLoc",activeLocColor:"activeLocColor"},outputs:{structSelected:"structSelected"},decls:2,vars:13,consts:[[1,"struct-icon",3,"click","mwActionHint","icon"],["class","loc-action-points",4,"ngIf"],[1,"loc-action-points"]],template:function(n,o){n&1&&(a(0,"mw-ra-icon",0),w("click",function(){return o.structSelected.emit(o.struct)}),c(),g(1,q0,2,1,"div",1)),n&2&&($("border-color",o.isCurrentLoc?o.activeLocColor:"rgb(90, 90, 90)"),pe("available",o.isAvailable&&!o.struct.visited)("completed",o.struct.visited)("disabled",!o.isAvailable)("guards",o.struct.guard&&!o.struct.visited&&o.isAvailable),u("mwActionHint",(o.struct.guard&&o.isAvailable&&!o.struct.visited?"Attack the guard of ":"")+o.struct.name+(o.struct.visited?"<hr/>Visited":o.struct.actionPoints?"<hr/>Cost: "+o.struct.actionPoints+" action points":""))("icon",o.struct.icon),l(),u("ngIf",o.isAvailable&&!o.struct.visited&&o.struct.actionPoints))},dependencies:[re,Rt,ue],styles:[".struct-icon[_ngcontent-%COMP%]{position:absolute;cursor:pointer;z-index:50;transform:translate(-50%,-50%) scale(1.2);text-align:center;font-size:20px;border:4px solid rgb(90,90,90);background-color:gray;color:#fff;border-radius:50%;width:20px;height:20px;display:block;filter:brightness(1)}.struct-icon[_ngcontent-%COMP%]:hover{filter:brightness(1);transition:.4s;transform:translate(-50%,-50%) scale(1.4)}.available[_ngcontent-%COMP%]{outline:4px solid rgba(151,133,27,.28)}.struct-icon.disabled[_ngcontent-%COMP%]{filter:brightness(.7)}.struct-icon[_ngcontent-%COMP%]:not(.disabled) ~ .path-line[_ngcontent-%COMP%]{opacity:1}.struct-icon[_ngcontent-%COMP%]:hover ~ .path-line[_ngcontent-%COMP%] > .line[_ngcontent-%COMP%]{stroke-width:7;animation:pathanim 2s linear infinite}.structure[_ngcontent-%COMP%]{width:100px;margin:10px;border-radius:6px;background:gray;color:#fff;padding:14px;cursor:pointer}.inactive[_ngcontent-%COMP%]{opacity:.5}.loc-action-points[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;z-index:50;position:relative;background:#4d4d4d;width:14px;height:14px;border-radius:50%;font-size:11px;text-align:center;color:#fff;border:2px solid;top:7px;left:5px}"]});let i=e;return i})();var Q0=["locationsContainer"];function K0(i,e){if(i&1){let r=R();a(0,"mw-map-canvas",6),w("mapDragEvent",function(n){A(r);let o=f();return O(o.updateLocationsPosition(n))}),c()}}function Z0(i,e){if(i&1&&(a(0,"div",8)(1,"span",12),d(2),c()()),i&2){let r=f().$implicit;$("left",r.x,"px")("top",r.y,"px"),l(2),M(" ",r.id," ")}}function X0(i,e){if(i&1&&(Kl(),a(0,"svg",13),h(1,"line",14),c()),i&2){let r=f().$implicit;$("left",r.svg.x,"px")("top",r.svg.y,"px"),Ha("width",r.svg.width)("height",r.svg.height),l(),Ha("x1",r.svg.ox)("y1",r.svg.oy)("x2",r.svg.tx)("y2",r.svg.ty)}}function J0(i,e){if(i&1){let r=R();a(0,"div",7)(1,"div",8)(2,"mw-map-structure",9),w("structSelected",function(n){A(r);let o=f();return O(o.onStructureSelected(n))}),c()(),g(3,Z0,3,5,"div",10)(4,X0,2,10,"svg",11),c()}if(i&2){let r=e.$implicit,t=f();l(),$("left",r.x,"px")("top",r.y,"px"),l(),u("struct",r)("isAvailable",t.structsService.availableStructuresMap[r.id])("isCurrentLoc",t.structsService.playerCurrentLocId===r.id)("activeLocColor",t.state.createdGame.selectedColor),l(),u("ngIf",t.isLocIdVisible),l(),u("ngIf",r.svg)}}var hl=(()=>{let e=class e extends ae(){constructor(t,n,o,s,p){super(),this.playersService=t,this.state=n,this.structsService=o,this.renderer=s,this.gameObjectsManager=p,this.isLocIdVisible=an.showLocationsIds,this.player=this.playersService.getCurrentPlayer(),ya(()=>{this.state.mainMenu.isOpen||this.events.dispatch(Wn())})}ngAfterViewInit(){if(this.state.mapCamera.cameraInitialized){let{x:o,y:s}=this.state.mapCamera;this.events.dispatch(dn({x:o,y:s}));return}let t=this.state.mapsState.currentMap.startingLocId,n=this.gameObjectsManager.getObjectById(er,t);n?this.events.dispatch(dn({x:n.x,y:n.y})):console.warn(`[Map View]: Couldn't find location with id ${t} to pan camera center on game start`),this.state.mapCamera.cameraInitialized=!0}updateLocationsPosition(t){let n=this.locationsRef.nativeElement;this.renderer.setStyle(n,"left",`${t.finalPosX}px`),this.renderer.setStyle(n,"top",`${t.finalPosY}px`)}onStructureSelected(t){!this.structsService.availableStructuresMap[t.id]||!t.generator||t.isInactive||(t.guard&&this.playersService.getEnemyPlayer().hero.setUnitGroups(t.guard),this.events.dispatch(Bn({struct:t})))}};e.\u0275fac=function(n){return new(n||e)(y(k),y(X),y(ci),y(Le),y(xe))},e.\u0275cmp=C({type:e,selectors:[["mw-structures-view"]],viewQuery:function(n,o){if(n&1&&Pe(Q0,5),n&2){let s;De(s=Ee())&&(o.locationsRef=s.first)}},features:[N],decls:7,vars:2,consts:[["locationsContainer",""],[3,"mapDragEvent",4,"ngIf"],[1,"map-view"],["class","struct",4,"ngFor","ngForOf"],[1,"player-info-panel"],[1,"player-actions"],[3,"mapDragEvent"],[1,"struct"],[2,"position","absolute"],[3,"structSelected","struct","isAvailable","isCurrentLoc","activeLocColor"],["style","position: absolute;",3,"left","top",4,"ngIf"],["class","path-line","version","1.1","xmlns","http://www.w3.org/2000/svg",3,"left","top",4,"ngIf"],[1,"loc-name"],["version","1.1","xmlns","http://www.w3.org/2000/svg",1,"path-line"],["stroke-dasharray","10, 13",1,"line"]],template:function(n,o){n&1&&(g(0,K0,1,0,"mw-map-canvas",1),a(1,"div",2,0),g(3,J0,5,10,"div",3),c(),h(4,"mw-player-info-panel",4)(5,"mw-action-hint")(6,"mw-player-map-actions-panel",5)),n&2&&(u("ngIf",o.state.settings.mapDebug),l(3),u("ngForOf",o.structsService.viewStructures))},dependencies:[z,re,xn,ss,ar,fl,Kr],styles:[".map-view[_ngcontent-%COMP%]{height:0;width:0;position:absolute;left:0;top:0;z-index:-1}@keyframes _ngcontent-%COMP%_pathanim{0%{stroke-dashoffset:0}to{stroke-dashoffset:-23}}.path-line[_ngcontent-%COMP%]{position:absolute;opacity:.4;transition:.4s;overflow:visible;min-width:15px;pointer-events:none}.struct[_ngcontent-%COMP%]:hover   .path-line[_ngcontent-%COMP%]{opacity:.6}.struct[_ngcontent-%COMP%]:hover   .path-line[_ngcontent-%COMP%] > .line[_ngcontent-%COMP%]{stroke-width:7;animation:_ngcontent-%COMP%_pathanim 2s linear infinite}.line[_ngcontent-%COMP%]{stroke:#000;stroke-width:5;stroke-dashoffset:0;opacity:.6}.guards[_ngcontent-%COMP%]{font-size:13px}.player-info-panel[_ngcontent-%COMP%]{position:fixed;left:0;bottom:0}.player-actions[_ngcontent-%COMP%]{position:fixed;left:70px;top:50%;display:flex;flex-direction:column;transform:translateY(-50%)}mw-action-hint[_ngcontent-%COMP%]{position:fixed;top:90%;left:0;right:0;font-size:13px}.loc-name[_ngcontent-%COMP%]{position:relative;left:-50%;background:#525252;text-align:center;color:#fff;display:block;font-size:9px;padding:2px;border-radius:3px;top:12px;z-index:100000}"]});let i=e;return i})();var Zr=(()=>{let e=class e{transform(t){return Ne(t)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275pipe=Ui({name:"entity",type:e,pure:!0});let i=e;return i})();function ty(i,e){if(i&1&&(a(0,"div",11)(1,"div"),d(2),c(),a(3,"div"),d(4),c()()),i&2){let r=e.$implicit;l(2),B(r.key),l(2),B(r.value)}}function iy(i,e){if(i&1){let r=R();a(0,"div",7)(1,"div"),d(2),ie(3,"entity"),c(),a(4,"div"),d(5),c(),a(6,"input",8),w("input",function(n){let o=A(r).$implicit,s=f();return O(s.updateCountForGroup(o,n))}),c(),a(7,"div"),d(8,"Cost:"),c(),a(9,"div",9),g(10,ty,5,2,"div",10),ie(11,"keyvalue"),c()()}if(i&2){let r=e.$implicit;l(2),B(ne(3,6,r.hire.unitTypeId).name),l(3),B(r.count),l(),u("min",0)("max",r.hire.maxCount)("value",0),l(4),u("ngForOf",ne(11,8,r.currentCost))}}function ny(i,e){i&1&&(a(0,"div"),d(1,"You don't have enough free slots in army."),c())}var gl=(()=>{let e=class e extends te{constructor(t,n){super(),this.playersService=t,this.unitGroups=n,this.canConfirm=!0,this.playerHasFreeSlots=!0,this.playerHasFreeSlots=this.playersService.getCurrentPlayer().hero.hasFreeUnitSlots()}ngOnInit(){this.hiredGroups=this.data.struct.reward.units.map(t=>{let n={},o={},s=Vt(t.unitTypeId).baseRequirements;return[ge.Gems,ge.Gold,ge.RedCrystals,ge.Wood].forEach(m=>{s[m]&&(n[m]=s[m],o[m]=0)}),{hire:t,count:0,baseCost:n,currentCost:o}})}updateCountForGroup(t,n){t.count=Number(n.target.value),this.canConfirm=!0,Object.entries(t.baseCost).forEach(([o,s])=>{t.currentCost[o]=s*t.count}),this.updateCanConfirm()}confirmHire(){let t=this.playersService.getCurrentPlayer(),n=this.calcTotalCosts();this.playersService.removeResourcesFromPlayer(t,n),this.hiredGroups.forEach(o=>{if(o.count){let s=this.unitGroups.createUnitGroup(o.hire.unitTypeId,{count:o.count},t.hero);this.playersService.addUnitGroupToTypeStack(t,s)}}),this.close()}calcTotalCosts(){return this.hiredGroups.reduce((t,n)=>(Object.entries(n.currentCost).forEach(([o,s])=>{let p=o;t[p]?t[p]+=n.currentCost[p]:t[p]=n.currentCost[p]}),t),{})}updateCanConfirm(){let t=this.calcTotalCosts();this.canConfirm=this.playersService.playerHasResources(this.playersService.getCurrentPlayer(),t)}};e.\u0275fac=function(n){return new(n||e)(y(k),y(Fe))},e.\u0275cmp=C({type:e,selectors:[["mw-hiring-reward-popup"]],features:[N],decls:10,vars:3,consts:[[2,"padding","10px"],["popupHeader",""],["popupContent",""],[1,"units"],["class","unit-column",4,"ngFor","ngForOf"],["popupButtons",""],[1,"button",3,"click","disabled"],[1,"unit-column"],["type","range",3,"input","min","max","value"],[1,"cost"],["class","resource",4,"ngFor","ngForOf"],[1,"resource"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content",0)(1,"div",1),d(2," Hire units: "),c(),a(3,"div",2)(4,"div",3),g(5,iy,12,10,"div",4),c(),g(6,ny,2,0,"div"),c(),a(7,"div",5)(8,"button",6),w("click",function(){return o.confirmHire()}),d(9," Confirm "),c()()()),n&2&&(l(5),u("ngForOf",o.hiredGroups),l(),pt(o.playerHasFreeSlots?-1:6),l(2),u("disabled",!o.canConfirm||!o.playerHasFreeSlots))},dependencies:[z,ce,ii,Zr],styles:[".units[_ngcontent-%COMP%]{display:flex;justify-content:center}.unit-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid gray;padding:10px;margin:6px;width:160px;align-items:center;font-size:13px}.cost[_ngcontent-%COMP%]{display:flex}.resource[_ngcontent-%COMP%]{border:1px solid gray;border-radius:4px;padding:7px}"]});let i=e;return i})();function ry(i,e){if(i&1&&(a(0,"div",9),h(1,"mw-item-icon",10),a(2,"div",11),d(3),c()()),i&2){let r=e.$implicit;l(),u("item",r)("hintPos","above"),l(2),M(" ",r.baseType.name," ")}}function oy(i,e){if(i&1){let r=R();a(0,"div",7),w("click",function(){let n=A(r).$implicit,o=f();return O(o.setSelectedGroup(n))}),g(1,ry,4,3,"div",8),c()}if(i&2){let r=e.$implicit,t=f();pe("selected",r===t.selectedGroup),l(),u("ngForOf",r)}}var yl=(()=>{let e=class e extends te{constructor(t,n){super(),this.itemsService=t,this.playersService=n}ngOnInit(){let t=this.data.struct.reward;this.itemGroups=t.itemGroups.map(n=>n.map(o=>this.itemsService.createItem(o)))}setSelectedGroup(t){this.selectedGroup=t}onSubmit(){this.selectedGroup.forEach(t=>{this.playersService.addItemToPlayer(this.playersService.getCurrentPlayer(),t)}),this.close()}};e.\u0275fac=function(n){return new(n||e)(y(Ai),y(k))},e.\u0275cmp=C({type:e,selectors:[["mw-item-reward-popup"]],features:[N],decls:10,vars:2,consts:[["popupHeader",""],[2,"text-align","center","padding-bottom","20px"],["popupContent",""],[1,"reward-container"],["class","items-group",3,"selected","click",4,"ngFor","ngForOf"],["popupButtons","",2,"padding-top","18px"],["mw-main-button","",3,"click","disabled"],[1,"items-group",3,"click"],["style","display: flex; flex-direction: column; align-items: center;",4,"ngFor","ngForOf"],[2,"display","flex","flex-direction","column","align-items","center"],[3,"item","hintPos"],[2,"font-size","11px","text-align","center"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0)(2,"div",1),d(3," Select Item "),c()(),a(4,"div",2)(5,"div",3),g(6,oy,2,3,"div",4),c()(),a(7,"div",5)(8,"button",6),w("click",function(){return o.onSubmit()}),d(9," Submit "),c()()()),n&2&&(l(6),u("ngForOf",o.itemGroups),l(2),u("disabled",!o.selectedGroup))},dependencies:[z,Fi,oe,ce],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between}.reward-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.items-group[_ngcontent-%COMP%]{margin:14px;padding:16px;border:1px solid gray;cursor:pointer}.selected[_ngcontent-%COMP%]{border-color:gold}"]});let i=e;return i})();function sy(i,e){if(i&1&&(a(0,"div",8)(1,"span"),d(2),c(),a(3,"span"),d(4),c()()),i&2){let r=e.$implicit;l(2),B(r.type.name),l(2),B(r.count)}}function ay(i,e){if(i&1&&(a(0,"div",8)(1,"span"),d(2),c(),a(3,"span"),d(4),c()()),i&2){let r=e.$implicit;l(2),B(r.type.name),l(2),B(r.count)}}var vl=(()=>{let e=class e extends te{constructor(t,n){super(),this.players=t,this.events=n,this.totalGoldReward=0,this.totalExperienceReward=0}ngOnInit(){this.data.enemyLosses.forEach(t=>{this.totalExperienceReward+=Math.round(t.count*t.type.neutralReward.experience)})}onContinue(t){if(!t.isWin){this.close(),this.events.dispatch(Eo());return}this.close(),this.players.addExperienceToPlayer(this.players.getCurrentPlayerId(),this.totalExperienceReward);let o=this.players.getCurrentPlayer().resources;o[ge.Gold]+=this.totalGoldReward,this.events.dispatch(Vi({struct:t.struct}))}};e.\u0275fac=function(n){return new(n||e)(y(k),y(j))},e.\u0275cmp=C({type:e,selectors:[["mw-post-fight-reward-popup"]],features:[N],decls:21,vars:4,consts:[["popupHeader",""],[1,"header"],["popupContent",""],[2,"text-align","center"],[1,"losses-container"],["class","loss-card",4,"ngFor","ngForOf"],["popupButtons",""],["mw-main-button","",2,"margin","auto","display","block",3,"click"],[1,"loss-card"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0)(2,"div",1),d(3),c()(),a(4,"div",2)(5,"div")(6,"div",3),d(7,"Player's Losses"),c(),a(8,"div",4),g(9,sy,5,2,"div",5),c()(),a(10,"div")(11,"div",3),d(12,"Enemy's Losses"),c(),a(13,"div",4),g(14,ay,5,2,"div",5),c()(),a(15,"div")(16,"div"),d(17),c()()(),a(18,"div",6)(19,"button",7),w("click",function(){return o.onContinue(o.data)}),d(20," Continue "),c()()()),n&2&&(l(3),B(o.data.isWin?"Win!":"Defeat"),l(6),u("ngForOf",o.data.playerLosses),l(5),u("ngForOf",o.data.enemyLosses),l(3),M("Experience: +",o.totalExperienceReward,""))},dependencies:[z,oe,ce],styles:[".header[_ngcontent-%COMP%]{text-align:center;padding-bottom:16px}.losses-container[_ngcontent-%COMP%]{display:flex;justify-content:center}.loss-card[_ngcontent-%COMP%]{width:72px;height:72px;background-color:gray;border-radius:6px;color:#fff;margin:4px;text-align:center;padding:12px 0;font-size:13px;box-sizing:border-box;display:flex;flex-direction:column}"]});let i=e;return i})();var cy=i=>({thisStruct:i});function ly(i,e){if(i&1&&(a(0,"div",7),h(1,"mw-description",8),c()),i&2){let r,t=f();l(),u("descriptions",t.data.struct.generator==null||(r=t.data.struct.generator.description(Ue(1,cy,t.data.struct)))==null?null:r.descriptions)}}var Cl=(()=>{let e=class e extends te{constructor(t){super(),this.events=t,this.struct=this.data.struct,this.totalGoldReward=0,this.totalExpReward=0}ngOnInit(){this.data.struct.guard?.forEach(t=>{this.totalExpReward+=Math.round(t.count*t.type.neutralReward.experience)})}onBattleConfirmed(){this.close(),this.events.dispatch(Hn({struct:this.popup.data.struct}))}};e.\u0275fac=function(n){return new(n||e)(y(j))},e.\u0275cmp=C({type:e,selectors:[["mw-pre-fight-popup"]],features:[N],decls:16,vars:4,consts:[["popupHeader",""],["popupContent",""],["class","description",4,"ngIf"],[3,"unitGroups"],["popupButtons",""],["mw-main-button","",3,"click"],["icon","crossed-swords"],[1,"description"],[3,"descriptions"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2),c(),a(3,"div",1),g(4,ly,2,3,"div",2),a(5,"div"),h(6,"mw-unit-groups-list",3),c(),a(7,"div")(8,"div"),d(9),c()()(),a(10,"div",4)(11,"button",5),w("click",function(){return o.onBattleConfirmed()}),h(12,"mw-ra-icon",6),d(13," Fight "),c(),a(14,"button",5),w("click",function(){return o.close()}),d(15," Cancel "),c()()()),n&2&&(l(2),M(" ",o.data.struct.generator==null?null:o.data.struct.generator.name," "),l(2),u("ngIf",o.data.struct.generator==null?null:o.data.struct.generator.description),l(2),u("unitGroups",o.data.struct.guard),l(3),M("Experience: ",o.totalExpReward,""))},dependencies:[re,Kt,os,ue,oe,ce],styles:[".description[_ngcontent-%COMP%]{padding:10px;text-align:center}"]});let i=e;return i})();var py=i=>({thisStruct:i});function uy(i,e){if(i&1&&h(0,"mw-description",3),i&2){let r,t=f();u("descriptions",t.struct.generator==null||(r=t.struct.generator.description(Ue(1,py,t.struct)))==null?null:r.descriptions)}}var wl=(()=>{let e=class e extends te{constructor(t,n,o,s){super(),this.players=t,this.apiProvider=n,this.state=o,this.events=s,this.struct=this.data.struct,this.state.eventHandlers.structures.triggerRefEventHandlers(this.struct,qr.StructInspected())}closePopup(){this.close()}accept(){let t=this.players.getCurrentPlayer(),n=this.data.struct;n.generator?.onVisited?.({playersApi:this.apiProvider.getPlayerApi(),spellsApi:this.apiProvider.getSpellsApi(),visitingPlayer:t}),this.state.eventHandlers.structures.triggerRefEventHandlers(this.data.struct,qr.StructVisited({visitingPlayer:this.players.getCurrentPlayer()}));let o=this.data.struct.actionPoints;o&&this.events.dispatch(jt({points:o})),n.isInactive=!0,this.closePopup()}};e.\u0275fac=function(n){return new(n||e)(y(k),y(li),y(X),y(j))},e.\u0275cmp=C({type:e,selectors:[["mw-preview-popup"]],features:[N],decls:11,vars:3,consts:[["popupHeader",""],["popupContent",""],[2,"white-space","pre","padding","16px"],[3,"descriptions"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],["mw-main-button","",3,"click"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2),c(),a(3,"div",1)(4,"div",2),g(5,uy,1,3,"mw-description",3),c()(),a(6,"div",4)(7,"button",5),w("click",function(){return o.accept()}),d(8,"Accept"),c(),a(9,"button",6),w("click",function(){return o.closePopup()}),d(10,"Cancel"),c()()()),n&2&&(l(2),M(" ",o.data.struct.name," "),l(3),pt(o.struct.generator!=null&&o.struct.generator.description?5:-1),l(2),u("disabled",(o.struct.controls==null?null:o.struct.controls.accept)===!1))},dependencies:[Kt,oe,ce],styles:["[_nghost-%COMP%]{text-align:center}"]});let i=e;return i})();function dy(i,e){if(i&1&&(a(0,"div",8)(1,"div"),d(2),c(),a(3,"div"),d(4),c()()),i&2){let r=e.$implicit;l(2),M(" ",r.type," "),l(2),M(" ",r.count," ")}}function my(i,e){if(i&1){let r=R();a(0,"div",6),w("click",function(){let n=A(r).$implicit,o=f();return O(o.setCurrentReward(o.data,n))}),g(1,dy,5,2,"div",7),c()}if(i&2){let r=e.$implicit,t=f();pe("selected",t.data.selectedRewardGroup===r),l(),u("ngForOf",r)}}var Sl=(()=>{let e=class e extends te{constructor(t){super(),this.playersService=t}ngOnInit(){this.resourceGroups=this.data.struct.reward.resourceGroups}setCurrentReward(t,n){t.selectedRewardGroup=n}confirmResources(t){this.close(),t.selectedRewardGroup&&t.selectedRewardGroup.forEach(n=>{this.playersService.addResourceToPlayer(this.playersService.getCurrentPlayer(),n.type,n.count)})}};e.\u0275fac=function(n){return new(n||e)(y(k))},e.\u0275cmp=C({type:e,selectors:[["mw-resources-reward-popup"]],features:[N],decls:9,vars:2,consts:[["popupHeader",""],["popupContent",""],[1,"reources-rewards"],["class","resource-column",3,"selected","click",4,"ngFor","ngForOf"],["popupButtons",""],["mw-main-button","",2,"margin","auto","display","block",3,"click","disabled"],[1,"resource-column",3,"click"],["class","resource-card",4,"ngFor","ngForOf"],[1,"resource-card"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2," Select Reward: "),c(),a(3,"div",1)(4,"div",2),g(5,my,2,3,"div",3),c()(),a(6,"div",4)(7,"button",5),w("click",function(){return o.confirmResources(o.data)}),d(8," Confirm "),c()()()),n&2&&(l(5),u("ngForOf",o.resourceGroups),l(2),u("disabled",!o.data.selectedRewardGroup))},dependencies:[z,oe,ce],styles:[".reources-rewards[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:20px 10px}.resource-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid gray;margin:0 20px;cursor:pointer;width:120px}.resource-column.selected[_ngcontent-%COMP%]{border:1px solid gold;margin:0 20px}.resource-card[_ngcontent-%COMP%]{text-align:center;margin:10px}"]});let i=e;return i})();var xl=(()=>{let e=class e extends te{constructor(t,n,o){super(),this.players=t,this.apiProvider=n,this.events=o}ngOnInit(){let n=this.data.struct.generator?.generateReward?.();n&&(this.reward=n,this.description=n.description)}closePopup(){this.reward.onAccept({playersApi:this.apiProvider.getPlayerApi(),spellsApi:this.apiProvider.getSpellsApi(),visitingPlayer:this.players.getCurrentPlayer()});let t=this.data.struct.actionPoints;t&&this.events.dispatch(jt({points:t})),this.close()}};e.\u0275fac=function(n){return new(n||e)(y(k),y(li),y(j))},e.\u0275cmp=C({type:e,selectors:[["mw-scripted-reward-popup"]],features:[N],decls:9,vars:1,consts:[["popupHeader",""],["popupContent",""],[2,"padding","10px 8px"],["popupButtons",""],["mw-main-button","",3,"click"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2," Victory! "),c(),a(3,"div",1)(4,"div",2),d(5),c()(),a(6,"div",3)(7,"button",4),w("click",function(){return o.closePopup()}),d(8,"Continue"),c()()()),n&2&&(l(5),B(o.description))},dependencies:[oe,ce]});let i=e;return i})();var fy=i=>({thisStruct:i});function hy(i,e){if(i&1&&(a(0,"div",8),h(1,"mw-description",9),c()),i&2){let r,t=f();l(),u("descriptions",t.data.struct.generator==null||(r=t.data.struct.generator.description(Ue(1,fy,t.data.struct)))==null?null:r.descriptions)}}function gy(i,e){if(i&1&&(a(0,"div",14)(1,"div"),d(2),c(),a(3,"div"),d(4),c()()),i&2){let r=e.$implicit;l(2),B(r.key),l(2),B(r.value)}}function yy(i,e){if(i&1){let r=R();a(0,"div",10)(1,"div"),d(2),c(),a(3,"div"),d(4,"to"),c(),a(5,"div"),d(6),ie(7,"entity"),c(),a(8,"input",11),w("input",function(n){let o=A(r).$implicit,s=f();return O(s.updateCountForGroup(o,n))}),c(),a(9,"div"),d(10,"Cost:"),c(),a(11,"div",12),g(12,gy,5,2,"div",13),ie(13,"keyvalue"),c()()}if(i&2){let r=e.$implicit;l(2),fe("",r.originalGroup.count," ",r.originalGroup.type.name,""),l(4),fe("",r.count," ",ne(7,8,r.hire.unitTypeId).name,""),l(2),u("min",0)("max",r.hire.maxCount)("value",0),l(4),u("ngForOf",ne(13,10,r.currentCost))}}var bl=(()=>{let e=class e extends te{constructor(t,n,o){super(),this.apiProvider=t,this.playersService=n,this.unitGroups=o,this.canConfirm=!0}ngOnInit(){this.hiredGroups=this.data.struct.reward.getUnits(this.apiProvider.getPlayerApi()).map(t=>{let n={},o={},s=t.type.upgradeDetails?.upgradeCost;return[ge.Gems,ge.Gold,ge.RedCrystals,ge.Wood].forEach(m=>{s[m]&&(n[m]=s[m],o[m]=0)}),{hire:{maxCount:t.count,unitTypeId:t.type.upgradeDetails?.target},count:0,baseCost:n,currentCost:o,originalGroup:t}})}updateCountForGroup(t,n){t.count=Number(n.target.value);let o=this.playersService.getCurrentPlayer().resources;this.canConfirm=!0,Object.entries(t.baseCost).forEach(([s,p])=>{t.currentCost[s]=p*t.count}),this.updateCanConfirm()}cancel(){this.close()}confirmHire(){let t=this.playersService.getCurrentPlayer(),n=t.resources,o=this.calcTotalCosts();Object.entries(o).forEach(([s,p])=>{n[s]-=p}),this.hiredGroups.forEach(s=>{if(s.count){this.playersService.removeNUnitsFromGroup(t,s.originalGroup,s.count);let p=this.unitGroups.createUnitGroup(s.hire.unitTypeId,{count:s.count},t.hero);this.playersService.addUnitGroupToTypeStack(t,p)}}),this.close()}calcTotalCosts(){return this.hiredGroups.reduce((t,n)=>(Object.entries(n.currentCost).forEach(([o,s])=>{let p=o;t[p]?t[p]+=n.currentCost[p]:t[p]=n.currentCost[p]}),t),{})}updateCanConfirm(){let t=this.playersService.getCurrentPlayer().resources,n=this.calcTotalCosts();this.canConfirm=Object.entries(n).every(([o,s])=>t[o]>=s)}};e.\u0275fac=function(n){return new(n||e)(y(li),y(k),y(Fe))},e.\u0275cmp=C({type:e,selectors:[["mw-upgrade-reward-popup"]],features:[N],decls:12,vars:4,consts:[["popupHeader",""],["popupContent",""],["class","description",4,"ngIf"],[1,"units"],["class","unit-column",4,"ngFor","ngForOf"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],["mw-main-button","",3,"click"],[1,"description"],[3,"descriptions"],[1,"unit-column"],["type","range",3,"input","min","max","value"],[1,"cost"],["class","resource",4,"ngFor","ngForOf"],[1,"resource"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2),c(),a(3,"div",1),g(4,hy,2,3,"div",2),a(5,"div",3),g(6,yy,14,12,"div",4),c()(),a(7,"div",5)(8,"button",6),w("click",function(){return o.confirmHire()}),d(9," Confirm "),c(),a(10,"button",7),w("click",function(){return o.cancel()}),d(11," Cancel "),c()()()),n&2&&(l(2),M(" ",o.data.struct.generator==null?null:o.data.struct.generator.name," "),l(2),u("ngIf",o.data.struct.generator==null?null:o.data.struct.generator.description),l(2),u("ngForOf",o.hiredGroups),l(2),u("disabled",!o.canConfirm))},dependencies:[z,re,Kt,oe,ce,ii,Zr],styles:[".units[_ngcontent-%COMP%]{display:flex;justify-content:center}.description[_ngcontent-%COMP%]{text-align:center;font-size:13px;padding:7px}.unit-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid gray;padding:10px;margin:6px;width:160px;align-items:center;font-size:13px}.cost[_ngcontent-%COMP%]{display:flex}.resource[_ngcontent-%COMP%]{border:1px solid gray;border-radius:4px;padding:7px}"]});let i=e;return i})();var Sr=(()=>{let e=class e{constructor(t,n){this.hostElem=t,this.renderer=n,this.hideEmpty=!0,this.renderer.addClass(this.hostElem.nativeElement,"mod-text")}ngOnDestroy(){this.renderer.removeClass(this.hostElem.nativeElement,"mod-text")}ngOnChanges(){let t=this.hostElem.nativeElement;if(this.hideEmpty&&!this.value){t.innerHTML="";return}if(typeof this.value!="number"){t.innerHTML="";return}t.innerHTML=(this.value>0?"+":"")+this.value,this.renderer.setStyle(t,"color",this.value<0?"red":"lime")}};e.\u0275fac=function(n){return new(n||e)(y(mt),y(Le))},e.\u0275dir=Re({type:e,selectors:[["","mwNumberModifier",""]],inputs:{value:[0,"mwNumberModifier","value"],hideEmpty:"hideEmpty"},features:[Bi]});let i=e;return i})();var cm=(i,e)=>({color:i,background:e});function vy(i,e){if(i&1&&(a(0,"div",5)(1,"div",6)(2,"div",7),h(3,"mw-ra-icon",3),c(),a(4,"div",8)(5,"div",9),d(6),c(),a(7,"div",10),d(8),c(),a(9,"div",10),d(10),c()()(),a(11,"div",11),h(12,"mw-spell-description",12),c()()),i&2){let r=f();l(2),u("ngStyle",Ht(8,cm,r.uiSpellIcon().iconClr,r.uiSpellIcon().bgClr)),l(),u("icon",r.uiSpellIcon().icon),l(3),B(r.spell().name),l(2),M("Level: ",r.spell().currentLevel,""),l(2),M("Mana Cost: ",r.spell().currentManaCost,""),l(2),u("spell",r.spell())("player",r.player())("hero",r.hero())}}var fs=(()=>{let e=class e{constructor(){this.spell=ee.required(),this.player=ee.required(),this.hero=ee.required(),this.onCooldown=ee(!1),this.disabled=ee(!1),this.isActive=ee(!1),this.hintPos=ee("above"),this.clicked=Zl(),this.isCurrentSpell=Be(()=>this.isActive()&&this.spell().baseType.activationType===this.activationTypes.Target),this.uiSpellIcon=Be(()=>this.spell().baseType.icon),this.activationTypes=I}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-spell-button"]],inputs:{spell:[1,"spell"],player:[1,"player"],hero:[1,"hero"],onCooldown:[1,"onCooldown"],disabled:[1,"disabled"],isActive:[1,"isActive"],hintPos:[1,"hintPos"]},outputs:{clicked:"clicked"},decls:6,vars:13,consts:[["hint",""],[3,"hintBody","hintPos"],[1,"ability","spell-icon",3,"click","ngStyle"],[3,"icon"],[1,"ra","light"],[2,"min-width","170px","max-width","200px"],[2,"display","flex"],[1,"tooltip-icon",3,"ngStyle"],[2,"padding","4px"],[2,"font-size","14px"],[2,"font-size","12px"],[2,"font-size","12px","padding","4px"],[3,"spell","player","hero"]],template:function(n,o){if(n&1){let s=R();a(0,"mw-hover-hint",1)(1,"div",2),w("click",function(){return A(s),O(o.clicked.emit(o.spell()))}),h(2,"mw-ra-icon",3)(3,"i",4),c(),g(4,vy,13,11,"ng-template",null,0,Y),c()}if(n&2){let s=se(5);u("hintBody",s)("hintPos",o.hintPos()),l(),pe("disabled",o.disabled())("current-ability",o.isCurrentSpell()),u("ngStyle",Ht(10,cm,o.uiSpellIcon().iconClr,o.uiSpellIcon().bgClr)),l(),u("icon",o.uiSpellIcon().icon),l(),nn("ra-"+o.uiSpellIcon().icon)}},styles:["[_nghost-%COMP%]{display:block;max-width:56px}.ability[_ngcontent-%COMP%]{width:48px;height:42px;border:1px solid gray;font-size:13px;display:flex;justify-content:center;align-items:center;border-radius:4px;margin:4px;cursor:pointer}.current-ability[_ngcontent-%COMP%]{border:1px solid gold}.disabled[_ngcontent-%COMP%]{cursor:not-allowed;opacity:.5}.spell-icon[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:center;font-size:42px;overflow:hidden}.tooltip-icon[_ngcontent-%COMP%]{height:32px;width:32px;overflow:hidden;font-size:28px;display:flex;align-items:center;justify-content:center}.light[_ngcontent-%COMP%]{position:absolute;mix-blend-mode:hard-light;filter:blur(4px);display:none}.ability[_ngcontent-%COMP%]:not(.no-mana):not(.disabled):hover   .light[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]:active   .spell-icon[_ngcontent-%COMP%], .spell-icon.current-ability[_ngcontent-%COMP%]{filter:brightness(.65)}"],changeDetection:0});let i=e;return i})();function wy(i,e){if(i&1&&h(0,"mw-item-slot",19),i&2){let r=e.$implicit;u("itemSlot",r)}}function Sy(i,e){if(i&1){let r=R();a(0,"div",22),w("mwNoContextMenu",function(){A(r);let n=f().$implicit,o=f(2);return O(o.splitGroup(n))})("click",function(){A(r);let n=f().$implicit,o=f(2);return O(o.clickOnSlot(n))}),a(1,"span"),d(2),c(),a(3,"span"),d(4),c()()}if(i&2){let r=f().$implicit,t=f(2);$("background",r.unitGroup.ownerPlayer.color),pe("active",r===t.activeGroupSlot),l(2),B(r.unitGroup.type.name),l(2),B(r.unitGroup.count)}}function xy(i,e){if(i&1){let r=R();a(0,"div",22),w("mwNoContextMenu",function(){A(r);let n=f().$implicit,o=f(2);return O(o.splitGroup(n))})("click",function(){A(r);let n=f().$implicit,o=f(2);return O(o.clickOnSlot(n))}),c()}}function by(i,e){if(i&1&&g(0,Sy,5,6,"div",20)(1,xy,1,0,"div",21),i&2){let r=e.$implicit;pt(r.unitGroup?0:1)}}function _y(i,e){if(i&1){let r=R();a(0,"div",25),w("mwNoContextMenu",function(){A(r);let n=f().$implicit,o=f(2);return O(o.splitGroup(n))})("click",function(){A(r);let n=f().$implicit,o=f(2);return O(o.clickOnSlot(n))}),a(1,"span"),d(2),c(),a(3,"span"),d(4),c()()}if(i&2){let r=f().$implicit,t=f(2);$("background",r.unitGroup.ownerPlayer.color),pe("active",r===t.activeGroupSlot),l(2),B(r.unitGroup.type.name),l(2),B(r.unitGroup.count)}}function My(i,e){if(i&1){let r=R();a(0,"div",25),w("mwNoContextMenu",function(){A(r);let n=f().$implicit,o=f(2);return O(o.splitGroup(n))})("click",function(){A(r);let n=f().$implicit,o=f(2);return O(o.clickOnSlot(n))}),c()}}function Py(i,e){if(i&1&&g(0,_y,5,6,"div",23)(1,My,1,0,"div",24),i&2){let r=e.$implicit;pt(r.unitGroup?0:1)}}function Dy(i,e){if(i&1&&(a(0,"div")(1,"div"),d(2),c()()),i&2){let r=e.$implicit;l(2),B(r)}}function Ey(i,e){if(i&1&&(ye(0),g(1,Dy,3,1,"div",27),ve()),i&2){let r=f().ngIf;l(),u("ngForOf",r)}}function Iy(i,e){i&1&&(a(0,"div"),d(1,"No specialties"),c())}function Ty(i,e){if(i&1&&(ye(0),g(1,Ey,2,1,"ng-container",26)(2,Iy,2,0,"ng-template",null,0,Y),ve()),i&2){let r=e.ngIf,t=se(3);l(),u("ngIf",r.length)("ngIfElse",t)}}function Fy(i,e){if(i&1&&(a(0,"div",16),h(1,"mw-spell-button",28),a(2,"div",29),d(3),c()()),i&2){let r=e.$implicit,t=f(2);l(),u("spell",r)("player",t.currentPlayer)("hero",t.currentPlayer.hero),l(2),M(" ",r.baseType.name," ")}}function Ay(i,e){if(i&1&&(ye(0),a(1,"div",5)(2,"div",6)(3,"div"),d(4," Your items: "),c(),a(5,"div",7),g(6,wy,1,1,"mw-item-slot",8),c()(),a(7,"div",9)(8,"div"),d(9),c(),a(10,"div"),d(11),c(),h(12,"mw-experience-bar",10),a(13,"div",11),wt(14,by,2,1,null,null,ei),c(),d(16," Reserve: "),a(17,"div",11),wt(18,Py,2,1,null,null,ei),c()()(),a(20,"div",12)(21,"div"),d(22,"Resistances:"),c(),a(23,"div"),d(24," Fire: "),h(25,"span",13),c(),a(26,"div"),d(27," Cold: "),h(28,"span",13),c(),a(29,"div"),d(30," Lightning: "),h(31,"span",13),c(),a(32,"div"),d(33," Poison: "),h(34,"span",13),c(),h(35,"hr"),a(36,"div",14),d(37," Specialties: "),g(38,Ty,4,2,"ng-container",2),ie(39,"async"),c(),h(40,"hr"),a(41,"div",15),d(42,"Spells:"),c(),a(43,"div",16)(44,"div",17),g(45,Fy,4,4,"div",18),c()()(),ve()),i&2){let r=e.ngIf,t=f();l(6),u("ngForOf",t.itemSlots),l(3),B(t.hero.base.name),l(2),M("Level ",t.hero.level,""),l(3),St(t.hero.mainUnitSlots),l(4),St(t.hero.reserveUnitSlots),l(7),u("mwNumberModifier",r.fireResist)("hideEmpty",!1),l(3),u("mwNumberModifier",r.coldResist)("hideEmpty",!1),l(3),u("mwNumberModifier",r.lightningResist)("hideEmpty",!1),l(3),u("mwNumberModifier",r.poisonResist)("hideEmpty",!1),l(4),u("ngIf",ne(39,13,t.heroSpecialties$)),l(7),u("ngForOf",t.currentPlayer.hero.spells)}}var _l=(()=>{let e=class e extends te{constructor(t,n,o,s){super(),this.playersService=t,this.state=n,this.curPlayerState=o,this.events=s,this.currentPlayer=this.playersService.getCurrentPlayer(),this.hero=this.currentPlayer.hero,this.heroStats$=this.hero.listenHeroStats(),this.itemSlots=Wt.getSlotTypes(),this.heroSpecialties$=this.hero.specialtiesModGroup.onValueChanges().pipe(Ri(p=>Pp(p).filter(([,m])=>m).map(([m,v])=>`${bp[m]}: ${v}`)))}splitGroup(t){this.activeGroupSlot=void 0,!(!t.unitGroup||t.unitGroup.count===1)&&this.hero.hasFreeUnitSlots()&&this.events.dispatch(bo({unitGroup:t.unitGroup}))}clickOnSlot(t){if(!this.activeGroupSlot){t.unitGroup&&(this.activeGroupSlot=t);return}if(this.activeGroupSlot){if(this.activeGroupSlot===t){this.activeGroupSlot=void 0;return}if(t.unitGroup){if(t.unitGroup.type===this.activeGroupSlot.unitGroup?.type){this.events.dispatch(_o({sourceSlot:this.activeGroupSlot,targetSlot:t,postAction:()=>{this.activeGroupSlot=void 0,this.hero.refreshUnitGroupsOrderBySlots()}}));return}Ca(this.activeGroupSlot,t),this.activeGroupSlot=void 0}else{let n=this.hero.mainUnitSlots.filter(o=>o.unitGroup).length;if(!this.activeGroupSlot.isReserve&&t.isReserve&&n===1){this.activeGroupSlot=void 0;return}t.unitGroup=this.activeGroupSlot.unitGroup,this.activeGroupSlot.unitGroup=null,this.activeGroupSlot=void 0}this.hero.refreshUnitGroupsOrderBySlots()}}};e.\u0275fac=function(n){return new(n||e)(y(k),y(X),y(nt),y(j))},e.\u0275cmp=C({type:e,selectors:[["mw-hero-popup"]],features:[N],decls:7,vars:3,consts:[["noSpecialties",""],["popupContent",""],[4,"ngIf"],["popupButtons","",2,"justify-content","end"],["mw-main-button","",3,"click"],[1,"hero-panel"],[1,"items"],[2,"display","flex","flex-direction","column"],[3,"itemSlot",4,"ngFor","ngForOf"],[1,"info"],[2,"width","270px"],[1,"unit-groups-slots"],[1,"stats-panel"],[3,"mwNumberModifier","hideEmpty"],[1,"specialties"],[2,"margin-bottom","5px","text-align","center"],[2,"display","flex","flex-direction","column","align-items","center"],[2,"display","flex","flex-wrap","wrap","justify-content","center","gap","4px"],["style","display: flex; flex-direction: column; align-items: center;",4,"ngFor","ngForOf"],[3,"itemSlot"],[1,"unit-slot",3,"active","background"],[1,"unit-slot"],[1,"unit-slot",3,"mwNoContextMenu","click"],[1,"unit-slot","reserve",3,"active","background"],[1,"unit-slot","reserve"],[1,"unit-slot","reserve",3,"mwNoContextMenu","click"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],[3,"spell","player","hero"],[2,"font-size","10px","text-align","center"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",1),g(2,Ay,46,15,"ng-container",2),ie(3,"async"),c(),a(4,"div",3)(5,"button",4),w("click",function(){return o.close()}),d(6," Close "),c()()()),n&2&&(l(2),u("ngIf",ne(3,1,o.heroStats$)))},dependencies:[Sr,Ti,si,oe,ce,rs,z,re,fs,gi],styles:[".buttons[_ngcontent-%COMP%]{margin-top:16px;display:flex;justify-content:flex-end}[_nghost-%COMP%]{width:500px}.hero-panel[_ngcontent-%COMP%]{text-align:left;display:flex}.items[_ngcontent-%COMP%]{margin-right:16px;font-size:10px}.info[_ngcontent-%COMP%]{font-size:12px}.unit-groups-slots[_ngcontent-%COMP%]{display:flex;padding-top:6px;gap:4px;text-align:center}.unit-groups-slots[_ngcontent-%COMP%]   .unit-slot[_ngcontent-%COMP%]{display:flex;justify-content:center;color:#fff;flex-direction:column;cursor:pointer;width:52px;height:52px;border:1px solid gray;box-sizing:border-box;border-radius:4px;-webkit-user-select:none;user-select:none}.unit-groups-slots[_ngcontent-%COMP%]   .unit-slot.reserve[_ngcontent-%COMP%]{width:40px;height:40px;font-size:10px;filter:brightness(.8)}.unit-groups-slots[_ngcontent-%COMP%]   .unit-slot.active[_ngcontent-%COMP%]{border-color:gold;border-width:2px}.stats-panel[_ngcontent-%COMP%]{position:absolute;right:-160px;box-sizing:border-box;top:0;background:#fff;font-size:13px;padding:6px 8px;width:150px}"]});let i=e;return i})();var lm=(()=>{let e=class e{constructor(t){this.events=t}openNewGameScreen(){this.events.dispatch(Ao())}openSettings(){this.events.dispatch(zn())}};e.\u0275fac=function(n){return new(n||e)(y(j))},e.\u0275cmp=C({type:e,selectors:[["mw-main-screen"]],decls:7,vars:0,consts:[[1,"block"],["mw-main-button","",3,"click"]],template:function(n,o){n&1&&(a(0,"div",0),d(1," Mirrorwalk "),a(2,"div")(3,"button",1),w("click",function(){return o.openNewGameScreen()}),d(4," New Game "),c(),a(5,"button",1),w("click",function(){return o.openSettings()}),d(6," Settings "),c()()())},dependencies:[oe],styles:["[_nghost-%COMP%]{display:block;position:relative}.block[_ngcontent-%COMP%]{position:fixed;right:0;bottom:0;width:250px;height:200px;padding:20px}[mw-main-button][_ngcontent-%COMP%]{width:100%}"]});let i=e;return i})();function ky(i,e){if(i&1){let r=R();ye(0),a(1,"div")(2,"input",5),w("click",function(){let n=A(r).$implicit,o=f();return O(o.setOrientation(n.value))}),c(),a(3,"label",6),d(4),c()(),ve()}if(i&2){let r=e.$implicit,t=f();l(2),u("id","orient-"+r.value)("value",r.value)("checked",t.settings.orientation===r.value),l(),u("for","orient-"+r.value),l(),B(r.label)}}var pm=(()=>{let e=class e extends te{constructor(t){super(),this.state=t,this.orientation=rn,this.orientationOptions=[{label:"Vertical",value:rn.Vertical},{label:"Horizontal",value:rn.Horizontal}],this.settings=this.state.settings}setOrientation(t){this.state.settings.orientation=t}loadScript(){import("./chunk-2PTTLI66.js").then(t=>{console.log("loaded script successfully!",t)})}loadScriptByPath(){var t=document.createElement("input");t.type="file",t.multiple=!0,t.onchange=n=>{var o=n.target.files[0];console.log(o);var s=new FileReader;s.readAsText(o),s.onload=p=>{var m=p.target.result;console.log(m);var v=document.createElement("script");v.innerHTML=m,v.setAttribute("type","module"),document.head.appendChild(v)}},t.click()}};e.\u0275fac=function(n){return new(n||e)(y(X))},e.\u0275cmp=C({type:e,selectors:[["mw-settings-popup"]],features:[N],decls:12,vars:1,consts:[["popupHeader",""],["popupContent",""],[4,"ngFor","ngForOf"],["mw-main-button","",3,"click"],["popupButtons",""],["type","radio","name","orientation",3,"click","id","value","checked"],[3,"for"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2," Units Orientation "),c(),a(3,"div",1),g(4,ky,5,5,"ng-container",2),a(5,"button",3),w("click",function(){return o.loadScriptByPath()}),d(6," Load Script By Path "),c(),a(7,"button",3),w("click",function(){return o.loadScript()}),d(8," Load Mod "),c()(),a(9,"div",4)(10,"button",3),w("click",function(){return o.close()}),d(11," Close "),c()()()),n&2&&(l(4),u("ngForOf",o.orientationOptions))},dependencies:[z,oe,ce]});let i=e;return i})();function Gy(i,e){if(i&1&&(a(0,"span"),d(1," ("),a(2,"span",9),d(3),c(),d(4,") "),c()),i&2){let r=f().$implicit,t=f();l(3),M("-",t.missingCostMap[r.type],"")}}function Ry(i,e){if(i&1&&(a(0,"div"),d(1),g(2,Gy,5,1,"span",5),c()),i&2){let r=e.$implicit,t=f();l(),fe(" ",r.count," ",r.resName," "),l(),u("ngIf",t.missingCostMap[r.type])}}function Uy(i,e){i&1&&(a(0,"div"),d(1," You don't have enough resources. "),c())}var hs=(()=>{let e=class e extends te{constructor(t,n,o){super(),this.players=t,this.events=n,this.state=o;let s=this.data.building;this.buildingLevel=s.base.levels[this.data.targetLevel-1];let p=this.getBuildingCost();this.cost=ta(p),this.missingCostMap=this.players.getMissingResources(this.players.getCurrentPlayer(),p),this.canBuild=this.players.playerHasResources(this.players.getCurrentPlayer(),p)}build(){let t=this.data.building;this.data.targetLevel===1?t.built=!0:(t.currentLevel=this.data.targetLevel-1,t.currentBuilding=t.base.levels[this.data.targetLevel-1].building),this.events.dispatch(Uo({building:t,player:this.players.getCurrentPlayer()})),this.players.removeResourcesFromPlayer(this.players.getCurrentPlayer(),this.getBuildingCost()),this.state.eventHandlers.buildings.triggerRefEventHandlers(this.data.building,ms.Built()),this.close()}getBuildingCost(){return this.buildingLevel.cost}};e.\u0275fac=function(n){return new(n||e)(y(k),y(j),y(X))},e.\u0275cmp=C({type:e,selectors:[["mw-build-popup"]],features:[N],decls:15,vars:7,consts:[["popupHeader",""],[2,"display","block","font-size","40px","margin","8px 0",3,"icon"],["popupContent",""],[2,"padding-bottom","8px"],[4,"ngFor","ngForOf"],[4,"ngIf"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],["mw-main-button","",3,"click"],[2,"color","red"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2),h(3,"mw-ra-icon",1),c(),a(4,"div",2)(5,"div",3),d(6),c(),a(7,"div"),g(8,Ry,3,3,"div",4),c(),g(9,Uy,2,0,"div",5),c(),a(10,"div",6)(11,"button",7),w("click",function(){return o.build()}),d(12,"Build"),c(),a(13,"button",8),w("click",function(){return o.close()}),d(14,"Close"),c()()()),n&2&&(l(2),fe(" Build: ",o.data.building.currentBuilding.name,", level ",o.data.targetLevel," "),l(),u("icon",o.data.building.base.icon),l(3),M(" ",o.buildingLevel.building.description," "),l(2),u("ngForOf",o.cost),l(),u("ngIf",!o.canBuild),l(2),u("disabled",!o.canBuild))},dependencies:[z,re,ue,oe,ce],styles:["[_nghost-%COMP%]{text-align:center;display:flex;flex-direction:column;font-size:14px;color:wheat}[popupButtons][_ngcontent-%COMP%]{padding-top:8px}"]});let i=e;return i})();function By(i,e){if(i&1&&(a(0,"span"),d(1),c()),i&2){let r=e.$implicit;l(),fe("",r.key,": ",r.value,"")}}var Xr=(()=>{let e=class e{constructor(){this.capitalize=!0}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-resources-cost"]],hostVars:2,hostBindings:function(n,o){n&2&&pe("capitalize",o.capitalize)},inputs:{cost:"cost",capitalize:"capitalize"},decls:3,vars:2,template:function(n,o){n&1&&(wt(0,By,2,2,"span",null,ei),ie(2,"keyvalue")),n&2&&St(ne(2,0,o.cost))},dependencies:[ii],styles:[".capitalize[_nghost-%COMP%]{text-transform:capitalize}"]});let i=e;return i})();function Hy(i,e){if(i&1){let r=R();a(0,"div",12),w("click",function(){let n=A(r).$implicit,o=f().$implicit,s=f();return O(s.selectItem(n,o.value))}),h(1,"mw-unit-group-preview",13)(2,"hr")(3,"mw-resources-cost",14),c()}if(i&2){let r=e.$implicit,t=f(2);pe("selected",t.selectedGroup===r),l(),u("unitType",r.type)("count",r.count),l(2),u("cost",r.cost)}}function Ly(i,e){if(i&1&&(a(0,"div",8)(1,"div",9),d(2),c(),a(3,"div",10),wt(4,Hy,4,5,"div",11,ei),c()()),i&2){let r=e.$implicit;l(2),B(r.value.name),l(2),St(r.value.groups)}}function Ny(i,e){i&1&&(a(0,"span"),d(1,"You don't have enough resources"),c())}var Ml=(()=>{let e=class e extends te{constructor(){super(...arguments),this.players=H(k),this.unitsService=H(Fe),this.events=H(j),this.currentPlayer=this.players.getCurrentPlayer(),this.canHire=!0}selectItem(t,n){this.selectedGroup=t,this.selectedGarrison=n,this.canHire=this.players.playerHasResources(this.currentPlayer,t.cost)}hire(){if(!this.selectedGroup||!this.selectedGarrison||!this.canHire)return;let t=this.selectedGroup;q.removeItem(this.selectedGarrison.groups,t),this.players.removeResourcesFromPlayer(this.currentPlayer,t.cost);let n=this.unitsService.createUnitGroup(t.type.id,{count:t.count},this.currentPlayer.hero);this.players.addUnitGroupToTypeStack(this.currentPlayer,n),this.events.dispatch(Ci({message:`${t.count} ${t.type.name} joined your army for 3 days.`})),this.events.dispatch($n({action:()=>{let o=this.players.removeUnitTypeCountFromPlayer(this.currentPlayer,t.type.id,t.count);o&&this.events.dispatch(Ci({message:`${o} ${t.type.name} have left your army.`}))},dayOffset:3})),this.selectedGarrison=void 0,this.selectedGroup=void 0}};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=dt(e)))(o||e)}})(),e.\u0275cmp=C({type:e,selectors:[["mw-garrison-popup"]],features:[N],decls:18,vars:5,consts:[["popupHeader",""],["popupContent",""],[1,"sub-info"],["class","hiring-section",4,"ngFor","ngForOf"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],["icon","guarded-tower"],["mw-main-button","",3,"click"],[1,"hiring-section"],[1,"header"],[1,"groups"],[1,"group",3,"selected"],[1,"group",3,"click"],[3,"unitType","count"],[3,"cost"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2,"Garrison"),c(),a(3,"div",1)(4,"div",2)(5,"p"),d(6,"Hire units temporarily (3 days) for reduced cost."),c(),a(7,"p"),d(8,"Garrison is reset each week."),c()(),g(9,Ly,6,1,"div",3),ie(10,"keyvalue"),g(11,Ny,2,0,"span"),c(),a(12,"div",4)(13,"button",5),w("click",function(){return o.hire()}),h(14,"mw-ra-icon",6),d(15," Hire "),c(),a(16,"button",7),w("click",function(){return o.close()}),d(17," Leave "),c()()()),n&2&&(l(9),u("ngForOf",ne(10,3,o.currentPlayer.garrisons)),l(2),pt(o.canHire?-1:11),l(2),u("disabled",!o.selectedGroup||!o.canHire))},dependencies:[z,Xr,Pa,ue,oe,ce,ii],styles:[".hiring-section[_ngcontent-%COMP%]{padding-top:8px}.groups[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:8px}.groups[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]{width:70px;font-size:13px;padding:3px 4px;-webkit-user-select:none;user-select:none;border:1px solid black;cursor:pointer}.groups[_ngcontent-%COMP%]   .group[_ngcontent-%COMP%]   .group-name[_ngcontent-%COMP%]{padding-bottom:4px}.groups[_ngcontent-%COMP%]   .group.selected[_ngcontent-%COMP%]{border:1px solid gold}[popupButtons][_ngcontent-%COMP%]{padding-top:8px}"]});let i=e;return i})();function jy(i,e){if(i&1){let r=R();a(0,"div",4),w("click",function(){A(r);let n=f();return O(n.setMode("upgrade"))}),d(1),c()}if(i&2){let r=f();pe("active",r.currentMode==="upgrade"),l(),M(" Upgrade: ",r.countToUpgrade-r.plannedToUpgrade," ")}}function $y(i,e){if(i&1&&(a(0,"div",16)(1,"div"),d(2),c(),a(3,"div"),d(4),c()()),i&2){let r=e.$implicit;l(2),B(r.key),l(2),B(r.value)}}function Vy(i,e){if(i&1){let r=R();a(0,"div",12)(1,"div"),d(2),c(),a(3,"div"),d(4),c(),a(5,"input",13),w("input",function(n){let o=A(r).$implicit,s=f();return O(s.updateCountForGroup(o,n))}),c(),a(6,"div"),d(7,"Cost:"),c(),a(8,"div",14),g(9,$y,5,2,"div",15),ie(10,"keyvalue"),c()()}if(i&2){let r=e.$implicit;l(2),B(r.hire.unitType.name),l(2),B(r.count),l(),u("min",0)("max",r.hire.maxCount)("value",0),l(4),u("ngForOf",ne(10,6,r.currentCost))}}function zy(i,e){if(i&1){let r=R();a(0,"button",17),w("click",function(){A(r);let n=f();return O(n.upgradeBuilding())}),d(1," Upgrade Building "),c()}}var Pl=(()=>{let e=class e extends te{constructor(t,n,o,s){super(),this.playersService=t,this.unitsService=n,this.popupService=o,this.gameObjectsManager=s,this.hirableGroups=[],this.canConfirm=!0,this.plannedToHire=0,this.plannedToUpgrade=0,this.currentMode="hire",this.unitType=Vt(this.data.hiringActivity.hiring.unitTypeId),this.activity=this.data.hiringActivity,this.currentBuilding=this.data.building.currentBuilding,this.canBeUpgraded=this.data.building.base.levels.length-1>this.data.building.currentLevel}ngOnInit(){console.log(this.data);let t=this.data.building.currentBuilding.activity;this.originalCountToHire=this.data.town.unitsAvailableMap[t.unitGrowthGroup],this.countToHire=this.originalCountToHire,this.activity.upgrade&&(this.countToUpgrade=this.playersService.getPlayerUnitsCountOfType(this.playersService.getCurrentPlayer(),this.activity.hiring.unitTypeId)),this.hirableGroups=this.getGroupsToHire().map(n=>{let o={},s={},p=Vt(n.unitTypeId).baseRequirements;return[ge.Gems,ge.Gold,ge.RedCrystals,ge.Wood].forEach(v=>{p[v]&&(o[v]=p[v],s[v]=0)}),{hire:{maxCount:this.data.town.unitsAvailableMap[t.unitGrowthGroup],unitType:Vt(n.unitTypeId)},count:0,baseCost:o,currentCost:s}})}setMode(t){if(this.currentMode===t)return;t==="hire"?this.plannedToUpgrade=0:this.plannedToHire=0,this.currentMode=t;let n=this.data.building.currentBuilding.activity;this.hirableGroups=this.getGroupsToHire().map(o=>{let s={},p={},m=Vt(this.activity.hiring.unitTypeId),v=this.currentMode==="hire"?Vt(o.unitTypeId).baseRequirements:m.upgradeDetails.upgradeCost;return[ge.Gems,ge.Gold,ge.RedCrystals,ge.Wood].forEach(E=>{v[E]&&(s[E]=v[E],p[E]=0)}),{hire:{maxCount:this.currentMode==="hire"?this.data.town.unitsAvailableMap[n.unitGrowthGroup]:this.countToUpgrade,unitType:Vt(o.unitTypeId)},count:0,baseCost:s,currentCost:p}})}getGroupsToHire(){let t=this.data.building.currentBuilding.activity,n=Vt(t.hiring.unitTypeId);return this.currentMode==="hire"?t.upgrade?[t.hiring,...n.upgradeDetails?.target?[{growth:0,unitTypeId:Vt(t.hiring?.unitTypeId).upgradeDetails?.target}]:[]]:[t.hiring]:[...n.upgradeDetails?.target?[{growth:0,unitTypeId:n.upgradeDetails.target}]:[]]}updateCountForGroup(t,n){t.count=Number(n.target.value),this.canConfirm=!0,Object.entries(t.baseCost).forEach(([o,s])=>{t.currentCost[o]=s*t.count}),this.currentMode==="hire"?this.plannedToHire=this.hirableGroups.reduce((o,s)=>o+s.count,0):this.plannedToUpgrade=this.hirableGroups.reduce((o,s)=>o+s.count,0),this.updateCanConfirm()}confirmHire(){let t=this.playersService.getCurrentPlayer(),n=this.calcTotalCosts();this.playersService.removeResourcesFromPlayer(t,n),this.currentMode==="hire"?this.hirableGroups.forEach(o=>{if(o.count){let s=this.unitsService.createUnitGroup(o.hire.unitType.id,{count:o.count},t.hero),p=this.data.building.currentBuilding.activity;this.data.town.unitsAvailableMap[p.unitGrowthGroup]-=o.count,this.playersService.addUnitGroupToTypeStack(t,s)}}):this.hirableGroups.forEach(o=>{if(o.count){this.playersService.removeUnitTypeCountFromPlayer(t,this.activity.hiring.unitTypeId,o.count);let s=this.unitsService.createUnitGroup(o.hire.unitType.id,{count:o.count},t.hero);this.playersService.addUnitGroupToTypeStack(t,s)}}),this.close()}upgradeBuilding(){this.close(),this.popupService.createBasicPopup({component:hs,data:{building:this.data.building,targetLevel:2},class:"dark"})}calcTotalCosts(){return this.hirableGroups.reduce((t,n)=>(Object.entries(n.currentCost).forEach(([o,s])=>{let p=o;t[p]?t[p]+=n.currentCost[p]:t[p]=n.currentCost[p]}),t),{})}updateCanConfirm(){let t=this.calcTotalCosts();this.canConfirm=this.playersService.playerHasResources(this.playersService.getCurrentPlayer(),t)}};e.\u0275fac=function(n){return new(n||e)(y(k),y(Fe),y(oi),y(xe))},e.\u0275cmp=C({type:e,selectors:[["mw-hiring-popup"]],features:[N],decls:19,vars:9,consts:[["popupHeader",""],["popupContent",""],[1,"sub-info"],[2,"display","flex","justify-content","center"],[1,"type",3,"click"],["class","type",3,"active","click",4,"ngIf"],[1,"hiring-panel"],["class","unit-column",4,"ngFor","ngForOf"],["popupButtons",""],["mw-main-button","",3,"click","disabled"],["mw-main-button","","style","font-size: 12px;",3,"click",4,"ngIf"],["mw-main-button","",3,"click"],[1,"unit-column"],["type","range",3,"input","min","max","value"],[1,"cost"],["class","resource",4,"ngFor","ngForOf"],[1,"resource"],["mw-main-button","",2,"font-size","12px",3,"click"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0),d(2),c(),a(3,"div",1)(4,"div",2)(5,"p"),d(6),c()(),a(7,"div",3)(8,"div",4),w("click",function(){return o.setMode("hire")}),d(9),c(),g(10,jy,2,3,"div",5),c(),a(11,"div",6),g(12,Vy,11,8,"div",7),c()(),a(13,"div",8)(14,"button",9),w("click",function(){return o.confirmHire()}),d(15," Hire "),c(),g(16,zy,2,0,"button",10),a(17,"button",11),w("click",function(){return o.close()}),d(18," Close "),c()()()),n&2&&(l(2),M(" ",o.currentBuilding.name," "),l(4),M(" Hire ",o.unitType.name," "),l(2),pe("active",o.currentMode==="hire"),l(),M(" Hire: ",o.countToHire-o.plannedToHire," "),l(),u("ngIf",o.activity.upgrade),l(2),u("ngForOf",o.hirableGroups),l(2),u("disabled",!o.canConfirm||o.countToHire-o.plannedToHire<0),l(2),u("ngIf",o.canBeUpgraded))},dependencies:[z,re,oe,ce,ii],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center}.type[_ngcontent-%COMP%]{padding:8px;margin:4px;font-size:12px;border:1px solid black;cursor:pointer}.type.active[_ngcontent-%COMP%]{border:1px solid gold}.hiring-panel[_ngcontent-%COMP%]{display:flex;justify-content:center}.unit-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid gray;padding:10px;margin:6px;width:160px;align-items:center;font-size:13px}.cost[_ngcontent-%COMP%]{display:flex}.resource[_ngcontent-%COMP%]{border:1px solid gray;border-radius:4px;padding:7px}"]});let i=e;return i})();function Wy(i,e){if(i&1){let r=R();a(0,"div",8),w("click",function(){let n=A(r).$implicit,o=f();return O(o.itemToBuy.set(n))}),h(1,"mw-item-icon",9),d(2),h(3,"mw-resources-cost",10),c()}if(i&2){let r=e.$implicit,t=f();pe("active",t.itemToBuy()===r),l(),u("itemBase",r),l(),M(" ",r.name," "),l(),u("cost",r.cost)}}function qy(i,e){if(i&1){let r=R();a(0,"div",8),w("click",function(){let n=A(r).$implicit,o=f(2);return O(o.itemToSell.set(n))}),h(1,"mw-item-icon",9),d(2),h(3,"mw-resources-cost",10),c()}if(i&2){let r=e.$implicit,t=f(2);pe("active",t.itemToSell()===r),l(),u("itemBase",r.baseType),l(),M(" ",r.baseType.name," "),l(),u("cost",r.baseType.sellingCost)}}function Yy(i,e){if(i&1&&(a(0,"div"),d(1,"Sell:"),c(),a(2,"div",2),wt(3,qy,4,5,"div",3,ei),c()),i&2){let r=f();l(3),St(r.hero.itemsBackpack)}}function Qy(i,e){if(i&1){let r=R();a(0,"button",4),w("click",function(){A(r);let n=f();return O(n.sellItem())}),d(1," Sell "),c()}if(i&2){let r=f();u("disabled",!r.canSell())}}var Dl=(()=>{let e=class e extends te{constructor(){super(...arguments),this.players=H(k),this.itemsService=H(Ai),this.events=H(j),this.currentPlayer=this.players.getCurrentPlayer(),this.hero=this.currentPlayer.hero,this.sellingData=this.data.building.getCustomData(),this.items=wp(this.sellingData?.items),this.allowsSelling=this.sellingData?.selling,this.itemToBuy=Ss(null),this.itemToSell=Ss(null),this.canBuy=Be(()=>{let t=this.itemToBuy();return this.itemToSell(),!!t&&this.players.playerHasResources(this.currentPlayer,t.cost)}),this.canSell=Be(()=>!!this.itemToSell())}buyItem(){let t=this.itemToBuy(),n=this.itemsService.createItem(t);this.players.removeResourcesFromPlayer(this.currentPlayer,t.cost||{}),this.events.dispatch(vi({item:n,player:this.currentPlayer})),q.removeItem(this.items,t),this.itemToBuy.set(null)}sellItem(){let t=this.itemToSell();this.players.addResourcesToPlayer(this.currentPlayer,t.baseType.sellingCost||{}),this.events.dispatch(Nn({item:t,player:this.currentPlayer})),this.itemToSell.set(null)}};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=dt(e)))(o||e)}})(),e.\u0275cmp=C({type:e,selectors:[["mw-items-selling-popup"]],features:[N],decls:17,vars:3,consts:[["popupHeader",""],["popupContent",""],[1,"item-list"],[1,"item",3,"active"],["mw-main-button","",3,"click","disabled"],["popupButtons",""],["mw-main-button","",3,"disabled"],["mw-main-button","",3,"click"],[1,"item",3,"click"],[3,"itemBase"],[2,"display","flex","flex-direction","column",3,"cost"]],template:function(n,o){n&1&&(a(0,"mw-popup-base-content")(1,"div",0)(2,"div"),d(3,"Items Market"),c(),a(4,"div"),d(5,"Buy:"),c()(),a(6,"div",1)(7,"div",2),wt(8,Wy,4,5,"div",3,ei),c(),a(10,"button",4),w("click",function(){return o.buyItem()}),d(11," Buy "),c(),g(12,Yy,5,0),c(),a(13,"div",5),g(14,Qy,2,1,"button",6),a(15,"button",7),w("click",function(){return o.popup.close()}),d(16," Close "),c()()()),n&2&&(l(8),St(o.items),l(2),u("disabled",!o.canBuy()),l(2),pt(o.allowsSelling?12:-1),l(2),pt(o.allowsSelling?14:-1))},dependencies:[Xr,Fi,oe,ce],styles:[".item-list[_ngcontent-%COMP%]{display:flex;gap:8px;justify-content:center}.item[_ngcontent-%COMP%]{border:1px solid gray;border-radius:4px;padding:4px;font-size:13px;cursor:pointer;max-width:94px;display:flex;flex-direction:column;align-items:center;text-align:center}.item.active[_ngcontent-%COMP%]{border-color:gold}"]});let i=e;return i})();function Ta(i){let e=H(j),r=H(Lr).escape$.subscribe(()=>e.dispatch(Pi({view:i})));H(Dr).onDestroy(()=>r.unsubscribe())}function Ky(i,e){if(i&1&&(a(0,"div",13),d(1),c()),i&2){let r=f().$implicit;l(),fe(" Level ",r.currentLevel+1,"/",r.base.levels.length," ")}}function Zy(i,e){i&1&&(a(0,"div",13),d(1,"Not built"),c())}function Xy(i,e){if(i&1){let r=R();a(0,"div",8)(1,"div",9),w("click",function(){let n=A(r).$implicit,o=f(2);return O(o.handleBuildingClicked(n))}),h(2,"mw-ra-icon",10),d(3),g(4,Ky,2,2,"div",11)(5,Zy,2,0,"ng-template",null,0,Y),h(7,"hr",12),c()()}if(i&2){let r=e.$implicit,t=se(6),n=f(2);u("mwActionHint","Inspect "+r.base.baseName),l(),$("background-color",n.builtColor),pe("not-built",!r.built),l(),u("icon",r.base.icon),l(),M(" ",r.currentBuilding.name," "),l(),u("ngIf",r.built)("ngIfElse",t)}}function Jy(i,e){if(i&1&&(a(0,"div",5)(1,"div"),d(2),c(),a(3,"div",6),g(4,Xy,8,9,"div",7),c()()),i&2){let r=e.$implicit;l(2),M("Tier ",r.key,""),l(2),u("ngForOf",r.value)}}var El=(()=>{let e=class e{constructor(t,n,o){this.state=t,this.events=n,this.popupService=o,this.players=H(k),this.buildingsByTiers={},this.town=this.state.createdGame.town,this.builtColor=this.state.createdGame.selectedColor,Ta(Ot.Structures),this.buildingsByTiers=Object.entries(this.town.base.availableBuildings).reduce((s,[p,m])=>(s[m.tier]?s[m.tier].push(this.town.buildings[p]):s[m.tier]=[this.town.buildings[p]],s),{})}leaveTown(){this.events.dispatch(xo({}))}handleBuildingClicked(t){if(!t.built){this.popupService.createBasicPopup({component:hs,data:{building:t,targetLevel:1},class:"dark"});return}let n=t.currentBuilding.activity;if(n)switch(n.type){case it.Hiring:let o=n;this.popupService.createBasicPopup({component:Pl,data:{building:t,town:this.town,hiringActivity:o}});break;case it.ItemsSelling:this.popupService.createBasicPopup({component:Dl,data:{building:t}});break;case it.Garrison:this.players.getCurrentPlayer().garrisons&&this.events.dispatch(Ln());break}}};e.\u0275fac=function(n){return new(n||e)(y(X),y(j),y(oi))},e.\u0275cmp=C({type:e,selectors:[["mw-town-view"]],decls:6,vars:3,consts:[["notBuilt",""],["mwActionHint","Return to Map","icon","sideswipe",2,"padding","0px 10px","position","fixed","top","50%",3,"click"],[1,"buildings"],["class","building",4,"ngFor","ngForOf"],[2,"position","absolute","bottom","0","left","0"],[1,"building"],[1,"build"],[3,"mwActionHint",4,"ngFor","ngForOf"],[3,"mwActionHint"],[1,"header",3,"click"],[2,"font-size","28px",3,"icon"],["style","font-size: 10px;",4,"ngIf","ngIfElse"],[2,"width","100%","border-top","0"],[2,"font-size","10px"]],template:function(n,o){n&1&&(a(0,"mw-icon-btn",1),w("click",function(){return o.leaveTown()}),c(),h(1,"mw-action-hint"),a(2,"div",2),g(3,Jy,5,2,"div",3),ie(4,"keyvalue"),c(),h(5,"mw-player-info-panel",4)),n&2&&(l(3),u("ngForOf",ne(4,1,o.buildingsByTiers)))},dependencies:[z,re,Rt,xn,ue,or,ar,ii],styles:[".buildings[_ngcontent-%COMP%]{display:flex;flex-direction:row;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%)}.building[_ngcontent-%COMP%]{display:flex;flex-direction:column;background-color:#41454e;color:#fff;text-align:center;margin:5px;border-radius:8px;font-size:14px}.building[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{padding:10px;cursor:pointer;margin:5px;color:#fff;border-radius:20px;display:flex;flex-direction:column}.building[_ngcontent-%COMP%]   .header.not-built[_ngcontent-%COMP%]{background:#555967!important;color:#aeaeae}.build[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center}mw-action-hint[_ngcontent-%COMP%]{position:fixed;top:90%;left:0;right:0;font-size:13px}"]});let i=e;return i})();var xr=class xr extends ae(){constructor(e,r,t){super(),this.popupService=e,this.battleState=r,this.playersService=t}displayPopup(e){this.popupService.createPopup(e)}openHeroInfo(){this.popupService.createPopup({component:_l,data:{},escape:!0})}openSettings(){this.popupService.createBasicPopup({component:pm,data:{},escape:!0})}openMainMenu(){this.popupService.createBasicPopup({component:va,data:{}})}openGarrison(){this.popupService.createBasicPopup({component:Ml,data:{}})}showGameOverPopup(){this.popupService.createBasicPopup({component:ma,data:{}})}displayPlayerRewardPopup(e){this.popupService.createBasicPopup({component:wa,data:e})}openUnitGroupSplitPopup(e){this.popupService.createBasicPopup({component:xa,data:e})}openUnitSlotsActionPopup(e){this.popupService.createBasicPopup({component:_a,data:e})}displayActionCardsPopup(){this.popupService.createBasicPopup({component:Jo,data:{},class:"transparent",isCloseable:!0})}playerSelectsStructure(e){if(e.struct.guard?.length){let r={struct:e.struct};this.events.dispatch(kr({component:Cl,data:r}));return}if(!e.struct.guard?.length){if(e.struct.generator?.onVisited||e.struct.generator?.type===_t.Scripted){let t={struct:e.struct};this.events.dispatch(kr({component:wl,data:t}));return}let r={struct:e.struct};this.events.dispatch(kr({component:bl,data:r}))}}fightEndsPopup(e){let r={isWin:e.win,playerLosses:this.getPlayerLosses(this.playersService.getCurrentPlayerId()),enemyLosses:this.getPlayerLosses(this.playersService.getEnemyPlayer().id),struct:e.struct};this.popupService.createPopup({data:r,component:vl})}displayRewardPopup(e){let r=e.struct,t={struct:r},n=r.reward;if(n){let o={[He.Resources]:Sl,[He.UnitsHire]:gl,[He.Item]:yl,[He.Scripted]:xl},s=n.type;if(s in o){let p=o[s];this.popupService.createBasicPopup({data:t,component:p})}}}getPlayerLosses(e){return[...this.battleState.playerLosses[e]].map(t=>({type:t[0],count:t[1]}))}};xr.\u0275fac=function(r){return new(r||xr)(x(oi),x(vt),x(k))},xr.\u0275prov=T({token:xr,factory:xr.\u0275fac});var ut=xr;_([G(kr)],ut.prototype,"displayPopup",null);_([J(Un)],ut.prototype,"openHeroInfo",null);_([J(zn)],ut.prototype,"openSettings",null);_([J(Wn)],ut.prototype,"openMainMenu",null);_([J(Ln)],ut.prototype,"openGarrison",null);_([J(Eo)],ut.prototype,"showGameOverPopup",null);_([G(Oo)],ut.prototype,"displayPlayerRewardPopup",null);_([G(bo)],ut.prototype,"openUnitGroupSplitPopup",null);_([G(_o)],ut.prototype,"openUnitSlotsActionPopup",null);_([J(Mo)],ut.prototype,"displayActionCardsPopup",null);_([G(Bn)],ut.prototype,"playerSelectsStructure",null);_([G(yi)],ut.prototype,"fightEndsPopup",null);_([G(To)],ut.prototype,"displayRewardPopup",null);var dm=yt({id:"#acard-loc-attack",title:"Attack",icon:"crossed-swords",type:tt.LocationAction,bgColor:"#f33b4e",description:"Attack the camp."}),mm=yt({id:"#acard-init-attack",title:"Initiative Attack",icon:"groundbreaker",type:tt.LocationAction,bgColor:"red",description:"Attack the camp, allowing your hero to cast a spell at the beginning of the fight."}),fm=yt({id:"#acard-visit",title:"Visit",icon:"trail",type:tt.LocationAction,bgColor:"#ffa446",description:"Visit the location. Takes 1 action point until location says otherwise."});var hm=yt({id:"#acard-thunder",title:"Thunder",icon:"lightning-storm",type:tt.Event,description:"Your hero loses 1 action point."}),gm=yt({id:"#acard-rainbow",title:"Rainbow",icon:"sunbeams",type:tt.Event,description:"Your hero gains +1 action point."}),ym=yt({id:"#acard-snowfall",title:"Snowfall",icon:"frost-emblem",type:tt.Event,description:"Your army is slowed down by 25% during the combat."}),vm=yt({id:"#acard-raiders",title:"Raiders",icon:"demolish",type:tt.Event,description:"Raiders are approaching. At the end of the day, you will lose a random building on the map."});var Fa=(()=>{let e=class e{constructor(){this.hostElem=Or(),this.renderer=H(Le),this.cursor=H(ua),this.ngZone=H(Jt),this.isHovered=!1,this.destroyed$=new Mt,this.setNativeCursorVisibility(!1),this.ngZone.runOutsideAngular(()=>{this.unlistenMouseMove=this.renderer.listen(this.hostElem,"mousemove",t=>{this.cursor.setCustomCursorPos(t.clientX,t.clientY)})})}ngOnDestroy(){this.cursor.clearCustomCursor(),this.isHovered=!1,this.destroyed$.next(),this.unlistenMouseMove()}onMouseOver(t){t.stopPropagation(),this.isHovered=!0;let n=this.getCursorToShow();n?(this.cursor.setCustomCursor(n.animation,n.options,n.data),this.setNativeCursorVisibility(!1)):(this.setNativeCursorVisibility(!0),this.cursor.clearCustomCursor())}onMouseOut(t){t.stopPropagation(),this.isHovered=!1,this.cursor.clearCustomCursor()}getCursorToShow(){return this.cursorAnimation}setCursorIcon(t){this.isHovered&&t&&(this.setNativeCursorVisibility(!1),this.cursor.setCustomCursor(t.animation,t.options,t.data)),t||(this.setNativeCursorVisibility(!0),this.cursor.clearCustomCursor())}recalcCursorIcon(){let t=this.getCursorToShow();this.isHovered&&t&&(this.setCursorIcon(t),this.setNativeCursorVisibility(!1)),t||(this.cursor.clearCustomCursor(),this.setNativeCursorVisibility(!0))}setNativeCursorVisibility(t){this.renderer.setStyle(this.hostElem,"cursor",t?"auto":"none")}};e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=Re({type:e,selectors:[["","mwCustomCursor",""]],hostBindings:function(n,o){n&1&&w("mouseenter",function(p){return o.onMouseOver(p)})("mouseleave",function(p){return o.onMouseOut(p)})}});let i=e;return i})();var gs=new bi("UI element unit group provider"),Aa=(()=>{let e=class e extends Fa{constructor(){super(...arguments),this.curPlayerState=H(nt),this.spells=H(wn),this.players=H(k),this.unitGroupProvider=H(gs)}ngOnInit(){this.unitGroup=this.unitGroupProvider.getUnitGroup(),this.curPlayerState.playerStateChanged$.pipe(Xe(this.destroyed$)).subscribe(()=>{this.recalcCursorIcon()})}getCursorToShow(){let t=this.players.isEnemyUnitGroup(this.unitGroup),n=this.curPlayerState.playerCurrentState;if(this.curPlayerState.playerCurrentState!==_e.SpellTargeting&&!t)return null;if(n===_e.Normal&&(!t||t&&!this.unitGroup.fightInfo.isAlive))return this.createStaticCursor("interdiction");let o=this.spells.canSpellBeCastOnUnit(this.curPlayerState.currentSpell,this.unitGroup,t);if(n===_e.SpellTargeting&&!o)return this.createStaticCursor("interdiction");let s={[_e.Normal]:"sword",[_e.SpellTargeting]:"burning-book",[_e.WaitsForTurn]:"hourglass"};return this.curPlayerState.playerCurrentState===_e.SpellTargeting?{animation:cu,options:{duration:2e3,iterations:1/0}}:this.createStaticCursor(s[this.curPlayerState.playerCurrentState])}createStaticCursor(t){return t==="interdiction"?{animation:au,data:{custom:{parts:[{color:"white",icon:t,text:"",type:"plainPart"}]}}}:{animation:su,data:{custom:{parts:[{color:"white",icon:t,text:"",type:"plainPart"}]}}}}};e.\u0275fac=(()=>{let t;return function(o){return(t||(t=dt(e)))(o||e)}})(),e.\u0275dir=Re({type:e,selectors:[["","mwUnitEventsCursor",""]],features:[N]});let i=e;return i})();var Oa=(()=>{let e=class e{constructor(t,n,o,s,p){this.curPlayerState=t,this.players=n,this.mwBattleStateService=o,this.events=s,this.unitGroupProvider=p,this.isEnemyCard=!1}ngOnInit(){this.actionTargetUnitGroup=this.unitGroupProvider.getUnitGroup(),this.isEnemyCard=this.players.isEnemyUnitGroup(this.actionTargetUnitGroup)}onContextMenu(t){return t.stopPropagation(),t.preventDefault(),!1}onMouseDown(t){t.button===2&&(t.preventDefault(),this.curPlayerState.isSpellBeingCasted()?(this.curPlayerState.cancelCurrentSpell(),this.dispatchUnitGroupHovered(this.isEnemyCard?gt.EnemyCard:gt.AllyCard)):this.events.dispatch(jo({unitGroup:this.actionTargetUnitGroup})))}onClick(){if(!this.canActivateCurrentSpell()){this.curPlayerState.cancelCurrentSpell();return}if(this.isEnemyCard){if(!this.actionTargetUnitGroup.fightInfo.isAlive)return;this.events.dispatch(Lo({attackedGroup:this.actionTargetUnitGroup,attackingGroup:this.mwBattleStateService.currentUnitGroup,attackingPlayer:this.mwBattleStateService.currentPlayer})),this.dispatchUnitGroupHovered(gt.EnemyCard)}else this.events.dispatch(No({unitGroup:this.actionTargetUnitGroup})),this.dispatchUnitGroupHovered(gt.Unhover)}canActivateCurrentSpell(){let n=this.curPlayerState.currentSpell.baseType.config.spellConfig.targetCastConfig?.canActivate;return n?n({unitGroup:this.actionTargetUnitGroup,isEnemy:this.isEnemyCard}):!0}dispatchUnitGroupHovered(t){this.events.dispatch(Di({hoverType:t,currentCard:this.mwBattleStateService.currentUnitGroup,hoveredCard:this.actionTargetUnitGroup}))}};e.\u0275fac=function(n){return new(n||e)(y(nt),y(k),y(vt),y(j),y(gs))},e.\u0275dir=Re({type:e,selectors:[["","mwUnitGroupCombatAction",""]],hostBindings:function(n,o){n&1&&w("contextmenu",function(p){return o.onContextMenu(p)})("mousedown",function(p){return o.onMouseDown(p)})("click",function(p){return o.onClick(p)})},inputs:{actionTargetUnitGroup:"actionTargetUnitGroup"}});let i=e;return i})();function nv(i,e){i&1&&h(0,"mw-ra-icon",20)}function rv(i,e){i&1&&h(0,"mw-ra-icon",21)}function ov(i,e){if(i&1&&(a(0,"div"),h(1,"mw-ra-icon",22),d(2),c()),i&2){let r=f().ngIf;l(2),M(" ",r.totalHealth," ")}}function sv(i,e){if(i&1&&h(0,"mw-unit-group-spell",23),i&2){let r=e.$implicit,t=f(2);u("hintPos",t.spellsHintsPosition)("spell",r)("owner",t.unitGroup)("onCooldown",t.unitGroup.fightInfo.spellsOnCooldown)("currentUnit",t.attackingUnitGroup)}}function av(i,e){if(i&1&&h(0,"mw-unit-group-buff",24),i&2){let r=e.$implicit,t=f(2);u("hintPos",t.spellsHintsPosition)("buff",r)("ownerUnit",t.unitGroup)}}function cv(i,e){if(i&1&&h(0,"mw-value-bar",25),i&2){let r=f(2);u("side",r.side)("showMax",!0)("currentValue",r.unitGroup.tailUnitHp)("maxValue",r.unitGroup.type.baseStats.health)("barHeight",14)}}function lv(i,e){if(i&1){let r=R();a(0,"div",3),w("mouseenter",function(){A(r);let n=f();return O(n.onCardHover(!0))})("mouseleave",function(){A(r);let n=f();return O(n.onCardHover(!1))}),a(1,"div",4)(2,"div",5)(3,"div",6),d(4),c(),a(5,"div",7)(6,"div"),h(7,"mw-ra-icon",8),d(8),c(),a(9,"div"),g(10,nv,1,0,"mw-ra-icon",9)(11,rv,1,0,"ng-template",null,0,Y),d(13),c(),a(14,"div"),h(15,"mw-ra-icon",10),d(16),h(17,"span",11),c(),g(18,ov,3,1,"div",12),c()(),a(19,"div",13)(20,"div",14),g(21,sv,1,5,"mw-unit-group-spell",15),c(),a(22,"div",14),g(23,av,1,3,"mw-unit-group-buff",16),c()()(),a(24,"div",17),h(25,"mw-unit-group-portrait",18),g(26,cv,1,5,"mw-value-bar",19),c()()}if(i&2){let r=e.ngIf,t=se(12),n=f();pe("active",n.mwBattleStateService.currentPlayer===n.playerInfo&&n.attackingUnitGroup===n.unitGroup)("inactive",!n.unitGroup.turnsLeft&&n.unitGroup.fightInfo.isAlive)("defeated",!n.unitGroup.fightInfo.isAlive),u("ngClass",n.side==="left"?"card-left":"card-right"),l(2),$("background",n.playerInfo.color),pe("current-group",n.mwBattleStateService.currentPlayer===n.playerInfo&&n.attackingUnitGroup===n.unitGroup)("hovered-enemy",n.isCardHovered&&n.isEnemyCard&&n.canCurrentPlayerAttack),l(2),fe(" ",n.unitGroup.type.name," (",n.unitGroup.count,") "),l(4),fe(" (",n.unitGroup.turnsLeft,"/",n.unitGroup.type.defaultTurnsPerRound,") "),l(2),u("ngIf",n.isGroupMelee)("ngIfElse",t),l(3),M(" ",r.avgTotalDamage," "),l(),pe("defence",r.defends),l(2),M(" ",r.baseSpeed," "),l(),u("mwNumberModifier",r.speedBonus),l(),u("ngIf",!n.isBoss),l(),u("ngClass",n.side),l(2),u("ngForOf",n.spells),l(2),u("ngForOf",n.effects),l(2),u("unitGroup",n.unitGroup)("toRight",n.side==="left"),l(),u("ngIf",n.isBoss)}}var ys=(()=>{let e=class e extends ae(){constructor(t,n,o,s,p,m){super(),this.hostElem=t,this.mwBattleStateService=n,this.playersService=o,this.unitsService=s,this.units=p,this.renderer=m,this.side="left",this.cardReady=new Ct,this.groupDies=new Ct,this.isCardHovered=!1,this.canCurrentPlayerAttack=!1,this.isGroupMelee=!1,this.initialCount=0,this.spells=[],this.effects=[],this.isBoss=!1,this.destroy$=new Mt}ngOnInit(){this.spellsHintsPosition="above",this.isGroupMelee=!this.unitsService.isUnitGroupRanged(this.unitGroup),this.isEnemyCard=this.playersService.getCurrentPlayer()!==this.playerInfo,this.initialCount=this.unitGroup.count,this.isBoss=this.unitGroup.type.defaultModifiers?.isBoss,this.cardReady.next(this),this.unitStats$=this.unitGroup.listenStats(),this.unitGroup.modGroup.getModValue("isSummon")&&this.renderer.addClass(this.hostElem.nativeElement,"summoned"),this.updateSpellsAndEffects(),this.events.eventStream$.pipe(Xe(this.destroyed$)).subscribe(()=>{let n=this.mwBattleStateService.currentUnitGroup;this.attackingUnitGroup=n,this.canCurrentPlayerAttack=this.mwBattleStateService.currentPlayer===this.playersService.getCurrentPlayer()}),this.events.onEvent(ln).pipe(Xe(this.destroyed$)).subscribe(n=>{n.unitGroup===this.unitGroup&&this.updateSpellsAndEffects()})}onDestroyed(){this.destroy$.next(),this.destroy$.complete(),this.events.dispatch(Di({hoverType:gt.Unhover})),this.groupDies.next()}onCardHover(t){if(this.isCardHovered=t,t){if(!this.unitGroup.fightInfo.isAlive){this.events.dispatch(Di({hoverType:gt.Unhover}));return}this.events.dispatch(Di({hoverType:this.isEnemyCard?gt.EnemyCard:gt.AllyCard,currentCard:this.mwBattleStateService.currentUnitGroup,hoveredCard:this.unitGroup}))}else this.events.dispatch(Di({hoverType:gt.Unhover}))}getUnitGroup(){return this.unitGroup}updateSpellsAndEffects(){let t=this.unitGroup.spells;this.effects=t.filter(n=>n.isEffect()),this.spells=t.filter(n=>!n.isEffect())}};e.\u0275fac=function(n){return new(n||e)(y(mt),y(vt),y(k),y(Da),y(Fe),y(Le))},e.\u0275cmp=C({type:e,selectors:[["mw-unit-group-card"]],inputs:{unitGroup:"unitGroup",playerInfo:"playerInfo",side:"side"},outputs:{cardReady:"cardReady",groupDies:"groupDies"},features:[xs([{provide:gs,useExisting:ql(()=>e)}]),N],decls:3,vars:4,consts:[["rangedIcon",""],[3,"containerId"],["class","card-top",3,"active","ngClass","inactive","defeated","mouseenter","mouseleave",4,"ngIf"],[1,"card-top",3,"mouseenter","mouseleave","ngClass"],[1,"card-wrapper"],[1,"card"],[2,"padding-bottom","3px","font-weight","500","white-space","nowrap"],[2,"font-size","12px"],["icon","spinning-sword"],["icon","sword",4,"ngIf","ngIfElse"],["icon","feather-wing"],[3,"mwNumberModifier"],[4,"ngIf"],[1,"abilities",3,"ngClass"],[1,"column-data"],[3,"hintPos","spell","owner","onCooldown","currentUnit",4,"ngFor","ngForOf"],[3,"hintPos","buff","ownerUnit",4,"ngFor","ngForOf"],[1,"portrait-container"],[3,"unitGroup","toRight"],["class","health-bar","barStyle","normal","color","rgb(201, 45, 45)",3,"side","showMax","currentValue","maxValue","barHeight",4,"ngIf"],["icon","sword"],["icon","crossbow"],["icon","health"],[3,"hintPos","spell","owner","onCooldown","currentUnit"],[3,"hintPos","buff","ownerUnit"],["barStyle","normal","color","rgb(201, 45, 45)",1,"health-bar",3,"side","showMax","currentValue","maxValue","barHeight"]],template:function(n,o){n&1&&(a(0,"mw-vfx-container",1),g(1,lv,27,31,"div",2),ie(2,"async"),c()),n&2&&(u("containerId",o.unitGroup.id),l(),u("ngIf",ne(2,2,o.unitStats$)))},styles:["@keyframes _ngcontent-%COMP%_summonedAnimation{0%{opacity:0;height:0;width:0px}to{opacity:100%;height:100px;width:115px}}.summoned[_nghost-%COMP%]{animation:_ngcontent-%COMP%_summonedAnimation .6s ease-in-out}.card-top[_ngcontent-%COMP%]{display:flex;position:relative;transition:.5s;left:0;right:0}.portrait-container[_ngcontent-%COMP%]{position:absolute;top:-25px}.card-left[_ngcontent-%COMP%]   .portrait-frame[_ngcontent-%COMP%]{scale:-1 1}.vertical[_nghost-%COMP%]   .card-left[_ngcontent-%COMP%]   .portrait-container[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-left[_ngcontent-%COMP%]   .portrait-container[_ngcontent-%COMP%]{right:79%}.vertical[_nghost-%COMP%]   .card-right[_ngcontent-%COMP%]   .portrait-container[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-right[_ngcontent-%COMP%]   .portrait-container[_ngcontent-%COMP%]{left:79%}.horizontal[_nghost-%COMP%]   .portrait-container[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .portrait-container[_ngcontent-%COMP%]{z-index:-1;right:0;top:-94px;left:-10px}.health-bar[_ngcontent-%COMP%]{position:relative;overflow:hidden;top:-42px;width:70px;border-radius:7px;border:1px solid gold}.card-left[_ngcontent-%COMP%]   .health-bar[_ngcontent-%COMP%]{left:24px}.card-right[_ngcontent-%COMP%]   .health-bar[_ngcontent-%COMP%]{right:-23px}.card-left[_ngcontent-%COMP%]{text-align:right}.card-right[_ngcontent-%COMP%]{text-align:left}.card-wrapper[_ngcontent-%COMP%]{position:relative}.abilities[_ngcontent-%COMP%]{position:absolute;font-size:12px;top:0;display:flex}.vertical[_nghost-%COMP%]   .abilities.left[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .abilities.left[_ngcontent-%COMP%]{right:185%;flex-direction:row-reverse}.vertical[_nghost-%COMP%]   .abilities.right[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .abilities.right[_ngcontent-%COMP%]{left:185%}.horizontal[_nghost-%COMP%]   .abilities[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .abilities[_ngcontent-%COMP%]{top:-62%;left:-42px;flex-direction:column}.card[_ngcontent-%COMP%]{display:block;width:115px;height:100px;border-radius:6px;align-items:center;box-sizing:border-box;font-size:13px;padding:4px 15px 0;color:#fff;border:3px solid transparent;-webkit-user-select:none;user-select:none}.card.current-group[_ngcontent-%COMP%]{border:3px solid gold}.hovered-enemy[_ngcontent-%COMP%]{border:3px solid rgba(240,113,113,.906)}.column-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin:0 4px}[_nghost-%COMP%]{position:relative}.card-top[_ngcontent-%COMP%]{transition:.5s;filter:brightness(100%) drop-shadow(0 0 0 rgba(0,0,0,.721))}.card-top.active[_ngcontent-%COMP%]{filter:brightness(100%) drop-shadow(2px 4px 6px rgba(0,0,0,.721))}.card-top.inactive[_ngcontent-%COMP%]{filter:brightness(85%) drop-shadow(0 0 0 rgba(0,0,0,.721))}.card-top.defeated[_ngcontent-%COMP%]{filter:brightness(55%) drop-shadow(0 0 0 rgba(0,0,0,.721))}.vertical[_nghost-%COMP%]   .card-top.active.card-left[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.active.card-left[_ngcontent-%COMP%]{left:32px}.vertical[_nghost-%COMP%]   .card-top.active.card-right[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.active.card-right[_ngcontent-%COMP%]{right:32px}.vertical[_nghost-%COMP%]   .card-top.inactive.card-left[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.inactive.card-left[_ngcontent-%COMP%]{left:-32px}.vertical[_nghost-%COMP%]   .card-top.inactive.card-right[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.inactive.card-right[_ngcontent-%COMP%]{right:-32px}.vertical[_nghost-%COMP%]   .card-top.defeated.card-left[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.defeated.card-left[_ngcontent-%COMP%]{left:-32px}.vertical[_nghost-%COMP%]   .card-top.defeated.card-right[_ngcontent-%COMP%], .vertical   [_nghost-%COMP%]   .card-top.defeated.card-right[_ngcontent-%COMP%]{right:32px}.horizontal[_nghost-%COMP%]   .card-top.active.card-left[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.active.card-left[_ngcontent-%COMP%]{transform:translateY(-32px)}.horizontal[_nghost-%COMP%]   .card-top.active.card-right[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.active.card-right[_ngcontent-%COMP%]{transform:translateY(32px)}.horizontal[_nghost-%COMP%]   .card-top.inactive.card-left[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.inactive.card-left[_ngcontent-%COMP%]{transform:translateY(32px)}.horizontal[_nghost-%COMP%]   .card-top.inactive.card-right[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.inactive.card-right[_ngcontent-%COMP%]{transform:translateY(-32px)}.horizontal[_nghost-%COMP%]   .card-top.defeated.card-left[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.defeated.card-left[_ngcontent-%COMP%]{transform:translateY(32px)}.horizontal[_nghost-%COMP%]   .card-top.defeated.card-right[_ngcontent-%COMP%], .horizontal   [_nghost-%COMP%]   .card-top.defeated.card-right[_ngcontent-%COMP%]{transform:translateY(-32px)}.defence[_ngcontent-%COMP%]{font-weight:700;color:gold}"]});let i=e;return i})();function pv(i,e){if(i&1){let r=R();a(0,"mw-unit-group-card",12),w("grupDies",function(){let n=A(r).$implicit,o=f();return O(o.onGroupDies(n))}),c()}if(i&2){let r=e.$implicit,t=f();u("playerInfo",t.mainPlayerInfo)("unitGroup",r)}}function uv(i,e){if(i&1){let r=R();a(0,"mw-unit-group-card",13),w("groupDies",function(){let n=A(r).$implicit,o=f();return O(o.onGroupDies(n))}),c()}if(i&2){let r=e.$implicit,t=f();u("playerInfo",t.enemyPlayerInfo)("unitGroup",r)}}function dv(i,e){if(i&1&&(a(0,"div",14)(1,"div"),d(2),c(),a(3,"div"),d(4),c(),a(5,"div"),d(6),c()()),i&2){let r=e.$implicit;$("background",r.ownerPlayer.color),l(2),B(r.type.name),l(2),B(r.count),l(2),M("turns: ",r.turnsLeft,"")}}var Jr=class Jr extends ae(){constructor(e,r,t,n,o,s,p,m,v){super(),this.mwPlayerState=e,this.players=r,this.mwBattleState=t,this.mwNeutralPlayer=n,this.cardsMapping=o,this.combatInteractor=s,this.vfx=p,this.cd=m,this.state=v,this.settings=this.state.settings,this.orientation=rn,this.currentUnitGroup$=this.mwBattleState.currentUnitGroup$,this.canDefend$=this.mwBattleState.currentUnitGroup$.pipe(Ri(S=>!!(S&&!S.getStats().defends&&!this.players.isEnemyUnitGroup(S)))),this.defendActionMessage$=this.mwBattleState.currentUnitGroup$.pipe(Ri(S=>!S||this.players.isEnemyUnitGroup(S)?"":S.getStats().defends?"Unit group is already defending":`Defend ${S.count} ${S.type.name}`))}ngOnInit(){this.mainPlayerUnitGroups=this.mwPlayerState.getUnitGroups(),this.neutralPlayerGroups=this.mwNeutralPlayer.getUnitGroups(),this.mainPlayerInfo=this.mwPlayerState.getPlayerInfo(),this.enemyPlayerInfo=this.mwNeutralPlayer.getPlayerInfo()}onGroupDies(e){this.cardsMapping.unregister(e)}ngAfterViewInit(){this.cards.forEach(e=>this.cardsMapping.register(e.unitGroup,e)),this.initInteractions(),this.cd.detectChanges()}initInteractions(){this.combatInteractor.onBattleBegins(),this.events.dispatch(Po({players:[this.mainPlayerInfo,this.enemyPlayerInfo],unitGroups:[...this.mainPlayerUnitGroups,...this.neutralPlayerGroups]})),this.updateFightQueue(),this.events.eventStream$.pipe(Xe(this.destroyed$)).subscribe(()=>{this.updatePlayersUnitGroupsToShow()})}defend(){this.events.dispatch(vo())}displayDamageVfxOverAttackedGroup(e){let r=e.attackingGroup.type.defaultModifiers?.isRanged;e.lifeStolen&&(this.vfx.createDroppingMessageForContainer(e.attackingGroup.id,fu(e.lifeStolenUnitsRestored,e.lifeStolen),{duration:1600}),this.vfx.createEffectAnimationForUnitGroup(e.attackingGroup,ru,{duration:700,darkOverlay:!1})),this.vfx.createFloatingMessageForUnitGroup(e.attackedGroup,$t(e.damage,e.loss,r,e.damageBlocked,e.isCritical),{duration:e.isCritical?1200:e.damageBlocked?1100:1e3})}registerSummonedUnit(e){this.updatePlayersUnitGroupsToShow(),this.cd.detectChanges(),this.cardsMapping.register(e.unitGroup,this.cards.find(r=>r.unitGroup===e.unitGroup))}updatePlayersUnitGroupsToShow(){this.mainPlayerUnitGroups=this.mwBattleState.heroesUnitGroupsMap.get(this.mainPlayerInfo),this.neutralPlayerGroups=this.mwBattleState.heroesUnitGroupsMap.get(this.enemyPlayerInfo),this.updateFightQueue()}updateFightQueue(){this.fightQueue=this.mwBattleState.getFightQueue()}};Jr.\u0275fac=function(r){return new(r||Jr)(y(nm),y(k),y(vt),y(im),y(Br),y(Pn),y(ai),y(di),y(X))},Jr.\u0275cmp=C({type:Jr,selectors:[["mw-gameboard"]],viewQuery:function(r,t){if(r&1&&Pe(ys,5),r&2){let n;De(n=Ee())&&(t.cards=n)}},features:[N],decls:19,vars:10,consts:[[1,"columns-wrapper",3,"ngClass"],[1,"columns"],[1,"column"],["class","card","mwUnitGroupCombatAction","","mwUnitEventsCursor","","side","left",3,"playerInfo","unitGroup","grupDies",4,"ngFor","ngForOf"],["class","card","mwUnitGroupCombatAction","","mwUnitEventsCursor","","side","right",3,"playerInfo","unitGroup","groupDies",4,"ngFor","ngForOf"],[1,"abilities-panel"],["icon","shield",2,"width","60px","text-align","center","color","#ffe5a0","background","#505263",3,"click","disabled","mwActionHint"],[1,"queue-panel"],["class","queue-card",3,"background",4,"ngFor","ngForOf"],[1,"hint-panel"],[1,"history-log-panel"],[1,"items-panel"],["mwUnitGroupCombatAction","","mwUnitEventsCursor","","side","left",1,"card",3,"grupDies","playerInfo","unitGroup"],["mwUnitGroupCombatAction","","mwUnitEventsCursor","","side","right",1,"card",3,"groupDies","playerInfo","unitGroup"],[1,"queue-card"]],template:function(r,t){r&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),g(3,pv,1,2,"mw-unit-group-card",3),c(),a(4,"div",2),g(5,uv,1,2,"mw-unit-group-card",4),c()()(),a(6,"div",5)(7,"mw-icon-btn",6),ie(8,"async"),ie(9,"async"),w("click",function(){return t.defend()}),c(),h(10,"mw-battle-hero-abilities"),c(),a(11,"div",7),g(12,dv,7,5,"div",8),c(),h(13,"mw-action-hint",9),a(14,"div",10),h(15,"mw-history-log"),c(),a(16,"div",11),d(17," Items: "),h(18,"mw-items-panel"),c()),r&2&&(u("ngClass",t.settings.orientation===t.orientation.Horizontal?"horizontal":"vertical"),l(3),u("ngForOf",t.mainPlayerUnitGroups),l(2),u("ngForOf",t.neutralPlayerGroups),l(2),u("disabled",ne(8,6,t.canDefend$)===!1)("mwActionHint",ne(9,8,t.defendActionMessage$)),l(5),u("ngForOf",t.fightQueue))},styles:[".columns-wrapper[_ngcontent-%COMP%]{position:absolute;top:0;left:0;height:80%;width:100%;display:flex;align-items:center}.columns-wrapper.horizontal[_ngcontent-%COMP%]{top:90px;height:65%}.columns-wrapper.horizontal[_ngcontent-%COMP%]   .columns[_ngcontent-%COMP%]{flex-direction:column-reverse}.columns-wrapper.horizontal[_ngcontent-%COMP%]   .columns[_ngcontent-%COMP%] > .column[_ngcontent-%COMP%]{flex-direction:row;height:auto;justify-content:space-evenly;width:100%}.columns[_ngcontent-%COMP%]{display:flex;width:680px;height:100%;justify-content:space-between;margin:auto;align-items:center}.column[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;justify-content:center}.card[_ngcontent-%COMP%]{margin:6px}.queue-panel[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;position:absolute;bottom:0;left:0}.queue-card[_ngcontent-%COMP%]{height:64px;width:64px;border-radius:6px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:12px;color:#fff;text-align:center;margin:8px}.abilities-panel[_ngcontent-%COMP%]{position:fixed;left:100px;top:35%}.hint-panel[_ngcontent-%COMP%]{display:flex;justify-content:center;width:100%;position:absolute;bottom:81px;left:0;font-size:12px}.history-log-panel[_ngcontent-%COMP%]{position:absolute;right:0;bottom:0;width:370px}.items-panel[_ngcontent-%COMP%]{position:absolute;left:16px;bottom:75px}"]});var En=Jr;_([G(Gn)],En.prototype,"displayDamageVfxOverAttackedGroup",null);_([G(uo)],En.prototype,"registerSummonedUnit",null);function fv(i,e){if(i&1&&(a(0,"span"),d(1),c()),i&2){let r=f().ngIf;l(),M(" (+",r.bonusAttack,") ")}}function hv(i,e){if(i&1&&(a(0,"span"),d(1),c()),i&2){let r=f().ngIf;l(),M(" (+",r.bonusDefence,") ")}}function gv(i,e){if(i&1&&(a(0,"div")(1,"div",1)(2,"div"),d(3),c(),a(4,"div"),d(5),c()(),a(6,"div",1)(7,"div"),d(8),c(),a(9,"div"),d(10),c()(),a(11,"div",1)(12,"div"),d(13),c(),a(14,"div"),d(15),c()(),a(16,"div",1)(17,"div"),d(18),c(),a(19,"div"),d(20),c()(),a(21,"div",1)(22,"div"),d(23,"Mana:"),c(),a(24,"div"),d(25),c()(),a(26,"div",1)(27,"div"),d(28,"Attack:"),c(),a(29,"div"),d(30),g(31,fv,2,1,"span",0),c()(),a(32,"div",1)(33,"div"),d(34,"Defence:"),c(),a(35,"div"),d(36),g(37,hv,2,1,"span",0),c()(),a(38,"div",2)(39,"div")(40,"div"),d(41),c()()()()),i&2){let r=e.ngIf,t=f();l(3),M("",t.resourceNames.gold,":"),l(2),B(t.currentPlayer.resources.gold),l(3),M("",t.resourceNames.wood,":"),l(2),B(t.currentPlayer.resources.wood),l(3),M("",t.resourceNames.redCrystals,":"),l(2),B(t.currentPlayer.resources.redCrystals),l(3),M("",t.resourceNames.gems,":"),l(2),B(t.currentPlayer.resources.gems),l(5),fe("",r.currentMana,"/",r.maxMana,""),l(5),M(" ",r.baseAttack," "),l(),u("ngIf",r.bonusAttack),l(5),M(" ",r.baseDefence," "),l(),u("ngIf",r.bonusDefence),l(4),fe(" Week: ",t.state.currentGame.week,", Day: ",t.state.currentGame.day," ")}}var Il=(()=>{let e=class e{constructor(t,n){this.playersService=t,this.state=n,this.resourceNames=ea,this.currentPlayer=this.playersService.getCurrentPlayer(),this.heroStats$=this.currentPlayer.hero.listenHeroStats()}};e.\u0275fac=function(n){return new(n||e)(y(k),y(X))},e.\u0275cmp=C({type:e,selectors:[["mw-player-resources"]],decls:2,vars:3,consts:[[4,"ngIf"],[1,"resource-info-row"],[1,"sub-info"]],template:function(n,o){n&1&&(g(0,gv,42,16,"div",0),ie(1,"async")),n&2&&u("ngIf",ne(1,1,o.heroStats$))},dependencies:[re,gi],styles:[".resource-info-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin:2px}[_nghost-%COMP%]{font-size:12px}.sub-info[_ngcontent-%COMP%]{margin-top:8px;font-size:13px}"]});let i=e;return i})();var vv=i=>[i];function Cv(i,e){if(i&1&&(a(0,"div"),h(1,"mw-ra-icon",24),a(2,"span",25),d(3),c()()),i&2){let r=f();l(),u("icon",r.selectedFaction.icon),l(2),B(r.selectedFaction.title)}}function wv(i,e){i&1&&(a(0,"div"),h(1,"mw-ra-icon",26),a(2,"span",25),d(3,"Random"),c()())}function Sv(i,e){if(i&1){let r=R();a(0,"mw-ra-icon",29),w("click",function(){let n=A(r).$implicit,o=f(2);return O(o.selectFaction(n))}),c()}if(i&2){let r=e.$implicit;u("icon",r.icon)}}function xv(i,e){if(i&1){let r=R();a(0,"mw-ra-icon",27),w("click",function(){A(r);let n=f();return O(n.selectFaction())}),c(),g(1,Sv,1,1,"mw-ra-icon",28)}if(i&2){let r=f();l(),u("ngForOf",r.playableFactions)}}function bv(i,e){if(i&1&&(a(0,"div"),h(1,"div",30),a(2,"span",25),d(3),c()()),i&2){let r=f();l(),$("background-image","url('assets/"+r.selectedHero.image+"')"),l(2),B(r.selectedHero.name)}}function _v(i,e){i&1&&(a(0,"div"),h(1,"mw-ra-icon",26),a(2,"span",25),d(3,"Random"),c()())}function Mv(i,e){if(i&1){let r=R();a(0,"div",32),w("click",function(){let n=A(r).$implicit,o=f(2);return O(o.selectHero(n))}),h(1,"div",30),a(2,"span",25),d(3),c()()}if(i&2){let r=e.$implicit;l(),$("background-image","url('assets/"+r.image+"')"),l(2),B(r.name)}}function Pv(i,e){if(i&1){let r=R();a(0,"div",31)(1,"div",32),w("click",function(){A(r);let n=f();return O(n.selectHero(null))}),h(2,"mw-ra-icon",26),a(3,"span",25),d(4,"Random"),c()(),g(5,Mv,4,3,"div",33),c()}if(i&2){let r=f();l(5),u("ngForOf",r.heroes)}}function Dv(i,e){if(i&1){let r=R();a(0,"div",35),w("click",function(){let n=A(r).$implicit,o=f(2);return O(o.pickColor(n))}),c()}if(i&2){let r=e.$implicit;$("background",r)}}function Ev(i,e){if(i&1&&g(0,Dv,1,2,"div",34),i&2){let r=f();u("ngForOf",r.colors)}}function Iv(i,e){if(i&1&&(a(0,"div")(1,"div"),d(2),c(),h(3,"mw-ra-icon",36),a(4,"div",37)(5,"div",38)(6,"div"),h(7,"mw-ra-icon",39),d(8),c(),a(9,"div"),h(10,"mw-ra-icon",40),d(11),c(),a(12,"div"),h(13,"mw-ra-icon",41),d(14),c()(),a(15,"div",38)(16,"div",42)(17,"div"),d(18),c(),a(19,"div"),d(20),c()()()(),a(21,"div",43),h(22,"mw-description",44),c()()),i&2){let r=f();l(2),M(" ",r.selectedHero.name," "),l(6),M(" ",r.selectedHero.initialState.stats.baseAttack," "),l(3),M(" ",r.selectedHero.initialState.stats.baseDefence," "),l(3),M(" ",r.selectedHero.initialState.stats.mana," "),l(4),M(" Gold: ",r.selectedHero.initialState.resources.gold," "),l(2),M(" Wood: ",r.selectedHero.initialState.resources.wood," "),l(2),u("descriptions",Ue(7,vv,r.selectedHero.generalDescription))}}function Tv(i,e){if(i&1&&(a(0,"span"),d(1),c()),i&2){let r=f(2);l(),M(" Play as random hero of ",r.selectedFaction.title," faction. ")}}function Fv(i,e){i&1&&(a(0,"span"),d(1,"Play as random hero of any faction."),c())}function Av(i,e){if(i&1&&(a(0,"div")(1,"div"),d(2,"Random Hero"),c(),h(3,"mw-ra-icon",45),a(4,"div",43),g(5,Tv,2,1,"span",16)(6,Fv,2,0,"ng-template",null,6,Y),c()()),i&2){let r=se(7),t=f();l(5),u("ngIf",t.selectedFaction)("ngIfElse",r)}}var Ov=[je],Cm=(()=>{let e=class e{constructor(t,n,o){this.events=t,this.state=n,this.gameObjectsManager=o,this.playableFactions=Ar.getAllFactions().filter(s=>!Ov.includes(s)),this.heroes=null,this.selectedHero=null,this.pickedColor=On.BLUE,this.colors=[On.BLUE,On.RED,On.GREEN],this.selectFaction(We),Ta(Ot.MainScreen)}startGame(){let t=this.selectedFaction||q.randItem(this.playableFactions),n=t.getTownBase();this.state.createdGame={faction:t,selectedColor:this.pickedColor,selectedHero:this.selectedHero||q.randItem(t.heroes),town:this.gameObjectsManager.createNewGameObject(om,{townBase:n})},console.log(this.state.createdGame),this.events.dispatch(wo())}returnToMainScreen(){this.events.dispatch(Vn())}selectFaction(t){this.selectedFaction=t,console.log(t),t?(this.heroes=t.getAllHeroes(),this.selectedHero=this.heroes[0]):(this.heroes=null,this.selectedHero=null)}selectHero(t){this.selectedHero=t}pickColor(t){this.pickedColor=t}};e.\u0275fac=function(n){return new(n||e)(y(j),y(X),y(xe))},e.\u0275cmp=C({type:e,selectors:[["mw-new-game-screen"]],decls:46,vars:13,consts:[["randomFaction",""],["factionsMenu",""],["randomHero",""],["heroesMenu",""],["colorsMenu",""],["randomHeroDescr",""],["allRandomHero",""],[1,"main-container"],[1,"players"],[1,"players-row"],[1,"name"],[1,"faction"],[1,"hero"],[1,"color"],[1,"player","players-row"],[3,"menuBody","pos"],[4,"ngIf","ngIfElse"],["pos","below",3,"menuBody"],[1,"color-item",2,"position","relative","top","-6px"],[1,"right-panel"],[1,"hero-description"],[1,"bottom-container"],[1,"buttons"],["mw-main-button","",3,"click"],[1,"item-icon",3,"icon"],[1,"icon-subtext"],["icon","perspective-dice-four",1,"item-icon"],["icon","perspective-dice-four",1,"item-icon",3,"click"],["class","item-icon",3,"icon","click",4,"ngFor","ngForOf"],[1,"item-icon",3,"click","icon"],[1,"item-icon","hero-icon"],[2,"display","flex","max-width","228px","padding","4px","justify-content","center","flex-wrap","wrap"],[1,"hero-option",3,"click"],["class","hero-option",3,"click",4,"ngFor","ngForOf"],["class","color-item",3,"background","click",4,"ngFor","ngForOf"],[1,"color-item",3,"click"],["icon","aura",1,"hero-icon"],[1,"hero-stats"],[1,"column"],["icon","sword"],["icon","shield"],["icon","crystal-ball"],[2,"margin-top","16px"],[1,"description"],[3,"descriptions"],["icon","perspective-dice-four",1,"hero-icon"]],template:function(n,o){if(n&1){let s=R();a(0,"div",7)(1,"div",8)(2,"div",9)(3,"div",10),d(4," Player: "),c(),a(5,"div",11),d(6," Faction: "),c(),a(7,"div",12),d(8," Hero: "),c(),a(9,"div",13),d(10," Color: "),c()(),a(11,"div",14)(12,"div",10),d(13,"Player 1"),c(),a(14,"div",11)(15,"mw-menu",15),g(16,Cv,4,2,"div",16)(17,wv,4,0,"ng-template",null,0,Y),c(),g(19,xv,2,1,"ng-template",null,1,Y),c(),a(21,"div",12)(22,"mw-menu",15),g(23,bv,4,3,"div",16)(24,_v,4,0,"ng-template",null,2,Y),c(),g(26,Pv,6,1,"ng-template",null,3,Y),c(),a(28,"div",13)(29,"mw-menu",17),h(30,"div",18),c(),g(31,Ev,1,1,"ng-template",null,4,Y),c()()(),a(33,"div",19)(34,"div",20)(35,"div",10),d(36,"Hero"),c(),g(37,Iv,23,9,"div",16),c(),g(38,Av,8,2,"ng-template",null,5,Y),c()(),a(40,"div",21)(41,"div",22)(42,"button",23),w("click",function(){return A(s),O(o.startGame())}),d(43," Start game "),c(),a(44,"button",23),w("click",function(){return A(s),O(o.returnToMainScreen())}),d(45," Return "),c()()()}if(n&2){let s=se(18),p=se(20),m=se(27),v=se(32),S=se(39);l(15),u("menuBody",p)("pos","below"),l(),u("ngIf",o.selectedFaction)("ngIfElse",s),l(6),u("menuBody",m)("pos","below"),l(),u("ngIf",o.selectedHero)("ngIfElse",s),l(6),u("menuBody",v),l(),$("background",o.pickedColor),l(7),u("ngIf",o.selectedHero)("ngIfElse",S)}},dependencies:[z,re,Kt,ue,is,oe],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;height:100vh}.main-container[_ngcontent-%COMP%]{margin:8px;display:flex;flex-grow:1}.bottom-container[_ngcontent-%COMP%]{display:flex}.players[_ngcontent-%COMP%]{width:100%;height:200px;padding:20px;display:flex;flex-direction:column}.players-row[_ngcontent-%COMP%]{display:flex;padding:4px 0;align-items:center;font-size:13px}.players-row[_ngcontent-%COMP%] > .name[_ngcontent-%COMP%]{flex:.1 0 140px}.players-row[_ngcontent-%COMP%] > .faction[_ngcontent-%COMP%]{flex:.1 0 140px;display:flex;justify-content:center}.players-row[_ngcontent-%COMP%] > .hero[_ngcontent-%COMP%]{flex:.1 0 140px;display:flex;justify-content:center}.players-row[_ngcontent-%COMP%] > .color[_ngcontent-%COMP%]{display:flex;justify-content:center;flex:.1 0 140px}.item-icon[_ngcontent-%COMP%]{width:72px;height:42px;background-color:#545459;color:#fff;display:flex;font-size:30px;align-items:center;justify-content:center;border-radius:3px;cursor:pointer}.item-icon.hero-icon[_ngcontent-%COMP%]{background-size:cover;background-position:center center}.hero-option[_ngcontent-%COMP%]{margin:2px;cursor:pointer}.color-item[_ngcontent-%COMP%]{width:64px;height:36px;cursor:pointer}.color-item[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:2px}.icon-subtext[_ngcontent-%COMP%]{font-size:9px;text-align:center;display:block}.buttons[_ngcontent-%COMP%]{padding:20px;display:flex;margin-left:auto}.player[_ngcontent-%COMP%]{display:flex}.right-panel[_ngcontent-%COMP%]{flex:.1 0 300px;padding:10px;font-size:14px;text-align:center}.right-panel[_ngcontent-%COMP%]   .hero-description[_ngcontent-%COMP%]{padding-top:16px}.right-panel[_ngcontent-%COMP%]   .hero-description[_ngcontent-%COMP%]   .hero-icon[_ngcontent-%COMP%]{font-size:20px}.right-panel[_ngcontent-%COMP%]   .hero-description[_ngcontent-%COMP%]   .hero-stats[_ngcontent-%COMP%]{display:flex}.right-panel[_ngcontent-%COMP%]   .hero-description[_ngcontent-%COMP%]   .hero-stats[_ngcontent-%COMP%]   .column[_ngcontent-%COMP%]{font-size:13px;flex:1 0 100px;text-align:left;padding-left:53px}.right-panel[_ngcontent-%COMP%]   .hero-description[_ngcontent-%COMP%]   .description[_ngcontent-%COMP%]{font-size:12px;margin-top:8px;padding:6px 20px;border-top:1px solid gainsboro}"]});let i=e;return i})();function Gv(i,e){if(i&1){let r=R();ye(0),h(1,"mw-player-resources",3)(2,"mw-event-feed"),a(3,"div",4)(4,"mw-round-icon-btn",5),w("click",function(){A(r);let n=f();return O(n.openMainMenu())}),c()(),ve()}}function Rv(i,e){i&1&&h(0,"mw-main-screen")}function Uv(i,e){i&1&&h(0,"mw-new-game-screen")}function Bv(i,e){i&1&&h(0,"mw-gameboard")}function Hv(i,e){i&1&&h(0,"mw-structures-view")}function Lv(i,e){i&1&&h(0,"mw-town-view")}var eo=class eo extends ae(){constructor(e){super(),this.cdr=e,this.currentView=Ot.MainScreen,this.viewTypes=Ot}openMainMenu(){this.events.dispatch(Wn())}navigateToView({view:e}){this.currentView=e}initScreen(){this.events.dispatch(Pi({view:Ot.MainScreen}))}openMewGameScreen(){this.events.dispatch(Pi({view:Ot.NewGame}))}openMapStructuresScreen(){this.events.dispatch(Pi({view:Ot.Structures}))}playerAcceptsFight(){this.events.dispatch(Pi({view:Ot.Battleground})),this.cdr.detectChanges()}structIsCompleted(e){e.struct.isInactive=!0,this.events.dispatch(Pi({view:Ot.Structures})),this.events.dispatch(To({struct:e.struct}))}displayTown(){this.currentView=Ot.Town}};eo.\u0275fac=function(r){return new(r||eo)(y(di))},eo.\u0275cmp=C({type:eo,selectors:[["mw-view-control"]],features:[N],decls:7,vars:7,consts:[[4,"ngIf"],[3,"ngSwitch"],[4,"ngSwitchCase"],[1,"resources-panel"],[1,"menu-panel"],["mwActionHint","Main Menu","icon","repair",3,"click"]],template:function(r,t){r&1&&(g(0,Gv,5,0,"ng-container",0),ye(1,1),g(2,Rv,1,0,"mw-main-screen",2)(3,Uv,1,0,"mw-new-game-screen",2)(4,Bv,1,0,"mw-gameboard",2)(5,Hv,1,0,"mw-structures-view",2)(6,Lv,1,0,"mw-town-view",2),ve()),r&2&&(u("ngIf",t.viewTypes.MainScreen!==t.currentView&&t.viewTypes.NewGame!==t.currentView),l(),u("ngSwitch",t.currentView),l(),u("ngSwitchCase",t.viewTypes.MainScreen),l(),u("ngSwitchCase",t.viewTypes.NewGame),l(),u("ngSwitchCase",t.viewTypes.Battleground),l(),u("ngSwitchCase",t.viewTypes.Structures),l(),u("ngSwitchCase",t.viewTypes.Town))},dependencies:[re,hi,on,Rt,ts,Sa,En,Il,lm,Cm,hl,El],styles:[".resources-panel[_ngcontent-%COMP%]{position:fixed;left:0;top:0;display:flex;flex-direction:column;width:148px;padding:8px;z-index:1}mw-event-feed[_ngcontent-%COMP%]{position:fixed;right:50%;bottom:12%;max-width:400px;z-index:10000}.menu-panel[_ngcontent-%COMP%]{position:fixed;top:0;right:0;padding:7px}"]});var ui=eo;_([G(Pi)],ui.prototype,"navigateToView",null);_([J(Vn)],ui.prototype,"initScreen",null);_([J(Ao)],ui.prototype,"openMewGameScreen",null);_([J(Gr)],ui.prototype,"openMapStructuresScreen",null);_([J(Hn)],ui.prototype,"playerAcceptsFight",null);_([G(Vi)],ui.prototype,"structIsCompleted",null);_([J(So)],ui.prototype,"displayTown",null);var jv=["hintsContainer"];function $v(i,e){if(i&1&&h(0,"mw-action-card",3),i&2){let r=e.$implicit;u("actionCard",r)}}var wm=[ct,pi,en,vr,Yr,Ji,Zt,lt,ki,ut,rm],Sm=(()=>{let e=class e{constructor(t,n){this.hintsService=t,this.events=n,this.actionCards=[dm,mm,fm,vm,gm,Qo,hm,yn,ym],this.injectGlobalServices()}ngOnInit(){this.hintsService.containerRef=this.hintsContainer}ngAfterViewInit(){this.events.dispatch(Co())}injectGlobalServices(){wm.forEach(t=>H(t))}};e.\u0275fac=function(n){return new(n||e)(y(Nr),y(j))},e.\u0275cmp=C({type:e,selectors:[["app-root"]],viewQuery:function(n,o){if(n&1&&Pe(jv,7),n&2){let s;De(s=Ee())&&(o.hintsContainer=s.first)}},features:[xs(wm)],decls:9,vars:1,consts:[["hintsContainer",""],[1,"test",2,"display","none"],[3,"actionCard",4,"ngFor","ngForOf"],[3,"actionCard"]],template:function(n,o){n&1&&(h(0,"mw-view-control")(1,"mw-popup-container")(2,"mw-hints-container",null,0)(4,"mw-vfx-layer")(5,"mw-custom-cursor")(6,"mw-shared-templates"),a(7,"div",1),g(8,$v,1,1,"mw-action-card",2),c()),n&2&&(l(8),u("ngForOf",o.actionCards))},dependencies:[ui,Xo,as,ps,es,fa,pa,z],styles:[".test[_ngcontent-%COMP%]{position:absolute;left:100px;top:100px;display:flex;gap:12px;max-width:1000px;flex-wrap:wrap}"]});let i=e;return i})();var xm=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-action-card-stack-item"]],inputs:{cardStack:"cardStack"},decls:3,vars:7,consts:[[3,"icon"],[2,"font-weight","600"]],template:function(n,o){n&1&&(h(0,"mw-ra-icon",0),a(1,"span",1),d(2),c()),n&2&&($("color",o.cardStack.card.iconColor)("background",o.cardStack.card.bgColor),u("icon",o.cardStack.card.icon),l(2),fe("",o.cardStack.card.title," x",o.cardStack.count,""))},dependencies:[ue],styles:["[_nghost-%COMP%]{display:block}mw-ra-icon[_ngcontent-%COMP%]{margin-right:3px}"],changeDetection:0});let i=e;return i})();var Tl=(()=>{let e=class e{transform(t){return no(t)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275pipe=Ui({name:"infNum",type:e,pure:!0});let i=e;return i})();var Vv=[Zr,Tl,Gt],zv=[Fa,Sr,Oa,Aa,Rt,Ti],tH=[...zv,...Vv,Xr,Xo,Jo,xm,ma,sl,as,Kt,ha,ga,Fi,si,cr,cs,ba,ls,$r,os,Pa,_n,ps,es,us,ts,Jc,fa,rr,xn,ue,pa,la,is,or,oe,Ma,ol,Sa,ce,ss,ar,rs,wa,xa,_a,va],Ut=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ze({type:e}),e.\u0275inj=Ve({imports:[ht]});let i=e;return i})();Ae(Jo,[z,Rt,Xo,ue],[Tl]);Ae(as,[sl,_n,ue],[]);Ae(ha,[Kt],[]);Ae(Fi,[sn,ha,ga,rr,ue],[]);Ae(si,[z,re,ga,Fi,is],[]);Ae(cr,[Kt],[]);Ae(cs,[ba],[]);Ae(ba,[z,re,Sr,Kt,ls,$r,ue],[gi]);Ae($r,[fi,re,sn,cr,rr,ue],[]);Ae(os,[z,Rt,Ti],[]);Ae(ps,[_n],[]);Ae(es,[re,_n],[]);Ae(us,[z,_n],[]);Ae(ts,[z,Jc],[]);Ae(ss,[Rt,ue,or],[]);Ae(ar,[z,Rt,Ti,si,rs],[]);function Wv(i,e){i&1&&h(0,"mw-ra-icon",4)}function qv(i,e){if(i&1){let r=R();a(0,"mw-spell-button",5),w("clicked",function(){let n=A(r).$implicit,o=f();return O(o.onAbilityClick(n))}),c()}if(i&2){let r=e.$implicit,t=f();u("spell",r)("player",t.currentPlayer)("hero",t.currentPlayer.hero)("disabled",t.currentPlayer.hero.stats.currentMana<r.currentManaCost||t.curPlayerState.spellsAreOnCooldown)("isActive",t.curPlayerState.currentSpell===r)}}var Fl=(()=>{let e=class e{constructor(t,n){this.players=t,this.curPlayerState=n,this.currentPlayer=this.players.getCurrentPlayer()}onAbilityClick(t){t.currentManaCost>this.currentPlayer.hero.stats.currentMana||this.curPlayerState.spellsAreOnCooldown||this.curPlayerState.playerCurrentState!==_e.WaitsForTurn&&this.curPlayerState.onSpellClick(t)}};e.\u0275fac=function(n){return new(n||e)(y(k),y(nt))},e.\u0275cmp=C({type:e,selectors:[["mw-battle-hero-abilities"]],decls:6,vars:3,consts:[[1,"abilities-list"],[1,"cd-icon"],["icon","hourglass",4,"ngIf"],[3,"spell","player","hero","disabled","isActive","clicked",4,"ngFor","ngForOf"],["icon","hourglass"],[3,"clicked","spell","player","hero","disabled","isActive"]],template:function(n,o){n&1&&(a(0,"div"),d(1),c(),a(2,"div",0)(3,"div",1),g(4,Wv,1,0,"mw-ra-icon",2),c(),g(5,qv,1,5,"mw-spell-button",3),c()),n&2&&(l(),M(" ",o.curPlayerState.playerCurrentState,`
`),l(3),u("ngIf",o.curPlayerState.spellsAreOnCooldown),l(),u("ngForOf",o.currentPlayer.hero.spells))},styles:[".abilities-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;position:relative;width:56px}.cd-icon[_ngcontent-%COMP%]{position:absolute;top:50%;left:-27px;margin-top:-25%;font-size:24px}"]});let i=e;return i})();var Yv=["historyLog"],ka=i=>({log:i});function Qv(i,e){i&1&&ke(0)}function Kv(i,e){if(i&1&&g(0,Qv,1,0,"ng-container",8),i&2){let r=f().$implicit;f();let t=se(7);u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,ka,r))}}function Zv(i,e){i&1&&ke(0)}function Xv(i,e){if(i&1&&g(0,Zv,1,0,"ng-container",8),i&2){let r=f().$implicit;f();let t=se(13);u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,ka,r))}}function Jv(i,e){i&1&&ke(0)}function eC(i,e){if(i&1&&g(0,Jv,1,0,"ng-container",8),i&2){let r=f().$implicit;f();let t=se(11);u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,ka,r))}}function tC(i,e){i&1&&ke(0)}function iC(i,e){if(i&1&&g(0,tC,1,0,"ng-container",8),i&2){let r=f().$implicit;f();let t=se(9);u("ngTemplateOutlet",t)("ngTemplateOutletContext",Ue(2,ka,r))}}function nC(i,e){if(i&1&&(a(0,"div",7),g(1,Kv,1,4,"ng-container")(2,Xv,1,4,"ng-container")(3,eC,1,4,"ng-container")(4,iC,1,4,"ng-container"),c()),i&2){let r,t=e.$implicit,n=f();l(),pt((r=t.type)===n.types.SimpleMsg?1:r===n.types.RoundInfoMsg?2:r===n.types.DealtDamageMsg?3:r===n.types.Html?4:-1)}}function rC(i,e){if(i&1&&d(0),i&2){let r=e.log;M(" ",r.message,`
`)}}function oC(i,e){if(i&1&&(h(0,"div",9),ie(1,"safeHtml")),i&2){let r=e.log;u("innerHTML",ne(1,1,r.message),Bt)}}function sC(i,e){if(i&1&&(a(0,"div"),d(1),c()),i&2){let r=f().log;l(),M(" ",r.damageBlocked," damage was blocked ")}}function aC(i,e){if(i&1&&(a(0,"div")(1,"span"),d(2),c(),d(3),c()),i&2){let r=f().log;l(),$("color",r.attackingPlayer.color),l(),fe("",r.attackersNumber," ",r.attacker.name,""),l(),fe(" steal ",r.stolenLife," life, reviving ",r.stolenLifeUnitsRestored," units. ")}}function cC(i,e){if(i&1&&(a(0,"div")(1,"span"),d(2),c(),d(3),a(4,"span"),d(5),c(),d(6),g(7,sC,2,1,"div",10)(8,aC,4,6,"div",10),c()),i&2){let r=e.log;l(),$("color",r.attackingPlayer.color),l(),fe("",r.attackersNumber," ",r.attacker.name,""),l(),fe(" deal ",r.damage," ",r.isCritical?"critical":""," damage to "),l(),$("color",r.attackedPlayer.color),l(),fe("",r.attackedNumber," ",r.attacked.name,""),l(),M(" , killing ",r.losses," units "),l(),u("ngIf",r.damageBlocked),l(),u("ngIf",r.stolenLife)}}function lC(i,e){if(i&1&&(a(0,"div",11),d(1),c()),i&2){let r=e.log;l(),M(" ",r.message," ")}}var bm=(()=>{let e=class e{constructor(t){this.battleLogService=t,this.types=kn,this.battleLogService.historyEvent$.pipe(ns()).subscribe(()=>{let n=this.historyLogElem.nativeElement;setTimeout(()=>{n.scrollTo({top:n.scrollHeight,behavior:"smooth"})},0)})}};e.\u0275fac=function(n){return new(n||e)(y(Ii))},e.\u0275cmp=C({type:e,selectors:[["mw-history-log"]],viewQuery:function(n,o){if(n&1&&Pe(Yv,7),n&2){let s;De(s=Ee())&&(o.historyLogElem=s.first)}},decls:14,vars:0,consts:[["historyLog",""],["simple",""],["htmlLog",""],["dealtDamageLog",""],["roundInfoMsg",""],[1,"history-panel"],[1,"history-log"],[1,"entry"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"innerHTML"],[4,"ngIf"],[2,"padding","8px","text-align","center"]],template:function(n,o){n&1&&(a(0,"div",5),d(1," Battle Log: "),a(2,"div",6,0),wt(4,nC,5,1,"div",7,ei),c()(),g(6,rC,1,1,"ng-template",null,1,Y)(8,oC,2,3,"ng-template",null,2,Y)(10,cC,9,13,"ng-template",null,3,Y)(12,lC,2,1,"ng-template",null,4,Y)),n&2&&(l(4),St(o.battleLogService.history))},dependencies:[re,At,Gt],styles:[".history-log[_ngcontent-%COMP%]{height:200px;overflow-y:scroll;font-size:13px}.history-panel[_ngcontent-%COMP%]{background-color:#fff}.entry[_ngcontent-%COMP%]{margin-bottom:8px}"]});let i=e;return i})();function pC(i,e){if(i&1&&h(0,"mw-item-icon",2),i&2){let r=e.$implicit;u("item",r)("hintPos","after")}}var Al=(()=>{let e=class e{constructor(t){this.players=t}ngOnInit(){this.currentPlayer=this.players.getCurrentPlayer(),this.equippedItems=this.currentPlayer.hero.inventory.getEquippedItems()}};e.\u0275fac=function(n){return new(n||e)(y(k))},e.\u0275cmp=C({type:e,selectors:[["mw-items-panel"]],decls:2,vars:1,consts:[[1,"items-container"],[3,"item","hintPos",4,"ngFor","ngForOf"],[3,"item","hintPos"]],template:function(n,o){n&1&&(a(0,"div",0),g(1,pC,1,2,"mw-item-icon",1),c()),n&2&&(l(),u("ngForOf",o.equippedItems))},styles:[".items-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;font-size:12px}"]});let i=e;return i})();var _m=(i,e)=>({color:i,background:e});function uC(i,e){if(i&1&&(a(0,"div",3),h(1,"mw-ra-icon",4),a(2,"div",5)(3,"div"),d(4),c(),a(5,"div"),d(6),c()()(),a(7,"div",6),h(8,"mw-spell-description",7),c()),i&2){let r=f();l(),u("icon",r.icon().icon)("ngStyle",Ht(8,_m,r.icon().iconClr,r.icon().bgClr)),l(3),B(r.baseType().name),l(2),M("Level ",r.buff().currentLevel,""),l(2),u("ownerUnit",r.ownerUnit())("hero",r.ownerUnit().ownerPlayer.hero)("player",r.ownerUnit().ownerPlayer)("spell",r.buff())}}var Ol=(()=>{let e=class e{constructor(){this.buff=ee.required(),this.ownerUnit=ee.required(),this.hintPos=ee("above"),this.baseType=Be(()=>this.buff().baseType),this.icon=Be(()=>this.baseType().icon)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-unit-group-buff"]],inputs:{buff:[1,"buff"],ownerUnit:[1,"ownerUnit"],hintPos:[1,"hintPos"]},decls:4,vars:7,consts:[["buffHint",""],[3,"hintBody","hintPos"],[1,"buff-icon",3,"icon","ngStyle"],[2,"display","flex"],[1,"hint-icon",3,"icon","ngStyle"],[2,"padding","4px","font-size","14px"],[2,"padding","4px","font-size","13px","max-width","240px"],[3,"ownerUnit","hero","player","spell"]],template:function(n,o){if(n&1&&(a(0,"mw-hover-hint",1),h(1,"mw-ra-icon",2),c(),g(2,uC,9,11,"ng-template",null,0,Y)),n&2){let s=se(3);u("hintBody",s)("hintPos",o.hintPos()),l(),u("icon",o.icon().icon)("ngStyle",Ht(4,_m,o.icon().iconClr,o.icon().bgClr))}},styles:[".buff-icon[_ngcontent-%COMP%]{display:block;font-size:24px;border-radius:50%;margin:4px;text-align:center;font-size:18px;width:20px;height:20px}.hint-icon[_ngcontent-%COMP%]{width:38px;font-size:30px;text-align:center;padding-top:5px}"],changeDetection:0});let i=e;return i})();var kl=(()=>{let e=class e{constructor(){this.curPlayerState=H(nt),this.spell=ee.required(),this.owner=ee.required(),this.hero=ee(),this.currentUnit=ee(),this.onCooldown=ee(),this.hintPos=ee("above"),this.baseType=Be(()=>this.spell().baseType),this.icon=Be(()=>this.baseType().icon),this.isPassive=Be(()=>this.baseType().activationType===I.Passive),this.disabled=Be(()=>this.currentUnit()!==this.owner()&&!this.isPassive())}onSpellClick(t){t.stopPropagation(),!(this.onCooldown()||this.disabled()||!this.owner().fightInfo.isAlive||this.isPassive())&&this.curPlayerState.playerCurrentState!==_e.WaitsForTurn&&this.curPlayerState.onSpellClick(this.spell(),this.owner())}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=C({type:e,selectors:[["mw-unit-group-spell"]],inputs:{spell:[1,"spell"],owner:[1,"owner"],hero:[1,"hero"],currentUnit:[1,"currentUnit"],onCooldown:[1,"onCooldown"],hintPos:[1,"hintPos"]},decls:1,vars:6,consts:[[3,"click","disabled","owner","hintPos","hero","onCooldown","spell"]],template:function(n,o){n&1&&(a(0,"mw-unit-group-spell-icon",0),w("click",function(p){return o.onSpellClick(p)}),c()),n&2&&u("disabled",o.disabled())("owner",o.owner())("hintPos",o.hintPos())("hero",o.hero())("onCooldown",o.onCooldown())("spell",o.spell())},changeDetection:0});let i=e;return i})();var Ga=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ze({type:e}),e.\u0275inj=Ve({imports:[Ut,ht]});let i=e;return i})();Ae(Fl,[ue,z,re,fs],[]);Ae(En,[Oa,Aa,Rt,Ti,xn,or,fi,z,Fl,bm,Al,ys],[gi]);Ae(Al,[Fi,z],[]);Ae(fs,[cr,rr,ue,sn],[]);Ae(ys,[Sr,ls,us,ue,Ma,fi,z,re,Ol,kl],[gi]);Ae(Ol,[cr,rr,ue,sn],[]);Ae(kl,[$r],[]);var Mm=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ze({type:e}),e.\u0275inj=Ve({imports:[ht,Ut]});let i=e;return i})();var Pm=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ze({type:e}),e.\u0275inj=Ve({imports:[ht,Ut]});let i=e;return i})();var Dm=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ze({type:e}),e.\u0275inj=Ve({imports:[ht,Ut]});let i=e;return i})();var Em=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ze({type:e}),e.\u0275inj=Ve({imports:[ht,Ut]});let i=e;return i})();var Im=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ze({type:e}),e.\u0275inj=Ve({imports:[ht,Ut,Ga,Mm,Dm,Pm,Em]});let i=e;return i})();var Gl=class extends Pr{constructor(){super(...arguments),this.feed=H(Xi)}handleError(e){console.error(e),!e.message.startsWith("NG")&&this.feed.pushSystemError(e)}},Tm=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=ze({type:e,bootstrap:[Sm]}),e.\u0275inj=Ve({providers:[{provide:Pr,useClass:Gl}],imports:[Ga,Im,Ut,Kp]});let i=e;return i})();var Fm={production:!0};Fm.production&&void 0;Qp().bootstrapModule(Tm).catch(i=>console.error(i));
